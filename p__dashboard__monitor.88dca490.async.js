(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7567],{90829:function(Mt,J,N){"use strict";var ue=N(67294),ye=N(83280),m=N(23185),ve=N(4322),j=N(24770),le=N(89182),se=function(ae,tt){var Le={};for(var it in ae)Object.prototype.hasOwnProperty.call(ae,it)&&tt.indexOf(it)<0&&(Le[it]=ae[it]);if(ae!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Vt=0,it=Object.getOwnPropertySymbols(ae);Vt<it.length;Vt++)tt.indexOf(it[Vt])<0&&Object.prototype.propertyIsEnumerable.call(ae,it[Vt])&&(Le[it[Vt]]=ae[it[Vt]]);return Le},Ne=(0,ue.forwardRef)(function(ae,tt){var Le=ae.chartRef,it=ae.style,Vt=it===void 0?{height:"inherit"}:it,sr=ae.className,At=ae.loading,er=ae.loadingTemplate,It=ae.errorTemplate,lt=se(ae,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),dt=(0,m.Z)(ye.TZ,lt),tr=dt.chart,Y=dt.container;return(0,ue.useEffect)(function(){(0,ve.J)(Le,tr.current)},[tr.current]),(0,ue.useImperativeHandle)(tt,function(){return{getChart:function(){return tr.current}}}),ue.createElement(j.Z,{errorTemplate:It},At&&ue.createElement(le.Z,{loadingTemplate:er,theme:ae.theme}),ue.createElement("div",{className:sr,style:Vt,ref:Y}))});J.Z=Ne},93343:function(Mt,J,N){"use strict";var ue=N(67294),ye=N(83280),m=N(23185),ve=N(4322),j=N(24770),le=N(89182),se=function(ae,tt){var Le={};for(var it in ae)Object.prototype.hasOwnProperty.call(ae,it)&&tt.indexOf(it)<0&&(Le[it]=ae[it]);if(ae!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Vt=0,it=Object.getOwnPropertySymbols(ae);Vt<it.length;Vt++)tt.indexOf(it[Vt])<0&&Object.prototype.propertyIsEnumerable.call(ae,it[Vt])&&(Le[it[Vt]]=ae[it[Vt]]);return Le},Ne=(0,ue.forwardRef)(function(ae,tt){var Le=ae.chartRef,it=ae.style,Vt=it===void 0?{height:"inherit"}:it,sr=ae.className,At=ae.loading,er=ae.loadingTemplate,It=ae.errorTemplate,lt=se(ae,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),dt=(0,m.Z)(ye.m,lt),tr=dt.chart,Y=dt.container;return(0,ue.useEffect)(function(){(0,ve.J)(Le,tr.current)},[tr.current]),(0,ue.useImperativeHandle)(tt,function(){return{getChart:function(){return tr.current}}}),ue.createElement(j.Z,{errorTemplate:It},At&&ue.createElement(le.Z,{loadingTemplate:er,theme:ae.theme}),ue.createElement("div",{className:sr,style:Vt,ref:Y}))});J.Z=Ne},64335:function(Mt,J,N){"use strict";var ue=N(67294),ye=(0,ue.createContext)({});J.Z=ye},21349:function(Mt,J,N){"use strict";var ue=N(84305),ye=N(75901),m=N(94184),ve=N.n(m),j=N(67294),le=N(64335),se=N(53645),Ne=N.n(se),ae=function(Le){var it=(0,j.useContext)(le.Z),Vt=Le.children,sr=Le.contentWidth,At=Le.className,er=Le.style,It=(0,j.useContext)(ye.ZP.ConfigContext),lt=It.getPrefixCls,dt=Le.prefixCls||lt("pro"),tr=sr||it.contentWidth,Y="".concat(dt,"-grid-content");return j.createElement("div",{className:ve()(Y,At,{wide:tr==="Fixed"}),style:er},j.createElement("div",{className:"".concat(dt,"-grid-content-children")},Vt))};J.Z=ae},66213:function(Mt,J,N){"use strict";N.d(J,{Z:function(){return m}});var ue=N(77608);function ye(ve,j){for(;!Object.prototype.hasOwnProperty.call(ve,j)&&(ve=(0,ue.Z)(ve),ve!==null););return ve}function m(){return typeof Reflect!="undefined"&&Reflect.get?m=Reflect.get:m=function(j,le,se){var Ne=ye(j,le);if(!!Ne){var ae=Object.getOwnPropertyDescriptor(Ne,le);return ae.get?ae.get.call(arguments.length<3?j:se):ae.value}},m.apply(this,arguments)}},31795:function(Mt,J,N){var ue=N(75752);Mt.exports.geometry=ye,Mt.exports.ring=ve;function ye(le){var se=0,Ne;switch(le.type){case"Polygon":return m(le.coordinates);case"MultiPolygon":for(Ne=0;Ne<le.coordinates.length;Ne++)se+=m(le.coordinates[Ne]);return se;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Ne=0;Ne<le.geometries.length;Ne++)se+=ye(le.geometries[Ne]);return se}}function m(le){var se=0;if(le&&le.length>0){se+=Math.abs(ve(le[0]));for(var Ne=1;Ne<le.length;Ne++)se-=Math.abs(ve(le[Ne]))}return se}function ve(le){var se,Ne,ae,tt,Le,it,Vt,sr=0,At=le.length;if(At>2){for(Vt=0;Vt<At;Vt++)Vt===At-2?(tt=At-2,Le=At-1,it=0):Vt===At-1?(tt=At-1,Le=0,it=1):(tt=Vt,Le=Vt+1,it=Vt+2),se=le[tt],Ne=le[Le],ae=le[it],sr+=(j(ae[0])-j(se[0]))*Math.sin(j(Ne[1]));sr=sr*ue.RADIUS*ue.RADIUS/2}return sr}function j(le){return le*Math.PI/180}},38163:function(Mt,J,N){var ue=N(31795);Mt.exports=ye;function ye(Ne,ae){switch(Ne&&Ne.type||null){case"FeatureCollection":return Ne.features=Ne.features.map(m(ye,ae)),Ne;case"GeometryCollection":return Ne.geometries=Ne.geometries.map(m(ye,ae)),Ne;case"Feature":return Ne.geometry=ye(Ne.geometry,ae),Ne;case"Polygon":case"MultiPolygon":return ve(Ne,ae);default:return Ne}}function m(Ne,ae){return function(tt){return Ne(tt,ae)}}function ve(Ne,ae){return Ne.type==="Polygon"?Ne.coordinates=j(Ne.coordinates,ae):Ne.type==="MultiPolygon"&&(Ne.coordinates=Ne.coordinates.map(m(j,ae))),Ne}function j(Ne,ae){ae=!!ae,Ne[0]=le(Ne[0],ae);for(var tt=1;tt<Ne.length;tt++)Ne[tt]=le(Ne[tt],!ae);return Ne}function le(Ne,ae){return se(Ne)===ae?Ne:Ne.reverse()}function se(Ne){return ue.ring(Ne)>=0}},70499:function(Mt){Mt.exports={activeChart:"activeChart___15gpK",activeChartGrid:"activeChartGrid___3PL4c",activeChartLegend:"activeChartLegend___2Ieyc",dashedLine:"dashedLine___2fgZX",line:"line___2cxqk"}},19134:function(Mt){Mt.exports={mapChart:"mapChart___4fQJB",pieCard:"pieCard___1ETZj"}},53645:function(){},27993:function(Mt,J,N){"use strict";N.r(J),N.d(J,{default:function(){return S4}});var ue={};N.r(ue),N.d(ue,{add:function(){return Cl},adjoint:function(){return Qr},clone:function(){return Pr},copy:function(){return ut},create:function(){return gr},determinant:function(){return Nn},equals:function(){return Fi},exactEquals:function(){return gn},frob:function(){return Ro},fromQuat:function(){return Oo},fromQuat2:function(){return po},fromRotation:function(){return qr},fromRotationTranslation:function(){return zi},fromRotationTranslationScale:function(){return Ka},fromRotationTranslationScaleOrigin:function(){return ns},fromScaling:function(){return ai},fromTranslation:function(){return yi},fromValues:function(){return Gt},fromXRotation:function(){return sn},fromYRotation:function(){return Qn},fromZRotation:function(){return hi},frustum:function(){return is},getRotation:function(){return us},getScaling:function(){return Di},getTranslation:function(){return go},identity:function(){return Zr},invert:function(){return Rr},lookAt:function(){return ii},mul:function(){return Ce},multiply:function(){return Xt},multiplyScalar:function(){return Ut},multiplyScalarAndAdd:function(){return bt},ortho:function(){return ra},orthoNO:function(){return Zo},orthoZO:function(){return cs},perspective:function(){return ls},perspectiveFromFieldOfView:function(){return _i},perspectiveNO:function(){return Uo},perspectiveZO:function(){return yo},rotate:function(){return Xr},rotateX:function(){return Er},rotateY:function(){return Hr},rotateZ:function(){return Yr},scale:function(){return dn},set:function(){return Ar},str:function(){return ga},sub:function(){return ie},subtract:function(){return we},targetTo:function(){return Ui},translate:function(){return ir},transpose:function(){return pr}});var ye=N(58024),m=N(39144),ve=N(13062),j=N(71230),le=N(89032),se=N(15746),Ne=N(95300),ae=N(7277),tt=N(25377),Le=N(67294),it=N(83280),Vt=N(23185),sr=N(4322),At=N(24770),er=N(89182),It=function(e,i){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r},lt=(0,Le.forwardRef)(function(e,i){var r=e.chartRef,n=e.style,a=n===void 0?{height:"inherit"}:n,s=e.className,p=e.loading,v=e.loadingTemplate,g=e.errorTemplate,x=It(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),C=(0,Vt.Z)(it.aC,x),w=C.chart,O=C.container;return(0,Le.useEffect)(function(){(0,sr.J)(r,w.current)},[w.current]),(0,Le.useImperativeHandle)(i,function(){return{getChart:function(){return w.current}}}),Le.createElement(At.Z,{errorTemplate:g},p&&Le.createElement(er.Z,{loadingTemplate:v,theme:e.theme}),Le.createElement("div",{className:s,style:a,ref:O}))}),dt=lt,tr=function(e,i){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r},Y=(0,Le.forwardRef)(function(e,i){var r=e.chartRef,n=e.style,a=n===void 0?{height:"inherit"}:n,s=e.className,p=e.loading,v=e.loadingTemplate,g=e.errorTemplate,x=tr(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),C=(0,Vt.Z)(it.kB,x),w=C.chart,O=C.container;return(0,Le.useEffect)(function(){(0,sr.J)(r,w.current)},[w.current]),(0,Le.useImperativeHandle)(i,function(){return{getChart:function(){return w.current}}}),Le.createElement(At.Z,{errorTemplate:g},p&&Le.createElement(er.Z,{loadingTemplate:v,theme:e.theme}),Le.createElement("div",{className:s,style:a,ref:O}))}),$t=Y,gt=function(e,i){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)i.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r},Je=(0,Le.forwardRef)(function(e,i){var r=e.chartRef,n=e.style,a=n===void 0?{height:"inherit"}:n,s=e.className,p=e.loading,v=e.loadingTemplate,g=e.errorTemplate,x=gt(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),C=(0,Vt.Z)(it.Kj,x),w=C.chart,O=C.container;return(0,Le.useEffect)(function(){(0,sr.J)(r,w.current)},[w.current]),(0,Le.useImperativeHandle)(i,function(){return{getChart:function(){return w.current}}}),Le.createElement(At.Z,{errorTemplate:g},p&&Le.createElement(er.Z,{loadingTemplate:v,theme:e.theme}),Le.createElement("div",{className:s,style:a,ref:O}))}),xt=Je,Qe=N(90829),Kt=N(21349),Sr=N(92077),Br=N.n(Sr),Jr=N(2824),Te=N(3182),Xe=N(69610),ke=N(54941),St=N(81306),vt=N(19809),zt=N(94043),Yt=N.n(zt),Cr=(0,Le.createContext)({});function Yn(){return(0,Le.useContext)(Cr)}var hn={},Ki={},Zn=function(i){return Ki[i]},Wn=function(i,r){Ki[i]=r},mi=function(i){return hn[i]},qn=function(i,r){hn[i]=r},ui={},ia={},ki=34,Ai=10,Vi=13;function sa(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function wi(e,i){var r=sa(e);return function(n,a){return i(r(n),a,e)}}function Ca(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var a in n)a in i||r.push(i[a]=a)}),r}function Mn(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function Ei(e){return e<0?"-"+Mn(-e,6):e>9999?"+"+Mn(e,6):Mn(e,4)}function Zi(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),a=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Ei(e.getUTCFullYear(),4)+"-"+Mn(e.getUTCMonth()+1,2)+"-"+Mn(e.getUTCDate(),2)+(a?"T"+Mn(i,2)+":"+Mn(r,2)+":"+Mn(n,2)+"."+Mn(a,3)+"Z":n?"T"+Mn(i,2)+":"+Mn(r,2)+":"+Mn(n,2)+"Z":r||i?"T"+Mn(i,2)+":"+Mn(r,2)+"Z":"")}function $i(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(w,O){var D,G,q=a(w,function(te,Se){if(D)return D(te,Se-1);G=te,D=O?wi(te,O):sa(te)});return q.columns=G||[],q}function a(w,O){var D=[],G=w.length,q=0,te=0,Se,ze=G<=0,$e=!1;w.charCodeAt(G-1)===Ai&&--G,w.charCodeAt(G-1)===Vi&&--G;function at(){if(ze)return ia;if($e)return $e=!1,ui;var Tt,Jt=q,fr;if(w.charCodeAt(Jt)===ki){for(;q++<G&&w.charCodeAt(q)!==ki||w.charCodeAt(++q)===ki;);return(Tt=q)>=G?ze=!0:(fr=w.charCodeAt(q++))===Ai?$e=!0:fr===Vi&&($e=!0,w.charCodeAt(q)===Ai&&++q),w.slice(Jt+1,Tt-1).replace(/""/g,'"')}for(;q<G;){if((fr=w.charCodeAt(Tt=q++))===Ai)$e=!0;else if(fr===Vi)$e=!0,w.charCodeAt(q)===Ai&&++q;else if(fr!==r)continue;return w.slice(Jt,Tt)}return ze=!0,w.slice(Jt,G)}for(;(Se=at())!==ia;){for(var Et=[];Se!==ui&&Se!==ia;)Et.push(Se),Se=at();O&&(Et=O(Et,te++))==null||D.push(Et)}return D}function s(w,O){return w.map(function(D){return O.map(function(G){return C(D[G])}).join(e)})}function p(w,O){return O==null&&(O=Ca(w)),[O.map(C).join(e)].concat(s(w,O)).join(`
`)}function v(w,O){return O==null&&(O=Ca(w)),s(w,O).join(`
`)}function g(w){return w.map(x).join(`
`)}function x(w){return w.map(C).join(e)}function C(w){return w==null?"":w instanceof Date?Zi(w):i.test(w+="")?'"'+w.replace(/"/g,'""')+'"':w}return{parse:n,parseRows:a,format:p,formatBody:v,formatRows:g,formatRow:x,formatValue:C}}var Wa=$i(","),de=Wa.parse,Fn=Wa.parseRows,Xa=Wa.format,vs=Wa.formatBody,jt=Wa.formatRows,or=Wa.formatRow,Mr=Wa.formatValue,I=N(96156),ar=N(85061),kn=N(38163),li=N.n(kn);function jn(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function an(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?jn(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jn(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Pi(e,i){var r=i.x,n=i.y,a=i.x1,s=i.y1,p=i.coordinates,v=[];return Array.isArray(e)?(e.forEach(function(g,x){var C=[];if(r&&n&&(C=[parseFloat(g[r]),parseFloat(g[n])]),r&&n&&a&&s){var w=[parseFloat(g[r]),parseFloat(g[n])],O=[parseFloat(g[a]),parseFloat(g[s])];C=[w,O]}if(p){var D="Polygon";Array.isArray(p[0])||(D="Point"),Array.isArray(p[0])&&!Array.isArray(p[0][0])&&(D="LineString");var G={type:D,coordinates:(0,ar.Z)(g[p])};li()(G,!0),C=G.coordinates}var q=an(an({},g),{},{_id:x,coordinates:C});v.push(q)}),{dataArray:v}):{dataArray:[]}}var Ii=[{lng1:100,lat1:30,lng2:130,lat2:30}],Ja={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function ms(e,i){var r=de(e);return Pi(r,i)}var xa=63710088e-1,ka={centimeters:xa*100,centimetres:xa*100,degrees:xa/111325,feet:xa*3.28084,inches:xa*39.37,kilometers:xa/1e3,kilometres:xa/1e3,meters:xa,metres:xa,miles:xa/1609.344,millimeters:xa*1e3,millimetres:xa*1e3,nauticalmiles:xa/1852,radians:1,yards:xa*1.0936},Ma={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/xa,yards:1.0936133},H={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function $(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function re(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return ge(i).geometry;case"LineString":return ce(i).geometry;case"Polygon":return Ge(i).geometry;case"MultiPoint":return Dt(i).geometry;case"MultiLineString":return mr(i).geometry;case"MultiPolygon":return Bt(i).geometry;default:throw new Error(e+" is invalid")}}function ge(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ea(e[0])||!ea(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return $(n,i,r)}function Ie(e,i,r){return r===void 0&&(r={}),mt(e.map(function(n){return ge(n,i)}),r)}function Ge(e,i,r){r===void 0&&(r={});for(var n=0,a=e;n<a.length;n++){var s=a[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var p=0;p<s[s.length-1].length;p++)if(s[s.length-1][p]!==s[0][p])throw new Error("First and last Position are not equivalent.")}var v={type:"Polygon",coordinates:e};return $(v,i,r)}function rt(e,i,r){return r===void 0&&(r={}),mt(e.map(function(n){return Ge(n,i)}),r)}function ce(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return $(n,i,r)}function De(e,i,r){return r===void 0&&(r={}),mt(e.map(function(n){return ce(n,i)}),r)}function mt(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function mr(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return $(n,i,r)}function Dt(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return $(n,i,r)}function Bt(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return $(n,i,r)}function yr(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return $(n,i,r)}function En(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function cn(e,i){i===void 0&&(i="kilometers");var r=ka[i];if(!r)throw new Error(i+" units is invalid");return e*r}function Pt(e,i){i===void 0&&(i="kilometers");var r=ka[i];if(!r)throw new Error(i+" units is invalid");return e/r}function un(e,i){return Wr(Pt(e,i))}function Gr(e){var i=e%360;return i<0&&(i+=360),i}function Wr(e){var i=e%(2*Math.PI);return i*180/Math.PI}function oi(e){var i=e%360;return i*Math.PI/180}function rn(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return cn(Pt(e,i),r)}function Ti(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=H[i];if(!n)throw new Error("invalid original units");var a=H[r];if(!a)throw new Error("invalid final units");return e/n*a}function ea(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function bi(e){return!!e&&e.constructor===Object}function Oi(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!ea(i))throw new Error("bbox must only contain numbers")})}function Si(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function ri(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Xi(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Da(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Da(e[0]);throw new Error("coordinates must only contain numbers")}function aa(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function Ri(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function Gi(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,a=e.features;n<a.length;n++){var s=a[n];if(!s||s.type!=="Feature"||!s.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!s.geometry||s.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+s.geometry.type)}}function za(e){return e.type==="Feature"?e.geometry:e}function su(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function Pa(e,i,r){if(e!==null)for(var n,a,s,p,v,g,x,C=0,w=0,O,D=e.type,G=D==="FeatureCollection",q=D==="Feature",te=G?e.features.length:1,Se=0;Se<te;Se++){x=G?e.features[Se].geometry:q?e.geometry:e,O=x?x.type==="GeometryCollection":!1,v=O?x.geometries.length:1;for(var ze=0;ze<v;ze++){var $e=0,at=0;if(p=O?x.geometries[ze]:x,p!==null){g=p.coordinates;var Et=p.type;switch(C=r&&(Et==="Polygon"||Et==="MultiPolygon")?1:0,Et){case null:break;case"Point":if(i(g,w,Se,$e,at)===!1)return!1;w++,$e++;break;case"LineString":case"MultiPoint":for(n=0;n<g.length;n++){if(i(g[n],w,Se,$e,at)===!1)return!1;w++,Et==="MultiPoint"&&$e++}Et==="LineString"&&$e++;break;case"Polygon":case"MultiLineString":for(n=0;n<g.length;n++){for(a=0;a<g[n].length-C;a++){if(i(g[n][a],w,Se,$e,at)===!1)return!1;w++}Et==="MultiLineString"&&$e++,Et==="Polygon"&&at++}Et==="Polygon"&&$e++;break;case"MultiPolygon":for(n=0;n<g.length;n++){for(at=0,a=0;a<g[n].length;a++){for(s=0;s<g[n][a].length-C;s++){if(i(g[n][a][s],w,Se,$e,at)===!1)return!1;w++}at++}$e++}break;case"GeometryCollection":for(n=0;n<p.geometries.length;n++)if(Pa(p.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Ia(e,i,r,n){var a=r;return Pa(e,function(s,p,v,g,x){p===0&&r===void 0?a=s:a=i(a,s,p,v,g,x)},n),a}function As(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function gs(e,i,r){var n=r;return As(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function ta(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function Yu(e,i,r){var n=r;return ta(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function _o(e){var i=[];return Pa(e,function(r){i.push(r)}),i}function Ua(e,i){var r,n,a,s,p,v,g,x,C,w,O=0,D=e.type==="FeatureCollection",G=e.type==="Feature",q=D?e.features.length:1;for(r=0;r<q;r++){for(v=D?e.features[r].geometry:G?e.geometry:e,x=D?e.features[r].properties:G?e.properties:{},C=D?e.features[r].bbox:G?e.bbox:void 0,w=D?e.features[r].id:G?e.id:void 0,g=v?v.type==="GeometryCollection":!1,p=g?v.geometries.length:1,a=0;a<p;a++){if(s=g?v.geometries[a]:v,s===null){if(i(null,O,x,C,w)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(s,O,x,C,w)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<s.geometries.length;n++)if(i(s.geometries[n],O,x,C,w)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}O++}}function so(e,i,r){var n=r;return Ua(e,function(a,s,p,v,g){s===0&&r===void 0?n=a:n=i(n,a,s,p,v,g)}),n}function Qi(e,i){Ua(e,function(r,n,a,s,p){var v=r===null?null:r.type;switch(v){case null:case"Point":case"LineString":case"Polygon":return i($(r,a,{bbox:s,id:p}),n,0)===!1?!1:void 0}var g;switch(v){case"MultiPoint":g="Point";break;case"MultiLineString":g="LineString";break;case"MultiPolygon":g="Polygon";break}for(var x=0;x<r.coordinates.length;x++){var C=r.coordinates[x],w={type:g,coordinates:C};if(i($(w,a),n,x)===!1)return!1}})}function qo(e,i,r){var n=r;return Qi(e,function(a,s,p){s===0&&p===0&&r===void 0?n=a:n=i(n,a,s,p)}),n}function Ko(e,i){Qi(e,function(r,n,a){var s=0;if(!!r.geometry){var p=r.geometry.type;if(!(p==="Point"||p==="MultiPoint")){var v,g=0,x=0,C=0;if(Pa(r,function(w,O,D,G,q){if(v===void 0||n>g||G>x||q>C){v=w,g=n,x=G,C=q,s=0;return}var te=lineString([v,w],r.properties);if(i(te,n,a,q,s)===!1)return!1;s++,v=w})===!1)return!1}}})}function qu(e,i,r){var n=r,a=!1;return Ko(e,function(s,p,v,g,x){a===!1&&r===void 0?n=s:n=i(n,s,p,v,g,x),a=!0}),n}function Ao(e,i){if(!e)throw new Error("geojson is required");Qi(e,function(r,n,a){if(r.geometry!==null){var s=r.geometry.type,p=r.geometry.coordinates;switch(s){case"LineString":if(i(r,n,a,0,0)===!1)return!1;break;case"Polygon":for(var v=0;v<p.length;v++)if(i(lineString(p[v],r.properties),n,a,v)===!1)return!1;break}}})}function $o(e,i,r){var n=r;return Ao(e,function(a,s,p,v){s===0&&r===void 0?n=a:n=i(n,a,s,p,v)}),n}function ba(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.segmentIndex||0,p=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),p=p||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":p=p||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var g=v.coordinates;switch(v.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=g.length+s-1),lineString([g[s],g[s+1]],p,i);case"Polygon":return a<0&&(a=g.length+a),s<0&&(s=g[a].length+s-1),lineString([g[a][s],g[a][s+1]],p,i);case"MultiLineString":return n<0&&(n=g.length+n),s<0&&(s=g[n].length+s-1),lineString([g[n][s],g[n][s+1]],p,i);case"MultiPolygon":return n<0&&(n=g.length+n),a<0&&(a=g[n].length+a),s<0&&(s=g[n][a].length-s-1),lineString([g[n][a][s],g[n][a][s+1]],p,i)}throw new Error("geojson is invalid")}function xo(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.coordIndex||0,p=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),p=p||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":p=p||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var g=v.coordinates;switch(v.type){case"Point":return point(g,p,i);case"MultiPoint":return n<0&&(n=g.length+n),point(g[n],p,i);case"LineString":return s<0&&(s=g.length+s),point(g[s],p,i);case"Polygon":return a<0&&(a=g.length+a),s<0&&(s=g[a].length+s),point(g[a][s],p,i);case"MultiLineString":return n<0&&(n=g.length+n),s<0&&(s=g[n].length+s),point(g[n][s],p,i);case"MultiPolygon":return n<0&&(n=g.length+n),a<0&&(a=g[n].length+a),s<0&&(s=g[n][a].length-s),point(g[n][a][s],p,i)}throw new Error("geojson is invalid")}function Qo(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function uo(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Qo(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function uu(e,i){var r=[],n={};if(!e.features)return e.features=[],{dataArray:[]};if(e.features=e.features.filter(function(s){var p=s.geometry;return s!=null&&p&&p.type&&p.coordinates&&p.coordinates.length>0}),li()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:n};var a=0;return Qi(e,function(s,p){var v=Xi(s),g=p,x=uo(uo({},s.properties),{},{coordinates:v,_id:g});r.push(x)}),{dataArray:r,featureKeys:n}}function Ac(e){var i=131,r=137,n=0;e+="x";for(var a=Math.floor(9007199254740991/r),s=0;s<e.length;s++)n>a&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(s);return n}function Fs(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}var Q=N(28481),Ee="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Ke(e){this.message=e}Ke.prototype=new Error,Ke.prototype.name="InvalidCharacterError";function kt(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new Ke("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",n=0,a,s,p=0;s=i.charAt(p++);~s&&(a=n%4?a*64+s:s,n++%4)?r+=String.fromCharCode(255&a>>(-2*n&6)):0)s=Ee.indexOf(s);return r}function Fr(e){e=String(e);for(var i,r,n,a,s="",p=0,v=e.length%3;p<e.length;){if((r=e.charCodeAt(p++))>255||(n=e.charCodeAt(p++))>255||(a=e.charCodeAt(p++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=r<<16|n<<8|a,s+=Ee.charAt(i>>18&63)+Ee.charAt(i>>12&63)+Ee.charAt(i>>6&63)+Ee.charAt(i&63)}return v?s.slice(0,v-3)+"===".substring(v):s}var ot=N(6610),wt=N(5991),lo=function(){function e(i,r){(0,ot.Z)(this,e),this.buffers=i,this.type=r}return(0,wt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,n,a){throw new Error("not implemented")}}]),e}(),Ji;typeof window=="undefined"?Ji={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Ji=window;var Ya=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Jo=Ya?my.getSystemInfoSync().pixelRatio:Ji.devicePixelRatio,en=N(10379),$r=N(46070),Rt=N(77608),Vo=(0,wt.Z)(function e(i,r){(0,ot.Z)(this,e),(0,I.Z)(this,"cancelBubble",void 0),(0,I.Z)(this,"cancelable",void 0),(0,I.Z)(this,"target",void 0),(0,I.Z)(this,"currentTarget",void 0),(0,I.Z)(this,"preventDefault",void 0),(0,I.Z)(this,"stopPropagation",void 0),(0,I.Z)(this,"type",void 0),(0,I.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()}),he=N(63349);function Js(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=lu(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function lu(e,i){if(!!e){if(typeof e=="string")return ys(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ys(e,i)}}function ys(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var oa=new WeakMap,bo=function(){function e(){(0,ot.Z)(this,e),oa.set(this,{})}return(0,wt.Z)(e,[{key:"addEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=oa.get(this);s||(s={}),s[r]||(s[r]=[]),s[r].push(n),oa.set(this,s),a.capture,a.once,a.passive}},{key:"removeEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=oa.get(this);if(s){var p=s[r];if(p&&p.length>0){for(var v=p.length;v--;v>0)if(p[v]===n){p.splice(v,1);break}}}}},{key:"dispatchEvent",value:function(r){var n=oa.get(this)[r.type];if(n){var a=Js(n),s;try{for(a.s();!(s=a.n()).done;){var p=s.value;p(r)}}catch(v){a.e(v)}finally{a.f()}}}}]),e}();function Kl(e){var i=wc();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function wc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ku=function(e){(0,en.Z)(r,e);var i=Kl(r);function r(){var n;return(0,ot.Z)(this,r),n=i.call(this),(0,I.Z)((0,he.Z)(n),"childNodes",void 0),n.childNodes=[],n}return(0,wt.Z)(r,[{key:"appendChild",value:function(a){this.childNodes.push(a)}},{key:"cloneNode",value:function(){var a=Object.create(this);return Object.assign(a,this),a}},{key:"removeChild",value:function(a){var s=this.childNodes.findIndex(function(p){return p===a});return s>-1?this.childNodes.splice(s,1):null}}]),r}(bo);function Tc(e){var i=Ml();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function Ml(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $u=function(e){(0,en.Z)(r,e);var i=Tc(r);function r(){var n;return(0,ot.Z)(this,r),n=i.call(this),(0,I.Z)((0,he.Z)(n),"className",void 0),(0,I.Z)((0,he.Z)(n),"children",void 0),n.className="",n.children=[],n}return(0,wt.Z)(r,[{key:"setAttribute",value:function(a,s){this[a]=s}},{key:"getAttribute",value:function(a){return this[a]}},{key:"setAttributeNS",value:function(a,s){this[a]=s}},{key:"getAttributeNS",value:function(a){return this[a]}}]),r}(Ku),cu=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Qu,_,T,F;if(cu){var R=my.getSystemInfoSync();Qu=R.screenWidth,_=R.screenHeight,T=R.windowWidth,F=R.windowHeight}else{var K=Ji.innerWidth,xe=Ji.innerHeight;Qu=K,_=xe,T=K,F=xe}var We={width:Qu,height:_,availWidth:T,availHeight:F,availLeft:0,availTop:0},ct=We.availWidth,ht=We.availHeight,cr={style:[]};function xr(e,i){if(!("parentNode"in e)){var r;i===0?r=function(){return null}:i===1?r=function(){return cr}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return cr}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function Rn(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:ct+"px",height:ht+"px",margin:"0px",padding:"0px"})}function ci(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=ct,e.clientHeight=ht),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function Jn(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=ct,e.offsetHeight=ht)}function Yi(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=ct,e.scrollHeight=ht)}function ha(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function La(e){var i=Hi();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function Hi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Fo(){}var ws=function(e){(0,en.Z)(r,e);var i=La(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=arguments.length>1?arguments[1]:void 0;return(0,ot.Z)(this,r),n=i.call(this),(0,I.Z)((0,he.Z)(n),"className",void 0),(0,I.Z)((0,he.Z)(n),"children",void 0),(0,I.Z)((0,he.Z)(n),"focus",void 0),(0,I.Z)((0,he.Z)(n),"blur",void 0),(0,I.Z)((0,he.Z)(n),"insertBefore",void 0),(0,I.Z)((0,he.Z)(n),"appendChild",void 0),(0,I.Z)((0,he.Z)(n),"removeChild",void 0),(0,I.Z)((0,he.Z)(n),"remove",void 0),(0,I.Z)((0,he.Z)(n),"innerHTML",void 0),(0,I.Z)((0,he.Z)(n),"tagName",void 0),n.className="",n.children=[],n.focus=Fo,n.blur=Fo,n.insertBefore=Fo,n.appendChild=Fo,n.removeChild=Fo,n.remove=Fo,n.innerHTML="",n.tagName=a.toUpperCase(),xr((0,he.Z)(n),s),Rn((0,he.Z)(n)),ha((0,he.Z)(n)),ci((0,he.Z)(n)),Jn((0,he.Z)(n)),Yi((0,he.Z)(n)),n}return(0,wt.Z)(r)}($u);function pl(e){var i=tf();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function tf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ju=function(e){(0,en.Z)(r,e);var i=pl(r);function r(n){return(0,ot.Z)(this,r),i.call(this,n)}return(0,wt.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(ws);function Mc(e){var i=Ru();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function Ru(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yu=function(e){(0,en.Z)(r,e);var i=Mc(r);function r(){return(0,ot.Z)(this,r),i.call(this,"video")}return(0,wt.Z)(r)}(Ju),wo={},da={};function yp(e,i){wo=e,wo.id=i,"tagName"in wo||(wo.tagName="CANVAS"),wo.type="canvas",Mixin.parentNode(wo),Mixin.style(wo),Mixin.classList(wo),Mixin.clientRegion(wo),Mixin.offsetRegion(wo),wo.focus=function(){},wo.blur=function(){}}function _p(e,i){var r=1024,n=1024;da={width:r,height:n,clientWidth:r/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in da||(da.tagName="CANVAS"),Mixin.parentNode(da),Mixin.style(da),Mixin.classList(da),Mixin.clientRegion(da),Mixin.offsetRegion(da),da.getContext=function(a){if(a==="2d")return e},da.focus=function(){},da.blur=function(){}}function vo(){return wo}function Ff(){return da}var _u=(0,wt.Z)(function e(){(0,ot.Z)(this,e);var i=vo(),r=i.createImage&&i.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),xr(r),ha(r),Object.assign(r,{addEventListener:function(a,s){r["on".concat(a)]=s.bind(r)},removeEventListener:function(a){r["on".concat(a)]=null}}),r}),Bs={href:"",protocol:"",host:""};function Pc(e){var i=hl();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function hl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Aa=function(e){(0,en.Z)(r,e);var i=Pc(r);function r(){return(0,ot.Z)(this,r),i.call(this,"body",0)}return(0,wt.Z)(r,[{key:"addEventListener",value:function(a,s){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s,p){}},{key:"dispatchEvent",value:function(a){}}]),r}(ws),Pl=function(e){(0,en.Z)(r,e);var i=Pc(r);function r(){return(0,ot.Z)(this,r),i.call(this,"html",0)}return(0,wt.Z)(r,[{key:"addEventListener",value:function(a,s){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s){}},{key:"dispatchEvent",value:function(a){}}]),r}(ws),$l={},os={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Bs,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new _u:i==="video"?new yu:new ws(i)},createElementNS:function(i,r){return this.createElement(r)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,r){return this.getElementsByTagName(r)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,r,n){$l[i]||($l[i]=[]),$l[i].push(r)},removeEventListener:function(i,r){var n=$l[i];if(n&&n.length>0){for(var a=n.length;a--;a>0)if(n[a]===r){n.splice(a,1);break}}},dispatchEvent:function(i){var r=i.type,n=$l[r];if(n)for(var a=0;a<n.length;a++)n[a](i);i.target&&typeof i.target["on"+r]=="function"&&i.target["on"+r](i)},createEvent:function(i){return new Vo(i)}};os.documentElement=new Pl,os.head=new ws("head"),os.body=new Aa;var Bf=Object,xp=N(90484),bp=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"_w",void 0),(0,I.Z)(this,"_h",void 0),(0,I.Z)(this,"_data",void 0);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,xp.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,wt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),rf=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,dl,Go,Lu;if(rf){var el=my.getSystemInfoSync();dl=el.system,Go=el.platform,Lu=el.language}else{var Ho={versions:function(){var e=Ji.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(Ji.navigator.browserLanguage||Ji.navigator.language).toLowerCase()};Ho.versions.android?Go="android":Ho.versions.trident?Go="IE":Ho.versions.presto?Go="Opera":Ho.versions.webKit?Go="webKit":Ho.versions.gecko?Go="Firefox":Ho.versions.mobile?Go="mobile":Ho.versions.ios?Go="ios":Ho.versions.iPhone?Go="iPhone":Ho.versions.iPad?Go="ipad":Ho.versions.webApp?Go="webApp":Ho.versions.weixin?Go="weixin":Ho.versions.qq&&(Go="qq"),dl=Ji.navigator.userAgent,Lu=Ho.language}var Il=dl.toLowerCase().indexOf("android")!==-1,tl=Il?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",eu="Mozilla/5.0 (".concat(tl,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Lu),nf={platform:Go,language:Lu,appVersion:"5.0 (".concat(tl,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:eu},af={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){}},of=0,rl=0;function Ql(e){var i=Date.now(),r=Math.max(of+23,i);return rl=setTimeout(function(){e(of=r)},r-i),rl}function Ic(e){var i=vo();return i.requestAnimationFrame?i.requestAnimationFrame(e):Ql(e)}function sf(e){var i=vo();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var Oc=function(){function e(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,ot.Z)(this,e),(0,I.Z)(this,"href",void 0),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=r+i}return(0,wt.Z)(e,null,[{key:"createObjectURL",value:function(r){var n=r.buffers[0],a=r.type,s=Ep(n),p="data:".concat(a,";base64, ");return p+s}}]),e}();function Ep(e){for(var i="",r=new Uint8Array(e),n=r.byteLength,a=0;a<n;a++)i+=String.fromCharCode(r[a]);return Fr(i)}var Rc={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},vl={};function uf(e){var i=lf();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function lf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ku=new Map,cf=new Map,Nf=new Map,Sp={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function Ol(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function ih(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,Ol.call(this,"readystatechange",i)}var ss=function(e){(0,en.Z)(r,e);var i=uf(r);function r(){var n;return(0,ot.Z)(this,r),n=i.call(this),(0,I.Z)((0,he.Z)(n),"onabort",void 0),(0,I.Z)((0,he.Z)(n),"onerror",void 0),(0,I.Z)((0,he.Z)(n),"onload",void 0),(0,I.Z)((0,he.Z)(n),"onloadstart",void 0),(0,I.Z)((0,he.Z)(n),"onprogress",void 0),(0,I.Z)((0,he.Z)(n),"ontimeout",void 0),(0,I.Z)((0,he.Z)(n),"onloadend",void 0),(0,I.Z)((0,he.Z)(n),"onreadystatechange",void 0),(0,I.Z)((0,he.Z)(n),"readyState",void 0),(0,I.Z)((0,he.Z)(n),"response",void 0),(0,I.Z)((0,he.Z)(n),"responseText",void 0),(0,I.Z)((0,he.Z)(n),"_responseType",void 0),(0,I.Z)((0,he.Z)(n),"responseXML",void 0),(0,I.Z)((0,he.Z)(n),"status",void 0),(0,I.Z)((0,he.Z)(n),"statusText",void 0),(0,I.Z)((0,he.Z)(n),"upload",void 0),(0,I.Z)((0,he.Z)(n),"withCredentials",void 0),(0,I.Z)((0,he.Z)(n),"timeout",void 0),(0,I.Z)((0,he.Z)(n),"_url",void 0),(0,I.Z)((0,he.Z)(n),"_method",void 0),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,ku.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,wt.Z)(r,[{key:"responseType",set:function(a){this._responseType=a}},{key:"abort",value:function(){var a=Nf.get("requestTask");a&&a.abort()}},{key:"getAllResponseHeaders",value:function(){var a=cf.get("responseHeader");return Object.keys(a).map(function(s){return"".concat(s,": ").concat(a[s])}).join(`
`)}},{key:"getResponseHeader",value:function(a){return cf.get("responseHeader")[a]}},{key:"open",value:function(a,s,p){this._method=a,this._url=s}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(a,s){var p=ku.get("requestHeader");p[a]=s,ku.set("requestHeader",p)}},{key:"addEventListener",value:function(a,s){var p=this;typeof s=="function"&&(this["on"+a]=function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};v.target=v.target||p,s.call(p,v)})}},{key:"removeEventListener",value:function(a,s){this["on"+a]===s&&(this["on"+a]=null)}}]),r}(bo);(0,I.Z)(ss,"UNSEND",void 0),(0,I.Z)(ss,"OPENED",void 0),(0,I.Z)(ss,"HEADERS_RECEIVED",void 0),(0,I.Z)(ss,"LOADING",void 0),(0,I.Z)(ss,"DONE",void 0),ss.UNSEND=0,ss.OPENED=1,ss.HEADERS_RECEIVED=2,ss.LOADING=3,ss.DONE=4;function qa(e){var i=Jl();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function Jl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rl=function(e){(0,en.Z)(r,e);var i=qa(r);function r(n){var a;return(0,ot.Z)(this,r),a=i.call(this,n),(0,I.Z)((0,he.Z)(a),"touches",void 0),(0,I.Z)((0,he.Z)(a),"targetTouches",void 0),(0,I.Z)((0,he.Z)(a),"changedTouches",void 0),a.touches=[],a.targetTouches=[],a.changedTouches=[],a.target=vo(),a.currentTarget=vo(),a}return(0,wt.Z)(r)}(Vo);function fu(e){var i=e||{},r=i.x,n=r===void 0?0:r,a=i.y,s=a===void 0?0:a,p=i.clientX,v=p===void 0?0:p,g=i.clientY,x=g===void 0?0:g;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=s):(e.x=v,e.y=x)}function Bi(e){return function(i){var r=new Rl(e);r.changedTouches=i.changedTouches,r.touches=i.touches,r.targetTouches=Array.prototype.slice.call(i.touches),r.timeStamp=i.timeStamp,r.changedTouches.forEach(function(n){return fu(n)}),r.touches.forEach(function(n){return fu(n)}),r.targetTouches.forEach(function(n){return fu(n)}),os.dispatchEvent(r)}}function Fa(e){return function(i){i.type=e,os.dispatchEvent(i)}}var Ns=Bi("touchstart"),ff=Bi("touchmove"),ml=Bi("touchend"),pf=Fa("mapCameaParams");function ah(e){var i=oh();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function oh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lc=function(e){(0,en.Z)(r,e);var i=ah(r);function r(n){var a;return(0,ot.Z)(this,r),a=i.call(this,n),(0,I.Z)((0,he.Z)(a),"buttons",void 0),(0,I.Z)((0,he.Z)(a),"which",void 0),(0,I.Z)((0,he.Z)(a),"pointerId",void 0),(0,I.Z)((0,he.Z)(a),"bubbles",void 0),(0,I.Z)((0,he.Z)(a),"button",void 0),(0,I.Z)((0,he.Z)(a),"width",void 0),(0,I.Z)((0,he.Z)(a),"height",void 0),(0,I.Z)((0,he.Z)(a),"pressure",void 0),(0,I.Z)((0,he.Z)(a),"isPrimary",void 0),(0,I.Z)((0,he.Z)(a),"pointerType",void 0),(0,I.Z)((0,he.Z)(a),"altKey",void 0),(0,I.Z)((0,he.Z)(a),"ctrlKey",void 0),(0,I.Z)((0,he.Z)(a),"metaKey",void 0),(0,I.Z)((0,he.Z)(a),"shiftKey",void 0),a.target=vo(),a.currentTarget=vo(),a}return(0,wt.Z)(r)}(Vo),ec=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],nl=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],Bo="touch";function tc(e,i,r){for(var n=new Lc(e),a=0;a<ec.length;a++){var s=ec[a];n[s]=i[s]||nl[a]}return n.type=e,n.target=vo(),n.currentTarget=vo(),n.buttons=rc(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=yn(i),n.pointerType=Bo,n.altKey=r.altKey,n.ctrlKey=r.ctrlKey,n.metaKey=r.metaKey,n.shiftKey=r.shiftKey,r.preventDefault&&(n.preventDefault=function(){r.preventDefault()}),n}function rc(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var eo=null;function yn(e){return eo===e.identifier}function co(e){eo===null&&(eo=e.identifier)}function il(e){eo===e.identifier&&(eo=null)}function al(e){return function(i){for(var r=i.changedTouches,n=0;n<r.length;n++){var a=r[n];n===0&&e==="pointerdown"?co(a):(e==="pointerup"||e==="pointercancel")&&il(a);var s=tc(e,a,i);os.dispatchEvent(s)}}}var xu=al("pointerdown"),zs=al("pointermove"),zf=al("pointerup");function Kr(e){var i=hf();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function hf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Uf=function(e){(0,en.Z)(r,e);var i=Kr(r);function r(n){return(0,ot.Z)(this,r),i.call(this,n)}return(0,wt.Z)(r)}(Vo);function Du(e){return function(i){i.type=e,os.dispatchEvent(i)}}var Ha=Du("mousedown"),Us=Du("mousemove"),df=Du("mouseup"),Fu=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Os=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),To=Fu||Os,Cp={atob:kt,btoa:Fr,devicePixelRatio:Jo,Blob:lo,document:os,Element:$u,Event:Vo,EventTarget:bo,HTMLCanvasElement:Bf,HTMLElement:ws,HTMLMediaElement:Ju,HTMLVideoElement:yu,Image:_u,ImageData:bp,navigator:nf,Node:Ku,requestAnimationFrame:Ic,cancelAnimationFrame:sf,screen:We,XMLHttpRequest:ss,performance:af,URL:Oc,WebGLRenderingContext:Rc,WebGL2RenderingContext:vl,addEventListener:function(i,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};os.addEventListener(i,r,n)},removeEventListener:function(i,r,n){os.removeEventListener(i,r)},dispatchEvent:function(i){os.dispatchEvent(i)},innerWidth:We.availWidth,innerHeight:We.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},Ea=To?Cp:Ji,Zf=To?ss:Ji.XMLHttpRequest,Ap=To?Bs:Ji.location;function tu(e){var i=e;return typeof e=="string"&&(i=Ea.document.getElementById(e)),i}function Rs(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Li(e){return Rs(e).split(/\s+/)}function bu(e){var i,r,n=Ea==null||(i=Ea.document)===null||i===void 0||(r=i.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var a in e)if(e[a]&&e[a]in n)return e[a];return e[0]}function va(e,i,r){var n=Ea.document.createElement(e);return n.className=i||"",r&&r.appendChild(n),n}function mo(e){var i=e.parentNode;i&&i.removeChild(e)}function Zs(e,i){if(e.classList!==void 0)for(var r=Li(i),n=0,a=r.length;n<a;n++)e.classList.add(r[n]);else if(!js(e,i)){var s=Vs(e);_s(e,(s?s+" ":"")+i)}}function pu(e,i){e.classList!==void 0?e.classList.remove(i):_s(e,Rs((" "+Vs(e)+" ").replace(" "+i+" "," ")))}function js(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=Vs(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function _s(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function Vs(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Ln(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var wn=bu(["transform","WebkitTransform"]);function nc(e,i){e.style[wn]=i}function xs(){if(typeof Event=="function")Ea.dispatchEvent(new Event("resize"));else{var e=Ea.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,Ea,0),Ea.dispatchEvent(e)}}function Eu(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function es(){var e,i=Ea.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(a){var s=a.split("="),p=(0,Q.Z)(s,2),v=p[0],g=p[1];return v==="initial-scale"});return n?n.split("=")[1]*1:1}var wa=es()<1?1:Ea.devicePixelRatio,kc=N(14665);function Dc(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var ma=N(51814);function Oa(e,i,r){return(0,ma.Z)()?Oa=Reflect.construct:Oa=function(a,s,p){var v=[null];v.push.apply(v,s);var g=Function.bind.apply(a,v),x=new g;return p&&(0,kc.Z)(x,p.prototype),x},Oa.apply(null,arguments)}function Fc(e){var i=typeof Map=="function"?new Map:void 0;return Fc=function(n){if(n===null||!Dc(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,a)}function a(){return Oa(n,arguments,(0,Rt.Z)(this).constructor)}return a.prototype=Object.create(n.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),(0,kc.Z)(a,n)},Fc(e)}function Ll(e){var i=Su();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function Su(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ru=function(e){(0,en.Z)(r,e);var i=Ll(r);function r(n,a,s){var p;return(0,ot.Z)(this,r),p=i.call(this,n),(0,I.Z)((0,he.Z)(p),"status",void 0),(0,I.Z)((0,he.Z)(p),"url",void 0),p.status=a,p.url=s,p.name=p.constructor.name,p.message=n,p}return(0,wt.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(Fc(Error));function No(e){var i=new Zf;i.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&i.setRequestHeader(r,e.headers[r]);return i.withCredentials=e.credentials==="include",i}var gl=function(i,r){var n=No(i);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var a;try{a=JSON.parse(n.response)}catch(s){return r(s)}r(null,a)}else n.status===401?r(new ru("".concat(n.statusText),n.status,i.url)):r(new ru(n.statusText,n.status,i.url))},n.send(),n},Cu=function(i,r){var n=No(i);return n.responseType="arraybuffer",n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){var a=n.response;if(a.byteLength===0&&n.status===200)return r(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?r(null,{data:a,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):r(new ru(n.statusText,n.status,i.url))},n.send(),n};function vf(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var kl="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Dl=function(i,r){return Cu(i,function(n,a){if(n)r(n);else if(a){var s=new Ea.Image;s.crossOrigin="anonymous";var p=Ea.URL||Ea.webkitURL;s.onload=function(){r(null,s),p.revokeObjectURL(s.src)};var v=new Ea.Blob([new Uint8Array(a.data)],{type:"image/png"});s.src=a.data.byteLength?p.createObjectURL(v):kl}})},Fl=2*Math.PI*6378137/2;function ic(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;yl(i,n)}),i}function yl(e,i){return Array.isArray(i[0])?i.forEach(function(r){yl(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function wp(e,i){return ol(e,i)}function ol(e,i){return Array.isArray(e[0])?e.map(function(r){return ol(r,i)}):i(e)}function Bu(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=mf(e,i);var n=e[0],a=e[1],s=n*Fl/180,p=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180);return p=p*Fl/180,r.enable&&(s=Number(s.toFixed(r.decimal)),p=Number(p.toFixed(r.decimal))),e.length===3?[s,p,e[2]]:[s,p]}function jf(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],a=r/Fl*180,s=n/Fl*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),i!=null&&(a=Number(a.toFixed(i)),s=Number(s.toFixed(i))),e.length===3?[a,s,e[2]]:[a,s]}function _l(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function nu(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function mf(e,i){if(i===!1)return e;var r=_l(e[0]),n=nu(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function Gs(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,a=Math.PI/180,s=e[0]*a,p=r*a;p=Math.log(Math.tan(Math.PI/4+p/2));var v=.5/Math.PI,g=.5,x=-.5/Math.PI;return a=.5,s=n*(v*s+g),p=n*(x*p+a),[Math.floor(s),Math.floor(p)]}function Tp(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,a=.5,s=256<<20,p=_slicedToArray(e,2),v=p[0],g=p[1];v=(v/s-r)/i,g=(g/s-a)/n,g=(Math.atan(Math.pow(Math.E,g))-Math.PI/4)*2,a=Math.PI/180;var x=g/a,C=v/a;return[C,x]}function ac(e,i,r){var n=oi(i[1]-e[1]),a=oi(i[0]-e[0]),s=oi(e[1]),p=oi(i[1]),v=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(p);return cn(2*Math.atan2(Math.sqrt(v),Math.sqrt(1-v)),r="meters")}function l(e){var i=Math.PI/180,r=85.0511287798,n=6378137,a=Math.max(Math.min(r,e[1]),-r),s=Math.sin(a*i),p=n*e[0]*i,v=n*Math.log((1+s)/(1-s))/2;return[p,v]}function f(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function c(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function d(e){return[[e[0],e[1]],[e[2],e[3]]]}function E(e){var i=A(e,[0,0]);return[e[0]/i,e[1]/i]}function A(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function M(e,i){return e[0]*i[0]+e[1]*i[1]}function L(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function U(e,i){return Math.acos(M(e,i)/(L(e)*L(i)))*180/Math.PI}function X(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function oe(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,a=[],s=0;s<e.length-1;s++){var p=e[s],v=e[s+1],g=A(p,v);n+=g;var x=[p[0]-v[0],p[1]-v[1]],C=X(r,x);if(s>0){var w=a[s-1].rotation;w-C>360-w+C&&(C=C+360)}a.push({start:p,end:v,dis:g,rotation:C,duration:0})}return a.map(function(O){O.duration=i*(O.dis/n)}),a}}var fe=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,ot.Z)(this,e),(0,I.Z)(this,"limit",void 0),(0,I.Z)(this,"cache",void 0),(0,I.Z)(this,"destroy",void 0),(0,I.Z)(this,"order",void 0),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,wt.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(a){return a===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function pe(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var Re=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,ot.Z)(this,e),(0,I.Z)(this,"duration",16),(0,I.Z)(this,"timestamp",new Date().getTime()),this.duration=i}return(0,wt.Z)(e,[{key:"run",value:function(r){var n=new Date().getTime(),a=n-this.timestamp;this.timestamp=n,a>=this.duration&&r()}}]),e}(),Pe=N(2650);function He(e){return typeof e=="string"?!!Pe.ZP(e):!1}function be(e){var i=Pe.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function je(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],a=i+r*256+n*65536-1;return a}function et(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function yt(e){var i=Ea.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;for(var n=r.createLinearGradient(0,0,256,1),a=null,s=e.positions[0],p=e.positions[e.positions.length-1],v=0;v<e.colors.length;++v){var g=(e.positions[v]-s)/(p-s);n.addColorStop(g,e.colors[v])}if(r.fillStyle=n,r.fillRect(0,0,256,1),To)return a=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),{data:a,width:256,height:1};a=r.getImageData(0,0,256,1).data;for(var x=r.createImageData(256,1),C=0;C<x.data.length;C+=4)x.data[C+0]=a[C+0],x.data[C+1]=a[C+1],x.data[C+2]=a[C+2],x.data[C+3]=a[C+3];return x}var Ht;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(Ht||(Ht={}));var Nt={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Qt(e,i,r){var n=e.classList;for(var a in Nt)Nt.hasOwnProperty(a)&&n.remove("l7-".concat(r,"-anchor-").concat(a));n.add("l7-".concat(r,"-anchor-").concat(i))}function rr(e,i){return{enable:e,mask:255,func:{cmp:514,ref:i?1:0,mask:255}}}var Ir={BACK:1029,FRONT:1028};function Or(e){switch(e){case"GAODE1.x":return Ir.BACK;case"GAODE2.x":return Ir.BACK;case"MAPBOX":return Ir.FRONT;case"SIMPLE":return Ir.FRONT;case"GLOBEL":return Ir.BACK;case"L7MAP":return Ir.FRONT;default:return Ir.FRONT}}function ln(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function Bn(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function Dn(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function Un(e){if(e.length===0)throw new Error("mean requires at least one data point");return Dn(e)/e.length}function Ni(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,a=1,s=1;s<e.length+1;s++)e[s]!==i?(a>n&&(n=a,r=i),a=1,i=e[s]):a++;return r*1}var on={min:Bn,max:ln,mean:Un,sum:Dn,mode:Ni};function ni(e,i){return e.map(function(r){return r[i]})}function pi(e,i){return on[e](i)}function ei(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,a=new Promise(function(p){Vn(e,function(v){p(v)})}),s={originData:e,images:a,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return s}function Vn(e,i){var r=e,n=[];if(typeof r=="string")Dl({url:r},function(p,v){n.push(v),i(n)});else{var a=r.length,s=0;r.forEach(function(p){Dl({url:p},function(v,g){s++,n.push(g),s===a&&i(n)})})}return ei}function gi(e,i){var r=i.extent,n=i.width,a=i.height,s=i.min,p=i.max,v={_id:1,dataArray:[{_id:1,data:Array.from(e),width:n,height:a,min:s,max:p,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return v}var Kn=N(30236),Gn=N.n(Kn),Mo=N(47037),ua=N.n(Mo),Wo=N(23560),to=N.n(Wo),ro=N(50361),Za=N.n(ro),bs=N(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Es(e,i,r,n){function a(s){return s instanceof r?s:new r(function(p){p(s)})}return new(r||(r=Promise))(function(s,p){function v(C){try{x(n.next(C))}catch(w){p(w)}}function g(C){try{x(n.throw(C))}catch(w){p(w)}}function x(C){C.done?s(C.value):a(C.value).then(v,g)}x((n=n.apply(e,i||[])).next())})}function Nu(e,i){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,a,s,p;return p={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function v(x){return function(C){return g([x,C])}}function g(x){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(s=x[0]&2?a.return:x[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,x[1])).done)return s;switch(a=0,s&&(x=[x[0]&2,s.value]),x[0]){case 0:case 1:s=x;break;case 4:return r.label++,{value:x[1],done:!1};case 5:r.label++,a=x[1],x=[0];continue;case 7:x=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(x[0]===6||x[0]===2)){r=0;continue}if(x[0]===3&&(!s||x[1]>s[0]&&x[1]<s[3])){r.label=x[1];break}if(x[0]===6&&r.label<s[1]){r.label=s[1],s=x;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(x);break}s[2]&&r.ops.pop(),r.trys.pop();continue}x=i.call(e,r)}catch(C){x=[6,C],a=0}finally{n=s=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}function Ss(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,s=[],p;try{for(;(i===void 0||i-- >0)&&!(a=n.next()).done;)s.push(a.value)}catch(v){p={error:v}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(p)throw p.error}}return s}function hu(){for(var e=[],i=0;i<arguments.length;i++)e=e.concat(Ss(arguments[i]));return e}function Ra(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function fo(e,i){return i={exports:{}},e(i,i.exports),i.exports}var zu=fo(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default});Ra(zu);var Au=fo(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];var s=n.pop();return r.call(this,n,s)}},e.exports=i.default});Ra(Au);var du=fo(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.fallback=a,i.wrap=s;var r=i.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,n=i.hasNextTick=typeof bs=="object"&&typeof bs.nextTick=="function";function a(v){setTimeout(v,0)}function s(v){return function(g){for(var x=[],C=arguments.length-1;C-- >0;)x[C]=arguments[C+1];return v(function(){return g.apply(void 0,x)})}}var p;r?p=setImmediate:n?p=bs.nextTick:p=a,i.default=s(p)});Ra(du);var Bc=du.fallback,wu=du.wrap,oc=du.hasSetImmediate,Uu=du.hasNextTick,Eo=fo(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Au),n=a(du);function a(g){return g&&g.__esModule?g:{default:g}}function s(g){return(0,Xo.isAsync)(g)?function(){for(var x=[],C=arguments.length;C--;)x[C]=arguments[C];var w=x.pop(),O=g.apply(this,x);return p(O,w)}:(0,r.default)(function(x,C){var w;try{w=g.apply(this,x)}catch(O){return C(O)}if(w&&typeof w.then=="function")return p(w,C);C(null,w)})}function p(g,x){return g.then(function(C){v(x,null,C)},function(C){v(x,C&&C.message?C:new Error(C))})}function v(g,x,C){try{g(x,C)}catch(w){(0,n.default)(function(O){throw O},w)}}e.exports=i.default});Ra(Eo);var Xo=fo(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isAsyncIterable=i.isAsyncGenerator=i.isAsync=void 0;var r=n(Eo);function n(g){return g&&g.__esModule?g:{default:g}}function a(g){return g[Symbol.toStringTag]==="AsyncFunction"}function s(g){return g[Symbol.toStringTag]==="AsyncGenerator"}function p(g){return typeof g[Symbol.asyncIterator]=="function"}function v(g){if(typeof g!="function")throw new Error("expected a function");return a(g)?(0,r.default)(g):g}i.default=v,i.isAsync=a,i.isAsyncGenerator=s,i.isAsyncIterable=p});Ra(Xo);var xl=Xo.isAsyncIterable,bl=Xo.isAsyncGenerator,la=Xo.isAsync,ts=fo(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,a){if(a===void 0&&(a=n.length),!a)throw new Error("arity is undefined");function s(){for(var p=this,v=[],g=arguments.length;g--;)v[g]=arguments[g];return typeof v[a-1]=="function"?n.apply(this,v):new Promise(function(x,C){v[a-1]=function(w){for(var O=[],D=arguments.length-1;D-- >0;)O[D]=arguments[D+1];if(w)return C(w);x(O.length>1?O:O[0])},n.apply(p,v)})}return Object.defineProperty(s,"name",{configurable:!0,value:"awaitable("+n.name+")"}),s}e.exports=i.default});Ra(ts);var rs=fo(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(zu),n=s(Xo),a=s(ts);function s(p){return p&&p.__esModule?p:{default:p}}i.default=(0,a.default)(function(p,v,g){var x=(0,r.default)(v)?[]:{};p(v,function(C,w,O){(0,n.default)(C)(function(D){for(var G,q=[],te=arguments.length-1;te-- >0;)q[te]=arguments[te+1];q.length<2&&(G=q,q=G[0]),x[w]=q,O(D)})},function(C){return g(C,x)})},3),e.exports=i.default});Ra(rs);var vu=fo(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function a(){for(var s=[],p=arguments.length;p--;)s[p]=arguments[p];if(n!==null){var v=n;n=null,v.apply(this,s)}}return Object.assign(a,n),a}e.exports=i.default});Ra(vu);var sc=fo(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default});Ra(sc);var uc=fo(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=g;var r=a(zu),n=a(sc);function a(x){return x&&x.__esModule?x:{default:x}}function s(x){var C=-1,w=x.length;return function(){return++C<w?{value:x[C],key:C}:null}}function p(x){var C=-1;return function(){var O=x.next();return O.done?null:(C++,{value:O.value,key:C})}}function v(x){var C=x?Object.keys(x):[],w=-1,O=C.length;return function(){var G=C[++w];return w<O?{value:x[G],key:G}:null}}function g(x){if((0,r.default)(x))return s(x);var C=(0,n.default)(x);return C?p(C):v(x)}e.exports=i.default});Ra(uc);var Bl=fo(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(n===null)throw new Error("Callback was already called.");var p=n;n=null,p.apply(this,a)}}e.exports=i.default});Ra(Bl);var Ts=fo(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default});Ra(Ts);var Nl=fo(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=a;var r=n(Ts);function n(s){return s&&s.__esModule?s:{default:s}}function a(s,p,v,g){var x=!1,C=!1,w=!1,O=0,D=0;function G(){O>=p||w||x||(w=!0,s.next().then(function(Se){var ze=Se.value,$e=Se.done;if(!(C||x)){if(w=!1,$e){x=!0,O<=0&&g(null);return}O++,v(ze,D,q),D++,G()}}).catch(te))}function q(Se,ze){if(O-=1,!C){if(Se)return te(Se);if(Se===!1){x=!0,C=!0;return}if(ze===r.default||x&&O<=0)return x=!0,g(null);G()}}function te(Se){C||(w=!1,x=!0,g(Se))}G()}e.exports=i.default});Ra(Nl);var iu=fo(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=v(vu),n=v(uc),a=v(Bl),s=v(Nl),p=v(Ts);function v(g){return g&&g.__esModule?g:{default:g}}i.default=function(g){return function(x,C,w){if(w=(0,r.default)(w),g<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!x)return w(null);if((0,Xo.isAsyncGenerator)(x))return(0,s.default)(x,g,C,w);if((0,Xo.isAsyncIterable)(x))return(0,s.default)(x[Symbol.asyncIterator](),g,C,w);var O=(0,n.default)(x),D=!1,G=!1,q=0,te=!1;function Se($e,at){if(!G)if(q-=1,$e)D=!0,w($e);else if($e===!1)D=!0,G=!0;else{if(at===p.default||D&&q<=0)return D=!0,w(null);te||ze()}}function ze(){for(te=!0;q<g&&!D;){var $e=O();if($e===null){D=!0,q<=0&&w(null);return}q+=1,C($e.value,$e.key,(0,a.default)(Se))}te=!1}ze()}},e.exports=i.default});Ra(iu);var Zu=fo(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(iu),n=s(Xo),a=s(ts);function s(v){return v&&v.__esModule?v:{default:v}}function p(v,g,x,C){return(0,r.default)(g)(v,(0,n.default)(x),C)}i.default=(0,a.default)(p,4),e.exports=i.default});Ra(Zu);var lc=fo(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=a(Zu),n=a(ts);function a(p){return p&&p.__esModule?p:{default:p}}function s(p,v,g){return(0,r.default)(p,1,v,g)}i.default=(0,n.default)(s,3),e.exports=i.default});Ra(lc);var Tu=fo(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(rs),n=a(lc);function a(p){return p&&p.__esModule?p:{default:p}}function s(p,v){return(0,r.default)(n.default,p,v)}e.exports=i.default}),zo=Ra(Tu),Hs=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,zo(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(a){r.apply(void 0,hu(n.args)),a(null,i)})},e}(),gf=fo(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=x(zu),n=x(Ts),a=x(Zu),s=x(vu),p=x(Bl),v=x(Xo),g=x(ts);function x(D){return D&&D.__esModule?D:{default:D}}function C(D,G,q){q=(0,s.default)(q);var te=0,Se=0,ze=D.length,$e=!1;ze===0&&q(null);function at(Et,Tt){Et===!1&&($e=!0),$e!==!0&&(Et?q(Et):(++Se===ze||Tt===n.default)&&q(null))}for(;te<ze;te++)G(D[te],te,(0,p.default)(at))}function w(D,G,q){return(0,a.default)(D,Infinity,G,q)}function O(D,G,q){var te=(0,r.default)(D)?C:w;return te(D,(0,v.default)(G),q)}i.default=(0,g.default)(O,3),e.exports=i.default});Ra(gf);var Mp=fo(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(gf),n=a(rs);function a(p){return p&&p.__esModule?p:{default:p}}function s(p,v){return(0,n.default)(r.default,p,v)}e.exports=i.default}),Vf=Ra(Mp),sh=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Vf(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(a){return Es(n,void 0,void 0,function(){return Nu(this,function(s){switch(s.label){case 0:return[4,r()];case 1:return s.sent(),a(null,i),[2]}})})})},e}(),uh=fo(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=p(vu),n=p(Bl),a=p(Xo),s=p(ts);function p(g){return g&&g.__esModule?g:{default:g}}function v(g,x){if(x=(0,r.default)(x),!Array.isArray(g))return x(new Error("First argument to waterfall must be an array of functions"));if(!g.length)return x();var C=0;function w(D){var G=(0,a.default)(g[C++]);G.apply(void 0,D.concat([(0,n.default)(O)]))}function O(D){for(var G=[],q=arguments.length-1;q-- >0;)G[q]=arguments[q+1];if(D!==!1){if(D||C===g.length)return x.apply(void 0,[D].concat(G));w(G)}}w([])}i.default=(0,s.default)(v),e.exports=i.default}),cc=Ra(uh),yf=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return cc(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var a=r();n(a?null:!1,a)}):this.tasks.push(function(n,a){var s=r();a(s?null:!1,i)})},e}(),_f=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return zo(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var a=r();n(a,i)})},e}(),ju=N(26729),zl=N.n(ju),xf=N(69848),lh=N.n(xf);function Hh(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Nc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Hh(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Pp(e,i){var r=i.radius,n=r===void 0?40:r,a=i.maxZoom,s=a===void 0?18:a,p=i.minZoom,v=p===void 0?0:p,g=i.zoom,x=g===void 0?2:g;if(e.pointIndex){var C=e.pointIndex.getClusters(e.extent,Math.floor(x));return e.dataArray=bd(C),e}var w=new(lh())({radius:n,minZoom:v,maxZoom:s}),O={type:"FeatureCollection",features:[]};return O.features=e.dataArray.map(function(D){return{type:"Feature",geometry:{type:"Point",coordinates:D.coordinates},properties:Nc({},D)}}),w.load(O.features),w}function bd(e){return e.map(function(i,r){return Nc({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function Ed(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function Wh(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function Ip(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,a=1;a<e.length;a++)n=i+e[a]*1,Math.abs(i)>=Math.abs(e[a])?r+=i-n+e[a]:r+=e[a]-n+i,i=n;return i+r*1}function Sd(e){if(e.length===0)throw new Error("mean requires at least one data point");return Ip(e)/e.length}var bf={min:Wh,max:Ed,mean:Sd,sum:Ip};function Cd(e,i){return e.map(function(r){return r[i]*1})}function Po(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function zc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Po(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Po(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Xh(e){var i=Op();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function Op(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Rp(e,i){if(Array.isArray(i))return i}var Gf=function(e){(0,en.Z)(r,e);var i=Xh(r);function r(n,a){var s;return(0,ot.Z)(this,r),s=i.call(this),(0,I.Z)((0,he.Z)(s),"data",void 0),(0,I.Z)((0,he.Z)(s),"extent",void 0),(0,I.Z)((0,he.Z)(s),"hooks",{init:new Hs}),(0,I.Z)((0,he.Z)(s),"parser",{type:"geojson"}),(0,I.Z)((0,he.Z)(s),"transforms",[]),(0,I.Z)((0,he.Z)(s),"cluster",!1),(0,I.Z)((0,he.Z)(s),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,I.Z)((0,he.Z)(s),"mapService",void 0),(0,I.Z)((0,he.Z)(s),"invalidExtent",!1),(0,I.Z)((0,he.Z)(s),"dataArrayChanged",!1),(0,I.Z)((0,he.Z)(s),"originData",void 0),(0,I.Z)((0,he.Z)(s),"rawData",void 0),(0,I.Z)((0,he.Z)(s),"cfg",{}),(0,I.Z)((0,he.Z)(s),"clusterIndex",void 0),s.originData=n,s.initCfg(a),s.hooks.init.tap("parser",function(){s.excuteParser()}),s.hooks.init.tap("cluster",function(){s.initCluster()}),s.hooks.init.tap("transform",function(){s.executeTrans()}),s.init(),s}return(0,wt.Z)(r,[{key:"setData",value:function(a,s){this.originData=a,this.dataArrayChanged=!1,this.initCfg(s),this.init(),this.emit("update")}},{key:"getClusters",value:function(a){return this.clusterIndex.getClusters(this.caculClusterExtent(2),a)}},{key:"getClustersLeaves",value:function(a){return this.clusterIndex.getLeaves(a,Infinity)}},{key:"updateClusterData",value:function(a){var s=this,p=this.clusterOptions,v=p.method,g=v===void 0?"sum":v,x=p.field,C=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(a));this.clusterOptions.zoom=a,C.forEach(function(w){w.id||(w.properties.point_count=1)}),(x||to()(g))&&(C=C.map(function(w){var O=w.id;if(O){var D=s.clusterIndex.getLeaves(O,Infinity),G=D.map(function(Se){return Se.properties}),q;if(ua()(g)&&x){var te=Cd(G,x);q=bf[g](te)}to()(g)&&(q=g(G)),w.properties.stat=q}else w.properties.point_count=1;return w})),this.data=Zn("geojson")({type:"FeatureCollection",features:C}),this.executeTrans()}},{key:"getFeatureById",value:function(a){var s=this.parser.type,p=s===void 0?"geojson":s;if(p==="geojson"&&!this.cluster){var v=a<this.originData.features.length?this.originData.features[a]:"null",g=Za()(v);if(this.transforms.length!==0||this.dataArrayChanged){var x=this.data.dataArray.find(function(C){return C._id===a});g.properties=x}return g}else return a<this.data.dataArray.length?this.data.dataArray[a]:"null"}},{key:"updateFeaturePropertiesById",value:function(a,s){this.data.dataArray=this.data.dataArray.map(function(p){return p._id===a?zc(zc({},p),s):p}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(a,s){var p=this.data.dataArray.find(function(v){return v[a]===s});return p==null?void 0:p._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(a){var s=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(s=f(d(this.extent),a)),s[0].concat(s[1])}},{key:"initCfg",value:function(a){this.cfg=Gn()(this.cfg,a,Rp);var s=this.cfg;s&&(s.parser&&(this.parser=s.parser),s.transforms&&(this.transforms=s.transforms),this.cluster=s.cluster||!1,s.clusterOptions&&(this.cluster=!0,this.clusterOptions=zc(zc({},this.clusterOptions),s.clusterOptions)))}},{key:"excuteParser",value:function(){var a=this.parser,s=a.type||"geojson";if(s==="imagetile"){this.data={tileurl:this.originData,dataArray:[]};return}var p=Zn(s);this.data=p(this.originData,a),this.extent=ic(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var a=this,s=this.transforms;s.forEach(function(p){var v=p.type,g=mi(v)(a.data,p);Object.assign(a.data,g)})}},{key:"initCluster",value:function(){if(!!this.cluster){var a=this.clusterOptions||{};this.clusterIndex=Pp(this.data,a)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),r}(ju.EventEmitter);function Lp(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function Ef(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=fc(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function fc(e,i){if(!!e){if(typeof e=="string")return Uc(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Uc(e,i)}}function Uc(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Zc=6378e3;function kp(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=a/(2*Math.PI*Zc)*(256<<20)/2,p=pc(r,a),v=p.gridHash,g=p.gridOffset,x=Sf(v,g,i);return{yOffset:s,xOffset:s,radius:s,type:"grid",dataArray:x}}function pc(e,i){var r=Infinity,n=-Infinity,a,s=Ef(e),p;try{for(s.s();!(p=s.n()).done;){var v=p.value;a=v.coordinates[1],Number.isFinite(a)&&(r=a<r?a:r,n=a>n?a:n)}}catch($e){s.e($e)}finally{s.f()}var g=(r+n)/2,x=Dp(i,g);if(x.xOffset<=0||x.yOffset<=0)return{gridHash:{},gridOffset:x};var C={},w=Ef(e),O;try{for(w.s();!(O=w.n()).done;){var D=O.value,G=D.coordinates[1],q=D.coordinates[0];if(Number.isFinite(G)&&Number.isFinite(q)){var te=Math.floor((G+90)/x.yOffset),Se=Math.floor((q+180)/x.xOffset),ze="".concat(te,"-").concat(Se);C[ze]=C[ze]||{count:0,points:[]},C[ze].count+=1,C[ze].points.push(D)}}}catch($e){w.e($e)}finally{w.f()}return{gridHash:C,gridOffset:x}}function Dp(e,i){var r=Hf(e),n=Fp(i,e);return{yOffset:r,xOffset:n}}function Hf(e){return e/Zc*(180/Math.PI)}function Fp(e,i){return i/Zc*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Sf(e,i,r){return Object.keys(e).reduce(function(n,a,s){var p=a.split("-"),v=parseInt(p[0],10),g=parseInt(p[1],10),x={};if(r.field&&r.method){var C=ni(e[a].points,r.field);x[r.method]=on[r.method](C)}return Object.assign(x,{_id:s,coordinates:Gs([-180+i.xOffset*(g+.5),-90+i.yOffset*(v+.5)]),rawData:e[a].points,count:e[a].count}),n.push(x),n},[])}var sl=Math.PI/3,au=[0,sl,2*sl,3*sl,4*sl,5*sl];function Wf(e){return e[0]}function Xf(e){return e[1]}function Yf(){var e=0,i=0,r=1,n=1,a=Wf,s=Xf,p,v,g;function x(w){var O={},D=[],G,q=w.length;for(G=0;G<q;++G)if(!(isNaN(Se=+a.call(null,te=w[G],G,w))||isNaN(ze=+s.call(null,te,G,w)))){var te,Se,ze,$e=Math.round(ze=ze/g),at=Math.round(Se=Se/v-($e&1)/2),Et=ze-$e;if(Math.abs(Et)*3>1){var Tt=Se-at,Jt=at+(Se<at?-1:1)/2,fr=$e+(ze<$e?-1:1),Dr=Se-Jt,tn=ze-fr;Tt*Tt+Et*Et>Dr*Dr+tn*tn&&(at=Jt+($e&1?1:-1)/2,$e=fr)}var wr=at+"-"+$e,xn=O[wr];xn?xn.push(te):(D.push(xn=O[wr]=[te]),xn.x=(at+($e&1)/2)*v,xn.y=$e*g)}return D}function C(w){var O=0,D=0;return au.map(function(G){var q=Math.sin(G)*w,te=-Math.cos(G)*w,Se=q-O,ze=te-D;return O=q,D=te,[Se,ze]})}return x.hexagon=function(w){return"m"+C(w==null?p:+w).join("l")+"z"},x.centers=function(){for(var w=[],O=Math.round(i/g),D=Math.round(e/v),G=O*g;G<n+p;G+=g,++O)for(var q=D*v+(O&1)*v/2;q<r+v/2;q+=v)w.push([q,G]);return w},x.mesh=function(){var w=C(p).slice(0,4).join("l");return x.centers().map(function(O){return"M"+O+"m"+w}).join("")},x.x=function(w){return arguments.length?(a=w,x):a},x.y=function(w){return arguments.length?(s=w,x):s},x.radius=function(w){return arguments.length?(p=+w,v=p*2*Math.sin(sl),g=p*1.5,x):p},x.size=function(w){return arguments.length?(e=i=0,r=+w[0],n=+w[1],x):[r-e,n-i]},x.extent=function(w){return arguments.length?(e=+w[0][0],i=+w[0][1],r=+w[1][0],n=+w[1][1],x):[[e,i],[r,n]]},x.radius(1)}function Cf(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function qf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Cf(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Cf(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var El=6378e3;function jc(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=i.method,p=s===void 0?"sum":s,v=a/(2*Math.PI*El)*(256<<20)/2,g=r.map(function(O){var D=Gs(O.coordinates),G=(0,Q.Z)(D,2),q=G[0],te=G[1];return qf(qf({},O),{},{coordinates:[q,te]})}),x=Yf().radius(v).x(function(O){return O.coordinates[0]}).y(function(O){return O.coordinates[1]}),C=x(g),w={dataArray:C.map(function(O,D){var G;if(i.field&&p){var q=ni(O,i.field);O[p]=on[p](q)}return G={},(0,I.Z)(G,i.method,O[p]),(0,I.Z)(G,"count",O.length),(0,I.Z)(G,"rawData",O),(0,I.Z)(G,"coordinates",[O.x,O.y]),(0,I.Z)(G,"_id",D),G}),radius:v,xOffset:v,yOffset:v,type:"hexagon"};return w}function ch(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Kf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ch(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ch(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Yh(e,i){var r=i.sourceField,n=i.targetField,a=i.data,s={};return a.forEach(function(p){s[p[r]]=p}),e.dataArray=e.dataArray.map(function(p){var v=p[n];return Kf(Kf({},p),s[v])}),e}function Ad(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}Wn("geojson",uu),Wn("image",ei),Wn("csv",ms),Wn("json",Pi),Wn("raster",gi),qn("cluster",Pp),qn("filter",Lp),qn("join",Yh),qn("map",Ad),qn("grid",kp),qn("hexagon",jc);var wd=Ii,Mu=Ja,Bp=Gf,fh=N(28660),Ur=N(86700),ul=N(84879),qt={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Td=N(31745),Sl=N.n(Td);function Vc(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function hc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Vc(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Vc(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ul(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=qh(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function qh(e,i){if(!!e){if(typeof e=="string")return Np(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Np(e,i)}}function Np(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var dc=30;function ph(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,a=e.buffer,s=e.maxCanvasWidth,p=e.mapping,v=p===void 0?{}:p,g=e.xOffset,x=g===void 0?0:g,C=e.yOffset,w=C===void 0?0:C,O=0,D=x;Array.from(i).forEach(function(q,te){if(!v[q]){var Se=r(q,te);D+dc>s&&(D=0,O++),v[q]={x:D,y:w+O*dc,width:dc,height:dc,advance:Se},D+=dc}});var G=n+a*2;return{mapping:v,xOffset:D,yOffset:w+O*G,canvasHeight:Io(w+(O+1)*G)}}function Sa(e,i,r){var n=0,a=0,s=0,p=[],v={},g=Ul(e),x;try{for(g.s();!(x=g.n()).done;){var C=x.value;if(!v[C.id]){var w=C.size;n+w+i>r&&(Zl(v,p,a),n=0,a=s+a+i,s=0,p=[]),p.push({icon:C,xOffset:n}),n=n+w+i,s=Math.max(s,w)}}}catch(D){g.e(D)}finally{g.f()}p.length>0&&Zl(v,p,a);var O=Io(s+a+i);return{mapping:v,canvasHeight:O}}function Zl(e,i,r){var n=Ul(i),a;try{for(n.s();!(a=n.n()).done;){var s=a.value,p=s.icon,v=s.xOffset;e[p.id]=hc(hc({},p),{},{x:v,y:r,image:p.image,width:p.width,height:p.height})}}catch(g){n.e(g)}finally{n.f()}}function Io(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var Ws,hh;function dh(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Md(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function Md(e,i){if(!!e){if(typeof e=="string")return Kh(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Kh(e,i)}}function Kh(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function $h(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function $f(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?$h(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$h(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Pd=B(),Id="sans-serif",Qf="normal",Qh=24,Jh=3,Jf=.25,Ba=8,zp=1024,jl=1,Gc=1,vh=3,y0=null;function B(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function me(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function Be(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var Ft=(Ws=(0,Ur.b2)(),Ws(hh=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"fontAtlas",void 0),(0,I.Z)(this,"iconFontMap",void 0),(0,I.Z)(this,"iconFontGlyphs",{}),(0,I.Z)(this,"fontOptions",void 0),(0,I.Z)(this,"key",void 0),(0,I.Z)(this,"cache",new fe(vh))}return(0,wt.Z)(e,[{key:"scale",get:function(){return Gc}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:Id,fontWeight:Qf,characterSet:Pd,fontSize:Qh,buffer:Jh,sdf:!0,cutoff:Jf,radius:Ba,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var n=this;r.forEach(function(a){n.iconFontGlyphs[a.name]=a.unicode})}},{key:"addIconFont",value:function(r,n){this.iconFontMap.set(r,n)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=$f($f({},this.fontOptions),r),this.key=this.getKey();var n=this.getNewChars(this.key,this.fontOptions.characterSet),a=this.cache.get(this.key);if(!(a&&n.length===0)){var s=this.generateFontAtlas(this.key,n,a);this.fontAtlas=s,this.cache.set(this.key,s)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,n,a){var s=this.fontOptions,p=s.fontFamily,v=s.fontWeight,g=s.fontSize,x=s.buffer,C=s.sdf,w=s.radius,O=s.cutoff,D=s.iconfont,G=a&&a.data;G||(G=Ea.document.createElement("canvas"),G.width=zp);var q=G.getContext("2d");me(q,p,g,v);var te=ph($f({getFontWidth:function(ks){return q.measureText(ks).width},fontHeight:g*Gc,buffer:x,characterSet:n,maxCanvasWidth:zp},a&&{mapping:a.mapping,xOffset:a.xOffset,yOffset:a.yOffset})),Se=te.mapping,ze=te.canvasHeight,$e=te.xOffset,at=te.yOffset,Et=q.getImageData(0,0,G.width,G.height);if(G.height=ze,q.putImageData(Et,0,0),me(q,p,g,v),C){var Tt=new(Sl())(g,x,w,O,p,v),Jt=q.getImageData(0,0,Tt.size,Tt.size),fr=dh(n),Dr;try{for(fr.s();!(Dr=fr.n()).done;){var tn=Dr.value;if(D){var wr=String.fromCharCode(parseInt(tn.replace("&#x","").replace(";",""),16)),xn=Tt.draw(wr);Be(xn,Jt)}else Be(Tt.draw(tn),Jt);q.putImageData(Jt,Se[tn].x,Se[tn].y)}}catch(as){fr.e(as)}finally{fr.f()}}else{var Tn=dh(n),$n;try{for(Tn.s();!($n=Tn.n()).done;){var Ga=$n.value;q.fillText(Ga,Se[Ga].x,Se[Ga].y+g*jl)}}catch(as){Tn.e(as)}finally{Tn.f()}}return{xOffset:$e,yOffset:at,mapping:Se,data:G,width:G.width,height:G.height}}},{key:"getKey",value:function(){return"key";var r,n,a,s,p,v,g,x}},{key:"getNewChars",value:function(r,n){var a=this.cache.get(r);if(!a)return n;var s=[],p=a.mapping,v=new Set(Object.keys(p)),g=new Set(n);return g.forEach(function(x){v.has(x)||s.push(x)}),s}}]),e}())||hh),ur,Lt;function nr(e){var i=hr();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function hr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _r=3,br=1024,Tr=64,kr=(ur=(0,Ur.b2)(),ur(Lt=function(e){(0,en.Z)(r,e);var i=nr(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"canvasHeight",128),(0,I.Z)((0,he.Z)(n),"texture",void 0),(0,I.Z)((0,he.Z)(n),"canvas",void 0),(0,I.Z)((0,he.Z)(n),"iconData",void 0),(0,I.Z)((0,he.Z)(n),"iconMap",void 0),(0,I.Z)((0,he.Z)(n),"ctx",void 0),(0,I.Z)((0,he.Z)(n),"loadingImageCount",0),n}return(0,wt.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=Ea.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(a,s){var p=this,v=new Image;if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:Tr}),this.updateIconMap(),this.loadImage(s).then(function(g){v=g;var x=p.iconData.find(function(C){return C.id===a});x&&(x.image=v,x.width=v.width,x.height=v.height),p.update()})}},{key:"addImageMini",value:function(a,s,p){var v=this,g=p.getSceneConfig().canvas,x=g.createImage();if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:Tr}),this.updateIconMap(),this.loadImageMini(s,g).then(function(C){x=C;var w=v.iconData.find(function(O){return O.id===a});w&&(w.image=x,w.width=x.width,w.height=x.height),v.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(a){return this.iconMap.hasOwnProperty(a)}},{key:"removeImage",value:function(a){this.hasImage(a)&&(this.iconData=this.iconData.filter(function(s){return s.id!==a}),delete this.iconMap[a],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(a){return new Promise(function(s,p){if(a instanceof HTMLImageElement){s(a);return}var v=new Image;v.crossOrigin="anonymous",v.onload=function(){s(v)},v.onerror=function(){p(new Error("Could not load image at "+a))},v.src=a instanceof File?URL.createObjectURL(a):a})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var a=this;this.canvas.width=br,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(s){var p=a.iconMap[s],v=p.x,g=p.y,x=p.image,C=p.width,w=C===void 0?64:C,O=p.height,D=O===void 0?64:O,G=Math.max(w,D),q=G/Tr,te=D/q,Se=w/q;x&&a.ctx.drawImage(x,v+(Tr-Se)/2,g+(Tr-te)/2,Se,te)})}},{key:"updateIconMap",value:function(){var a=Sa(this.iconData,_r,br),s=a.mapping,p=a.canvasHeight;this.iconMap=s,this.canvasHeight=p}},{key:"loadImageMini",value:function(a,s){return new Promise(function(p,v){var g=s.createImage();g.crossOrigin="anonymous",g.onload=function(){p(g)},g.onerror=function(){v(new Error("Could not load image at "+a))},g.src=a})}}]),r}(ju.EventEmitter))||Lt),dr=N(49685);function gr(){var e=new dr.WT(16);return dr.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Pr(e){var i=new dr.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function ut(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function Gt(e,i,r,n,a,s,p,v,g,x,C,w,O,D,G,q){var te=new dr.WT(16);return te[0]=e,te[1]=i,te[2]=r,te[3]=n,te[4]=a,te[5]=s,te[6]=p,te[7]=v,te[8]=g,te[9]=x,te[10]=C,te[11]=w,te[12]=O,te[13]=D,te[14]=G,te[15]=q,te}function Ar(e,i,r,n,a,s,p,v,g,x,C,w,O,D,G,q,te){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=s,e[5]=p,e[6]=v,e[7]=g,e[8]=x,e[9]=C,e[10]=w,e[11]=O,e[12]=D,e[13]=G,e[14]=q,e[15]=te,e}function Zr(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pr(e,i){if(e===i){var r=i[1],n=i[2],a=i[3],s=i[6],p=i[7],v=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=s,e[11]=i[14],e[12]=a,e[13]=p,e[14]=v}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function Rr(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=i[4],v=i[5],g=i[6],x=i[7],C=i[8],w=i[9],O=i[10],D=i[11],G=i[12],q=i[13],te=i[14],Se=i[15],ze=r*v-n*p,$e=r*g-a*p,at=r*x-s*p,Et=n*g-a*v,Tt=n*x-s*v,Jt=a*x-s*g,fr=C*q-w*G,Dr=C*te-O*G,tn=C*Se-D*G,wr=w*te-O*q,xn=w*Se-D*q,Tn=O*Se-D*te,$n=ze*Tn-$e*xn+at*wr+Et*tn-Tt*Dr+Jt*fr;return $n?($n=1/$n,e[0]=(v*Tn-g*xn+x*wr)*$n,e[1]=(a*xn-n*Tn-s*wr)*$n,e[2]=(q*Jt-te*Tt+Se*Et)*$n,e[3]=(O*Tt-w*Jt-D*Et)*$n,e[4]=(g*tn-p*Tn-x*Dr)*$n,e[5]=(r*Tn-a*tn+s*Dr)*$n,e[6]=(te*at-G*Jt-Se*$e)*$n,e[7]=(C*Jt-O*at+D*$e)*$n,e[8]=(p*xn-v*tn+x*fr)*$n,e[9]=(n*tn-r*xn-s*fr)*$n,e[10]=(G*Tt-q*at+Se*ze)*$n,e[11]=(w*at-C*Tt-D*ze)*$n,e[12]=(v*Dr-p*wr-g*fr)*$n,e[13]=(r*wr-n*Dr+a*fr)*$n,e[14]=(q*$e-G*Et-te*ze)*$n,e[15]=(C*Et-w*$e+O*ze)*$n,e):null}function Qr(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=i[4],v=i[5],g=i[6],x=i[7],C=i[8],w=i[9],O=i[10],D=i[11],G=i[12],q=i[13],te=i[14],Se=i[15];return e[0]=v*(O*Se-D*te)-w*(g*Se-x*te)+q*(g*D-x*O),e[1]=-(n*(O*Se-D*te)-w*(a*Se-s*te)+q*(a*D-s*O)),e[2]=n*(g*Se-x*te)-v*(a*Se-s*te)+q*(a*x-s*g),e[3]=-(n*(g*D-x*O)-v*(a*D-s*O)+w*(a*x-s*g)),e[4]=-(p*(O*Se-D*te)-C*(g*Se-x*te)+G*(g*D-x*O)),e[5]=r*(O*Se-D*te)-C*(a*Se-s*te)+G*(a*D-s*O),e[6]=-(r*(g*Se-x*te)-p*(a*Se-s*te)+G*(a*x-s*g)),e[7]=r*(g*D-x*O)-p*(a*D-s*O)+C*(a*x-s*g),e[8]=p*(w*Se-D*q)-C*(v*Se-x*q)+G*(v*D-x*w),e[9]=-(r*(w*Se-D*q)-C*(n*Se-s*q)+G*(n*D-s*w)),e[10]=r*(v*Se-x*q)-p*(n*Se-s*q)+G*(n*x-s*v),e[11]=-(r*(v*D-x*w)-p*(n*D-s*w)+C*(n*x-s*v)),e[12]=-(p*(w*te-O*q)-C*(v*te-g*q)+G*(v*O-g*w)),e[13]=r*(w*te-O*q)-C*(n*te-a*q)+G*(n*O-a*w),e[14]=-(r*(v*te-g*q)-p*(n*te-a*q)+G*(n*g-a*v)),e[15]=r*(v*O-g*w)-p*(n*O-a*w)+C*(n*g-a*v),e}function Nn(e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],p=e[5],v=e[6],g=e[7],x=e[8],C=e[9],w=e[10],O=e[11],D=e[12],G=e[13],q=e[14],te=e[15],Se=i*p-r*s,ze=i*v-n*s,$e=i*g-a*s,at=r*v-n*p,Et=r*g-a*p,Tt=n*g-a*v,Jt=x*G-C*D,fr=x*q-w*D,Dr=x*te-O*D,tn=C*q-w*G,wr=C*te-O*G,xn=w*te-O*q;return Se*xn-ze*wr+$e*tn+at*Dr-Et*fr+Tt*Jt}function Xt(e,i,r){var n=i[0],a=i[1],s=i[2],p=i[3],v=i[4],g=i[5],x=i[6],C=i[7],w=i[8],O=i[9],D=i[10],G=i[11],q=i[12],te=i[13],Se=i[14],ze=i[15],$e=r[0],at=r[1],Et=r[2],Tt=r[3];return e[0]=$e*n+at*v+Et*w+Tt*q,e[1]=$e*a+at*g+Et*O+Tt*te,e[2]=$e*s+at*x+Et*D+Tt*Se,e[3]=$e*p+at*C+Et*G+Tt*ze,$e=r[4],at=r[5],Et=r[6],Tt=r[7],e[4]=$e*n+at*v+Et*w+Tt*q,e[5]=$e*a+at*g+Et*O+Tt*te,e[6]=$e*s+at*x+Et*D+Tt*Se,e[7]=$e*p+at*C+Et*G+Tt*ze,$e=r[8],at=r[9],Et=r[10],Tt=r[11],e[8]=$e*n+at*v+Et*w+Tt*q,e[9]=$e*a+at*g+Et*O+Tt*te,e[10]=$e*s+at*x+Et*D+Tt*Se,e[11]=$e*p+at*C+Et*G+Tt*ze,$e=r[12],at=r[13],Et=r[14],Tt=r[15],e[12]=$e*n+at*v+Et*w+Tt*q,e[13]=$e*a+at*g+Et*O+Tt*te,e[14]=$e*s+at*x+Et*D+Tt*Se,e[15]=$e*p+at*C+Et*G+Tt*ze,e}function ir(e,i,r){var n=r[0],a=r[1],s=r[2],p,v,g,x,C,w,O,D,G,q,te,Se;return i===e?(e[12]=i[0]*n+i[4]*a+i[8]*s+i[12],e[13]=i[1]*n+i[5]*a+i[9]*s+i[13],e[14]=i[2]*n+i[6]*a+i[10]*s+i[14],e[15]=i[3]*n+i[7]*a+i[11]*s+i[15]):(p=i[0],v=i[1],g=i[2],x=i[3],C=i[4],w=i[5],O=i[6],D=i[7],G=i[8],q=i[9],te=i[10],Se=i[11],e[0]=p,e[1]=v,e[2]=g,e[3]=x,e[4]=C,e[5]=w,e[6]=O,e[7]=D,e[8]=G,e[9]=q,e[10]=te,e[11]=Se,e[12]=p*n+C*a+G*s+i[12],e[13]=v*n+w*a+q*s+i[13],e[14]=g*n+O*a+te*s+i[14],e[15]=x*n+D*a+Se*s+i[15]),e}function dn(e,i,r){var n=r[0],a=r[1],s=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*a,e[5]=i[5]*a,e[6]=i[6]*a,e[7]=i[7]*a,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=i[11]*s,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function Xr(e,i,r,n){var a=n[0],s=n[1],p=n[2],v=Math.hypot(a,s,p),g,x,C,w,O,D,G,q,te,Se,ze,$e,at,Et,Tt,Jt,fr,Dr,tn,wr,xn,Tn,$n,Ga;return v<dr.Ib?null:(v=1/v,a*=v,s*=v,p*=v,g=Math.sin(r),x=Math.cos(r),C=1-x,w=i[0],O=i[1],D=i[2],G=i[3],q=i[4],te=i[5],Se=i[6],ze=i[7],$e=i[8],at=i[9],Et=i[10],Tt=i[11],Jt=a*a*C+x,fr=s*a*C+p*g,Dr=p*a*C-s*g,tn=a*s*C-p*g,wr=s*s*C+x,xn=p*s*C+a*g,Tn=a*p*C+s*g,$n=s*p*C-a*g,Ga=p*p*C+x,e[0]=w*Jt+q*fr+$e*Dr,e[1]=O*Jt+te*fr+at*Dr,e[2]=D*Jt+Se*fr+Et*Dr,e[3]=G*Jt+ze*fr+Tt*Dr,e[4]=w*tn+q*wr+$e*xn,e[5]=O*tn+te*wr+at*xn,e[6]=D*tn+Se*wr+Et*xn,e[7]=G*tn+ze*wr+Tt*xn,e[8]=w*Tn+q*$n+$e*Ga,e[9]=O*Tn+te*$n+at*Ga,e[10]=D*Tn+Se*$n+Et*Ga,e[11]=G*Tn+ze*$n+Tt*Ga,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function Er(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[4],p=i[5],v=i[6],g=i[7],x=i[8],C=i[9],w=i[10],O=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=s*a+x*n,e[5]=p*a+C*n,e[6]=v*a+w*n,e[7]=g*a+O*n,e[8]=x*a-s*n,e[9]=C*a-p*n,e[10]=w*a-v*n,e[11]=O*a-g*n,e}function Hr(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],p=i[1],v=i[2],g=i[3],x=i[8],C=i[9],w=i[10],O=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a-x*n,e[1]=p*a-C*n,e[2]=v*a-w*n,e[3]=g*a-O*n,e[8]=s*n+x*a,e[9]=p*n+C*a,e[10]=v*n+w*a,e[11]=g*n+O*a,e}function Yr(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],p=i[1],v=i[2],g=i[3],x=i[4],C=i[5],w=i[6],O=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a+x*n,e[1]=p*a+C*n,e[2]=v*a+w*n,e[3]=g*a+O*n,e[4]=x*a-s*n,e[5]=C*a-p*n,e[6]=w*a-v*n,e[7]=O*a-g*n,e}function yi(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function ai(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function qr(e,i,r){var n=r[0],a=r[1],s=r[2],p=Math.hypot(n,a,s),v,g,x;return p<dr.Ib?null:(p=1/p,n*=p,a*=p,s*=p,v=Math.sin(i),g=Math.cos(i),x=1-g,e[0]=n*n*x+g,e[1]=a*n*x+s*v,e[2]=s*n*x-a*v,e[3]=0,e[4]=n*a*x-s*v,e[5]=a*a*x+g,e[6]=s*a*x+n*v,e[7]=0,e[8]=n*s*x+a*v,e[9]=a*s*x-n*v,e[10]=s*s*x+g,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function sn(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Qn(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function hi(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function zi(e,i,r){var n=i[0],a=i[1],s=i[2],p=i[3],v=n+n,g=a+a,x=s+s,C=n*v,w=n*g,O=n*x,D=a*g,G=a*x,q=s*x,te=p*v,Se=p*g,ze=p*x;return e[0]=1-(D+q),e[1]=w+ze,e[2]=O-Se,e[3]=0,e[4]=w-ze,e[5]=1-(C+q),e[6]=G+te,e[7]=0,e[8]=O+Se,e[9]=G-te,e[10]=1-(C+D),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function po(e,i){var r=new dr.WT(3),n=-i[0],a=-i[1],s=-i[2],p=i[3],v=i[4],g=i[5],x=i[6],C=i[7],w=n*n+a*a+s*s+p*p;return w>0?(r[0]=(v*p+C*n+g*s-x*a)*2/w,r[1]=(g*p+C*a+x*n-v*s)*2/w,r[2]=(x*p+C*s+v*a-g*n)*2/w):(r[0]=(v*p+C*n+g*s-x*a)*2,r[1]=(g*p+C*a+x*n-v*s)*2,r[2]=(x*p+C*s+v*a-g*n)*2),zi(e,i,r),e}function go(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function Di(e,i){var r=i[0],n=i[1],a=i[2],s=i[4],p=i[5],v=i[6],g=i[8],x=i[9],C=i[10];return e[0]=Math.hypot(r,n,a),e[1]=Math.hypot(s,p,v),e[2]=Math.hypot(g,x,C),e}function us(e,i){var r=new dr.WT(3);Di(r,i);var n=1/r[0],a=1/r[1],s=1/r[2],p=i[0]*n,v=i[1]*a,g=i[2]*s,x=i[4]*n,C=i[5]*a,w=i[6]*s,O=i[8]*n,D=i[9]*a,G=i[10]*s,q=p+C+G,te=0;return q>0?(te=Math.sqrt(q+1)*2,e[3]=.25*te,e[0]=(w-D)/te,e[1]=(O-g)/te,e[2]=(v-x)/te):p>C&&p>G?(te=Math.sqrt(1+p-C-G)*2,e[3]=(w-D)/te,e[0]=.25*te,e[1]=(v+x)/te,e[2]=(O+g)/te):C>G?(te=Math.sqrt(1+C-p-G)*2,e[3]=(O-g)/te,e[0]=(v+x)/te,e[1]=.25*te,e[2]=(w+D)/te):(te=Math.sqrt(1+G-p-C)*2,e[3]=(v-x)/te,e[0]=(O+g)/te,e[1]=(w+D)/te,e[2]=.25*te),e}function Ka(e,i,r,n){var a=i[0],s=i[1],p=i[2],v=i[3],g=a+a,x=s+s,C=p+p,w=a*g,O=a*x,D=a*C,G=s*x,q=s*C,te=p*C,Se=v*g,ze=v*x,$e=v*C,at=n[0],Et=n[1],Tt=n[2];return e[0]=(1-(G+te))*at,e[1]=(O+$e)*at,e[2]=(D-ze)*at,e[3]=0,e[4]=(O-$e)*Et,e[5]=(1-(w+te))*Et,e[6]=(q+Se)*Et,e[7]=0,e[8]=(D+ze)*Tt,e[9]=(q-Se)*Tt,e[10]=(1-(w+G))*Tt,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function ns(e,i,r,n,a){var s=i[0],p=i[1],v=i[2],g=i[3],x=s+s,C=p+p,w=v+v,O=s*x,D=s*C,G=s*w,q=p*C,te=p*w,Se=v*w,ze=g*x,$e=g*C,at=g*w,Et=n[0],Tt=n[1],Jt=n[2],fr=a[0],Dr=a[1],tn=a[2],wr=(1-(q+Se))*Et,xn=(D+at)*Et,Tn=(G-$e)*Et,$n=(D-at)*Tt,Ga=(1-(O+Se))*Tt,as=(te+ze)*Tt,ks=(G+$e)*Jt,Ds=(te-ze)*Jt,Qs=(1-(O+q))*Jt;return e[0]=wr,e[1]=xn,e[2]=Tn,e[3]=0,e[4]=$n,e[5]=Ga,e[6]=as,e[7]=0,e[8]=ks,e[9]=Ds,e[10]=Qs,e[11]=0,e[12]=r[0]+fr-(wr*fr+$n*Dr+ks*tn),e[13]=r[1]+Dr-(xn*fr+Ga*Dr+Ds*tn),e[14]=r[2]+tn-(Tn*fr+as*Dr+Qs*tn),e[15]=1,e}function Oo(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=r+r,v=n+n,g=a+a,x=r*p,C=n*p,w=n*v,O=a*p,D=a*v,G=a*g,q=s*p,te=s*v,Se=s*g;return e[0]=1-w-G,e[1]=C+Se,e[2]=O-te,e[3]=0,e[4]=C-Se,e[5]=1-x-G,e[6]=D+q,e[7]=0,e[8]=O+te,e[9]=D-q,e[10]=1-x-w,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function is(e,i,r,n,a,s,p){var v=1/(r-i),g=1/(a-n),x=1/(s-p);return e[0]=s*2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*g,e[6]=0,e[7]=0,e[8]=(r+i)*v,e[9]=(a+n)*g,e[10]=(p+s)*x,e[11]=-1,e[12]=0,e[13]=0,e[14]=p*s*2*x,e[15]=0,e}function Uo(e,i,r,n,a){var s=1/Math.tan(i/2),p;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(p=1/(n-a),e[10]=(a+n)*p,e[14]=2*a*n*p):(e[10]=-1,e[14]=-2*n),e}var ls=Uo;function yo(e,i,r,n,a){var s=1/Math.tan(i/2),p;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(p=1/(n-a),e[10]=a*p,e[14]=a*n*p):(e[10]=-1,e[14]=-n),e}function _i(e,i,r,n){var a=Math.tan(i.upDegrees*Math.PI/180),s=Math.tan(i.downDegrees*Math.PI/180),p=Math.tan(i.leftDegrees*Math.PI/180),v=Math.tan(i.rightDegrees*Math.PI/180),g=2/(p+v),x=2/(a+s);return e[0]=g,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=-((p-v)*g*.5),e[9]=(a-s)*x*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function Zo(e,i,r,n,a,s,p){var v=1/(i-r),g=1/(n-a),x=1/(s-p);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*g,e[14]=(p+s)*x,e[15]=1,e}var ra=Zo;function cs(e,i,r,n,a,s,p){var v=1/(i-r),g=1/(n-a),x=1/(s-p);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*g,e[14]=s*x,e[15]=1,e}function ii(e,i,r,n){var a,s,p,v,g,x,C,w,O,D,G=i[0],q=i[1],te=i[2],Se=n[0],ze=n[1],$e=n[2],at=r[0],Et=r[1],Tt=r[2];return Math.abs(G-at)<dr.Ib&&Math.abs(q-Et)<dr.Ib&&Math.abs(te-Tt)<dr.Ib?Zr(e):(C=G-at,w=q-Et,O=te-Tt,D=1/Math.hypot(C,w,O),C*=D,w*=D,O*=D,a=ze*O-$e*w,s=$e*C-Se*O,p=Se*w-ze*C,D=Math.hypot(a,s,p),D?(D=1/D,a*=D,s*=D,p*=D):(a=0,s=0,p=0),v=w*p-O*s,g=O*a-C*p,x=C*s-w*a,D=Math.hypot(v,g,x),D?(D=1/D,v*=D,g*=D,x*=D):(v=0,g=0,x=0),e[0]=a,e[1]=v,e[2]=C,e[3]=0,e[4]=s,e[5]=g,e[6]=w,e[7]=0,e[8]=p,e[9]=x,e[10]=O,e[11]=0,e[12]=-(a*G+s*q+p*te),e[13]=-(v*G+g*q+x*te),e[14]=-(C*G+w*q+O*te),e[15]=1,e)}function Ui(e,i,r,n){var a=i[0],s=i[1],p=i[2],v=n[0],g=n[1],x=n[2],C=a-r[0],w=s-r[1],O=p-r[2],D=C*C+w*w+O*O;D>0&&(D=1/Math.sqrt(D),C*=D,w*=D,O*=D);var G=g*O-x*w,q=x*C-v*O,te=v*w-g*C;return D=G*G+q*q+te*te,D>0&&(D=1/Math.sqrt(D),G*=D,q*=D,te*=D),e[0]=G,e[1]=q,e[2]=te,e[3]=0,e[4]=w*te-O*q,e[5]=O*G-C*te,e[6]=C*q-w*G,e[7]=0,e[8]=C,e[9]=w,e[10]=O,e[11]=0,e[12]=a,e[13]=s,e[14]=p,e[15]=1,e}function ga(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Ro(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Cl(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function we(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function Ut(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function bt(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function gn(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function Fi(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],p=e[4],v=e[5],g=e[6],x=e[7],C=e[8],w=e[9],O=e[10],D=e[11],G=e[12],q=e[13],te=e[14],Se=e[15],ze=i[0],$e=i[1],at=i[2],Et=i[3],Tt=i[4],Jt=i[5],fr=i[6],Dr=i[7],tn=i[8],wr=i[9],xn=i[10],Tn=i[11],$n=i[12],Ga=i[13],as=i[14],ks=i[15];return Math.abs(r-ze)<=dr.Ib*Math.max(1,Math.abs(r),Math.abs(ze))&&Math.abs(n-$e)<=dr.Ib*Math.max(1,Math.abs(n),Math.abs($e))&&Math.abs(a-at)<=dr.Ib*Math.max(1,Math.abs(a),Math.abs(at))&&Math.abs(s-Et)<=dr.Ib*Math.max(1,Math.abs(s),Math.abs(Et))&&Math.abs(p-Tt)<=dr.Ib*Math.max(1,Math.abs(p),Math.abs(Tt))&&Math.abs(v-Jt)<=dr.Ib*Math.max(1,Math.abs(v),Math.abs(Jt))&&Math.abs(g-fr)<=dr.Ib*Math.max(1,Math.abs(g),Math.abs(fr))&&Math.abs(x-Dr)<=dr.Ib*Math.max(1,Math.abs(x),Math.abs(Dr))&&Math.abs(C-tn)<=dr.Ib*Math.max(1,Math.abs(C),Math.abs(tn))&&Math.abs(w-wr)<=dr.Ib*Math.max(1,Math.abs(w),Math.abs(wr))&&Math.abs(O-xn)<=dr.Ib*Math.max(1,Math.abs(O),Math.abs(xn))&&Math.abs(D-Tn)<=dr.Ib*Math.max(1,Math.abs(D),Math.abs(Tn))&&Math.abs(G-$n)<=dr.Ib*Math.max(1,Math.abs(G),Math.abs($n))&&Math.abs(q-Ga)<=dr.Ib*Math.max(1,Math.abs(q),Math.abs(Ga))&&Math.abs(te-as)<=dr.Ib*Math.max(1,Math.abs(te),Math.abs(as))&&Math.abs(Se-ks)<=dr.Ib*Math.max(1,Math.abs(Se),Math.abs(ks))}var Ce=Xt,ie=we,Ve,ft,Ot=(Ve=(0,Ur.b2)(),Ve(ft=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"viewport",void 0),(0,I.Z)(this,"overridedViewProjectionMatrix",void 0),(0,I.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,I.Z)(this,"jitteredProjectionMatrix",void 0),(0,I.Z)(this,"viewMatrixInverse",void 0),(0,I.Z)(this,"cameraPosition",void 0)}return(0,wt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=gr(),Rr(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,Q.Z)(r,2),a=n[0],s=n[1];return[a,s]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var a=yi(gr(),[r,n,0]);this.jitteredProjectionMatrix=Xt(gr(),a,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Xt(gr(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||ft),qe,Fe;function nt(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_e(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function _e(e,i){if(!!e){if(typeof e=="string")return Ue(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ue(e,i)}}function Ue(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Ae=(qe=(0,Ur.b2)(),qe(Fe=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"container",void 0),(0,I.Z)(this,"controlCorners",void 0),(0,I.Z)(this,"controlContainer",void 0),(0,I.Z)(this,"scene",void 0),(0,I.Z)(this,"mapsService",void 0),(0,I.Z)(this,"controls",[]),(0,I.Z)(this,"unAddControls",[])}return(0,wt.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(qt.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var a=n.get(qt.IMapService);a.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=nt(this.controls),n;try{for(r.s();!(n=r.n()).done;){var a=n.value;a.remove()}}catch(s){r.e(s)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",a=this.controlContainer=va("div",n+"control-container",this.container);function s(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],v=p.map(function(g){return n+g}).join(" ");r[p.join("")]=va("div",v,a)}s(["top","left"]),s(["top","right"]),s(["bottom","left"]),s(["bottom","right"]),s(["top","center"]),s(["right","center"]),s(["left","center"]),s(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&mo(this.controlCorners[r]);this.controlContainer&&mo(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||Fe),pt,_t,vr=(pt=(0,Ur.b2)(),pt(_t=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"container",void 0),(0,I.Z)(this,"scene",void 0),(0,I.Z)(this,"mapsService",void 0),(0,I.Z)(this,"markers",[]),(0,I.Z)(this,"markerLayers",[]),(0,I.Z)(this,"unAddMarkers",[]),(0,I.Z)(this,"unAddMarkerLayers",[])}return(0,wt.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(qt.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||_t),jr,Vr,nn=(jr=(0,Ur.b2)(),jr(Vr=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"scene",void 0),(0,I.Z)(this,"popup",void 0),(0,I.Z)(this,"mapsService",void 0),(0,I.Z)(this,"unAddPopup",void 0)}return(0,wt.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(qt.IMapService)}}]),e}())||Vr),Nr=N(82492),Cn=N.n(Nr),fn={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},Sn=fn,_n,vn;function Xn(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ya(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Xn(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Xn(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var fs={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},ja={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},_a=(_n=(0,Ur.b2)(),_n(vn=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"sceneConfigCache",{}),(0,I.Z)(this,"layerConfigCache",{})}return(0,wt.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return Sn[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=ya(ya({},fs),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,a){this.layerConfigCache[n]=ya({},Cn()({},this.sceneConfigCache[r],ja,a))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||vn);function fi(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function Hn(e,i,r,n,a){var s={};return Object.keys(n).forEach(function(p){s[p]=n[p]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=r.slice().reverse().reduce(function(p,v){return v(e,i,p)||p},s),a&&s.initializer!==void 0&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),s.initializer===void 0&&(Object.defineProperty(e,i,s),s=null),s}function Vu(){var e=new dr.WT(4);return dr.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Gu(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function mh(e,i,r,n){var a=new dr.WT(4);return a[0]=e,a[1]=i,a[2]=r,a[3]=n,a}function Hu(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function Hc(e,i,r,n,a){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e}function Up(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function yv(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function ps(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function ed(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function Af(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function Od(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function Rd(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function _0(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function gh(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function Wc(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function _v(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function xv(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return Math.hypot(r,n,a,s)}function ym(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return r*r+n*n+a*a+s*s}function Ms(e){var i=e[0],r=e[1],n=e[2],a=e[3];return Math.hypot(i,r,n,a)}function ep(e){var i=e[0],r=e[1],n=e[2],a=e[3];return i*i+r*r+n*n+a*a}function bv(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function t(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function o(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=r*r+n*n+a*a+s*s;return p>0&&(p=1/Math.sqrt(p)),e[0]=r*p,e[1]=n*p,e[2]=a*p,e[3]=s*p,e}function u(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function h(e,i,r,n){var a=r[0]*n[1]-r[1]*n[0],s=r[0]*n[2]-r[2]*n[0],p=r[0]*n[3]-r[3]*n[0],v=r[1]*n[2]-r[2]*n[1],g=r[1]*n[3]-r[3]*n[1],x=r[2]*n[3]-r[3]*n[2],C=i[0],w=i[1],O=i[2],D=i[3];return e[0]=w*x-O*g+D*v,e[1]=-(C*x)+O*p-D*s,e[2]=C*g-w*p+D*a,e[3]=-(C*v)+w*s-O*a,e}function y(e,i,r,n){var a=i[0],s=i[1],p=i[2],v=i[3];return e[0]=a+n*(r[0]-a),e[1]=s+n*(r[1]-s),e[2]=p+n*(r[2]-p),e[3]=v+n*(r[3]-v),e}function b(e,i){i=i||1;var r,n,a,s,p,v;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,p=r*r+n*n;while(p>=1);do a=glMatrix.RANDOM()*2-1,s=glMatrix.RANDOM()*2-1,v=a*a+s*s;while(v>=1);var g=Math.sqrt((1-p)/v);return e[0]=i*r,e[1]=i*n,e[2]=i*a*g,e[3]=i*s*g,e}function S(e,i,r){var n=i[0],a=i[1],s=i[2],p=i[3];return e[0]=r[0]*n+r[4]*a+r[8]*s+r[12]*p,e[1]=r[1]*n+r[5]*a+r[9]*s+r[13]*p,e[2]=r[2]*n+r[6]*a+r[10]*s+r[14]*p,e[3]=r[3]*n+r[7]*a+r[11]*s+r[15]*p,e}function P(e,i,r){var n=i[0],a=i[1],s=i[2],p=r[0],v=r[1],g=r[2],x=r[3],C=x*n+v*s-g*a,w=x*a+g*n-p*s,O=x*s+p*a-v*n,D=-p*n-v*a-g*s;return e[0]=C*x+D*-p+w*-g-O*-v,e[1]=w*x+D*-v+O*-p-C*-g,e[2]=O*x+D*-g+C*-v-w*-p,e[3]=i[3],e}function k(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function z(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Z(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function W(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],p=i[0],v=i[1],g=i[2],x=i[3];return Math.abs(r-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(n-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(a-g)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(s-x)<=glMatrix.EPSILON*Math.max(1,Math.abs(s),Math.abs(x))}var ee=null,ne=null,Me=null,Oe=null,Ye=null,Ze=null,st=null,Ct=function(){var e=Vu();return function(i,r,n,a,s,p){var v,g;for(r||(r=4),n||(n=0),a?g=Math.min(a*r+n,i.length):g=i.length,v=n;v<g;v+=r)e[0]=i[v],e[1]=i[v+1],e[2]=i[v+2],e[3]=i[v+3],s(e,e,p),i[v]=e[0],i[v+1]=e[1],i[v+2]=e[2],i[v+3]=e[3];return i}}(),Zt=Math.PI/180,Wt=512,lr=4003e4;function Lr(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,a=n===void 0?0:n,s=e.scale,p=e.highPrecision,v=p===void 0?!1:p,g=e.flipY,x=g===void 0?!1:g;s=s!==void 0?s:Math.pow(2,a);var C={},w=Wt*s,O=Math.cos(r*Zt),D=w/360,G=D/O,q=w/lr/O;if(C.pixelsPerMeter=[q,-q,q],C.metersPerPixel=[1/q,-1/q,1/q],C.pixelsPerDegree=[D,-G,q],C.degreesPerPixel=[1/D,-1/G,1/q],v){var te=Zt*Math.tan(r*Zt)/O,Se=D*te/2,ze=w/lr*te,$e=ze/G*q;C.pixelsPerDegree2=[0,-Se,ze],C.pixelsPerMeter2=[$e,0,$e],x&&(C.pixelsPerDegree2[1]=-C.pixelsPerDegree2[1],C.pixelsPerMeter2[1]=-C.pixelsPerMeter2[1])}return x&&(C.pixelsPerMeter[1]=-C.pixelsPerMeter[1],C.metersPerPixel[1]=-C.metersPerPixel[1],C.pixelsPerDegree[1]=-C.pixelsPerDegree[1],C.degreesPerPixel[1]=-C.degreesPerPixel[1]),C}var zr;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(zr||(zr={}));var Pn={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},pn,zn,mn,Mi,ti,In=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],ji=(pn=(0,Ur.b2)(),zn=(0,Ur.f3)(qt.ICameraService),pn(mn=(Mi=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"needRefresh",!0),fi(this,"cameraService",ti,this),(0,I.Z)(this,"coordinateSystem",void 0),(0,I.Z)(this,"viewportCenter",void 0),(0,I.Z)(this,"viewportCenterProjection",void 0),(0,I.Z)(this,"pixelsPerDegree",void 0),(0,I.Z)(this,"pixelsPerDegree2",void 0),(0,I.Z)(this,"pixelsPerMeter",void 0)}return(0,wt.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),a=this.cameraService.getCenter(),s=Lr({latitude:a[1],zoom:r}),p=s.pixelsPerMeter,v=s.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=p,this.pixelsPerDegree=v,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===zr.LNGLAT||this.coordinateSystem===zr.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===zr.LNGLAT_OFFSET?this.calculateLnglatOffset(a,r):this.coordinateSystem===zr.P20_OFFSET&&this.calculateLnglatOffset(a,r,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,a,s){var p=Lr({latitude:r[1],zoom:n,scale:a,flipY:s,highPrecision:!0}),v=p.pixelsPerMeter,g=p.pixelsPerDegree,x=p.pixelsPerDegree2,C=this.cameraService.getViewMatrix(),w=this.cameraService.getProjectionMatrix(),O=Xt([],w,C),D=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=S([],[D[0],D[1],0,1],O),C=this.cameraService.getViewMatrixUncentered()||C,O=Xt([],w,C),O=Xt([],O,In),this.cameraService.setViewProjectionMatrix(O),this.pixelsPerMeter=v,this.pixelsPerDegree=g,this.pixelsPerDegree2=x}}]),e}(),ti=Hn(Mi.prototype,"cameraService",[zn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mi))||mn),Ci=N(20396),Wi=N.n(Ci),An;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(An||(An={}));var ca,no,So,ho,io;function Lo(e){var i=hs();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function hs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ds={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},Xs=(ca=(0,Ur.b2)(),no=(0,Ur.f3)(qt.IMapService),ca(So=(ho=function(e){(0,en.Z)(r,e);var i=Lo(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"indragging",!1),fi((0,he.Z)(n),"mapService",io,(0,he.Z)(n)),(0,I.Z)((0,he.Z)(n),"hammertime",void 0),(0,I.Z)((0,he.Z)(n),"lastClickTime",0),(0,I.Z)((0,he.Z)(n),"lastClickXY",[-1,-1]),(0,I.Z)((0,he.Z)(n),"clickTimer",void 0),(0,I.Z)((0,he.Z)(n),"$containter",void 0),(0,I.Z)((0,he.Z)(n),"onDrag",function(v){var g=n.interactionEvent(v);g.type=ds[g.type],g.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(An.Drag,g)}),(0,I.Z)((0,he.Z)(n),"onHammer",function(v){v.srcEvent.stopPropagation();var g=n.interactionEvent(v);n.emit(An.Hover,g)}),(0,I.Z)((0,he.Z)(n),"onTouch",function(v){var g=v.touches[0];n.onHover({x:g.pageX,y:g.pageY,type:"touch"})}),(0,I.Z)((0,he.Z)(n),"onHover",function(v){var g=v.clientX,x=v.clientY,C=g,w=x,O=v.type,D=n.mapService.getMapContainer();if(D)if(To)C=C-D.left-0,w=w-D.top-0;else{var G=D.getBoundingClientRect(),q=G.top,te=G.left;C=C-te-D.clientLeft,w=w-q-D.clientTop}var Se=n.mapService.containerToLngLat([C,w]);if(O==="click"){if(!To&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(C,w,Se);return}if(O==="touch"){n.isDoubleTap(C,w,Se);return}O!=="click"&&O!=="dblclick"&&n.emit(An.Hover,{x:C,y:w,lngLat:Se,type:O,target:v})}),n}return(0,wt.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(An.Hover)}},{key:"triggerHover",value:function(a){var s=a.x,p=a.y;this.emit(An.Hover,{x:s,y:p})}},{key:"triggerSelect",value:function(a){this.emit(An.Select,{featureId:a})}},{key:"triggerActive",value:function(a){this.emit(An.Active,{featureId:a})}},{key:"handleMiniEvent",value:function(a){this.onHover({clientX:a.touches[0].pageX,clientY:a.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var a=this.mapService.getMapContainer();if(a)if(To)Ea.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var s=new(Wi()).Manager(a);s.add(new(Wi()).Tap({event:"dblclick",taps:2})),s.add(new(Wi()).Tap({event:"click"})),s.add(new(Wi()).Pan({threshold:0,pointers:0})),s.add(new(Wi()).Press({})),s.on("dblclick click",this.onHammer),s.on("panstart panmove panend pancancel",this.onDrag),a.addEventListener("mousemove",this.onHover),a.addEventListener("mousedown",this.onHover,!0),a.addEventListener("mouseup",this.onHover),a.addEventListener("contextmenu",this.onHover),this.hammertime=s}}},{key:"removeEventListenerOnMap",value:function(){if(To)Ea.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var a=this.mapService.getMapContainer();a&&(a.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),a.removeEventListener("mousedown",this.onHover),a.removeEventListener("mouseup",this.onHover),a.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(a){var s=a.type,p=a.pointerType,v,g;p==="touch"?(g=Math.floor(a.pointers[0].clientY),v=Math.floor(a.pointers[0].clientX)):(g=Math.floor(a.srcEvent.y),v=Math.floor(a.srcEvent.x));var x=this.mapService.getMapContainer();if(x){var C=x.getBoundingClientRect(),w=C.top,O=C.left;v-=O,g-=w}var D=this.mapService.containerToLngLat([v,g]);return{x:v,y:g,lngLat:D,type:s,target:a.srcEvent}}},{key:"isDoubleTap",value:function(a,s,p){var v=this,g=new Date().getTime(),x="click";g-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-a)<10&&Math.abs(this.lastClickXY[1]-s)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),x="dblclick",this.emit(An.Hover,{x:a,y:s,lngLat:p,type:x})):(this.lastClickTime=g,this.lastClickXY=[a,s],this.clickTimer=setTimeout(function(){x="click",v.emit(An.Hover,{x:a,y:s,lngLat:p,type:x})},400))}}]),r}(zl()),io=Hn(ho.prototype,"mapService",[no],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ho))||So),Ta=N(92137),Ys=N(87757),di=N.n(Ys),Cs=0;function qi(e){if(To)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(Cs++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function Va(e){var i,r,n=!0;return e==null||(i=e.target)===null||i===void 0||(r=i.path)===null||r===void 0||r.map(function(a){if(a!=null&&a.classList){var s;a==null||(s=a.classList)===null||s===void 0||s.forEach(function(p){(p==="l7-marker"||p==="l7-popup")&&(n=!1)})}}),n}var V;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(V||(V={}));var na,qs,Ps,$a,jo,Is,fa,mu,Pu,Vl,ko,Gl,ll;function tp(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function vc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?tp(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tp(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Zp=(na=(0,Ur.b2)(),qs=(0,Ur.f3)(qt.IMapService),Ps=(0,Ur.f3)(qt.IRendererService),$a=(0,Ur.f3)(qt.IGlobalConfigService),jo=(0,Ur.f3)(qt.IInteractionService),Is=(0,Ur.f3)(qt.ILayerService),na(fa=(mu=function(){function e(){var i=this;(0,ot.Z)(this,e),fi(this,"mapService",Pu,this),fi(this,"rendererService",Vl,this),fi(this,"configService",ko,this),fi(this,"interactionService",Gl,this),fi(this,"layerService",ll,this),(0,I.Z)(this,"pickingFBO",void 0),(0,I.Z)(this,"width",0),(0,I.Z)(this,"height",0),(0,I.Z)(this,"alreadyInPicking",!1),(0,I.Z)(this,"pickBufferScale",1),(0,I.Z)(this,"lastPickTime",new Date().getTime()),(0,I.Z)(this,"pickFromPickingFBO",function(r,n){var a,s=n.x,p=n.y,v=n.lngLat,g=n.type,x=n.target,C=!1,w=i.rendererService,O=w.getViewportSize,D=w.readPixels,G=w.getContainer,q=i.getContainerSize(G()),te=q.width,Se=q.height;te*=wa,Se*=wa;var ze=r.getLayerConfig(),$e=ze.enableHighlight,at=ze.enableSelect,Et=s*wa,Tt=p*wa;if(Et>te-1*wa||Et<0||Tt>Se-1*wa||Tt<0)return!1;var Jt;if(Jt=D({x:Math.floor(Et/i.pickBufferScale),y:Math.floor((Se-(p+1)*wa)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),Jt[0]!==0||Jt[1]!==0||Jt[2]!==0){var fr=je(Jt),Dr=r.getSource().getFeatureById(fr);fr!==r.getCurrentPickId()&&g==="mousemove"&&(g="mouseenter");var tn={x:s,y:p,type:g,lngLat:v,featureId:fr,feature:Dr,target:x};Dr&&(C=!0,r.setCurrentPickId(fr),i.triggerHoverOnLayer(r,tn))}else{var wr={x:s,y:p,lngLat:v,type:r.getCurrentPickId()!==null&&g==="mousemove"?"mouseout":"un"+g,featureId:null,target:x,feature:null};i.triggerHoverOnLayer(r,vc(vc({},wr),{},{type:"unpick"})),i.triggerHoverOnLayer(r,wr),r.setCurrentPickId(null)}if($e&&i.highlightPickedFeature(r,Jt),at&&g==="click"&&((a=Jt)===null||a===void 0?void 0:a.toString())!==[0,0,0,0].toString()){var xn=je(Jt);r.getCurrentSelectedId()===null||xn!==r.getCurrentSelectedId()?(i.selectFeature(r,Jt),r.setCurrentSelectedId(xn)):(i.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return C})}return(0,wt.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,a=n.createTexture2D,s=n.createFramebuffer,p=n.getViewportSize,v=n.getContainer,g=this.getContainerSize(v()),x=g.width,C=g.height;x*=wa,C*=wa,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=s({color:a({width:Math.round(x/this.pickBufferScale),height:Math.round(C/this.pickBufferScale),wrapS:V.CLAMP_TO_EDGE,wrapT:V.CLAMP_TO_EDGE})}),this.interactionService.on(An.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,Ta.Z)(di().mark(function n(a,s,p){var v=this,g,x,C,w;return di().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:g=this.rendererService,x=g.useFramebuffer,C=g.clear,w=g.getContainer,this.resizePickingFBO(),x(this.pickingFBO,function(){C({framebuffer:v.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),a.hooks.beforePickingEncode.call(),a.renderModels(),a.hooks.afterPickingEncode.call();var G=v.pickBox(a,s);p(G)});case 3:case"end":return D.stop()}},n,this)}));function r(n,a,s){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var a=this,s=n.map(function(wr){var xn=wr<0?0:wr;return Math.floor(xn*wa/a.pickBufferScale)}),p=(0,Q.Z)(s,4),v=p[0],g=p[1],x=p[2],C=p[3],w=this.rendererService,O=w.getViewportSize,D=w.readPixels,G=w.getContainer,q=this.getContainerSize(G()),te=q.width,Se=q.height;if(te*=wa,Se*=wa,v>(te-1)*wa/this.pickBufferScale||x<0||g>(Se-1)*wa/this.pickBufferScale||C<0)return[];var ze,$e=Math.min(te/this.pickBufferScale,x)-v,at=Math.min(Se/this.pickBufferScale,C)-g;ze=D({x:v,y:Math.floor(Se/this.pickBufferScale-(C+1)),width:$e,height:at,data:new Uint8Array($e*at*4),framebuffer:this.pickingFBO});for(var Et=[],Tt={},Jt=0;Jt<ze.length/4;Jt=Jt+1){var fr=ze.slice(Jt*4,Jt*4+4),Dr=je(fr);if(Dr!==-1&&!Tt[Dr]){var tn=r.getSource().getFeatureById(Dr);Et.push(vc(vc({},tn),{},{pickedFeatureIdx:Dr})),Tt[Dr]=!0}}return Et}},{key:"handleCursor",value:function(r,n){var a=r.getLayerConfig(),s=a.cursor,p=s===void 0?"":s,v=a.cursorEnabled;if(v){var g=this.mapService.version,x=g==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),C=x==null?void 0:x.style.getPropertyValue("cursor");n==="unmousemove"&&C!==""?x==null||x.style.setProperty("cursor",""):n==="mousemove"&&(x==null||x.style.setProperty("cursor",p))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/wa,height:r.height/wa}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,Ta.Z)(di().mark(function n(a){var s;return di().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())){v.next=2;break}return v.abrupt("return");case 2:if(this.alreadyInPicking=!0,s=new Date().getTime(),!(s-this.lastPickTime>10||a.type==="contextmenu"||a.type==="click")){v.next=7;break}return v.next=7,this.pickingLayers(a);case 7:this.lastPickTime=s,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return v.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),a=n.width,s=n.height;a*=wa,s*=wa,(this.width!==a||this.height!==s)&&(this.pickingFBO.resize({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale)}),this.width=a,this.height=s)}},{key:"pickingLayers",value:function(){var i=(0,Ta.Z)(di().mark(function n(a){var s=this,p,v,g,x,C;return di().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:p=this.rendererService,v=p.getViewportSize,g=p.useFramebuffer,x=p.clear,C=p.getContainer,this.resizePickingFBO(),g(this.pickingFBO,function(){var D=s.layerService.getRenderList();D.filter(function(G){return G.needPick(a.type)}).reverse().some(function(G){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),G.hooks.beforePickingEncode.call(),G.masks.length>0&&G.masks.map(function(te){te.hooks.beforeRenderData.call(),te.hooks.beforeRender.call(),te.render(),te.hooks.afterRender.call()}),G.renderModels(!0),G.hooks.afterPickingEncode.call();var q=s.pickFromPickingFBO(G,a);return s.layerService.pickedLayerId=q?+G.id:-1,q&&!G.getLayerConfig().enablePropagation})});case 3:case"end":return O.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){Va(n)&&(this.handleCursor(r,n.type),r.emit(n.type,n))}},{key:"highlightPickedFeature",value:function(r,n){var a=(0,Q.Z)(n,3),s=a[0],p=a[1],v=a[2];r.hooks.beforeHighlight.call([s,p,v])}},{key:"selectFeature",value:function(r,n){var a=(0,Q.Z)(n,3),s=a[0],p=a[1],v=a[2];r.hooks.beforeSelect.call([s,p,v])}}]),e}(),Pu=Hn(mu.prototype,"mapService",[qs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vl=Hn(mu.prototype,"rendererService",[Ps],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ko=Hn(mu.prototype,"configService",[$a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gl=Hn(mu.prototype,"interactionService",[jo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ll=Hn(mu.prototype,"layerService",[Is],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mu))||fa),Xc=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,ot.Z)(this,e),(0,I.Z)(this,"autoStart",void 0),(0,I.Z)(this,"startTime",0),(0,I.Z)(this,"oldTime",0),(0,I.Z)(this,"running",!1),(0,I.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,wt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),rp,yh,np,jp,_h,wf,mc,Vp,ip;function Tf(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Gp(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function Gp(e,i){if(!!e){if(typeof e=="string")return xh(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xh(e,i)}}function xh(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var td=(rp=(0,Ur.b2)(),yh=(0,Ur.f3)(qt.IRendererService),np=(0,Ur.f3)(qt.IMapService),jp=(0,Ur.f3)(qt.IGlobalConfigService),rp(_h=(wf=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"pickedLayerId",-1),(0,I.Z)(this,"clock",new Xc),(0,I.Z)(this,"alreadyInRendering",!1),(0,I.Z)(this,"layers",[]),(0,I.Z)(this,"layerList",[]),(0,I.Z)(this,"layerRenderID",void 0),(0,I.Z)(this,"sceneInited",!1),(0,I.Z)(this,"animateInstanceCount",0),(0,I.Z)(this,"shaderPicking",!0),(0,I.Z)(this,"enableRender",!0),fi(this,"renderService",mc,this),fi(this,"mapService",Vp,this),fi(this,"configService",ip,this)}return(0,wt.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r),this.updateLayerRenderList()}},{key:"addMask",value:function(r){this.sceneInited&&r.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()}),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(n){return n.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(n){return n.name===r})}},{key:"cleanRemove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),this.renderLayers()}},{key:"remove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(r){this.enableRender=r}},{key:"renderLayers",value:function(){var i=(0,Ta.Z)(di().mark(function n(){var a,s,p;return di().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){g.next=2;break}return g.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),a=Tf(this.layerList),g.prev=5,a.s();case 7:if((s=a.n()).done){g.next=21;break}if(p=s.value,p.hooks.beforeRenderData.call(),p.hooks.beforeRender.call(),!p.isLayerGroup&&p.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),p.masks.map(function(x){x.hooks.beforeRenderData.call(),x.hooks.beforeRender.call(),x.render(),x.hooks.afterRender.call()})),!p.getLayerConfig().enableMultiPassRenderer){g.next=17;break}return g.next=15,p.renderMultiPass();case 15:g.next=18;break;case 17:p.render();case 18:p.hooks.afterRender.call();case 19:g.next=7;break;case 21:g.next=26;break;case 23:g.prev=23,g.t0=g.catch(5),a.e(g.t0);case 26:return g.prev=26,a.f(),g.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return g.stop()}},n,this,[[5,23,26,29]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).sort(function(n,a){return n.zIndex-a.zIndex}).forEach(function(n){n.isLayerGroup?n.layerChildren.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).sort(function(a,s){return a.zIndex-s.zIndex}).forEach(function(a){r.layerList.push(a)}):r.layerList.push(n)})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var r=be(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=Ea.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){Ea.cancelAnimationFrame(this.layerRenderID)}}]),e}(),mc=Hn(wf.prototype,"renderService",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vp=Hn(wf.prototype,"mapService",[np],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ip=Hn(wf.prototype,"configService",[jp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wf))||_h),gc=N(81253),bh=N(14293),Al=N.n(bh),Eh=function(){function e(i){var r=this;(0,ot.Z)(this,e),(0,I.Z)(this,"name",void 0),(0,I.Z)(this,"type",void 0),(0,I.Z)(this,"scale",void 0),(0,I.Z)(this,"descriptor",void 0),(0,I.Z)(this,"featureBufferLayout",[]),(0,I.Z)(this,"needRescale",!1),(0,I.Z)(this,"needRemapping",!1),(0,I.Z)(this,"needRegenerateVertices",!1),(0,I.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,I.Z)(this,"vertexAttribute",void 0),(0,I.Z)(this,"defaultCallback",function(n){if(n.length===0){var a;return((a=r.scale)===null||a===void 0?void 0:a.defaultValues)||[]}return n.map(function(s,p){var v,g=(v=r.scale)===null||v===void 0?void 0:v.scalers[p].func,x=g(s);return x})}),this.setProps(i)}return(0,wt.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var a,s=(a=this.scale)===null||a===void 0?void 0:a.callback.apply(a,(0,ar.Z)(r));if(!Al()(s))return[s]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Sh=["buffer","update","name"],Ch=["buffer","update","name"],Mf,ap,Ah,op,sp,Pf;function Hp(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Yc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Hp(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hp(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function x0(e){return new Promise(function(i){return setTimeout(i,e)})}var b0=(Mf={},(0,I.Z)(Mf,V.FLOAT,4),(0,I.Z)(Mf,V.UNSIGNED_BYTE,1),(0,I.Z)(Mf,V.UNSIGNED_SHORT,2),Mf),Ld=(ap=(0,Ur.b2)(),Ah=(0,Ur.f3)(qt.IRendererService),ap(op=(sp=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"attributesAndIndices",void 0),fi(this,"rendererService",Pf,this),(0,I.Z)(this,"attributes",[]),(0,I.Z)(this,"triangulation",void 0),(0,I.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,wt.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new Eh(r),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(r,n,a){var s=this.getLayerStyleAttribute(r);s||(s=this.registerStyleAttribute(Yc(Yc({},n),{},{name:r})));var p=n.scale;p&&s&&(s.scale=p,s.needRescale=!0,s.needRemapping=!0,s.needRegenerateVertices=!0,a&&a.featureRange&&(s.featureRange=a.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,a=this.getLayerStyleAttribute(r),s=a==null||(n=a.scale)===null||n===void 0?void 0:n.scalers;return s&&s[0]?s[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,p=this.attributes.find(function(at){return at.name===r});if(p&&p.descriptor){var v=p.descriptor,g=v.update,x=v.buffer,C=v.size,w=C===void 0?0:C,O=b0[x.type||V.FLOAT];if(g){var D=this.featureLayout,G=D.elements,q=D.sizePerElement,te=G.slice(a,s);if(!te.length)return;var Se=te[0].offset,ze=Se*w*O,$e=te.map(function(at,Et){for(var Tt=at.featureIdx,Jt=at.vertices,fr=at.normals,Dr=Jt.length/q,tn=[],wr=0;wr<Dr;wr++){var xn=fr?fr.slice(wr*3,wr*3+3):[];tn.push.apply(tn,(0,ar.Z)(g(n[Tt],Tt,Jt.slice(wr*q,wr*q+q),Et,xn)))}return tn}).reduce(function(at,Et){return at.push.apply(at,(0,ar.Z)(Et)),at},[]);p.vertexAttribute.updateBuffer({data:$e,offset:ze})}}}},{key:"createAttributesAndIndices",value:function(r,n,a){var s=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var p=this.attributes.map(function(ze){return ze.resetDescriptor(),ze.descriptor}),v=0,g=[],x=[],C=[],w=3;r.forEach(function(ze,$e){var at=s.triangulation(ze,a),Et=at.indices,Tt=at.vertices,Jt=at.normals,fr=at.size,Dr=at.indexes;Et.forEach(function(Tn){x.push(Tn+v)}),w=fr;var tn=Tt.length/fr;s.featureLayout.sizePerElement=w,s.featureLayout.elements.push({featureIdx:$e,vertices:Tt,normals:Jt,offset:v}),v+=tn;for(var wr=function($n){var Ga=(Jt==null?void 0:Jt.slice($n*3,$n*3+3))||[],as=Tt.slice($n*fr,$n*fr+fr),ks=0;Dr&&Dr[$n]!==void 0&&(ks=Dr[$n]),p.forEach(function(Ds,Qs){if(Ds&&Ds.update){var ef;(ef=Ds.buffer.data).push.apply(ef,(0,ar.Z)(Ds.update(ze,$e,as,$n,Ga,ks)))}})},xn=0;xn<tn;xn++)wr(xn)});var O=this.rendererService,D=O.createAttribute,G=O.createBuffer,q=O.createElements,te={};p.forEach(function(ze,$e){if(ze){var at=ze.buffer,Et=ze.update,Tt=ze.name,Jt=(0,gc.Z)(ze,Sh),fr=D(Yc({buffer:G(at)},Jt));te[ze.name||""]=fr,s.attributes[$e].vertexAttribute=fr}});var Se=q({data:x,type:V.UNSIGNED_INT,count:x.length});return this.attributesAndIndices={attributes:te,elements:Se},this.attributesAndIndices}},{key:"createAttributes",value:function(r,n){var a=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var s=this.attributes.map(function(D){return D.resetDescriptor(),D.descriptor}),p=0,v=[],g=3;r.forEach(function(D,G){var q=a.triangulation(D),te=q.indices,Se=q.vertices,ze=q.normals,$e=q.size,at=q.indexes;te.forEach(function(fr){v.push(fr+p)}),g=$e;var Et=Se.length/$e;a.featureLayout.sizePerElement=g,a.featureLayout.elements.push({featureIdx:G,vertices:Se,normals:ze,offset:p}),p+=Et;for(var Tt=function(Dr){var tn=(ze==null?void 0:ze.slice(Dr*3,Dr*3+3))||[],wr=Se.slice(Dr*$e,Dr*$e+$e),xn=0;at&&at[Dr]!==void 0&&(xn=at[Dr]),s.forEach(function(Tn,$n){if(Tn&&Tn.update){var Ga;(Ga=Tn.buffer.data).push.apply(Ga,(0,ar.Z)(Tn.update(D,G,wr,Dr,tn,xn)))}})},Jt=0;Jt<Et;Jt++)Tt(Jt)});var x=this.rendererService,C=x.createAttribute,w=x.createBuffer,O={};return s.forEach(function(D,G){if(D){var q=D.buffer,te=D.update,Se=D.name,ze=(0,gc.Z)(D,Ch),$e=C(Yc({buffer:w(q)},ze));O[D.name||""]=$e,a.attributes[G].vertexAttribute=$e}}),{attributes:O}}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),Pf=Hn(sp.prototype,"rendererService",[Ah],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sp))||op),kd=N(67709),Dd=N.n(kd),E0,Wp,Do,wl,S0,qc,rd,Fd,wh,Hl,Th,Xp,Mh,Ph,nd,Bd,Yp,Ks,Nd,zd,Ud,Zd,Iu,Ih,jd,Wl,C0,Vd,If,up,lp,cp,fp;function A0(e){var i=w0();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function w0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var T0=(E0=(0,Ur.b2)(),Wp=(0,Ur.f3)(qt.SceneID),Do=(0,Ur.f3)(qt.IIconService),wl=(0,Ur.f3)(qt.IFontService),S0=(0,Ur.f3)(qt.IControlService),qc=(0,Ur.f3)(qt.IGlobalConfigService),rd=(0,Ur.f3)(qt.IMapService),Fd=(0,Ur.f3)(qt.ICoordinateSystemService),wh=(0,Ur.f3)(qt.IRendererService),Hl=(0,Ur.f3)(qt.ILayerService),Th=(0,Ur.f3)(qt.ICameraService),Xp=(0,Ur.f3)(qt.IInteractionService),Mh=(0,Ur.f3)(qt.IPickingService),Ph=(0,Ur.f3)(qt.IShaderModuleService),nd=(0,Ur.f3)(qt.IMarkerService),Bd=(0,Ur.f3)(qt.IPopupService),E0(Yp=(Ks=function(e){(0,en.Z)(r,e);var i=A0(r);function r(){var n;return(0,ot.Z)(this,r),n=i.call(this),(0,I.Z)((0,he.Z)(n),"destroyed",!1),(0,I.Z)((0,he.Z)(n),"loaded",!1),(0,I.Z)((0,he.Z)(n),"loadFont",!1),(0,I.Z)((0,he.Z)(n),"fontFamily",""),fi((0,he.Z)(n),"id",Nd,(0,he.Z)(n)),fi((0,he.Z)(n),"iconService",zd,(0,he.Z)(n)),fi((0,he.Z)(n),"fontService",Ud,(0,he.Z)(n)),fi((0,he.Z)(n),"controlService",Zd,(0,he.Z)(n)),fi((0,he.Z)(n),"configService",Iu,(0,he.Z)(n)),fi((0,he.Z)(n),"map",Ih,(0,he.Z)(n)),fi((0,he.Z)(n),"coordinateSystemService",jd,(0,he.Z)(n)),fi((0,he.Z)(n),"rendererService",Wl,(0,he.Z)(n)),fi((0,he.Z)(n),"layerService",C0,(0,he.Z)(n)),fi((0,he.Z)(n),"cameraService",Vd,(0,he.Z)(n)),fi((0,he.Z)(n),"interactionService",If,(0,he.Z)(n)),fi((0,he.Z)(n),"pickingService",up,(0,he.Z)(n)),fi((0,he.Z)(n),"shaderModuleService",lp,(0,he.Z)(n)),fi((0,he.Z)(n),"markerService",cp,(0,he.Z)(n)),fi((0,he.Z)(n),"popupService",fp,(0,he.Z)(n)),(0,I.Z)((0,he.Z)(n),"inited",!1),(0,I.Z)((0,he.Z)(n),"initPromise",void 0),(0,I.Z)((0,he.Z)(n),"rendering",!1),(0,I.Z)((0,he.Z)(n),"$container",void 0),(0,I.Z)((0,he.Z)(n),"canvas",void 0),(0,I.Z)((0,he.Z)(n),"markerContainer",void 0),(0,I.Z)((0,he.Z)(n),"hooks",void 0),(0,I.Z)((0,he.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),xs(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,I.Z)((0,he.Z)(n),"handleMapCameraChanged",function(a){n.cameraService.update(a),n.render()}),n.hooks={init:new sh},n}return(0,wt.Z)(r,[{key:"init",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Ta.Z)(di().mark(function p(){return di().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.version!=="GAODE2.x"?s.map.init():x()});case 2:if(!(s.map.version==="GAODE2.x"&&s.map.initViewPort)){g.next=6;break}return g.next=5,s.map.init();case 5:s.map.initViewPort();case 6:s.map.onCameraChanged(s.handleMapCameraChanged),s.map.addMarkerContainer(),s.markerService.addMarkers(),s.markerService.addMarkerLayers(),s.popupService.initPopup(),s.interactionService.init(),s.interactionService.on(An.Drag,s.addSceneEvent.bind(s));case 13:case"end":return g.stop()}},p)}))),this.hooks.init.tapPromise("initRenderer",(0,Ta.Z)(di().mark(function p(){var v,g;return di().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(v=qi(s.configService.getSceneConfig(s.id).id||""),s.$container=v,!v){C.next=11;break}return s.canvas=va("canvas","",v),s.setCanvas(),C.next=7,s.rendererService.init(s.canvas,s.configService.getSceneConfig(s.id));case 7:Dd()(s.$container,s.handleWindowResized),Ea.matchMedia&&((g=Ea.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||g===void 0||g.addListener(s.handleWindowResized)),C.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:s.pickingService.init(s.id);case 13:case"end":return C.stop()}},p)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Ta.Z)(di().mark(function p(){return di().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.initMiniMap()});case 2:s.map.onCameraChanged(s.handleMapCameraChanged),s.interactionService.init(),s.interactionService.on(An.Drag,s.addSceneEvent.bind(s));case 5:case"end":return g.stop()}},p)}))),this.hooks.init.tapPromise("initRenderer",(0,Ta.Z)(di().mark(function p(){var v;return di().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(v=a.canvas,s.$container=v||null,!s.$container){x.next=7;break}return x.next=5,s.rendererService.init(a.canvas,s.configService.getSceneConfig(s.id));case 5:x.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:s.pickingService.init(s.id);case 9:case"end":return x.stop()}},p)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(a){this.layerService.sceneService=this,this.layerService.add(a),this.render()}},{key:"addMask",value:function(a){this.layerService.sceneService=this,this.layerService.addMask(a),this.render()}},{key:"render",value:function(){var n=(0,Ta.Z)(di().mark(function s(){return di().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.rendering||this.destroyed)){v.next=2;break}return v.abrupt("return");case 2:if(this.rendering=!0,this.inited){v.next=23;break}return v.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){v.next=18;break}return v.prev=8,v.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:v.next=18;break;case 13:v.prev=13,v.t0=v.catch(8),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(v.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return v.stop()}},s,this,[[8,13]])}));function a(){return n.apply(this,arguments)}return a}()},{key:"addFontFace",value:function(a,s){this.fontFamily=a;var p=document.createElement("style");p.type="text/css",p.innerText=`
        @font-face{
            font-family: '`.concat(a,`';
            src: url('`).concat(s,`') format('woff2'),
            url('`).concat(s,`') format('woff'),
            url('`).concat(s,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(p),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(a){var s,p=(s=this.$container)===null||s===void 0?void 0:s.getElementsByTagName("canvas")[0];this.render();var v=a==="jpg"?p==null?void 0:p.toDataURL("image/jpeg"):p==null?void 0:p.toDataURL("image/png");return v}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var a=this.$container.parentElement;a!==null&&(this.markerContainer=va("div","l7-marker-container",a))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var a=this,s,p;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var g;(g=a.$container)===null||g===void 0||g.removeChild(a.canvas),a.canvas=null,a.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(s=this.$container)===null||s===void 0||(p=s.parentNode)===null||p===void 0||p.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,kd.unbind)(this.$container,this.handleWindowResized),Ea.matchMedia){var v;(v=Ea.matchMedia("screen and (min-resolution: 2dppx)"))===null||v===void 0||v.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var a,s,p=wa,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,g=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x&&(x.width=v*p,x.height=g*p),this.rendererService.viewport({x:0,y:0,width:p*v,height:p*g})}},{key:"setCanvas",value:function(){var a,s,p=wa,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,g=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x.width=v*p,x.height=g*p,x.style.width="100%",x.style.height="100%"}},{key:"addSceneEvent",value:function(a){this.emit(a.type,a)}}]),r}(ju.EventEmitter),Nd=Hn(Ks.prototype,"id",[Wp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zd=Hn(Ks.prototype,"iconService",[Do],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ud=Hn(Ks.prototype,"fontService",[wl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zd=Hn(Ks.prototype,"controlService",[S0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iu=Hn(Ks.prototype,"configService",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ih=Hn(Ks.prototype,"map",[rd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jd=Hn(Ks.prototype,"coordinateSystemService",[Fd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wl=Hn(Ks.prototype,"rendererService",[wh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C0=Hn(Ks.prototype,"layerService",[Hl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vd=Hn(Ks.prototype,"cameraService",[Th],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),If=Hn(Ks.prototype,"interactionService",[Xp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),up=Hn(Ks.prototype,"pickingService",[Mh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lp=Hn(Ks.prototype,"shaderModuleService",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cp=Hn(Ks.prototype,"markerService",[nd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fp=Hn(Ks.prototype,"popupService",[Bd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ks))||Yp),M0=N(44908),id=N.n(M0);function Gd(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var Kc=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Hd(e){var i={};return e=e.replace(Kc,function(r,n,a){var s=a.split(":"),p=s[0].trim(),v="";switch(s.length>1&&(v=s[1].trim()),n){case"bool":v=v==="true";break;case"float":case"int":v=Number(v);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":v?v=v.replace("[","").replace("]","").split(",").reduce(function(g,x){return g.push(Number(x.trim())),g},[]):v=new Array(Gd(n)).fill(0);break;default:}return i[p]=v,"uniform ".concat(n," ").concat(p,`;
`)}),{content:e,uniforms:i}}var ad,od;function Wd(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function pp(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Wd(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wd(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Xd="#define PI 3.14159265359",P0=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Yd=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,I0=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,Oh=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,O0=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,sd=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Ev=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,R0=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Sv=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,Cv=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,Av=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,wv=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,Tv=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,Mv=/precision\s+(high|low|medium)p\s+float/,Pv=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,Iv=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,yc=(ad=(0,Ur.b2)(),ad(od=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"moduleCache",{}),(0,I.Z)(this,"rawContentCache",{})}return(0,wt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Xd,fs:Xd}),this.registerModule("decode",{vs:P0,fs:""}),this.registerModule("projection",{vs:Ev,fs:""}),this.registerModule("project",{vs:sd,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:R0}),this.registerModule("lighting",{vs:I0,fs:""}),this.registerModule("light",{vs:Yd,fs:""}),this.registerModule("picking",{vs:O0,fs:Oh}),this.registerModule("styleMapping",{vs:Sv,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:Tv,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:Cv,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:Av,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:wv,fs:""})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var a=n.vs,s=n.fs,p=n.uniforms,v=Hd(a),g=v.content,x=v.uniforms,C=Hd(s),w=C.content,O=C.uniforms;this.rawContentCache[r]={fs:w,uniforms:pp(pp(pp({},x),O),p),vs:g}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var a=this.rawContentCache[r].vs,s=this.rawContentCache[r].fs,p=this.processModule(a,[],"vs"),v=p.content,g=p.includeList,x=this.processModule(s,[],"fs"),C=x.content,w=x.includeList,O=C,D=id()(g.concat(w).concat(r)).reduce(function(G,q){return pp(pp({},G),n.rawContentCache[q].uniforms)},{});return Mv.test(C)||(O=Pv+C),this.moduleCache[r]={fs:O.trim(),uniforms:D,vs:v.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,a){var s=this,p=r.replace(Iv,function(v,g){var x=g.split(" "),C=x[0].replace(/"/g,"");if(n.indexOf(C)>-1)return"";var w=s.rawContentCache[C][a];n.push(C);var O=s.processModule(w,n,a),D=O.content;return D});return{content:p,includeList:n}}}]),e}())||od),hp=N(66213),$c;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})($c||($c={}));var qp,qd,L0=(qp=(0,Ur.b2)(),qp(qd=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"shaderModuleService",void 0),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"cameraService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"interactionService",void 0),(0,I.Z)(this,"layerService",void 0),(0,I.Z)(this,"config",void 0)}return(0,wt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return $c.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(qt.IRendererService),this.cameraService=r.getContainer().get(qt.ICameraService),this.mapService=r.getContainer().get(qt.IMapService),this.interactionService=r.getContainer().get(qt.IInteractionService),this.layerService=r.getContainer().get(qt.ILayerService),this.shaderModuleService=r.getContainer().get(qt.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||qd),_m,xm;function sb(e){var i=ub();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function ub(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lb=(_m=(0,Ur.b2)(),_m(xm=function(e){(0,en.Z)(r,e);var i=sb(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(a,s){(0,hp.Z)((0,Rt.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(L0))||xm),bm,Em,Sm,Ov,Cm;function cb(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=fb(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function fb(e,i){if(!!e){if(typeof e=="string")return Am(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Am(e,i)}}function Am(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var pb=(bm=(0,Ur.b2)(),Em=(0,Ur.f3)(qt.IPostProcessor),bm(Sm=(Ov=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"passes",[]),fi(this,"postProcessor",Cm,this),(0,I.Z)(this,"layer",void 0),(0,I.Z)(this,"renderFlag",void 0),(0,I.Z)(this,"width",0),(0,I.Z)(this,"height",0)}return(0,wt.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,Ta.Z)(di().mark(function n(){var a,s,p;return di().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:a=cb(this.passes),g.prev=1,a.s();case 3:if((s=a.n()).done){g.next=9;break}return p=s.value,g.next=7,p.render(this.layer);case 7:g.next=3;break;case 9:g.next=14;break;case 11:g.prev=11,g.t0=g.catch(1),a.e(g.t0);case 14:return g.prev=14,a.f(),g.finish(14);case 17:return g.next=19,this.postProcessor.render(this.layer);case 19:case"end":return g.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===$c.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,a){r.init(this.layer,n),this.passes.splice(a,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),Cm=Hn(Ov.prototype,"postProcessor",[Em],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ov))||Sm),wm,Tm;function Mm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Pm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Mm(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Mm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function hb(e){var i=db();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function db(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vb=(wm=(0,Ur.b2)(),wm(Tm=function(e){(0,en.Z)(r,e);var i=hb(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"pickingFBO",void 0),(0,I.Z)((0,he.Z)(n),"layer",void 0),(0,I.Z)((0,he.Z)(n),"width",0),(0,I.Z)((0,he.Z)(n),"height",0),(0,I.Z)((0,he.Z)(n),"alreadyInRendering",!1),(0,I.Z)((0,he.Z)(n),"pickFromPickingFBO",function(v){var g=v.x,x=v.y,C=v.lngLat,w=v.type;if(!(!n.layer.isVisible()||!n.layer.needPick(w))){var O=n.rendererService,D=O.getViewportSize,G=O.readPixels,q=O.useFramebuffer,te=D(),Se=te.width,ze=te.height,$e=n.layer.getLayerConfig(),at=$e.enableHighlight,Et=$e.enableSelect,Tt=g*wa,Jt=x*wa;if(!(Tt>Se||Tt<0||Jt>ze||Jt<0)){var fr;q(n.pickingFBO,function(){var Dr;if(fr=G({x:Math.round(Tt),y:Math.round(ze-(x+1)*wa),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),fr[0]!==0||fr[1]!==0||fr[2]!==0){var tn=je(fr),wr=n.layer.getSource().getFeatureById(tn),xn={x:g,y:x,type:w,lngLat:C,featureId:tn,feature:wr};wr&&(n.layer.setCurrentPickId(tn),n.triggerHoverOnLayer(xn))}else{var Tn={x:g,y:x,lngLat:C,type:n.layer.getCurrentPickId()===null?"un"+w:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(Pm(Pm({},Tn),{},{type:"unpick"})),n.triggerHoverOnLayer(Tn),n.layer.setCurrentPickId(null)}at&&n.highlightPickedFeature(fr),Et&&w==="click"&&((Dr=fr)===null||Dr===void 0?void 0:Dr.toString())!==[0,0,0,0].toString()&&n.selectFeature(fr)})}}}),n}return(0,wt.Z)(r,[{key:"getType",value:function(){return $c.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(a,s){(0,hp.Z)((0,Rt.Z)(r.prototype),"init",this).call(this,a,s),this.layer=a;var p=this.rendererService,v=p.createTexture2D,g=p.createFramebuffer,x=p.getViewportSize,C=x(),w=C.width,O=C.height;this.pickingFBO=g({color:v({width:w,height:O,wrapS:V.CLAMP_TO_EDGE,wrapT:V.CLAMP_TO_EDGE})}),this.interactionService.on(An.Hover,this.pickFromPickingFBO),this.interactionService.on(An.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(An.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(a){var s=this;if(!this.alreadyInRendering){var p=this.rendererService,v=p.getViewportSize,g=p.useFramebuffer,x=p.clear,C=v(),w=C.width,O=C.height;this.alreadyInRendering=!0,(this.width!==w||this.height!==O)&&(this.pickingFBO.resize({width:w,height:O}),this.width=w,this.height=O),g(this.pickingFBO,function(){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var D=s.layer.multiPassRenderer.getRenderFlag();s.layer.multiPassRenderer.setRenderFlag(!1),a.hooks.beforePickingEncode.call(),a.render(),a.hooks.afterPickingEncode.call(),s.layer.multiPassRenderer.setRenderFlag(D),s.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(a){this.layer.emit(a.type,a)}},{key:"highlightPickedFeature",value:function(a){var s=(0,Q.Z)(a,3),p=s[0],v=s[1],g=s[2];this.layer.hooks.beforeHighlight.call([p,v,g]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(a){var s=(0,Q.Z)(a,3),p=s[0],v=s[1],g=s[2];this.layer.hooks.beforeSelect.call([p,v,g]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(a){var s=a.featureId,p=et(s);this.selectFeature(new Uint8Array(p))}},{key:"highlightFeatureHandle",value:function(a){var s=a.featureId,p=et(s);this.highlightPickedFeature(new Uint8Array(p))}}]),r}(L0))||Tm),mb=N(11700),gb=N.n(mb),yb=N(68929),_b=N.n(yb),Im,Om,Rm,Rv,Lm;function km(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Kd(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?km(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):km(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var xb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,dp=(Im=(0,Ur.b2)(),Om=(0,Ur.f3)(qt.IShaderModuleService),Im(Rm=(Rv=function(){function e(){(0,ot.Z)(this,e),fi(this,"shaderModuleService",Lm,this),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"config",void 0),(0,I.Z)(this,"quad",xb),(0,I.Z)(this,"enabled",!0),(0,I.Z)(this,"renderToScreen",!1),(0,I.Z)(this,"model",void 0),(0,I.Z)(this,"name",void 0),(0,I.Z)(this,"optionsToUpdate",{})}return(0,wt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return $c.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(qt.IRendererService),this.shaderModuleService=r.getContainer().get(qt.IShaderModuleService);var a=this.rendererService,s=a.createAttribute,p=a.createBuffer,v=a.createModel,g=this.setupShaders(),x=g.vs,C=g.fs,w=g.uniforms;this.model=v({vs:x,fs:C,attributes:{a_Position:s({buffer:p({data:[-4,-4,4,-4,0,4],type:V.FLOAT}),size:2})},uniforms:Kd(Kd({u_Texture:null},w),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var a=this,s=r.multiPassRenderer.getPostProcessor(),p=this.rendererService,v=p.useFramebuffer,g=p.getViewportSize,x=p.clear,C=g(),w=C.width,O=C.height;v(this.renderToScreen?null:s.getWriteFBO(),function(){x({framebuffer:s.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var D=Kd({u_BloomFinal:0,u_Texture:s.getReadFBO(),u_ViewportSize:[w,O]},a.convertOptionsToUniforms(a.optionsToUpdate));n&&(D.u_BloomFinal=1,D.u_Texture2=n),a.model.draw({uniforms:D})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=Kd(Kd({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(a){Al()(r[a])||(n["u_".concat(gb()(_b()(a)))]=r[a])}),n}}]),e}(),Lm=Hn(Rv.prototype,"shaderModuleService",[Om],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rv))||Rm),Dm,Fm;function Bm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Nm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Bm(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Bm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function bb(e){var i=Eb();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function Eb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sb=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,Cb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ab=(Dm=(0,Ur.b2)(),Dm(Fm=function(e){(0,en.Z)(r,e);var i=bb(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Cb,fs:Sb});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:Nm(Nm({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Al()(a.bloomRadius)||(s.u_radius=a.bloomRadius),Al()(a.bloomIntensity)||(s.u_intensity=a.bloomIntensity),Al()(a.bloomBaseRadio)||(s.u_baseRadio=a.bloomBaseRadio),s}}]),r}(dp))||Fm),zm,Um;function Zm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function jm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Zm(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function wb(e){var i=Tb();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function Tb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Mb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Pb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ib=(zm=(0,Ur.b2)(),zm(Um=function(e){(0,en.Z)(r,e);var i=wb(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Pb,fs:Mb});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:jm(jm({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Al()(a.blurRadius)||(s.u_BlurDir=[a.blurRadius,0]),s}}]),r}(dp))||Um),Vm,Gm;function Hm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Wm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Hm(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ob(e){var i=Rb();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function Rb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,kb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Db=(Vm=(0,Ur.b2)(),Vm(Gm=function(e){(0,en.Z)(r,e);var i=Ob(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:kb,fs:Lb});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:Wm(Wm({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return Al()(a.blurRadius)||(s.u_BlurDir=[0,a.blurRadius]),s}}]),r}(dp))||Gm),Xm,Ym;function qm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Km(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?qm(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Fb(e){var i=Bb();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function Bb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Nb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,zb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ub=(Xm=(0,Ur.b2)(),Xm(Ym=function(e){(0,en.Z)(r,e);var i=Fb(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:zb,fs:Nb});var a=this.shaderModuleService.getModule("colorhalftone-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:Km(Km({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(dp))||Ym),$m,Qm;function Zb(e){var i=jb();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function jb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Gb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Hb=($m=(0,Ur.b2)(),$m(Qm=function(e){(0,en.Z)(r,e);var i=Zb(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:Gb,fs:Vb}),this.shaderModuleService.getModule("copy-pass")}}]),r}(dp))||Qm),Jm,eg;function tg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function rg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?tg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Wb(e){var i=Xb();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function Xb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Yb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,qb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Kb=(Jm=(0,Ur.b2)(),Jm(eg=function(e){(0,en.Z)(r,e);var i=Wb(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:qb,fs:Yb});var a=this.shaderModuleService.getModule("hexagonalpixelate-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:rg(rg({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(dp))||eg),ng,ig;function ag(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function og(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ag(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ag(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function $b(e){var i=Qb();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function Qb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Jb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,e2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,t2=(ng=(0,Ur.b2)(),ng(ig=function(e){(0,en.Z)(r,e);var i=$b(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:e2,fs:Jb});var a=this.shaderModuleService.getModule("ink-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:og(og({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(dp))||ig),sg,ug;function r2(e){var i=n2();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function n2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var i2=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,a2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,o2=(sg=(0,Ur.b2)(),sg(ug=function(e){(0,en.Z)(r,e);var i=r2(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:a2,fs:i2}),this.shaderModuleService.getModule("noise-pass")}}]),r}(dp))||ug),lg,cg;function s2(e){var i=u2();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function u2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var l2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,c2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,f2=(lg=(0,Ur.b2)(),lg(cg=function(e){(0,en.Z)(r,e);var i=s2(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:l2,fs:c2}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(dp))||cg),fg,pg,hg,dg,ud,vg,p2=(fg=(0,Ur.b2)(),pg=(0,Ur.f3)(qt.IRendererService),hg=(0,Ur.zY)(),fg(dg=(ud=function(){function e(){(0,ot.Z)(this,e),fi(this,"rendererService",vg,this),(0,I.Z)(this,"passes",[]),(0,I.Z)(this,"readFBO",void 0),(0,I.Z)(this,"writeFBO",void 0)}return(0,wt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,a=r.createTexture2D,s=n(),p=s.width,v=s.height;return a({x:0,y:0,width:p,height:v,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(a,s){n(r.readFBO,(0,Ta.Z)(di().mark(function p(){return di().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:a(r.getCurrentFBOTex());case 1:case"end":return g.stop()}},p)})))})}},{key:"renderBloomPass",value:function(){var i=(0,Ta.Z)(di().mark(function n(a,s){var p,v;return di().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,this.getReadFBOTex();case 2:p=x.sent,v=0;case 4:if(!(v<4)){x.next=11;break}return x.next=7,s.render(a,p);case 7:this.swap(),v++,x.next=4;break;case 11:case"end":return x.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){var i=(0,Ta.Z)(di().mark(function n(a){var s,p;return di().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:s=0;case 1:if(!(s<this.passes.length)){g.next=15;break}if(p=this.passes[s],p.setRenderToScreen(this.isLastEnabledPass(s)),p.getName()!=="bloom"){g.next=9;break}return g.next=7,this.renderBloomPass(a,p);case 7:g.next=12;break;case 9:return g.next=11,p.render(a);case 11:s!==this.passes.length-1&&this.swap();case 12:s++,g.next=1;break;case 15:case"end":return g.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,a){r.init(n,a),this.passes.push(r)}},{key:"insert",value:function(r,n,a,s){r.init(a,s),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,a=r.createTexture2D;this.readFBO=n({color:a({width:1,height:1,wrapS:V.CLAMP_TO_EDGE,wrapT:V.CLAMP_TO_EDGE})}),this.writeFBO=n({color:a({width:1,height:1,wrapS:V.CLAMP_TO_EDGE,wrapT:V.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),vg=Hn(ud.prototype,"rendererService",[pg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hn(ud.prototype,"init",[hg],Object.getOwnPropertyDescriptor(ud.prototype,"init"),ud.prototype),ud))||dg),mg,gg;function h2(e){var i=d2();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function d2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var v2=(mg=(0,Ur.b2)(),mg(gg=function(e){(0,en.Z)(r,e);var i=h2(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getType",value:function(){return $c.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(a,s){(0,hp.Z)((0,Rt.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(a){var s=this.rendererService,p=s.useFramebuffer,v=s.clear,g=a.multiPassRenderer.getPostProcessor().getReadFBO();p(g,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:g}),a.multiPassRenderer.setRenderFlag(!1),a.models.forEach(function(x){x.draw({uniforms:a.layerModel.getUninforms()})}),a.multiPassRenderer.setRenderFlag(!0)})}}]),r}(L0))||gg),yg,_g,xg,Lv,bg;function Eg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Sg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Eg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Eg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function m2(e){var i=g2();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function g2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var y2=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,Cg=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,_2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function Ag(e,i){for(var r=0,n=1/i,a=e;a>0;)r=r+n*(a%i),a=Math.floor(a/i),n=n/i;return r}var x2=1,b2=(yg=(0,Ur.b2)(),_g=(0,Ur.f3)(qt.IShaderModuleService),yg(xg=(Lv=function(e){(0,en.Z)(r,e);var i=m2(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),fi((0,he.Z)(n),"shaderModuleService",bg,(0,he.Z)(n)),(0,I.Z)((0,he.Z)(n),"haltonSequence",[]),(0,I.Z)((0,he.Z)(n),"accumulatingId",0),(0,I.Z)((0,he.Z)(n),"frame",0),(0,I.Z)((0,he.Z)(n),"timer",void 0),(0,I.Z)((0,he.Z)(n),"sampleRenderTarget",void 0),(0,I.Z)((0,he.Z)(n),"prevRenderTarget",void 0),(0,I.Z)((0,he.Z)(n),"outputRenderTarget",void 0),(0,I.Z)((0,he.Z)(n),"copyRenderTarget",void 0),(0,I.Z)((0,he.Z)(n),"blendModel",void 0),(0,I.Z)((0,he.Z)(n),"outputModel",void 0),(0,I.Z)((0,he.Z)(n),"copyModel",void 0),n}return(0,wt.Z)(r,[{key:"getType",value:function(){return $c.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(a,s){(0,hp.Z)((0,Rt.Z)(r.prototype),"init",this).call(this,a,s);var p=this.rendererService,v=p.createFramebuffer,g=p.createTexture2D;this.sampleRenderTarget=v({color:g({width:1,height:1,wrapS:V.CLAMP_TO_EDGE,wrapT:V.CLAMP_TO_EDGE})}),this.prevRenderTarget=v({color:g({width:1,height:1,wrapS:V.CLAMP_TO_EDGE,wrapT:V.CLAMP_TO_EDGE})}),this.outputRenderTarget=v({color:g({width:1,height:1,wrapS:V.CLAMP_TO_EDGE,wrapT:V.CLAMP_TO_EDGE})}),this.copyRenderTarget=v({color:g({width:1,height:1,wrapS:V.CLAMP_TO_EDGE,wrapT:V.CLAMP_TO_EDGE})});for(var x=0;x<30;x++)this.haltonSequence.push([Ag(x,2),Ag(x,3)]);this.blendModel=this.createTriangleModel("blend-pass",y2),this.outputModel=this.createTriangleModel("copy-pass",Cg,{blend:{enable:!0,func:{srcRGB:V.ONE,dstRGB:V.ONE_MINUS_SRC_ALPHA,srcAlpha:V.ONE,dstAlpha:V.ONE_MINUS_SRC_ALPHA},equation:{rgb:V.FUNC_ADD,alpha:V.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",Cg)}},{key:"render",value:function(a){var s=this,p=this.rendererService,v=p.clear,g=p.getViewportSize,x=p.useFramebuffer,C=g(),w=C.width,O=C.height;this.sampleRenderTarget.resize({width:w,height:O}),this.prevRenderTarget.resize({width:w,height:O}),this.outputRenderTarget.resize({width:w,height:O}),this.copyRenderTarget.resize({width:w,height:O}),this.resetFrame(),this.stopAccumulating();var D=a.multiPassRenderer.getPostProcessor().getReadFBO();x(D,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:D}),a.multiPassRenderer.setRenderFlag(!1),a.render(),a.multiPassRenderer.setRenderFlag(!0)});var G=function q(te){!s.accumulatingId||te!==s.accumulatingId||s.isFinished()||(s.doRender(a),Ea.requestAnimationFrame(function(){q(te)}))};this.accumulatingId=x2++,this.timer=Ea.setTimeout(function(){G(s.accumulatingId)},50)}},{key:"doRender",value:function(a){var s=this,p=this.rendererService,v=p.clear,g=p.getViewportSize,x=p.useFramebuffer,C=g(),w=C.width,O=C.height,D=a.getLayerConfig(),G=D.jitterScale,q=G===void 0?1:G,te=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((te[0]*2-1)/w*q,(te[1]*2-1)/O*q),a.multiPassRenderer.setRenderFlag(!1),a.hooks.beforeRender.call(),x(this.sampleRenderTarget,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:s.sampleRenderTarget}),a.render()}),a.hooks.afterRender.call(),a.multiPassRenderer.setRenderFlag(!0);var Se=a.getLayerConfig();x(this.outputRenderTarget,function(){s.blendModel.draw({uniforms:{u_opacity:Se.opacity||1,u_MixRatio:s.frame===0?1:.9,u_Diffuse1:s.sampleRenderTarget,u_Diffuse2:s.frame===0?a.multiPassRenderer.getPostProcessor().getReadFBO():s.prevRenderTarget}})}),this.frame===0&&v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(x(this.copyRenderTarget,function(){s.outputModel.draw({uniforms:{u_Texture:s.outputRenderTarget}})}),x(a.multiPassRenderer.getPostProcessor().getReadFBO(),function(){s.copyModel.draw({uniforms:{u_Texture:s.copyRenderTarget}})}),a.multiPassRenderer.getPostProcessor().render(a));var ze=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=ze,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,Ea.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(a,s,p){this.shaderModuleService.registerModule(a,{vs:_2,fs:s});var v=this.shaderModuleService.getModule(a),g=v.vs,x=v.fs,C=v.uniforms,w=this.rendererService,O=w.createAttribute,D=w.createBuffer,G=w.createModel;return G(Sg({vs:g,fs:x,attributes:{a_Position:O({buffer:D({data:[-4,-4,4,-4,0,4],type:V.FLOAT}),size:2})},uniforms:Sg({},C),depth:{enable:!1},count:3},p))}}]),r}(L0),bg=Hn(Lv.prototype,"shaderModuleService",[_g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lv))||xg),$d=new Ur.W2;$d.bind(qt.IGlobalConfigService).to(_a).inSingletonScope(),(0,Ur.GW)((0,Ur.b2)(),ju.EventEmitter),$d.bind(qt.IEventEmitter).to(ju.EventEmitter);var wg=(0,ul.Z)($d,!1),kv=function(i){var r=wg.lazyInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},O4=function(i){var r=wg.lazyMultiInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},Xl=$d,E2=0;function S2(){var e=new Ur.W2;return e.parent=$d,e.bind(qt.SceneID).toConstantValue("".concat(E2++)),e.bind(qt.IShaderModuleService).to(yc).inSingletonScope(),e.bind(qt.ILayerService).to(td).inSingletonScope(),e.bind(qt.ISceneService).to(T0).inSingletonScope(),e.bind(qt.ICameraService).to(Ot).inSingletonScope(),e.bind(qt.ICoordinateSystemService).to(ji).inSingletonScope(),e.bind(qt.IInteractionService).to(Xs).inSingletonScope(),e.bind(qt.IPickingService).to(Zp).inSingletonScope(),e.bind(qt.IControlService).to(Ae).inSingletonScope(),e.bind(qt.IMarkerService).to(vr).inSingletonScope(),e.bind(qt.IIconService).to(kr).inSingletonScope(),e.bind(qt.IFontService).to(Ft).inSingletonScope(),e.bind(qt.IPopupService).to(nn).inSingletonScope(),e.bind(qt.INormalPass).to(lb).whenTargetNamed("clear"),e.bind(qt.INormalPass).to(vb).whenTargetNamed("pixelPicking"),e.bind(qt.INormalPass).to(v2).whenTargetNamed("render"),e.bind(qt.INormalPass).to(b2).whenTargetNamed("taa"),e.bind(qt.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(qt.INormalPass,r)}}),e.bind(qt.IPostProcessingPass).to(Hb).whenTargetNamed("copy"),e.bind(qt.IPostProcessingPass).to(Ab).whenTargetNamed("bloom"),e.bind(qt.IPostProcessingPass).to(Ib).whenTargetNamed("blurH"),e.bind(qt.IPostProcessingPass).to(Db).whenTargetNamed("blurV"),e.bind(qt.IPostProcessingPass).to(o2).whenTargetNamed("noise"),e.bind(qt.IPostProcessingPass).to(f2).whenTargetNamed("sepia"),e.bind(qt.IPostProcessingPass).to(Ub).whenTargetNamed("colorHalftone"),e.bind(qt.IPostProcessingPass).to(Kb).whenTargetNamed("hexagonalPixelate"),e.bind(qt.IPostProcessingPass).to(t2).whenTargetNamed("ink"),e.bind(qt.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(qt.IPostProcessingPass,r);return n.setName(r),n}}),e}function Tg(e){var i=new Ur.W2;return i.parent=e,i.bind(qt.IStyleAttributeService).to(Ld).inSingletonScope(),i.bind(qt.IMultiPassRenderer).to(pb).inSingletonScope(),i.bind(qt.IPostProcessor).to(p2).inSingletonScope(),i}var R4=N(74691),C2=null;function L4(e){return C2.indexOf(e)}var A2=2,k4=4,w2=64,D4=128,T2=256,M2=512,F4=8192,B4=16384,N4=32768,P2=null,Mg=131072,z4=262144,I2=524288,U4=1048576,O2=2097152,Z4=4194304,R2=8388608,L2=16777216,k2=null;function k0(e,i){return e=_clamp(Math.floor(e),0,255),i=_clamp(Math.floor(i),0,255),256*e+i}function j4(e){var i=e.color,r=e.radius,n=e.tileX,a=e.tileY,s=e.shape,p=e.opacity,v=e.stroke,g=e.strokeWidth,x=e.strokeOpacity,C=[],w=[],O=[],D=[k0(i[0],i[1]),k0(i[2],i[3])],G=[k0(v[0],v[1]),k0(v[2],v[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(q){var te=_slicedToArray(q,2),Se=te[0],ze=te[1];C.push([].concat(D,[(Se+1)*R2+(ze+1)*O2+getShapeIndex(s)*Mg+r,(n+512)*I2+(a+512)*w2])),w.push([].concat(G,[g,x])),O.push([p,0,0,0])}),{packedBuffer:C,packedBuffer2:w,packedBuffer3:O}}function V4(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*k2+r*L2+n*Mg+r*P2+n*M2+r*T2+n*A2+r}var _c;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(_c||(_c={}));var ou;(function(e){e.LINEAR="linear",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat"})(ou||(ou={}));var Kp;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(Kp||(Kp={}));var On;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(On||(On={}));var D2=["mapload","mapchange","mapAfterFrameChange"],Rh={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Dv=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],$p;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})($p||($p={}));function Pg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ig(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Pg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Pg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function F2(e){var i=B2();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function B2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var N2=0,D0=function(e){(0,en.Z)(r,e);var i=F2(r);function r(n){var a;return(0,ot.Z)(this,r),a=i.call(this),(0,I.Z)((0,he.Z)(a),"controlOption",void 0),(0,I.Z)((0,he.Z)(a),"container",void 0),(0,I.Z)((0,he.Z)(a),"sceneContainer",void 0),(0,I.Z)((0,he.Z)(a),"mapsService",void 0),(0,I.Z)((0,he.Z)(a),"renderService",void 0),(0,I.Z)((0,he.Z)(a),"layerService",void 0),(0,I.Z)((0,he.Z)(a),"controlService",void 0),(0,I.Z)((0,he.Z)(a),"isShow",void 0),a.controlOption=Ig(Ig({},a.getDefault()),n||{}),a}return(0,wt.Z)(r,[{key:"getDefault",value:function(){return{position:$p.TOPRIGHT,name:"".concat(N2++)}}},{key:"setPosition",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$p.BOTTOMRIGHT,s=this.controlService;return s&&s.removeControl(this),this.controlOption.position=a,s&&s.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(a){this.mapsService=a.get(qt.IMapService),this.renderService=a.get(qt.IRendererService),this.layerService=a.get(qt.ILayerService),this.controlService=a.get(qt.IControlService),this.sceneContainer=a,this.isShow=!0,this.container=this.onAdd();var s=this.container,p=this.controlOption.position,v=this.controlService.controlCorners[p];return Zs(s,"l7-control"),p.indexOf("bottom")!==-1?v.insertBefore(s,v.firstChild):v.appendChild(s),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var a=this.container;Zs(a,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var a=this.container;pu(a,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;mo(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(a){if(this.mapsService&&a&&a.screenX>0&&a.screenY>0){var s=this.mapsService.getContainer();s!==null&&s.focus()}}}]),r}(ju.EventEmitter);function z2(e){var i=U2();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function U2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var G4=function(e){(0,en.Z)(r,e);var i=z2(r);function r(n){var a;return(0,ot.Z)(this,r),a=i.call(this,n),(0,I.Z)((0,he.Z)(a),"layerControlInputs",void 0),(0,I.Z)((0,he.Z)(a),"layers",void 0),(0,I.Z)((0,he.Z)(a),"lastZIndex",void 0),(0,I.Z)((0,he.Z)(a),"handlingClick",void 0),(0,I.Z)((0,he.Z)(a),"layersLink",void 0),(0,I.Z)((0,he.Z)(a),"baseLayersList",void 0),(0,I.Z)((0,he.Z)(a),"separator",void 0),(0,I.Z)((0,he.Z)(a),"overlaysList",void 0),(0,I.Z)((0,he.Z)(a),"form",void 0),a.layerControlInputs=[],a.layers=[],a.lastZIndex=0,a.handlingClick=!1,a.initLayers(),pe(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,he.Z)(a)),a}return(0,wt.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:$p.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var a=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(s){s.layer.on("remove",a.onLayerChange),s.layer.on("add",a.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(a,s){return this.addLayer(a,s,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var a=this.renderService.getViewportSize(),s=a.height;Zs(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var p=s-(this.container.offsetTop+50);return p<this.form.clientHeight?(Zs(this.form,"l7-control-layers-scrollbar"),this.form.style.height=p+"px"):pu(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return pu(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var a=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(s){s.layer.off("remove",a.onLayerChange),s.layer.off("add",a.onLayerChange)}))}},{key:"initLayout",value:function(){var a="l7-control-layers",s=this.container=va("div",a),p=this.controlOption.collapsed;s.setAttribute("aria-haspopup","true");var v=this.form=va("form",a+"-list");p&&(this.mapsService.on("click",this.collapse),s.addEventListener("mouseenter",this.expand),s.addEventListener("mouseleave",this.collapse)),this.layersLink=va("a",a+"-toggle",s);var g=this.layersLink;g.title="Layers",p||this.expand(),this.baseLayersList=va("div",a+"-base",v),this.separator=va("div",a+"-separator",v),this.overlaysList=va("div",a+"-overlays",v),s.appendChild(v)}},{key:"initLayers",value:function(){var a=this,s=this.controlOption,p=s.baseLayers,v=p===void 0?{}:p,g=s.overlayers,x=g===void 0?{}:g;Object.keys(v).forEach(function(C,w){a.addLayer(v[C],C,!1)}),Object.keys(x).forEach(function(C,w){a.addLayer(x[C],C,!0)})}},{key:"update",value:function(){if(!this.container)return this;Ln(this.baseLayersList),Ln(this.overlaysList),this.layerControlInputs=[];var a,s,p,v,g=0;for(p=0;p<this.layers.length;p++)v=this.layers[p],this.addItem(v),s=s||v.overlay,a=a||!v.overlay,g+=v.overlay?0:1;return this.controlOption.hideSingleBase&&(a=a&&g>1,this.baseLayersList.style.display=a?"":"none"),this.separator.style.display=s&&a?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var a=this.layerControlInputs,s,p,v=this.mapsService.getZoom(),g=a.length-1;g>=0;g--)if(s=a[g],p=this.layerService.getLayer(s.layerId),p&&p.inited){var x=p.getMinZoom(),C=p.getMaxZoom();s.disabled=v<x||v>C}}},{key:"addLayer",value:function(a,s,p){this.mapsService&&(a.on("add",this.onLayerChange),a.on("remove",this.onLayerChange)),this.layers.push({layer:a,name:s,overlay:p});var v=this.controlOption,g=v.sortLayers,x=v.sortFunction,C=v.autoZIndex;g&&this.layers.sort(function(w,O){return x(w.layer,O.layer,w.name,O.name)}),C&&a.setZIndex&&(this.lastZIndex++,a.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(a){this.handlingClick||this.update();var s=this.layerService.getLayer(a.target.layerId),p=s!=null&&s.overlay?a.type==="add"?"overlayadd":"overlayremove":a.type==="add"?"baselayerchange":null;p&&this.emit(p,s)}},{key:"createRadioElement",value:function(a,s){var p='<input type="radio" class="l7-control-layers-selector" name="'+a+'"'+(s?' checked="checked"':"")+"/>",v=document.createElement("div");return v.innerHTML=p,v.firstChild}},{key:"addItem",value:function(a){var s=document.createElement("label"),p=this.layerService.getLayer(a.layer.id),v=p&&p.inited&&a.layer.isVisible(),g;a.overlay?(g=document.createElement("input"),g.type="checkbox",g.className="l7-control-layers-selector",g.defaultChecked=v):g=this.createRadioElement("l7-base-layers",v),this.layerControlInputs.push(g),g.layerId=a.layer.id,g.addEventListener("click",this.onInputClick);var x=document.createElement("span");x.innerHTML=" "+a.name;var C=document.createElement("div");s.appendChild(C),C.appendChild(g),C.appendChild(x);var w=a.overlay?this.overlaysList:this.baseLayersList;return w.appendChild(s),this.checkDisabledLayers(),s}},{key:"onInputClick",value:function(){var a=this.layerControlInputs,s,p,v=[],g=[];this.handlingClick=!0;for(var x=a.length-1;x>=0;x--)s=a[x],p=this.layerService.getLayer(s.layerId),s.checked?v.push(p):s.checked||g.push(p);g.forEach(function(C){C.hide()}),v.forEach(function(C){C.show()}),this.handlingClick=!1}}]),r}(D0);function Z2(e){var i=j2();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function j2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var V2=function(e){(0,en.Z)(r,e);var i=Z2(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getDefault",value:function(){return{position:$p.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var a="l7-control-logo",s=va("div",a),p=va("a","l7-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://antv.alipay.com/l7",p.setAttribute("aria-label","AntV logo"),p.setAttribute("rel","noopener nofollow"),s.appendChild(p),s}},{key:"onRemove",value:function(){return null}}]),r}(D0);function G2(e){var i=H2();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function H2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var H4=function(e){(0,en.Z)(r,e);var i=G2(r);function r(n){var a;return(0,ot.Z)(this,r),a=i.call(this,n),(0,I.Z)((0,he.Z)(a),"mScale",void 0),(0,I.Z)((0,he.Z)(a),"iScale",void 0),pe(["update"],(0,he.Z)(a)),a}return(0,wt.Z)(r,[{key:"getDefault",value:function(){return{position:$p.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var a="l7-control-scale",s=va("div",a);this.addScales(a+"-line",s);var p=this.controlOption.updateWhenIdle;return this.mapsService.on(p?"moveend":"mapmove",this.update),this.mapsService.on(p?"zoomend":"zoomchange",this.update),this.update(),s}},{key:"onRemove",value:function(){var a=this.controlOption.updateWhenIdle;this.mapsService.off(a?"zoomend":"zoomchange",this.update),this.mapsService.off(a?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var a=this.mapsService,s=this.controlOption.maxWidth,p=a.getSize()[1]/2,v=a.containerToLngLat([0,p]),g=a.containerToLngLat([s,p]),x=ac([v.lng,v.lat],[g.lng,g.lat]);this.updateScales(x)}},{key:"updateScales",value:function(a){var s=this.controlOption,p=s.metric,v=s.imperial;p&&a&&this.updateMetric(a),v&&a&&this.updateImperial(a)}},{key:"updateMetric",value:function(a){var s=this.getRoundNum(a),p=s<1e3?s+" m":s/1e3+" km";this.updateScale(this.mScale,p,s/a)}},{key:"updateImperial",value:function(a){var s=a*3.2808399,p,v,g;s>5280?(p=s/5280,v=this.getRoundNum(p),this.updateScale(this.iScale,v+" mi",v/p)):(g=this.getRoundNum(s),this.updateScale(this.iScale,g+" ft",g/s))}},{key:"updateScale",value:function(a,s,p){var v=this.controlOption.maxWidth;a.style.width=Math.round(v*p)+"px",a.innerHTML=s}},{key:"getRoundNum",value:function(a){var s=Math.pow(10,(Math.floor(a)+"").length-1),p=a/s;return p=p>=10?10:p>=5?5:p>=3?3:p>=2?2:1,s*p}},{key:"addScales",value:function(a,s){var p=this.controlOption,v=p.metric,g=p.imperial;v&&(this.mScale=va("div",a,s)),g&&(this.iScale=va("div",a,s))}}]),r}(D0);function W2(e){var i=X2();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function X2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var W4=function(e){(0,en.Z)(r,e);var i=W2(r);function r(n){var a;return(0,ot.Z)(this,r),a=i.call(this,n),(0,I.Z)((0,he.Z)(a),"disabled",void 0),(0,I.Z)((0,he.Z)(a),"zoomInButton",void 0),(0,I.Z)((0,he.Z)(a),"zoomOutButton",void 0),pe(["updateDisabled","zoomIn","zoomOut"],(0,he.Z)(a)),a}return(0,wt.Z)(r,[{key:"getDefault",value:function(){return{position:$p.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var a="l7-control-zoom",s=va("div",a+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,a+"-in",s,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,a+"-out",s,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),s}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(a,s,p,v,g){var x=va("a",p,v);return x.innerHTML=a,x.title=s,x.href="javascript:void(0)",x.addEventListener("click",g),x}},{key:"updateDisabled",value:function(){var a=this.mapsService,s="l7-disabled";pu(this.zoomInButton,s),pu(this.zoomOutButton,s),(this.disabled||a.getZoom()<=a.getMinZoom())&&Zs(this.zoomOutButton,s),(this.disabled||a.getZoom()>=a.getMaxZoom())&&Zs(this.zoomInButton,s)}}]),r}(D0);function Og(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Rg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Og(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Og(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Y2(e){var i=q2();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function q2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lg=function(e){(0,en.Z)(r,e);var i=Y2(r);function r(n){var a;return(0,ot.Z)(this,r),a=i.call(this),(0,I.Z)((0,he.Z)(a),"markerOption",void 0),(0,I.Z)((0,he.Z)(a),"defaultMarker",void 0),(0,I.Z)((0,he.Z)(a),"popup",void 0),(0,I.Z)((0,he.Z)(a),"mapsService",void 0),(0,I.Z)((0,he.Z)(a),"sceneSerive",void 0),(0,I.Z)((0,he.Z)(a),"lngLat",void 0),(0,I.Z)((0,he.Z)(a),"scene",void 0),(0,I.Z)((0,he.Z)(a),"added",!1),(0,I.Z)((0,he.Z)(a),"eventHandle",function(s){a.emit(s.type,{target:s,data:a.markerOption.extData,lngLat:a.lngLat})}),a.markerOption=Rg(Rg({},a.getDefault()),n),pe(["update","onMove","onUp","addDragHandler","onMapClick"],(0,he.Z)(a)),a.init(),a}return(0,wt.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:Ht.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(a){this.scene=a,this.mapsService=a.get(qt.IMapService),this.sceneSerive=a.get(qt.ISceneService);var s=this.markerOption,p=s.element,v=s.draggable;return this.mapsService.getMarkerContainer().appendChild(p),this.registerMarkerEvent(p),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var a=this.markerOption.element;return a&&mo(a),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(a){var s=this;if(!this.added)return this.once("added",function(){s.setElement(a)}),this;var p=this.markerOption.element;return p&&mo(p),this.markerOption.element=a,this.init(),this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.update(),this}},{key:"openPopup",value:function(){var a=this;if(!this.added)return this.once("added",function(){a.openPopup()}),this;var s=this.popup;return s?(s.isOpen()||s.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var a=this;this.added||this.once("added",function(){a.closePopup()});var s=this.popup;return s&&s.remove(),this}},{key:"setPopup",value:function(a){return this.popup=a,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var a=this.popup;if(a)a.isOpen()?a.remove():a.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(a){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(a){this.markerOption.extData=a}},{key:"update",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,p=a.anchor;this.updatePosition(),nc(s,"".concat(Nt[p]))}}},{key:"onMapClick",value:function(a){var s=this.markerOption.element;this.popup&&s&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,p=a.offsets,v=this.lngLat,g=v.lng,x=v.lat,C=this.mapsService.getBounds(),w=this.mapsService.lngLatToContainer([g,x]);if(s){s.style.display="block",s.style.whiteSpace="nowrap";var O=this.mapsService.getContainer(),D=0,G=0;if(O&&(D=O.scrollWidth,G=O.scrollHeight),Math.abs(C[0][0])>180||Math.abs(C[1][0])>180){if(w.x>D){var q=this.mapsService.lngLatToContainer([g-360,x]);w.x=q.x}if(w.x<0){var te=this.mapsService.lngLatToContainer([g+360,x]);w.x=te.x}}(w.x>D||w.x<0||w.y>G||w.y<0)&&(s.style.display="none"),s.style.left=w.x+p[0]+"px",s.style.top=w.y-p[1]+"px"}}}},{key:"init",value:function(){var a=this,s=this.markerOption.element,p=this.markerOption,v=p.color,g=p.anchor;if(!s){this.defaultMarker=!0,s=va("div"),this.markerOption.element=s;var x=document.createElementNS("http://www.w3.org/2000/svg","svg");x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height","48px"),x.setAttributeNS(null,"width","48px"),x.setAttributeNS(null,"viewBox","0 0 1024 1024");var C=document.createElementNS("http://www.w3.org/2000/svg","path");C.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),C.setAttributeNS(null,"fill",v),x.appendChild(C),s.appendChild(x)}Zs(s,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(w){var O,D,G=((O=a.markerOption)===null||O===void 0?void 0:O.style)&&((D=a.markerOption)===null||D===void 0?void 0:D.style[w]);s&&(s.style[w]=G)}),s.addEventListener("click",function(w){a.onMapClick(w)}),s.addEventListener("click",this.eventHandle),Qt(s,g,"marker")}},{key:"registerMarkerEvent",value:function(a){a.addEventListener("mousemove",this.eventHandle),a.addEventListener("click",this.eventHandle),a.addEventListener("mousedown",this.eventHandle),a.addEventListener("mouseup",this.eventHandle),a.addEventListener("dblclick",this.eventHandle),a.addEventListener("contextmenu",this.eventHandle),a.addEventListener("mouseover",this.eventHandle),a.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var a=this.getElement();a.removeEventListener("mousemove",this.eventHandle),a.removeEventListener("click",this.eventHandle),a.removeEventListener("mousedown",this.eventHandle),a.removeEventListener("mouseup",this.eventHandle),a.removeEventListener("dblclick",this.eventHandle),a.removeEventListener("contextmenu",this.eventHandle),a.removeEventListener("mouseover",this.eventHandle),a.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(a){throw new Error("Method not implemented.")}},{key:"onUp",value:function(a){throw new Error("Method not implemented.")}}]),r}(ju.EventEmitter);function kg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Dg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?kg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):kg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function K2(e){var i=$2();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function $2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var X4=function(e){(0,en.Z)(r,e);var i=K2(r);function r(n){var a,s;return(0,ot.Z)(this,r),s=i.call(this),(0,I.Z)((0,he.Z)(s),"markers",[]),(0,I.Z)((0,he.Z)(s),"markerLayerOption",void 0),(0,I.Z)((0,he.Z)(s),"clusterIndex",void 0),(0,I.Z)((0,he.Z)(s),"points",[]),(0,I.Z)((0,he.Z)(s),"clusterMarkers",[]),(0,I.Z)((0,he.Z)(s),"mapsService",void 0),(0,I.Z)((0,he.Z)(s),"scene",void 0),(0,I.Z)((0,he.Z)(s),"zoom",void 0),(0,I.Z)((0,he.Z)(s),"bbox",void 0),s.markerLayerOption=Cn()(s.getDefault(),n),pe(["update"],(0,he.Z)(s)),s.zoom=((a=s.markerLayerOption.clusterOption)===null||a===void 0?void 0:a.zoom)||-99,s}return(0,wt.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(a){return this.scene=a,this.mapsService=a.get(qt.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(a){var s=this.markerLayerOption.cluster;if(s&&(this.addPoint(a,this.markers.length),this.mapsService)){var p=this.mapsService.getZoom(),v=this.mapsService.getBounds();this.bbox=f(v,.5),this.zoom=Math.floor(p),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(a)}},{key:"removeMarker",value:function(a){this.markers.indexOf(a);var s=this.markers.indexOf(a);s>-1&&this.markers.splice(s,1)}},{key:"hide",value:function(){this.markers.map(function(a){a.getElement().style.opacity="0"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(a){a.getElement().style.opacity="1"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var a=this.markerLayerOption.cluster;return a?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var a=this;this.getMarkers().forEach(function(s){s.addTo(a.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(a){a.remove()}),this.clusterMarkers.forEach(function(a){a.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(a,s){var p=a.getLnglat(),v=p.lng,g=p.lat,x={geometry:{type:"Point",coordinates:[v,g]},properties:Dg(Dg({},a.getExtData()),{},{marker_id:s})};this.points.push(x),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var a=this.markerLayerOption.clusterOption,s=a.radius,p=a.minZoom,v=p===void 0?0:p,g=a.maxZoom;this.clusterIndex=new(lh())({radius:s,minZoom:v,maxZoom:g}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(a,s){var p=this,v=a[0].concat(a[1]),g=this.clusterIndex.getClusters(v,s);this.clusterMarkers.forEach(function(x){x.remove()}),this.clusterMarkers=[],g.forEach(function(x){var C,w=p.markerLayerOption.clusterOption,O=w.field,D=w.method;if(x.properties&&(C=x.properties)!==null&&C!==void 0&&C.cluster_id){var G,q=p.getLeaves((G=x.properties)===null||G===void 0?void 0:G.cluster_id);if(x.properties.clusterData=q,O&&D){var te=q==null?void 0:q.map(function(Et){var Tt=(0,I.Z)({},O,Et.properties[O]);return Tt}),Se=ni(te,O),ze=pi(D,Se),$e="point_"+D;x.properties[$e]=ze.toFixed(2)}}var at=p.clusterMarker(x);p.clusterMarkers.push(at),at.addTo(p.scene)})}},{key:"getLeaves",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return a?this.clusterIndex.getLeaves(a,s,p):null}},{key:"clusterMarker",value:function(a){var s=this.markerLayerOption.clusterOption,p=s,v=p.element,g=v===void 0?this.generateElement.bind(this):v,x=new Lg({element:g(a)}).setLnglat({lng:a.geometry.coordinates[0],lat:a.geometry.coordinates[1]});return x}},{key:"normalMarker",value:function(a){var s=a.properties.marker_id;return this.markers[s]}},{key:"update",value:function(){if(!!this.mapsService){var a=this.mapsService.getZoom(),s=this.mapsService.getBounds();(!this.bbox||Math.abs(a-this.zoom)>=1||!c(this.bbox,s))&&(this.bbox=f(s,.5),this.zoom=Math.floor(a),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(a){var s=va("div","l7-marker-cluster"),p=va("div","",s),v=va("span","",p),g=this.markerLayerOption.clusterOption,x=g.field,C=g.method;a.properties.point_count=a.properties.point_count||1;var w=x&&C?a.properties["point_"+C]||a.properties[x]:a.properties.point_count;return v.textContent=w,s}}]),r}(ju.EventEmitter);function Fg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Bg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Fg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Q2(e){var i=J2();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function J2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ng=function(e){(0,en.Z)(r,e);var i=Q2(r);function r(n){var a;return(0,ot.Z)(this,r),a=i.call(this),(0,I.Z)((0,he.Z)(a),"popupOption",void 0),(0,I.Z)((0,he.Z)(a),"mapsService",void 0),(0,I.Z)((0,he.Z)(a),"sceneSerive",void 0),(0,I.Z)((0,he.Z)(a),"lngLat",void 0),(0,I.Z)((0,he.Z)(a),"content",void 0),(0,I.Z)((0,he.Z)(a),"closeButton",void 0),(0,I.Z)((0,he.Z)(a),"timeoutInstance",void 0),(0,I.Z)((0,he.Z)(a),"container",void 0),(0,I.Z)((0,he.Z)(a),"tip",void 0),(0,I.Z)((0,he.Z)(a),"scene",void 0),a.popupOption=Bg(Bg({},a.getdefault()),n),pe(["update","onClickClose","remove"],(0,he.Z)(a)),a}return(0,wt.Z)(r,[{key:"addTo",value:function(a){var s=this;return this.mapsService=a.get(qt.IMapService),this.sceneSerive=a.get(qt.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=a,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){s.mapsService.on("click",s.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(a){var s=window.document.createDocumentFragment(),p=window.document.createElement("body"),v;for(p.innerHTML=a;v=p.firstChild,!!v;)s.appendChild(v);return this.setDOMContent(s)}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(a){return this.setDOMContent(window.document.createTextNode(a))}},{key:"setMaxWidth",value:function(a){return this.popupOption.maxWidth=a,this.update(),this}},{key:"setDOMContent",value:function(a){return this.createContent(),this.content.appendChild(a),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&mo(this.content),this.content=va("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=va("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(a,s,p){var v=window.document.createElement(a);return s!==void 0&&(v.className=s),p&&p.appendChild(v),v}},{key:"removeDom",value:function(a){a.parentNode&&a.parentNode.removeChild(a)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:Ht.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(a){a.stopPropagation&&a.stopPropagation(),this.remove()}},{key:"update",value:function(){var a=this,s=this.lngLat,p=this.popupOption,v=p.className,g=p.maxWidth,x=p.anchor;if(!(!this.mapsService||!s||!this.content)){var C=this.mapsService.getMarkerContainer();if(!this.container&&C){this.container=this.creatDom("div","l7-popup",C),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),v&&v.split(" ").forEach(function(O){return a.container.classList.add(O)});var w=this.popupOption.stopPropagation;w&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(O){a.container.addEventListener(O,function(D){D.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}g&&this.container.style.maxWidth!==g&&(this.container.style.maxWidth=g),this.updatePosition(),nc(this.container,"".concat(Nt[x])),Qt(this.container,x,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.lngLat,s=a.lng,p=a.lat,v=this.popupOption.offsets,g=this.mapsService.lngLatToContainer([s,p]);this.container.style.left=g.x+v[0]+"px",this.container.style.top=g.y-v[1]+"px"}}}]),r}(ju.EventEmitter);function eE(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),a.appendChild(p),p}}eE(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var tE=N(52353),rE=N.n(tE),nE=N(13218),Wu=N.n(nE),Qp,zg=(Qp={},(0,I.Z)(Qp,_c.additive,{enable:!0,func:{srcRGB:V.ONE,dstRGB:V.ONE,srcAlpha:1,dstAlpha:1}}),(0,I.Z)(Qp,_c.none,{enable:!1}),(0,I.Z)(Qp,_c.normal,{enable:!0,func:{srcRGB:V.SRC_ALPHA,dstRGB:V.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,I.Z)(Qp,_c.subtractive,{enable:!0,func:{srcRGB:V.ONE,dstRGB:V.ONE,srcAlpha:V.ZERO,dstAlpha:V.ONE_MINUS_SRC_COLOR},equation:{rgb:V.FUNC_SUBTRACT,alpha:V.FUNC_SUBTRACT}}),(0,I.Z)(Qp,_c.max,{enable:!0,func:{srcRGB:V.ONE,dstRGB:V.ONE},equation:{rgb:V.MAX_EXT}}),(0,I.Z)(Qp,_c.min,{enable:!0,func:{srcRGB:V.ONE,dstRGB:V.ONE},equation:{rgb:V.MIN_EXT}}),Qp),iE=N(81763),pa=N.n(iE),Y4=1024;function cl(e,i,r,n,a){i.updateStyleAttribute(e,r,n,a)}function aE(e,i){e.opacity&&F0("opacity",i,e.opacity),e.strokeWidth&&F0("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&F0("strokeOpacity",i,e.strokeOpacity),e.stroke&&oE("stroke",i,e.stroke),e.offsets&&Ug("offsets",i,e.offsets),e.textOffset&&Ug("textOffset",i,e.textOffset),e.thetaOffset&&F0("thetaOffset",i,e.thetaOffset)}function F0(e,i,r){ua()(r)?cl(e,i,r,function(n){return n}):pa()(r)?cl(e,i,[r],void 0):Array.isArray(r)&&r.length===2?ua()(r[0])&&to()(r[1])||ua()(r[0])&&Array.isArray(r[1])&&pa()(r[1][0])&&pa()(r[1][1])?cl(e,i,r[0],r[1]):cl(e,i,[1],void 0):cl(e,i,[1],void 0)}function Ug(e,i,r){ua()(r)?cl(e,i,r,function(n){return n}):Array.isArray(r)&&r.length===2&&ua()(r[0])&&to()(r[1])?cl(e,i,r[0],r[1]):Array.isArray(r)&&r.length===2&&pa()(r[0])&&pa()(r[1])?cl(e,i,r,void 0):cl(e,i,[0,0],void 0)}function oE(e,i,r){ua()(r)?cl(e,i,r,void 0):Array.isArray(r)&&r.length===2&&(ua()(r[0])&&to()(r[1])||ua()(r[0])&&Array.isArray(r[1])&&r[1].length>0)?cl(e,i,r[0],r[1]):cl(e,i,"#fff",void 0)}var Ls;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(Ls||(Ls={}));function sE(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=E(r),a=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return a}function uE(e,i){var r=this;e.length>0&&i.version===Ls["GAODE2.x"]&&(typeof e[0].coordinates[0]=="number"?e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=Ls["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=r.mapService.lngLatToCoord(n.coordinates)}):e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=Ls["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=r.mapService.lngLatToCoords(n.coordinates)}))}function lE(e,i){e.length>0&&i.version===Ls.SIMPLE&&e.map(function(r){r.simpleCoordinate||(r.coordinates=cE(r.coordinates,i),r.simpleCoordinate=!0)})}function cE(e,i){if(typeof e[0]=="number")return i.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var r=[];return e.map(function(a){var s=[];a.map(function(p){s.push(i.simpleMapCoord.unproject(p))}),r.push(s)}),r}else{var n=[];return e.map(function(a){n.push(i.simpleMapCoord.unproject(a))}),n}}function fE(e,i,r){var n;if(!e.scale)return[];var a=(e==null||(n=e.scale)===null||n===void 0?void 0:n.scalers)||[],s=[];a.forEach(function(v){var g,x=v.field;(i.hasOwnProperty(x)||((g=e.scale)===null||g===void 0?void 0:g.type)==="variable")&&s.push(i[x])});var p=e.mapping?e.mapping(s):[];return e.name==="color"&&!He(p[0])?[r]:p}function pE(e,i,r,n,a,s){var p=s==null?void 0:s.getLayerConfig(),v=p.arrow,g=v===void 0?{enable:!1}:v,x=i.map(function(C){var w={id:C._id,coordinates:C.coordinates};if(e.filter(function(G){return G.scale!==void 0}).forEach(function(G){var q=fE(G,C,a);G.needRemapping=!1,G.name==="color"&&(q=q.map(function(te){return be(te)})),w[G.name]=Array.isArray(q)&&q.length===1?q[0]:q,G.name==="shape"&&(w.shape=r.getIconFontKey(w[G.name]))}),w.shape==="line"&&g.enable){var O=w.coordinates,D=sE(O[0],O[1]);w.coordinates.splice(1,0,D,D)}return w});return uE(x,n),lE(x,n),x}function hE(e,i,r,n,a,s){var p=new Bp(a,s),v=e.getBottomColor(),g=n.getLayerStyleAttributes()||[],x=p.data.dataArray,C=x,w=pE(g,C,i,r,v,e);return p.destroy(),w}function Zg(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function jg(e,i,r,n){var a=e.multiPassRenderer,s=e.getLayerConfig(),p=s.enablePicking,v=s.enableTAA;return v?a.add(n("taa")):a.add(n("render")),Zg(i).forEach(function(g){var x=(0,Q.Z)(g,2),C=x[0],w=x[1];a.add(r(C),w)}),a.add(r("copy")),a}var dE=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function vE(e,i,r){if(typeof i=="string"&&typeof r=="string"&&i!==r){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}dE.map(function(n){if(n.includes(i)&&n.includes(r)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var mE=["passes"],gE=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],Vg,Fv,Gg;function yE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_E(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function _E(e,i){if(!!e){if(typeof e=="string")return Hg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Hg(e,i)}}function Hg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Wg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Xu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Wg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function xE(e){var i=bE();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function bE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xg=0,Jp=(Vg=kv(qt.IGlobalConfigService),Fv=function(e){(0,en.Z)(r,e);var i=xE(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,ot.Z)(this,r),n=i.call(this),(0,I.Z)((0,he.Z)(n),"id","".concat(Xg++)),(0,I.Z)((0,he.Z)(n),"name","".concat(Xg)),(0,I.Z)((0,he.Z)(n),"type",void 0),(0,I.Z)((0,he.Z)(n),"visible",!0),(0,I.Z)((0,he.Z)(n),"zIndex",0),(0,I.Z)((0,he.Z)(n),"minZoom",void 0),(0,I.Z)((0,he.Z)(n),"maxZoom",void 0),(0,I.Z)((0,he.Z)(n),"inited",!1),(0,I.Z)((0,he.Z)(n),"layerModelNeedUpdate",!1),(0,I.Z)((0,he.Z)(n),"pickedFeatureID",null),(0,I.Z)((0,he.Z)(n),"selectedFeatureID",null),(0,I.Z)((0,he.Z)(n),"styleNeedUpdate",!1),(0,I.Z)((0,he.Z)(n),"rendering",void 0),(0,I.Z)((0,he.Z)(n),"clusterZoom",0),(0,I.Z)((0,he.Z)(n),"layerType",void 0),(0,I.Z)((0,he.Z)(n),"isLayerGroup",!1),(0,I.Z)((0,he.Z)(n),"triangulation",void 0),(0,I.Z)((0,he.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,I.Z)((0,he.Z)(n),"hooks",{init:new _f,afterInit:new _f,beforeRender:new _f,beforeRenderData:new yf,afterRender:new Hs,beforePickingEncode:new Hs,afterPickingEncode:new Hs,beforeHighlight:new Hs(["pickedColor"]),afterHighlight:new Hs,beforeSelect:new Hs(["pickedColor"]),afterSelect:new Hs,beforeDestroy:new Hs,afterDestroy:new Hs}),(0,I.Z)((0,he.Z)(n),"models",[]),(0,I.Z)((0,he.Z)(n),"multiPassRenderer",void 0),(0,I.Z)((0,he.Z)(n),"plugins",void 0),(0,I.Z)((0,he.Z)(n),"sourceOption",void 0),(0,I.Z)((0,he.Z)(n),"layerModel",void 0),(0,I.Z)((0,he.Z)(n),"shapeOption",void 0),(0,I.Z)((0,he.Z)(n),"sceneContainer",void 0),(0,I.Z)((0,he.Z)(n),"layerChildren",[]),(0,I.Z)((0,he.Z)(n),"masks",[]),fi((0,he.Z)(n),"configService",Gg,(0,he.Z)(n)),(0,I.Z)((0,he.Z)(n),"shaderModuleService",void 0),(0,I.Z)((0,he.Z)(n),"cameraService",void 0),(0,I.Z)((0,he.Z)(n),"coordinateService",void 0),(0,I.Z)((0,he.Z)(n),"iconService",void 0),(0,I.Z)((0,he.Z)(n),"fontService",void 0),(0,I.Z)((0,he.Z)(n),"pickingService",void 0),(0,I.Z)((0,he.Z)(n),"rendererService",void 0),(0,I.Z)((0,he.Z)(n),"layerService",void 0),(0,I.Z)((0,he.Z)(n),"interactionService",void 0),(0,I.Z)((0,he.Z)(n),"mapService",void 0),(0,I.Z)((0,he.Z)(n),"styleAttributeService",void 0),(0,I.Z)((0,he.Z)(n),"layerSource",void 0),(0,I.Z)((0,he.Z)(n),"postProcessingPassFactory",void 0),(0,I.Z)((0,he.Z)(n),"normalPassFactory",void 0),(0,I.Z)((0,he.Z)(n),"animateOptions",{enable:!1}),(0,I.Z)((0,he.Z)(n),"container",void 0),(0,I.Z)((0,he.Z)(n),"encodedData",void 0),(0,I.Z)((0,he.Z)(n),"configSchema",void 0),(0,I.Z)((0,he.Z)(n),"currentPickId",null),(0,I.Z)((0,he.Z)(n),"rawConfig",void 0),(0,I.Z)((0,he.Z)(n),"needUpdateConfig",void 0),(0,I.Z)((0,he.Z)(n),"pendingStyleAttributes",[]),(0,I.Z)((0,he.Z)(n),"scaleOptions",{}),(0,I.Z)((0,he.Z)(n),"animateStartTime",void 0),(0,I.Z)((0,he.Z)(n),"aniamateStatus",!1),(0,I.Z)((0,he.Z)(n),"bottomColor","rgba(0, 0, 0, 0)"),(0,I.Z)((0,he.Z)(n),"isDestroied",!1),(0,I.Z)((0,he.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var s=n.getLayerConfig(),p=s.autoFit,v=s.fitBoundsOptions;p&&n.fitBounds(v),n.reRender()}),n.name=a.name||n.id,n.zIndex=a.zIndex||0,n.rawConfig=a,n}return(0,wt.Z)(r,[{key:"addMaskLayer",value:function(a){this.masks.push(a)}},{key:"removeMaskLayer",value:function(a){var s=this.masks.indexOf(a);s>-1&&this.masks.splice(s,1),a.destroy()}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(a){if(!this.inited)this.needUpdateConfig=Xu(Xu({},this.needUpdateConfig),a);else{var s=this.container.get(qt.SceneID);aE(a,this),this.configService.setLayerConfig(s,this.id,Xu(Xu(Xu({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),a)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(a,s){this.container=a,this.sceneContainer=s}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(a){this.bottomColor=a}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(a){return this.plugins.push(a),this}},{key:"init",value:function(){var a=this,s=this.container.get(qt.SceneID);this.configService.setLayerConfig(s,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(qt.IIconService),this.fontService=this.container.get(qt.IFontService),this.rendererService=this.container.get(qt.IRendererService),this.layerService=this.container.get(qt.ILayerService),this.interactionService=this.container.get(qt.IInteractionService),this.pickingService=this.container.get(qt.IPickingService),this.mapService=this.container.get(qt.IMapService);var p=this.getLayerConfig(),v=p.enableMultiPassRenderer,g=p.passes;v&&g!==null&&g!==void 0&&g.length&&g.length>0&&this.mapService.on("mapAfterFrameChange",function(){a.renderLayers()}),this.cameraService=this.container.get(qt.ICameraService),this.coordinateService=this.container.get(qt.ICoordinateSystemService),this.shaderModuleService=this.container.get(qt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(qt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(qt.IFactoryNormalPass),this.styleAttributeService=this.container.get(qt.IStyleAttributeService),this.multiPassRenderer=this.container.get(qt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(O){var D=O.attributeName,G=O.attributeField,q=O.attributeValues,te=O.updateOptions;a.styleAttributeService.updateStyleAttribute(D,{scale:Xu({field:G},a.splitValuesAndCallbackInAttribute(q,a.getLayerConfig()[D]))},te)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(qt.ILayerPlugin);var x=yE(this.plugins),C;try{for(x.s();!(C=x.n()).done;){var w=C.value;w.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(O){x.e(O)}finally{x.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(a){a.attributes&&a.elements?this.models.map(function(s){s.updateAttributesAndElements(a.attributes,a.elements)}):console.warn("data error")}},{key:"createModelData",value:function(a,s){if(this.layerModel.createModelData)return this.layerModel.createModelData(s);var p=this.calculateEncodeData(a,s),v=this.triangulation;return p&&v?this.styleAttributeService.createAttributesAndIndices(p,v):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(a,s){return this.inited?hE(this,this.fontService,this.mapService,this.styleAttributeService,a,s):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Xu(Xu({},this.getDefaultConfig()),this.rawConfig));var a=this.getLayerConfig(),s=a.animateOption;s!=null&&s.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(a,s,p){return this.updateStyleAttribute("color",a,s,p),this}},{key:"texture",value:function(a,s,p){return this.updateStyleAttribute("texture",a,s,p),this}},{key:"rotate",value:function(a,s,p){return this.updateStyleAttribute("rotate",a,s,p),this}},{key:"size",value:function(a,s,p){return this.updateStyleAttribute("size",a,s,p),this}},{key:"filter",value:function(a,s,p){return this.updateStyleAttribute("filter",a,s,p),this}},{key:"shape",value:function(a,s,p){var v,g,x,C=(v=this.styleAttributeService)===null||v===void 0||(g=v.getLayerStyleAttribute("shape"))===null||g===void 0||(x=g.scale)===null||x===void 0?void 0:x.field,w=a;return this.shapeOption={field:a,values:s},this.updateStyleAttribute("shape",a,s,p),vE(this,C,w),this}},{key:"label",value:function(a,s,p){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:a,attributeValues:s,updateOptions:p}),this}},{key:"animate",value:function(a){var s={};return Wu()(a)?(s.enable=!0,s=Xu(Xu({},s),a)):s.enable=a,this.updateLayerConfig({animateOption:s}),this}},{key:"source",value:function(a,s){return a!=null&&a.data?(this.setSource(a),this):(this.sourceOption={data:a,options:s},this.clusterZoom=0,this)}},{key:"setData",value:function(a,s){var p=this;return this.inited?this.layerSource.setData(a,s):this.on("inited",function(){var v=p.getSource();v?p.layerSource.setData(a,s):(p.source(new Bp(a,s)),p.sourceEvent())}),this}},{key:"style",value:function(a){var s=this,p=this.getLayerConfig(),v=a.passes,g=(0,gc.Z)(a,mE);return v&&Zg(v).forEach(function(x){var C=s.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(x[0]);C&&C.updateOptions(x[1])}),this.rawConfig=Xu(Xu({},this.rawConfig),g),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),p&&p.mask===!0&&a.mask===!1&&(this.clearModels(),this.models=this.layerModel.buildModels()),this}},{key:"scale",value:function(a,s){return Wu()(a)?this.scaleOptions=Xu(Xu({},this.scaleOptions),a):this.scaleOptions[a]=s,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"renderMultiPass",value:function(){var n=(0,Ta.Z)(di().mark(function s(){return di().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.getEncodedData().length===0){v.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){v.next=6;break}return v.next=4,this.multiPassRenderer.render();case 4:v.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return v.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"active",value:function(a){var s={};return s.enableHighlight=Wu()(a)?!0:a,Wu()(a)?(s.enableHighlight=!0,a.color&&(s.highlightColor=a.color),a.mix&&(s.activeMix=a.mix)):s.enableHighlight=!!a,this.updateLayerConfig(s),this}},{key:"setActive",value:function(a,s){var p=this;if(Wu()(a)){var v=a.x,g=v===void 0?0:v,x=a.y,C=x===void 0?0:x;this.updateLayerConfig({highlightColor:Wu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Wu()(s)?s.mix:this.getLayerConfig().activeMix}),this.pick({x:g,y:C})}else this.updateLayerConfig({pickedFeatureID:a,highlightColor:Wu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Wu()(s)?s.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(et(a)).then(function(){setTimeout(function(){p.reRender()},1)})}},{key:"select",value:function(a){var s={};return s.enableSelect=Wu()(a)?!0:a,Wu()(a)?(s.enableSelect=!0,a.color&&(s.selectColor=a.color),a.mix&&(s.selectMix=a.mix)):s.enableSelect=!!a,this.updateLayerConfig(s),this}},{key:"setSelect",value:function(a,s){var p=this;if(Wu()(a)){var v=a.x,g=v===void 0?0:v,x=a.y,C=x===void 0?0:x;this.updateLayerConfig({selectColor:Wu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Wu()(s)?s.mix:this.getLayerConfig().selectMix}),this.pick({x:g,y:C})}else this.updateLayerConfig({pickedFeatureID:a,selectColor:Wu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Wu()(s)?s.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(et(a)).then(function(){setTimeout(function(){p.reRender()},1)})}},{key:"setBlend",value:function(a){return this.updateLayerConfig({blend:a}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.type==="CanvasLayer"&&this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(a){return this.zIndex=a,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(a){this.currentPickId=a}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(a){this.selectedFeatureID=a}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var a=this.mapService.getZoom(),s=this.getLayerConfig(),p=s.visible,v=s.minZoom,g=v===void 0?-Infinity:v,x=s.maxZoom,C=x===void 0?Infinity:x;return!!p&&a>=g&&a<=C}},{key:"setMultiPass",value:function(a,s){if(this.updateLayerConfig({enableMultiPassRenderer:a}),s&&this.updateLayerConfig({passes:s}),a){var p=this.getLayerConfig(),v=p.passes,g=v===void 0?[]:v;this.multiPassRenderer=jg(this,g,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var x=this.rendererService.getViewportSize(),C=x.width,w=x.height;this.multiPassRenderer.resize(C,w)}return this}},{key:"setMinZoom",value:function(a){return this.updateLayerConfig({minZoom:a}),this}},{key:"getMinZoom",value:function(){var a=this.getLayerConfig(),s=a.minZoom;return s}},{key:"getMaxZoom",value:function(){var a=this.getLayerConfig(),s=a.maxZoom;return s}},{key:"get",value:function(a){var s=this.getLayerConfig();return s[a]}},{key:"setMaxZoom",value:function(a){return this.updateLayerConfig({maxZoom:a}),this}},{key:"setAutoFit",value:function(a){return this.updateLayerConfig({autoFit:a}),this}},{key:"fitBounds",value:function(a){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var s=this.getSource(),p=s.extent,v=p.some(function(g){return Math.abs(g)===Infinity});return v?this:(this.mapService.fitBounds([[p[0],p[1]],[p[2],p[3]]],a),this)}},{key:"destroy",value:function(){var a;this.isDestroied||(this.layerChildren.map(function(s){return s.destroy()}),this.layerChildren=[],this.masks.map(function(s){return s.destroy()}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(a=this.layerModel)===null||a===void 0||a.clearModels(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(a){return a.destroy()}),this.layerModel.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(a){return a.needRescale||a.needRemapping||a.needRegenerateVertices}).length}},{key:"setSource",value:function(a){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=a,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(a){this.encodedData=a}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(a){return this.styleAttributeService.getLayerAttributeScale(a)}},{key:"getLegendItems",value:function(a){var s=this.styleAttributeService.getLayerAttributeScale(a);if(!s)return[];if(s.invertExtent){var p=s.range().map(function(x){return(0,I.Z)({value:s.invertExtent(x)},a,x)});return p}else if(s.ticks){var v=s.ticks().map(function(x){return(0,I.Z)({value:x},a,s(x))});return v}else if(s!=null&&s.domain){var g=s.domain().filter(function(x){return!rE()(x)}).map(function(x){return(0,I.Z)({value:x},a,s(x))});return g}return[]}},{key:"pick",value:function(a){var s=a.x,p=a.y;this.interactionService.triggerHover({x:s,y:p})}},{key:"boxSelect",value:function(a,s){this.pickingService.boxPickLayer(this,a,s)}},{key:"buildLayerModel",value:function(a){var s=a.moduleName,p=a.vertexShader,v=a.fragmentShader,g=a.triangulation,x=a.segmentNumber,C=(0,gc.Z)(a,gE);this.shaderModuleService.registerModule(s,{vs:p,fs:v});var w=this.shaderModuleService.getModule(s),O=w.vs,D=w.fs,G=w.uniforms,q=this.rendererService.createModel,te=this.styleAttributeService.createAttributesAndIndices(this.encodedData,g,x),Se=te.attributes,ze=te.elements;return q(Xu({attributes:Se,uniforms:G,fs:D,vs:O,elements:ze,blend:zg[_c.normal]},C))}},{key:"createAttrubutes",value:function(a){var s=a.triangulation,p=this.styleAttributeService.createAttributes(this.encodedData,s),v=p.attributes;return v}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(a){var s=this.getLayerConfig(),p=s.enableHighlight,v=p===void 0?!0:p,g=s.enableSelect,x=g===void 0?!0:g,C=this.eventNames().indexOf(a)!==-1||this.eventNames().indexOf("un"+a)!==-1;return(a==="click"||a==="dblclick")&&x&&(C=!0),a==="mousemove"&&(v||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(C=!0),this.isVisible()&&C}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var n=(0,Ta.Z)(di().mark(function s(p){return di().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,p.render();case 2:case"end":return g.stop()}},s)}));function a(s){return n.apply(this,arguments)}return a}()},{key:"renderModels",value:function(a){var s=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.layerModel.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(p){p.draw({uniforms:s.layerModel.getUninforms()},a)})),this}},{key:"updateStyleAttribute",value:function(a,s,p,v){this.inited?this.styleAttributeService.updateStyleAttribute(a,{scale:Xu({field:s},this.splitValuesAndCallbackInAttribute(p,this.getLayerConfig()[s]))},v):this.pendingStyleAttributes.push({attributeName:a,attributeField:s,attributeValues:p,updateOptions:v})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(a){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(a,s){return{values:to()(a)?void 0:a||s,callback:to()(a)?a:void 0}}}]),r}(ju.EventEmitter),Gg=Hn(Fv.prototype,"configService",[Vg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fv),EE=N(18446),ld=N.n(EE),Yg,Bv,qg;function SE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=CE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function CE(e,i){if(!!e){if(typeof e=="string")return Kg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Kg(e,i)}}function Kg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Co=(Yg=kv(qt.IGlobalConfigService),Bv=function(){function e(i){(0,ot.Z)(this,e),(0,I.Z)(this,"triangulation",void 0),(0,I.Z)(this,"createTexture2D",void 0),(0,I.Z)(this,"layer",void 0),(0,I.Z)(this,"dataTexture",void 0),(0,I.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,I.Z)(this,"rowCount",void 0),(0,I.Z)(this,"cacheStyleProperties",void 0),(0,I.Z)(this,"cellLength",void 0),(0,I.Z)(this,"cellProperties",void 0),(0,I.Z)(this,"cellTypeLayout",void 0),(0,I.Z)(this,"stylePropertyesExist",void 0),(0,I.Z)(this,"dataTextureTest",void 0),fi(this,"configService",qg,this),(0,I.Z)(this,"shaderModuleService",void 0),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"iconService",void 0),(0,I.Z)(this,"fontService",void 0),(0,I.Z)(this,"styleAttributeService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"cameraService",void 0),(0,I.Z)(this,"layerService",void 0),this.layer=i,this.rendererService=i.getContainer().get(qt.IRendererService),this.shaderModuleService=i.getContainer().get(qt.IShaderModuleService),this.styleAttributeService=i.getContainer().get(qt.IStyleAttributeService),this.mapService=i.getContainer().get(qt.IMapService),this.iconService=i.getContainer().get(qt.IIconService),this.fontService=i.getContainer().get(qt.IFontService),this.cameraService=i.getContainer().get(qt.ICameraService),this.layerService=i.getContainer().get(qt.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:V.NEAREST,min:V.NEAREST,width:1,height:1}))}return(0,wt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return ld()(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),ld()(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),ld()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),ld()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),ld()(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),ld()(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!pa()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!pa()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!pa()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!pa()(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return ua()(r)?!!(0,Pe.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=be(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Array.isArray(r)&&r.length===2&&pa()(r[0])&&pa()(r[1]))}},{key:"patchMod",value:function(r,n){for(var a=0;a<n;a++)r.push(-1)}},{key:"patchData",value:function(r,n,a){var s=SE(a),p;try{for(s.s();!(p=s.n()).done;){var v=p.value,g=v.attr,x=v.count,C=n[g];C!==void 0?g==="stroke"?r.push.apply(r,(0,ar.Z)(be(C))):g==="offsets"?this.isOffsetStatic(C)?r.push(-C[0],C[1]):r.push(0,0):r.push(pa()(C)?C:1):this.patchMod(r,x)}}catch(w){s.e(w)}finally{s.f()}}},{key:"calDataFrame",value:function(r,n,a){for(var s=n.length,p=Math.ceil(s*r/this.DATA_TEXTURE_WIDTH),v=p*this.DATA_TEXTURE_WIDTH,g=[],x=0;x<s;x++){var C=n[x];this.patchData(g,C,a)}for(var w=g.length;w<v;w++)g.push(-1);return{data:g,width:this.DATA_TEXTURE_WIDTH,height:p}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,a=n===void 0?"normal":n;return zg[_c[a]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),qg=Hn(Bv.prototype,"configService",[Yg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bv),AE=N(9187),Of=N.n(AE),$g=100,q4=36,K4=40;function Qg(e){return e/180*Math.acos(-1)}function Jg(e){var i=Qg(e[0])+Math.PI/2,r=Qg(e[1]),n=$g+Math.random()*.4,a=n*Math.cos(r)*Math.cos(i),s=n*Math.cos(r)*Math.sin(i),p=n*Math.sin(r);return[s,p,a]}function $4(e,i){var r=mat4.create(),n=mat4.create(),a=vec3.fromValues(0,1,0),s=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var p=typeof i.segments!="undefined"?i.segments:32,v=2+p,g=2*v,x=[],C=[],w=[],O=[],D=[],G=[],q=0;q<=v;q++){for(var te=q/v,Se=te*Math.PI,ze=0;ze<=g;ze++){var $e=ze/g,at=$e*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-Se),mat4.identity(r),mat4.rotateY(r,r,at),vec3.transformMat4(s,a,n),vec3.transformMat4(s,s,r),vec3.scale(s,s,-e),w.push(s.slice()),O.push.apply(O,_toConsumableArray(s.slice())),vec3.normalize(s,s),D.push.apply(D,_toConsumableArray(s.slice())),G.push([$e,1-te]),O.push($e,1-te)}if(q>0)for(var Et=w.length,Tt=Et-2*(g+1);Tt+g+2<Et;Tt++)x.push([Tt,Tt+1,Tt+g+1]),C.push(Tt,Tt+1,Tt+g+1),x.push([Tt+g+1,Tt+1,Tt+g+2]),C.push(Tt+g+1,Tt+1,Tt+g+2)}return{cells:x,positions:w,uvs:G,positionsArr:O,indicesArr:C,normalArr:D}}var xi=N(31437),B0=xi.Ue(),Q4=xi.Ue(),$s=xi.Ue(),eh=xi.Ue(),cd=xi.Ue();function Nv(e,i,r,n,a){xi.IH(e,r,n),xi.Fv(e,e),i=xi.al(-e[1],e[0]);var s=xi.al(-r[1],r[0]);return[a/xi.AK(i,s),i]}function th(e,i){return xi.t8(e,-i[1],i[0])}function fd(e,i,r){return xi.lu(e,i,r),xi.Fv(e,e),e}function zv(e,i){return e[0]===i[0]&&e[1]===i[1]}function J4(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var ey=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,ot.Z)(this,e),(0,I.Z)(this,"complex",void 0),(0,I.Z)(this,"join",void 0),(0,I.Z)(this,"cap",void 0),(0,I.Z)(this,"miterLimit",void 0),(0,I.Z)(this,"thickness",void 0),(0,I.Z)(this,"normal",void 0),(0,I.Z)(this,"lastFlip",-1),(0,I.Z)(this,"miter",xi.al(0,0)),(0,I.Z)(this,"started",!1),(0,I.Z)(this,"dash",!1),(0,I.Z)(this,"totalDistance",0),(0,I.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,wt.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,p=a.startIndex,v=1;v<s;v++){var g,x,C,w=r[v-1];w.push((g=n[v-1][2])!==null&&g!==void 0?g:0);var O=n[v-1],D=r[v];D.push((x=n[v][2])!==null&&x!==void 0?x:0);var G=n[v],q=v<r.length-1?[].concat((0,ar.Z)(r[v+1]),[(C=n[v+1][2])!==null&&C!==void 0?C:0]):null,te=v<n.length-1?n[v+1]:null,Se=this.segment_gaode2(a,p,w,D,q,O,G,te);p+=Se}if(this.dash)for(var ze=0;ze<a.positions.length/6;ze++)a.positions[ze*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"simpleExtrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,p=a.startIndex,v=1;v<s;v++){var g,x,C,w=r[v-1];w.push((g=n[v-1][2])!==null&&g!==void 0?g:0);var O=n[v-1],D=r[v];D.push((x=n[v][2])!==null&&x!==void 0?x:0);var G=n[v],q=v<r.length-1?[].concat((0,ar.Z)(r[v+1]),[(C=n[v+1][2])!==null&&C!==void 0?C:0]):null,te=v<n.length-1?n[v+1]:null,Se=this.simpleSegment(a,p,w,D,q,O,G,te);p+=Se}if(this.dash)for(var ze=0;ze<a.positions.length/6;ze++)a.positions[ze*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,p=1;p<a;p++){var v=r[p-1],g=r[p],x=p<r.length-1?r[p+1]:null,C=this.segment(n,s,v,g,x);s+=C}if(this.dash)for(var w=0;w<n.positions.length/6;w++)n.positions[w*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,p=1;p<a;p++){var v=r[p-1],g=r[p],x=p<r.length-1?r[p+1]:null,C=this.simpleSegment(n,s,v,g,x);s+=C}if(this.dash)for(var w=0;w<n.positions.length/6;w++)n.positions[w*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,a,s,p,v,g,x){var C=0,w=r.indices,O=r.positions,D=r.normals,G=this.cap==="square",q=this.join==="bevel",te=Gs([g[0],g[1]]),Se=Gs([v[0],v[1]]);fd($s,s,a);var ze=0;if(this.dash&&(ze=this.lineSegmentDistance(te,Se),this.totalDistance+=ze),this.normal||(this.normal=xi.Ue(),th(this.normal,$s)),!this.started)if(this.started=!0,G){var $e=xi.Ue(),at=xi.Ue();xi.IH($e,this.normal,$s),xi.IH(at,this.normal,$s),D.push(at[0],at[1],0),D.push($e[0],$e[1],0),O.push(a[0],a[1],a[2]|0,this.totalDistance-ze,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),O.push(a[0],a[1],a[2]|0,this.totalDistance-ze,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(O,D,a,this.normal,this.thickness,this.totalDistance-ze);if(w.push(n+0,n+1,n+2),p){zv(s,p)&&xi.IH(p,s,xi.Fv(p,xi.$X(p,s,a))),fd(eh,p,s);var Jt=Nv(cd,xi.Ue(),$s,eh,this.thickness),fr=(0,Q.Z)(Jt,2),Dr=fr[0],tn=fr[1],wr=xi.AK(cd,this.normal)<0?-1:1,xn=q;if(!xn&&this.join==="miter"){var Tn=Dr;Tn>this.miterLimit&&(xn=!0)}xn?(D.push(this.normal[0],this.normal[1],0),D.push(tn[0],tn[1],0),O.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*wr,s[2]|0),this.complex.indexes.push(this.currentIndex),O.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*wr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,w.push.apply(w,(0,ar.Z)(this.lastFlip!==-wr?[n,n+2,n+3]:[n+2,n+1,n+3])),w.push(n+2,n+3,n+4),th(B0,eh),xi.JG(this.normal,B0),D.push(this.normal[0],this.normal[1],0),O.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*wr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,C+=3):(this.extrusions(O,D,s,tn,Dr,this.totalDistance),w.push.apply(w,(0,ar.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),wr=-1,xi.JG(this.normal,tn),C+=2),this.lastFlip=wr}else{if(th(this.normal,$s),G){var Et=xi.Ue(),Tt=xi.Ue();xi.lu(Tt,$s,this.normal),xi.IH(Et,$s,this.normal),D.push(Tt[0],Tt[1],0),D.push(Et[0],Et[1],0),O.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),O.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(O,D,s,this.normal,this.thickness,this.totalDistance);w.push.apply(w,(0,ar.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),C+=2}return C}},{key:"simpleSegment",value:function(r,n,a,s,p){var v=0,g=r.indices,x=r.positions,C=r.normals,w=Gs([s[0],s[1]]),O=Gs([a[0],a[1]]);fd($s,w,O);var D=0;if(this.dash&&(D=this.lineSegmentDistance(w,O),this.totalDistance+=D),this.normal||(this.normal=xi.Ue(),th(this.normal,$s)),this.started||(this.started=!0,this.extrusions(x,C,a,this.normal,this.thickness,this.totalDistance-D)),g.push(n+0,n+1,n+2),!p)th(this.normal,$s),this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance),g.push.apply(g,(0,ar.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2;else{var G=Gs([p[0],p[1]]);zv(w,G)&&xi.IH(G,w,xi.Fv(G,xi.$X(G,w,O))),fd(eh,G,w);var q=Nv(cd,xi.Ue(),$s,eh,this.thickness),te=(0,Q.Z)(q,2),Se=te[0],ze=te[1],$e=xi.AK(cd,this.normal)<0?-1:1;this.extrusions(x,C,s,ze,Se,this.totalDistance),g.push.apply(g,(0,ar.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),$e=-1,xi.JG(this.normal,ze),v+=2,this.lastFlip=$e}return v}},{key:"segment",value:function(r,n,a,s,p){var v=0,g=r.indices,x=r.positions,C=r.normals,w=this.cap==="square",O=this.join==="bevel",D=Gs([s[0],s[1]]),G=Gs([a[0],a[1]]);fd($s,D,G);var q=0;if(this.dash&&(q=this.lineSegmentDistance(D,G),this.totalDistance+=q),this.normal||(this.normal=xi.Ue(),th(this.normal,$s)),!this.started)if(this.started=!0,w){var te=xi.Ue(),Se=xi.Ue();xi.IH(te,this.normal,$s),xi.IH(Se,this.normal,$s),C.push(Se[0],Se[1],0),C.push(te[0],te[1],0),x.push(a[0],a[1],a[2]|0,this.totalDistance-q,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),x.push(a[0],a[1],a[2]|0,this.totalDistance-q,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(x,C,a,this.normal,this.thickness,this.totalDistance-q);if(g.push(n+0,n+1,n+2),p){var at=Gs([p[0],p[1]]);zv(D,at)&&xi.IH(at,D,xi.Fv(at,xi.$X(at,D,G))),fd(eh,at,D);var Et=Nv(cd,xi.Ue(),$s,eh,this.thickness),Tt=(0,Q.Z)(Et,2),Jt=Tt[0],fr=Tt[1],Dr=xi.AK(cd,this.normal)<0?-1:1,tn=O;if(!tn&&this.join==="miter"){var wr=Jt;wr>this.miterLimit&&(tn=!0)}tn?(C.push(this.normal[0],this.normal[1],0),C.push(fr[0],fr[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Dr,s[2]|0),this.complex.indexes.push(this.currentIndex),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*Dr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,g.push.apply(g,(0,ar.Z)(this.lastFlip!==-Dr?[n,n+2,n+3]:[n+2,n+1,n+3])),g.push(n+2,n+3,n+4),th(B0,eh),xi.JG(this.normal,B0),C.push(this.normal[0],this.normal[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Dr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,v+=3):(this.extrusions(x,C,s,fr,Jt,this.totalDistance),g.push.apply(g,(0,ar.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Dr=-1,xi.JG(this.normal,fr),v+=2),this.lastFlip=Dr}else{if(th(this.normal,$s),w){var ze=xi.Ue(),$e=xi.Ue();xi.lu($e,$s,this.normal),xi.IH(ze,$s,this.normal),C.push($e[0],$e[1],0),C.push(ze[0],ze[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance);g.push.apply(g,(0,ar.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2}return v}},{key:"extrusions",value:function(r,n,a,s,p,v){n.push(s[0],s[1],0),n.push(s[0],s[1],0),r.push(a[0],a[1],a[2]|0,v,-p,a[2]|0),this.complex.indexes.push(this.currentIndex),r.push(a[0],a[1],a[2]|0,v,p,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var a=n[0]-r[0],s=n[1]-r[1];return Math.sqrt(a*a+s*s)}}]),e}();function Lh(e){if(pa()(e[0]))return e;if(pa()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(pa()(e[0][0][0])){var i=e,r=0,n=0,a=0;return i.forEach(function(s){s.forEach(function(p){r+=p[0],n+=p[1],a++})}),[r/a,n/a,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function wE(e){for(var i=e[0],r=e[1],n=e[0],a=e[1],s=0,p=0,v=0,g=0;g<e.length;g+=2){var x=e[g],C=e[g+1];x&&C&&(i=Math.max(x,i),r=Math.max(C,r),n=Math.min(x,n),a=Math.min(C,a),s+=x,p+=C,v++)}return{center:[s/v,p/v],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-a,2))/2}}var Qa=N(77160);function TE(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,a=Of().flatten(e),s=a.vertices,p=a.dimensions,v=[],g=[],x=0;x<s.length/p;x++)p===2?v.push(s[x*2],s[x*2+1],1):v.push(s[x*3],s[x*3+1],1);var C=Of()(a.vertices,a.holes,a.dimensions);g.push.apply(g,(0,ar.Z)(C));for(var w=function(G){var q=a.vertices.slice(G*p,(G+1)*p),te=a.vertices.slice((G+1)*p,(G+2)*p);te.length===0&&(te=a.vertices.slice(0,p));var Se=v.length/3;v.push(q[0],q[1],1,te[0],te[1],1,q[0],q[1],0,te[0],te[1],0),g.push.apply(g,(0,ar.Z)([0,2,1,2,3,1].map(function(ze){return ze+Se})))},O=0;O<n;O++)w(O);return{positions:v,index:g}}function ME(e){var i=Of().flatten(e),r=Of()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function ty(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var a=e[0].length,s=Of().flatten(e),p=s.vertices,v=s.dimensions,g=[],x=[],C=[],w=0;w<p.length/v;w++)v===2?g.push(p[w*2],p[w*2+1],1,-1,-1):g.push(p[w*3],p[w*3+1],1,-1,-1),C.push(0,0,1);var O=Of()(s.vertices,s.holes,s.dimensions);x.push.apply(x,(0,ar.Z)(O));for(var D=function(te){var Se=s.vertices.slice(te*v,(te+1)*v),ze=s.vertices.slice((te+1)*v,(te+2)*v);ze.length===0&&(ze=s.vertices.slice(0,v));var $e=g.length/5;g.push(Se[0],Se[1],1,0,0,ze[0],ze[1],1,.1,0,Se[0],Se[1],0,0,.8,ze[0],ze[1],0,.1,.8);var at=PE([ze[0],ze[1],1],[Se[0],Se[1],0],[Se[0],Se[1],1],i);C.push.apply(C,(0,ar.Z)(at).concat((0,ar.Z)(at),(0,ar.Z)(at),(0,ar.Z)(at))),x.push.apply(x,(0,ar.Z)([1,2,0,3,2,1].map(function(Et){return Et+$e})))},G=0;G<a;G++)D(G);return{positions:g,index:x,normals:C}}function PE(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=Qa.create(),s=Qa.create(),p=Qa.create();n&&(e=Bu(e),i=Bu(i),r=Bu(r));var v=Qa.fromValues.apply(Qa,(0,ar.Z)(e)),g=Qa.fromValues.apply(Qa,(0,ar.Z)(i)),x=Qa.fromValues.apply(Qa,(0,ar.Z)(r));Qa.sub(a,x,g),Qa.sub(s,v,g),Qa.cross(p,a,s);var C=Qa.create();return Qa.normalize(C,p),C}var xc,kh;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(kh||(kh={}));var Dh;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Dh||(Dh={}));function Qd(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],a=0;a<e;a++)n.push(r*a+i*Math.PI/12);var s=n.map(function(p){var v=Math.sin(p+Math.PI/4),g=Math.cos(p+Math.PI/4);return[v,g,0]});return s}function ry(){return Qd(30)}function ny(){return Qd(4)}function iy(){return Qd(3)}function ay(){return Qd(6,1)}function oy(){return Qd(5)}var pd=(xc={},(0,I.Z)(xc,Dh.CIRCLE,ry),(0,I.Z)(xc,Dh.HEXAGON,ay),(0,I.Z)(xc,Dh.TRIANGLE,iy),(0,I.Z)(xc,Dh.SQUARE,ny),(0,I.Z)(xc,Dh.PENTAGON,oy),(0,I.Z)(xc,kh.CYLINDER,ry),(0,I.Z)(xc,kh.HEXAGONCOLUMN,ay),(0,I.Z)(xc,kh.TRIANGLECOLUMN,iy),(0,I.Z)(xc,kh.SQUARECOLUMN,ny),(0,I.Z)(xc,kh.PENTAGONCOLUMN,oy),xc),N0={};function Fh(e){var i=Lh(e.coordinates);return{vertices:[].concat((0,ar.Z)(i),(0,ar.Z)(i),(0,ar.Z)(i),(0,ar.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function sy(e){var i=Lh(e.coordinates),r=Jg(i);return{vertices:[].concat((0,ar.Z)(r),(0,ar.Z)(r),(0,ar.Z)(r),(0,ar.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function uy(e){var i=e.shape,r=RE(i,!1),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function ly(e){var i=Lh(e.coordinates);return{vertices:(0,ar.Z)(i),indices:[0],size:i.length}}function Jd(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new ey({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var p=r;Array.isArray(p[0][0])||(p=[r]);for(var v=0;v<s.length;v++){var g=s[v],x=p[v];a.extrude_gaode2(g,x)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(O){a.extrude(O)})}var w=a.complex;return{vertices:w.positions,indices:w.indices,normals:w.normals,indexes:w.indexes,size:6}}function IE(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new ey({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var p=r;Array.isArray(p[0][0])||(p=[r]);for(var v=0;v<s.length;v++){var g=s[v],x=p[v];a.simpleExtrude_gaode2(g,x)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(O){a.simpleExtrude(O)})}var w=a.complex;return{vertices:w.positions,indices:w.indices,normals:w.normals,size:6}}function e0(e){var i=e.coordinates,r=Of().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Of()(n,s,a),vertices:n,size:a}}function cy(e){var i=e.coordinates,r=Of().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Of()(n,s,a),vertices:OE(n),size:a+4}}function OE(e){for(var i=[],r=wE(e),n=r.center,a=r.radius,s=0;s<e.length;s+=2){var p=e[s],v=e[s+1];i.push.apply(i,[p,v,0].concat((0,ar.Z)(n),[a]))}return i}function fy(e){var i=e.coordinates,r=ty(i,!0),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function py(e){var i=e.shape,r=kE(i),n=r.positions,a=r.index;return{vertices:n,indices:a,size:3}}function hy(e){var i=e.coordinates,r=[].concat((0,ar.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,ar.Z)(i[1]),[0,1,0],(0,ar.Z)(i[0]),[0,0,1],(0,ar.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function z0(e,i){for(var r=i||30,n=e.coordinates,a=[],s=[],p=function(x){a.push(x,1,x,n[0][0],n[0][1],n[1][0],n[1][1],x,-1,x,n[0][0],n[0][1],n[1][0],n[1][1]),x!==r-1&&s.push.apply(s,(0,ar.Z)([0,1,2,1,3,2].map(function(C){return x*2+C})))},v=0;v<r;v++)p(v);return{vertices:a,indices:s,size:7}}function dy(e){var i=e.coordinates;i.length===2&&i.push(0);var r=e.size,n=U0(-1,1),a=U0(1,1),s=U0(-1,-1),p=U0(1,-1),v=[].concat((0,ar.Z)(i),(0,ar.Z)(n),(0,ar.Z)(i),(0,ar.Z)(s),(0,ar.Z)(i),(0,ar.Z)(p),(0,ar.Z)(i),(0,ar.Z)(a)),g=[0,1,2,3,0,2];return{vertices:v,indices:g,size:5}}function RE(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(N0&&N0[e])return N0[e];var r=pd[e]?pd[e]():pd.cylinder(),n=ty([r],i);return N0[e]=n,n}function eP(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=new Float32Array(e.length/r*3),s,p,v,g=vec3.create(),x=vec3.create(),C=vec3.create(),w=0,O=i.length;w<O;w+=3){s=i[w+0]*3,p=i[w+1]*3,v=i[w+2]*3;var D=[e[s],e[s+1]],G=[e[p],e[p+1]],q=[e[v],e[v+1]];n&&(D=lngLatToMeters(D),G=lngLatToMeters(G),q=lngLatToMeters(q));var te=D,Se=_slicedToArray(te,2),ze=Se[0],$e=Se[1],at=vec3.fromValues(ze,$e,e[s+2]),Et=G,Tt=_slicedToArray(Et,2),Jt=Tt[0],fr=Tt[1],Dr=vec3.fromValues(Jt,fr,e[p+2]),tn=q,wr=_slicedToArray(tn,2),xn=wr[0],Tn=wr[1],$n=vec3.fromValues(xn,Tn,e[v+2]);vec3.sub(g,$n,Dr),vec3.sub(x,at,Dr),vec3.cross(C,g,x),a[s]+=g[0],a[s+1]+=g[1],a[s+2]+=g[2],a[p]+=g[0],a[p+1]+=g[1],a[p+2]+=g[2],a[v]+=g[0],a[v+1]+=g[1],a[v+2]+=g[2]}return LE(a),a}function LE(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),a=vec3.create();vec3.normalize(a,n),e.set(a,i)}}function tP(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function kE(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=pd[e]?pd[e]():pd.circle(),n=i.indexOf(e)===-1?ME([r]):TE([r]);return n}function U0(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function rP(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function nP(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function DE(e){var i=FE();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function FE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BE=`uniform float u_opacity;
varying vec4 v_Color;

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
}
`,NE=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"

void main() {

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,zE=function(e){(0,en.Z)(r,e);var i=DE(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?0:s;return{u_opacity:pa()(p)?p:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"mask",vertexShader:NE,fragmentShader:BE,triangulation:e0,blend:this.getBlend(),depth:{enable:!1},stencil:{enable:!0,mask:255,func:{cmp:V.ALWAYS,ref:1,mask:255},opFront:{fail:V.REPLACE,zfail:V.REPLACE,zpass:V.REPLACE}}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(Co),UE={fill:zE},ZE=UE;function jE(e){var i=VE();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function VE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GE=function(e){(0,en.Z)(r,e);var i=jE(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"type","MaskLayer"),n}return(0,wt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new ZE[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"fill"}}]),r}(Jp),HE=N(88307),WE=N.n(HE),XE=function(){function e(i,r){(0,ot.Z)(this,e),(0,I.Z)(this,"attribute",void 0),(0,I.Z)(this,"buffer",void 0);var n=r.buffer,a=r.offset,s=r.stride,p=r.normalized,v=r.size,g=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:a||0,stride:s||0,normalized:p||!1,divisor:g||0},v&&(this.attribute.size=v)}return(0,wt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),vp,t0,mp,bc,r0,rh,n0,Z0,Rf,Bh,Ou,Lf,kf,j0,YE=(vp={},(0,I.Z)(vp,V.POINTS,"points"),(0,I.Z)(vp,V.LINES,"lines"),(0,I.Z)(vp,V.LINE_LOOP,"line loop"),(0,I.Z)(vp,V.LINE_STRIP,"line strip"),(0,I.Z)(vp,V.TRIANGLES,"triangles"),(0,I.Z)(vp,V.TRIANGLE_FAN,"triangle fan"),(0,I.Z)(vp,V.TRIANGLE_STRIP,"triangle strip"),vp),vy=(t0={},(0,I.Z)(t0,V.STATIC_DRAW,"static"),(0,I.Z)(t0,V.DYNAMIC_DRAW,"dynamic"),(0,I.Z)(t0,V.STREAM_DRAW,"stream"),t0),Uv=(mp={},(0,I.Z)(mp,V.BYTE,"int8"),(0,I.Z)(mp,V.UNSIGNED_INT,"int16"),(0,I.Z)(mp,V.INT,"int32"),(0,I.Z)(mp,V.UNSIGNED_BYTE,"uint8"),(0,I.Z)(mp,V.UNSIGNED_SHORT,"uint16"),(0,I.Z)(mp,V.UNSIGNED_INT,"uint32"),(0,I.Z)(mp,V.FLOAT,"float"),mp),qE=(bc={},(0,I.Z)(bc,V.ALPHA,"alpha"),(0,I.Z)(bc,V.LUMINANCE,"luminance"),(0,I.Z)(bc,V.LUMINANCE_ALPHA,"luminance alpha"),(0,I.Z)(bc,V.RGB,"rgb"),(0,I.Z)(bc,V.RGBA,"rgba"),(0,I.Z)(bc,V.RGBA4,"rgba4"),(0,I.Z)(bc,V.RGB5_A1,"rgb5 a1"),(0,I.Z)(bc,V.RGB565,"rgb565"),(0,I.Z)(bc,V.DEPTH_COMPONENT,"depth"),(0,I.Z)(bc,V.DEPTH_STENCIL,"depth stencil"),bc),KE=(r0={},(0,I.Z)(r0,V.DONT_CARE,"dont care"),(0,I.Z)(r0,V.NICEST,"nice"),(0,I.Z)(r0,V.FASTEST,"fast"),r0),gy=(rh={},(0,I.Z)(rh,V.NEAREST,"nearest"),(0,I.Z)(rh,V.LINEAR,"linear"),(0,I.Z)(rh,V.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,I.Z)(rh,V.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,I.Z)(rh,V.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,I.Z)(rh,V.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),rh),yy=(n0={},(0,I.Z)(n0,V.REPEAT,"repeat"),(0,I.Z)(n0,V.CLAMP_TO_EDGE,"clamp"),(0,I.Z)(n0,V.MIRRORED_REPEAT,"mirror"),n0),$E=(Z0={},(0,I.Z)(Z0,V.NONE,"none"),(0,I.Z)(Z0,V.BROWSER_DEFAULT_WEBGL,"browser"),Z0),QE=(Rf={},(0,I.Z)(Rf,V.NEVER,"never"),(0,I.Z)(Rf,V.ALWAYS,"always"),(0,I.Z)(Rf,V.LESS,"less"),(0,I.Z)(Rf,V.LEQUAL,"lequal"),(0,I.Z)(Rf,V.GREATER,"greater"),(0,I.Z)(Rf,V.GEQUAL,"gequal"),(0,I.Z)(Rf,V.EQUAL,"equal"),(0,I.Z)(Rf,V.NOTEQUAL,"notequal"),Rf),_y=(Bh={},(0,I.Z)(Bh,V.FUNC_ADD,"add"),(0,I.Z)(Bh,V.MIN_EXT,"min"),(0,I.Z)(Bh,V.MAX_EXT,"max"),(0,I.Z)(Bh,V.FUNC_SUBTRACT,"subtract"),(0,I.Z)(Bh,V.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Bh),V0=(Ou={},(0,I.Z)(Ou,V.ZERO,"zero"),(0,I.Z)(Ou,V.ONE,"one"),(0,I.Z)(Ou,V.SRC_COLOR,"src color"),(0,I.Z)(Ou,V.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,I.Z)(Ou,V.SRC_ALPHA,"src alpha"),(0,I.Z)(Ou,V.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,I.Z)(Ou,V.DST_COLOR,"dst color"),(0,I.Z)(Ou,V.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,I.Z)(Ou,V.DST_ALPHA,"dst alpha"),(0,I.Z)(Ou,V.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,I.Z)(Ou,V.CONSTANT_COLOR,"constant color"),(0,I.Z)(Ou,V.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,I.Z)(Ou,V.CONSTANT_ALPHA,"constant alpha"),(0,I.Z)(Ou,V.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,I.Z)(Ou,V.SRC_ALPHA_SATURATE,"src alpha saturate"),Ou),JE=(Lf={},(0,I.Z)(Lf,V.NEVER,"never"),(0,I.Z)(Lf,V.ALWAYS,"always"),(0,I.Z)(Lf,V.LESS,"less"),(0,I.Z)(Lf,V.LEQUAL,"lequal"),(0,I.Z)(Lf,V.GREATER,"greater"),(0,I.Z)(Lf,V.GEQUAL,"gequal"),(0,I.Z)(Lf,V.EQUAL,"equal"),(0,I.Z)(Lf,V.NOTEQUAL,"notequal"),Lf),hd=(kf={},(0,I.Z)(kf,V.ZERO,"zero"),(0,I.Z)(kf,V.KEEP,"keep"),(0,I.Z)(kf,V.REPLACE,"replace"),(0,I.Z)(kf,V.INVERT,"invert"),(0,I.Z)(kf,V.INCR,"increment"),(0,I.Z)(kf,V.DECR,"decrement"),(0,I.Z)(kf,V.INCR_WRAP,"increment wrap"),(0,I.Z)(kf,V.DECR_WRAP,"decrement wrap"),kf),eS=(j0={},(0,I.Z)(j0,V.FRONT,"front"),(0,I.Z)(j0,V.BACK,"back"),j0),tS=function(){function e(i,r){(0,ot.Z)(this,e),(0,I.Z)(this,"buffer",void 0);var n=r.data,a=r.usage,s=r.type;this.buffer=i.buffer({data:n,usage:vy[a||V.STATIC_DRAW],type:Uv[s||V.UNSIGNED_BYTE]})}return(0,wt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,a=r.offset;this.buffer.subdata(n,a)}}]),e}(),rS=function(){function e(i,r){(0,ot.Z)(this,e),(0,I.Z)(this,"elements",void 0);var n=r.data,a=r.usage,s=r.type,p=r.count;this.elements=i.elements({data:n,usage:vy[a||V.STATIC_DRAW],type:Uv[s||V.UNSIGNED_BYTE],count:p})}return(0,wt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),nS=function(){function e(i,r){(0,ot.Z)(this,e),(0,I.Z)(this,"framebuffer",void 0);var n=r.width,a=r.height,s=r.color,p=r.colors,v=r.depth,g=r.stencil,x={width:n,height:a};Array.isArray(p)&&(x.colors=p.map(function(C){return C.get()})),s&&typeof s!="boolean"&&(x.color=s.get()),this.framebuffer=i.framebuffer(x)}return(0,wt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.framebuffer.resize(n,a)}}]),e}(),iS=N(36719),aS=N.n(iS),oS=N(68630),sS=N.n(oS);function xy(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ec(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?xy(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xy(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var uS=function(){function e(i,r){(0,ot.Z)(this,e),(0,I.Z)(this,"reGl",void 0),(0,I.Z)(this,"destroyed",!1),(0,I.Z)(this,"drawCommand",void 0),(0,I.Z)(this,"drawPickCommand",void 0),(0,I.Z)(this,"drawParams",void 0),(0,I.Z)(this,"options",void 0),(0,I.Z)(this,"uniforms",{}),this.reGl=i;var n=r.vs,a=r.fs,s=r.attributes,p=r.uniforms,v=r.primitive,g=r.count,x=r.elements,C=r.depth,w=r.blend,O=r.stencil,D=r.cull,G=r.instances,q={};this.options=r,p&&(this.uniforms=this.extractUniforms(p),Object.keys(p).forEach(function($e){q[$e]=i.prop($e)}));var te={};Object.keys(s).forEach(function($e){te[$e]=s[$e].get()});var Se={attributes:te,frag:a,uniforms:q,vert:n,blend:{},primitive:YE[v===void 0?V.TRIANGLES:v]};G&&(Se.instances=G),g&&(Se.count=g),x&&(Se.elements=x.get()),this.initDepthDrawParams({depth:C},Se),this.initBlendDrawParams({blend:w},Se),this.initStencilDrawParams({stencil:O},Se),this.initCullDrawParams({cull:D},Se),this.drawCommand=i(Se);var ze=Za()(Se);ze.blend=Ec(Ec({},ze.blend),{},{enable:!1}),this.drawPickCommand=i(ze),this.drawParams=Se}return(0,wt.Z)(e,[{key:"updateAttributesAndElements",value:function(r,n){var a={};Object.keys(r).forEach(function(p){a[p]=r[p].get()}),this.drawParams.attributes=a,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams);var s=Za()(this.drawParams);s.blend=Ec(Ec({},s.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(s)}},{key:"updateAttributes",value:function(r){var n={};Object.keys(r).forEach(function(s){n[s]=r[s].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams);var a=Za()(this.drawParams);a.blend=Ec(Ec({},a.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(a)}},{key:"addUniforms",value:function(r){this.uniforms=Ec(Ec({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var a=Ec(Ec({},this.uniforms),this.extractUniforms(r.uniforms||{})),s={};Object.keys(a).forEach(function(p){var v=(0,xp.Z)(a[p]);v==="boolean"||v==="number"||Array.isArray(a[p])||a[p].BYTES_PER_ELEMENT?s[p]=a[p]:s[p]=a[p].get()}),n?this.drawPickCommand(s):this.drawCommand(s)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var a=r.depth;a&&(n.depth={enable:a.enable===void 0?!0:!!a.enable,mask:a.mask===void 0?!0:!!a.mask,func:QE[a.func||V.LESS],range:a.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var a=r.blend;if(a){var s=a.enable,p=a.func,v=a.equation,g=a.color,x=g===void 0?[0,0,0,0]:g;n.blend={enable:!!s,func:{srcRGB:V0[p&&p.srcRGB||V.SRC_ALPHA],srcAlpha:V0[p&&p.srcAlpha||V.SRC_ALPHA],dstRGB:V0[p&&p.dstRGB||V.ONE_MINUS_SRC_ALPHA],dstAlpha:V0[p&&p.dstAlpha||V.ONE_MINUS_SRC_ALPHA]},equation:{rgb:_y[v&&v.rgb||V.FUNC_ADD],alpha:_y[v&&v.alpha||V.FUNC_ADD]},color:x}}}},{key:"initStencilDrawParams",value:function(r,n){var a=r.stencil;if(a){var s=a.enable,p=a.mask,v=p===void 0?-1:p,g=a.func,x=g===void 0?{cmp:V.ALWAYS,ref:0,mask:-1}:g,C=a.opFront,w=C===void 0?{fail:V.KEEP,zfail:V.KEEP,zpass:V.KEEP}:C,O=a.opBack,D=O===void 0?{fail:V.KEEP,zfail:V.KEEP,zpass:V.KEEP}:O;n.stencil={enable:!!s,mask:v,func:Ec(Ec({},x),{},{cmp:JE[x.cmp]}),opFront:{fail:hd[w.fail],zfail:hd[w.zfail],zpass:hd[w.zpass]},opBack:{fail:hd[D.fail],zfail:hd[D.zfail],zpass:hd[D.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var a=r.cull;if(a){var s=a.enable,p=a.face,v=p===void 0?V.BACK:p;n.cull={enable:!!s,face:eS[v]}}}},{key:"extractUniforms",value:function(r){var n=this,a={};return Object.keys(r).forEach(function(s){n.extractUniformsRecursively(s,r[s],a,"")}),a}},{key:"extractUniformsRecursively",value:function(r,n,a,s){var p=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||aS()(n)||n===""||"resize"in n){a["".concat(s&&s+".").concat(r)]=n;return}sS()(n)&&Object.keys(n).forEach(function(v){p.extractUniformsRecursively(v,n[v],a,"".concat(s&&s+".").concat(r))}),Array.isArray(n)&&n.forEach(function(v,g){Object.keys(v).forEach(function(x){p.extractUniformsRecursively(x,v[x],a,"".concat(s&&s+".").concat(r,"[").concat(g,"]"))})})}}]),e}(),lS=function(){function e(i,r){(0,ot.Z)(this,e),(0,I.Z)(this,"texture",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"isDistroy",!1);var n=r.data,a=r.type,s=a===void 0?V.UNSIGNED_BYTE:a,p=r.width,v=r.height,g=r.flipY,x=g===void 0?!1:g,C=r.format,w=C===void 0?V.RGBA:C,O=r.mipmap,D=O===void 0?!1:O,G=r.wrapS,q=G===void 0?V.CLAMP_TO_EDGE:G,te=r.wrapT,Se=te===void 0?V.CLAMP_TO_EDGE:te,ze=r.aniso,$e=ze===void 0?0:ze,at=r.alignment,Et=at===void 0?1:at,Tt=r.premultiplyAlpha,Jt=Tt===void 0?!1:Tt,fr=r.mag,Dr=fr===void 0?V.NEAREST:fr,tn=r.min,wr=tn===void 0?V.NEAREST:tn,xn=r.colorSpace,Tn=xn===void 0?V.BROWSER_DEFAULT_WEBGL:xn,$n=r.x,Ga=$n===void 0?0:$n,as=r.y,ks=as===void 0?0:as,Ds=r.copy,Qs=Ds===void 0?!1:Ds;this.width=p,this.height=v;var ef={width:p,height:v,type:Uv[s],format:qE[w],wrapS:yy[q],wrapT:yy[Se],mag:gy[Dr],min:gy[wr],alignment:Et,flipY:x,colorSpace:$E[Tn],premultiplyAlpha:Jt,aniso:$e,x:Ga,y:ks,copy:Qs};n&&(ef.data=n),typeof D=="number"?ef.mipmap=KE[D]:typeof D=="boolean"&&(ef.mipmap=D),this.texture=i.texture(ef)}return(0,wt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.texture.resize(n,a),this.width=n,this.height=a}},{key:"destroy",value:function(){if(!this.isDistroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDistroy=!0}}]),e}(),by,Ey,cS=(by=(0,Ur.b2)(),by(Ey=function(){function e(){var i=this;(0,ot.Z)(this,e),(0,I.Z)(this,"extensionObject",void 0),(0,I.Z)(this,"gl",void 0),(0,I.Z)(this,"$container",void 0),(0,I.Z)(this,"canvas",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"isDirty",void 0),(0,I.Z)(this,"createModel",function(r){return new uS(i.gl,r)}),(0,I.Z)(this,"createAttribute",function(r){return new XE(i.gl,r)}),(0,I.Z)(this,"createBuffer",function(r){return new tS(i.gl,r)}),(0,I.Z)(this,"createElements",function(r){return new rS(i.gl,r)}),(0,I.Z)(this,"createTexture2D",function(r){return new lS(i.gl,r)}),(0,I.Z)(this,"createFramebuffer",function(r){return new nS(i.gl,r)}),(0,I.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,I.Z)(this,"clear",function(r){var n=r.color,a=r.depth,s=r.stencil,p=r.framebuffer,v=p===void 0?null:p,g={color:n,depth:a,stencil:s};g.framebuffer=v===null?v:v.get(),i.gl.clear(g)}),(0,I.Z)(this,"viewport",function(r){var n=r.x,a=r.y,s=r.width,p=r.height;i.gl._gl.viewport(n,a,s,p),i.width=s,i.height=p,i.gl._refresh()}),(0,I.Z)(this,"readPixels",function(r){var n=r.framebuffer,a=r.x,s=r.y,p=r.width,v=r.height,g={x:a,y:s,width:p,height:v};return n&&(g.framebuffer=n.get()),i.gl.read(g)}),(0,I.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,I.Z)(this,"getContainer",function(){if(To)return i.canvas;var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,I.Z)(this,"getCanvas",function(){return i.canvas}),(0,I.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,I.Z)(this,"destroy",function(){i.canvas=null,i.gl.destroy(),i.gl=null})}return(0,wt.Z)(e,[{key:"init",value:function(){var i=(0,Ta.Z)(di().mark(function n(a,s){var p=this;return di().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.canvas=a,g.next=3,new Promise(function(x,C){WE()({canvas:p.canvas,attributes:{alpha:!0,antialias:s.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:s.preserveDrawingBuffer,stencil:s.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(O,D){(O||!D)&&C(O),x(D)}})});case 3:this.gl=g.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return g.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||Ey);function Sy(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Cy(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Sy(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Sy(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var fS=function(){function e(i){(0,ot.Z)(this,e),(0,I.Z)(this,"sceneService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"controlService",void 0),(0,I.Z)(this,"layerService",void 0),(0,I.Z)(this,"iconService",void 0),(0,I.Z)(this,"markerService",void 0),(0,I.Z)(this,"popupService",void 0),(0,I.Z)(this,"fontService",void 0),(0,I.Z)(this,"interactionService",void 0),(0,I.Z)(this,"container",void 0);var r=i.id,n=i.map,a=i.canvas,s=i.hasBaseMap,p=S2();this.container=p,n.setContainer(p,r,a,s),p.bind(qt.IRendererService).to(cS).inSingletonScope(),this.sceneService=p.get(qt.ISceneService),this.mapService=p.get(qt.IMapService),this.iconService=p.get(qt.IIconService),this.fontService=p.get(qt.IFontService),this.controlService=p.get(qt.IControlService),this.layerService=p.get(qt.ILayerService),this.markerService=p.get(qt.IMarkerService),this.interactionService=p.get(qt.IInteractionService),this.popupService=p.get(qt.IPopupService),To?this.sceneService.initMiniScene(i):(this.initComponent(r),this.sceneService.init(i),this.initControl())}return(0,wt.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var a=new r(this);a.init()}else this.on("loaded",function(){var s=new r(n);s.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=Tg(this.container);r.setContainer(n,this.container),this.sceneService.addLayer(r);var a=r.getLayerConfig();if(a){var s=a.mask,p=a.maskfence,v=a.maskColor,g=v===void 0?"#000":v,x=a.maskOpacity,C=x===void 0?0:x;if(s&&p){var w=new GE().source(p).shape("fill").color(g).style({opacity:C});this.addMask(w,r.id)}}else console.warn("addLayer should run after scene loaded!")}},{key:"addMask",value:function(r,n){var a=this.getLayer(n);if(a){var s=Tg(this.container);r.setContainer(s,this.container),a.addMaskLayer(r),this.sceneService.addLayer(r)}else console.warn("parent layer not find!")}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,n){this.layerService.remove(r,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(a){var s=(0,Q.Z)(a,2),p=s[0],v=s[1];n.fontService.addIconFont(p,v)})}},{key:"addFontFace",value:function(r,n){this.sceneService.addFontFace(r,n)}},{key:"addImage",value:function(r,n){To?this.iconService.addImageMini(r,n,this.sceneService):this.iconService.addImage(r,n)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,n){Dv.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.on(r,n)}},{key:"once",value:function(r,n){Dv.indexOf(r)===-1?this.mapService.once(r,n):this.sceneService.once(r,n)}},{key:"off",value:function(r,n){Dv.indexOf(r)===-1?this.mapService.off(r,n):this.sceneService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var a=this.sceneService.getSceneConfig(),s=a.fitBoundsOptions,p=a.animate;this.mapService.fitBounds(r,n||Cy(Cy({},s),{},{animate:p}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(qt.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:tu(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,a=r.logoPosition;n&&this.addControl(new V2({position:a}))}}]),e}();function pS(e){var i=hS();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function hS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dS=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,vS=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,mS=function(e){(0,en.Z)(r,e);var i=pS(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"cityCenter",void 0),(0,I.Z)((0,he.Z)(n),"cityMinSize",void 0),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.baseColor,g=v===void 0?"rgb(16,16,16)":v,x=a.brightColor,C=x===void 0?"rgb(255,176,38)":x,w=a.windowColor,O=w===void 0?"rgb(30,60,89)":w,D=a.time,G=D===void 0?0:D,q=a.sweep,te=q===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:q;return{u_cityCenter:te.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*te.sweepRadius,u_circleSweep:te.enable?1:0,u_circleSweepColor:be(te.sweepColor).slice(0,3),u_circleSweepSpeed:te.sweepSpeed,u_opacity:p,u_baseColor:be(g),u_brightColor:be(C),u_windowColor:be(O),u_time:this.layer.getLayerAnimateTime()||G}}},{key:"calCityGeo",value:function(){var a=(0,Q.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],v=a[2],g=a[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(v+s)/2,(g+p)/2]);var x=this.mapService.lngLatToCoord([v,g]),C=this.mapService.lngLatToCoord([s,p]);this.cityMinSize=Math.sqrt(Math.pow(x[0]-C[0],2)+Math.pow(x[1]-C[1],2))/4}else{var w=v-s,O=g-p;this.cityCenter=[(v+s)/2,(g+p)/2],this.cityMinSize=Math.sqrt(Math.pow(w,2)+Math.pow(O,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:vS,fragmentShader:dS,triangulation:fy,cull:{enable:!0,face:V.BACK}})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(s,p,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?10:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(s,p,v,g){var x=s.size;return[v[3],v[4]]}}})}}]),r}(Co);function gS(e){var i=yS();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function yS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _S=function(e){(0,en.Z)(r,e);var i=gS(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"type","PolygonLayer"),n}return(0,wt.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new mS(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(a){this.updateLayerConfig({time:a})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(Jp);function xS(e){var i=bS();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function bS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ES=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,SS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,CS=function(e){(0,en.Z)(r,e);var i=xS(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:p||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:ES,fragmentShader:SS,triangulation:py,depth:{enable:!1},primitive:V.TRIANGLES,blend:this.getBlend(),stencil:rr(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:On.Attribute,descriptor:{name:"a_Pos",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(s,p){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(Co);function AS(e){var i=wS();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function wS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,MS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,PS=function(e){(0,en.Z)(r,e);var i=AS(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:p||1,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:TS,fragmentShader:MS,triangulation:uy,depth:{enable:!0},blend:this.getBlend(),stencil:rr(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){var x=s.size;return Array.isArray(x)?[x[0]]:[x]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(s,p,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:On.Attribute,descriptor:{name:"a_Pos",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(s,p){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(Co);function IS(e,i){for(var r=[],n=[],a=[],s=e+1,p=i+1,v=e/2,g=i/2,x=0;x<p;x++)for(var C=x-g,w=0;w<s;w++){var O=w-v;n.push(O/v,-C/g,0),a.push(w/e),a.push(1-x/i)}for(var D=0;D<i;D++)for(var G=0;G<e;G++){var q=G+s*D,te=G+s*(D+1),Se=G+1+s*(D+1),ze=G+1+s*D;r.push(q,te,ze),r.push(te,Se,ze)}return{vertices:n,indices:r,uvs:a}}var Ay,wy;function Ty(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function My(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ty(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ty(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function OS(e){var i=RS();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function RS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LS=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,kS=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,DS=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

float getBlurIndusty() {
    float h = 2.0/512.0;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y + 1.0 * h) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y + 1.0 * h) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y + 1.0 * h) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y-1.0*h) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y-1.0*h) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y-1.0*h) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,FS=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,BS=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,NS=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,Py=(Ay=(0,Ur.b2)(),Ay(wy=function(e){(0,en.Z)(r,e);var i=OS(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"texture",void 0),(0,I.Z)((0,he.Z)(n),"colorTexture",void 0),(0,I.Z)((0,he.Z)(n),"heatmapFramerBuffer",void 0),(0,I.Z)((0,he.Z)(n),"intensityModel",void 0),(0,I.Z)((0,he.Z)(n),"colorModel",void 0),(0,I.Z)((0,he.Z)(n),"shapeType",void 0),n}return(0,wt.Z)(r,[{key:"render",value:function(){var a=this,s=this.rendererService,p=s.clear,v=s.useFramebuffer;v(this.heatmapFramerBuffer,function(){p({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.heatmapFramerBuffer}),a.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var a,s=this.rendererService,p=s.createFramebuffer,v=s.clear,g=s.getViewportSize,x=s.createTexture2D,C=s.useFramebuffer,w=this.styleAttributeService.getLayerStyleAttribute("shape"),O=(w==null||(a=w.scale)===null||a===void 0?void 0:a.field)||"heatmap";this.shapeType=O,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=O==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var D=g(),G=D.width,q=D.height;return this.heatmapFramerBuffer=p({color:x({width:Math.floor(G/4),height:Math.floor(q/4),wrapS:V.CLAMP_TO_EDGE,wrapT:V.CLAMP_TO_EDGE,min:V.LINEAR,mag:V.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:On.Attribute,descriptor:{name:"a_Dir",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(s,p,v,g){return[v[3],v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return[C]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.triangulation=dy,this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:NS,fragmentShader:BS,triangulation:dy,depth:{enable:!1},cull:{enable:!0,face:Or(this.mapService.version)},blend:{enable:!0,func:{srcRGB:V.ONE,srcAlpha:1,dstRGB:V.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;this.shaderModuleService.registerModule("heatmapColor",{vs:FS,fs:DS});var x=this.shaderModuleService.getModule("heatmapColor"),C=x.vs,w=x.fs,O=x.uniforms,D=this.rendererService,G=D.createAttribute,q=D.createElements,te=D.createBuffer,Se=D.createModel;return Se({vs:C,fs:w,attributes:{a_Position:G({buffer:te({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:V.FLOAT}),size:3}),a_Uv:G({buffer:te({data:[0,1,1,1,0,0,1,0],type:V.FLOAT}),size:2})},uniforms:My({},O),depth:{enable:!1},blend:this.getBlend(),count:6,elements:q({data:[0,2,1,2,3,1],type:V.UNSIGNED_INT,count:6}),stencil:rr(p,g)})}},{key:"drawIntensityMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.intensity,v=p===void 0?10:p,g=a.radius,x=g===void 0?5:g;this.intensityModel.draw({uniforms:{u_opacity:s||1,u_radius:x,u_intensity:v}})}},{key:"drawColorMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=gr();Rr(p,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,ar.Z)(p)}})}},{key:"build3dHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.rendererService.getViewportSize,C=x(),w=C.width,O=C.height,D=IS(w/4,O/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:kS,fs:LS});var G=this.shaderModuleService.getModule("heatmap3dColor"),q=G.vs,te=G.fs,Se=G.uniforms,ze=this.rendererService,$e=ze.createAttribute,at=ze.createElements,Et=ze.createBuffer,Tt=ze.createModel;return Tt({vs:q,fs:te,attributes:{a_Position:$e({buffer:Et({data:D.vertices,type:V.FLOAT}),size:3}),a_Uv:$e({buffer:Et({data:D.uvs,type:V.FLOAT}),size:2})},primitive:V.TRIANGLES,uniforms:My({},Se),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:V.SRC_ALPHA,srcAlpha:1,dstRGB:V.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:at({data:D.indices,type:V.UNSIGNED_INT,count:D.indices.length}),stencil:rr(p,g)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var a=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var s=this.layer.getLayerConfig(),p=s.rampColors,v=yt(p);this.colorTexture=a({data:new Uint8Array(v.data),width:v.width,height:v.height,wrapS:V.CLAMP_TO_EDGE,wrapT:V.CLAMP_TO_EDGE,min:V.NEAREST,mag:V.NEAREST,flipY:!1})}}]),r}(Co))||wy);function zS(e){var i=US();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function US(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZS=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,jS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,VS=function(e){(0,en.Z)(r,e);var i=zS(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:p||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:jS,fragmentShader:ZS,triangulation:py,depth:{enable:!1},primitive:V.TRIANGLES,blend:this.getBlend(),stencil:rr(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:On.Attribute,descriptor:{name:"a_Pos",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(s,p){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(Co),GS={heatmap:Py,heatmap3d:Py,grid:CS,grid3d:PS,hexagon:VS},HS=GS;function WS(e){var i=XS();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function XS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YS=function(e){(0,en.Z)(r,e);var i=WS(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"type","HeatMapLayer"),n}return(0,wt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new HS[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var a=this,s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(p){return p.draw({uniforms:a.layerModel.getUninforms()})}),this)}},{key:"updateModelData",value:function(a){a.attributes&&a.elements?this.models[0].updateAttributesAndElements(a.attributes,a.elements):console.warn("data error")}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=this.getLayerConfig(),v=p.shape3d,g=this.getSource(),x=g.data.type,C=(s==null||(a=s.scale)===null||a===void 0?void 0:a.field)||"heatmap";return C==="heatmap"||C==="heatmap3d"?"heatmap":x==="hexagon"?(v==null?void 0:v.indexOf(C))===-1?"hexagon":"grid3d":x==="grid"?(v==null?void 0:v.indexOf(C))===-1?"grid":"grid3d":"heatmap"}}]),r}(Jp);function qS(e){var i=KS();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function KS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $S=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,QS=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,JS=function(e){(0,en.Z)(r,e);var i=qS(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"texture",void 0),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture}}},{key:"initModels",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.mask,v=p===void 0?!1:p,g=s.maskInside,x=g===void 0?!0:g,C=this.layer.getSource(),w=this.rendererService.createTexture2D;if(this.texture=w({height:0,width:0}),To){var O=this.layerService.sceneService.getSceneConfig().canvas,D=O.createImage();D.crossOrigin="anonymous",D.src=C.data.originData,D.onload=function(){a.texture=w({data:D,width:D.width,height:D.height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}else C.data.images.then(function(G){a.texture=w({data:G[0],width:G[0].width,height:G[0].height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:QS,fragmentShader:$S,triangulation:hy,primitive:V.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:rr(v,x)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(s,p,v,g){return[v[3],v[4]]}}})}}]),r}(Co),eC={image:JS},tC=eC;function rC(e){var i=nC();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function nC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iC=function(e){(0,en.Z)(r,e);var i=rC(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"type","ImageLayer"),n}return(0,wt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new tC[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={image:{}};return s[a]}},{key:"getModelType",value:function(){return"image"}}]),r}(Jp);function aC(e){var i=oC();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function oC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sC=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,uC=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  

   styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,lC=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,cC=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,fC=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,pC=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,hC={solid:0,dash:1},dC=function(e){(0,en.Z)(r,e);var i=aC(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"texture",void 0),(0,I.Z)((0,he.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:V.NEAREST,min:V.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.lineType,w=C===void 0?"solid":C,O=a.dashArray,D=O===void 0?[10,5]:O,G=a.forward,q=G===void 0?!0:G,te=a.lineTexture,Se=te===void 0?!1:te,ze=a.iconStep,$e=ze===void 0?100:ze,at=a.segmentNumber,Et=at===void 0?30:at,Tt=a.thetaOffset,Jt=Tt===void 0?.314:Tt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,thetaOffset:Jt})){this.judgeStyleAttributes({opacity:s,thetaOffset:Jt});var fr=this.layer.getEncodedData(),Dr=this.calDataFrame(this.cellLength,fr,this.cellProperties),tn=Dr.data,wr=Dr.width,xn=Dr.height;this.rowCount=xn,this.dataTexture=this.cellLength>0&&tn.length>0?this.createTexture2D({flipY:!0,data:tn,format:V.LUMINANCE,type:V.FLOAT,width:wr,height:xn}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}D.length===2&&D.push(0,0);var Tn=0,$n=[0,0,0,0],Ga=[0,0,0,0];return p&&v&&($n=be(p),Ga=be(v),Tn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:pa()(Jt)?Jt:0,u_opacity:pa()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:Et,u_line_type:hC[w||"solid"],u_dash_array:D,u_blur:.9,u_lineDir:q?1:-1,u_texture:this.texture,u_line_texture:Se?1:0,u_icon_step:$e,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Tn,u_sourceColor:$n,u_targetColor:Ga}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor,v=a.lineType;return v==="dash"?{frag:sC,vert:uC,type:"dash"}:s&&p?{frag:fC,vert:pC,type:"linear"}:{frag:lC,vert:cC,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,p=s===void 0?30:s,v=a.mask,g=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x,w=this.getShaders(),O=w.frag,D=w.vert,G=w.type;return[this.layer.buildLayerModel({moduleName:"arc2dline"+G,vertexShader:D,fragmentShader:O,triangulation:z0,depth:{enable:!1},blend:this.getBlend(),segmentNumber:p,stencil:rr(g,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,w=C===void 0?1:C;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:On.Attribute,descriptor:{name:"a_Instance",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:4,update:function(p,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),w=p.texture,O=C[w]||{x:0,y:0},D=O.x,G=O.y;return[D,G]}}})}}]),r}(Co);function vC(e){var i=mC();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function mC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,yC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,_C=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,xC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,bC={solid:0,dash:1},EC=function(e){(0,en.Z)(r,e);var i=vC(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"texture",void 0),(0,I.Z)((0,he.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:V.NEAREST,min:V.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.lineType,w=C===void 0?"solid":C,O=a.dashArray,D=O===void 0?[10,5]:O,G=a.lineTexture,q=G===void 0?!1:G,te=a.iconStep,Se=te===void 0?100:te,ze=a.segmentNumber,$e=ze===void 0?30:ze,at=a.globalArcHeight,Et=at===void 0?10:at;D.length===2&&D.push(0,0);var Tt=0,Jt=[0,0,0,0],fr=[0,0,0,0];if(p&&v&&(Jt=be(p),fr=be(v),Tt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Dr=this.layer.getEncodedData(),tn=this.calDataFrame(this.cellLength,Dr,this.cellProperties),wr=tn.data,xn=tn.width,Tn=tn.height;this.rowCount=Tn,this.dataTexture=this.cellLength>0&&wr.length>0?this.createTexture2D({flipY:!0,data:wr,format:V.LUMINANCE,type:V.FLOAT,width:xn,height:Tn}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:$g,u_global_height:Et,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:pa()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:$e,u_line_type:bC[w]||0,u_dash_array:D,u_texture:this.texture,u_line_texture:q?1:0,u_icon_step:Se,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Tt,u_sourceColor:Jt,u_targetColor:fr}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor,v=a.lineType;return s&&p?{frag:_C,vert:xC,type:"linear"}:{frag:gC,vert:yC,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,p=s===void 0?30:s,v=a.mask,g=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x,w=this.getShaders(),O=w.frag,D=w.vert,G=w.type;return[this.layer.buildLayerModel({moduleName:"arc3Dline"+G,vertexShader:D,fragmentShader:O,triangulation:z0,blend:this.getBlend(),segmentNumber:p,stencil:rr(g,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,w=C===void 0?1:C;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:On.Attribute,descriptor:{name:"a_Instance",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:4,update:function(p,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),w=p.texture,O=C[w]||{x:0,y:0},D=O.x,G=O.y;return[D,G]}}})}}]),r}(Co);function SC(e){var i=CC();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function CC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var AC=`#define LineTypeSolid 0.0
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,wC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,TC=function(e){(0,en.Z)(r,e);var i=SC(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.forward,x=g===void 0?!0:g,C=a.segmentNumber,w=C===void 0?30:C,O=a.thetaOffset,D=O===void 0?.314:O,G=0,q=[0,0,0,0],te=[0,0,0,0];return p&&v&&(q=be(p),te=be(v),G=1),{u_thetaOffset:D,u_opacity:pa()(s)?s:1,segmentNumber:w,u_blur:.9,u_lineDir:x?1:-1,u_linearColor:G,u_sourceColor:q,u_targetColor:te}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,p=s===void 0?30:s;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:wC,fragmentShader:AC,triangulation:z0,depth:{enable:!1},blend:this.getBlend(),segmentNumber:p})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:On.Attribute,descriptor:{name:"a_Instance",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:4,update:function(s,p,v,g){return[v[3],v[4],v[5],v[6]]}}})}}]),r}(Co);function MC(e){var i=PC();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function PC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,OC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,RC={solid:0,dash:1},LC=function(e){(0,en.Z)(r,e);var i=MC(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"texture",void 0),(0,I.Z)((0,he.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:V.NEAREST,min:V.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.lineType,w=C===void 0?"solid":C,O=a.dashArray,D=O===void 0?[10,5]:O,G=a.lineTexture,q=G===void 0?!1:G,te=a.iconStep,Se=te===void 0?100:te,ze=a.segmentNumber,$e=ze===void 0?30:ze;D.length===2&&D.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var at=0,Et=[0,0,0,0],Tt=[0,0,0,0];if(p&&v&&(Et=be(p),Tt=be(v),at=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Jt=this.layer.getEncodedData(),fr=this.calDataFrame(this.cellLength,Jt,this.cellProperties),Dr=fr.data,tn=fr.width,wr=fr.height;this.rowCount=wr,this.dataTexture=this.cellLength>0&&Dr.length>0?this.createTexture2D({flipY:!0,data:Dr,format:V.LUMINANCE,type:V.FLOAT,width:tn,height:wr}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:pa()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:$e,u_line_type:RC[w]||0,u_dash_array:D,u_texture:this.texture,u_line_texture:q?1:0,u_icon_step:Se,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:at,u_sourceColor:Et,u_targetColor:Tt}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"greatcircleline",vertexShader:OC,fragmentShader:IC,triangulation:z0,depth:{enable:!1},blend:this.getBlend(),stencil:rr(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,w=C===void 0?1:C;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:On.Attribute,descriptor:{name:"a_Instance",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:4,update:function(p,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),w=p.texture,O=C[w]||{x:0,y:0},D=O.x,G=O.y;return[D,G]}}})}}]),r}(Co);function kC(e){var i=DC();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function DC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FC=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 // dash line
 
  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;

  gl_FragColor = filterColor(gl_FragColor);
}
`,BC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,NC=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,Iy=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,zC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,UC={solid:0,dash:1},Oy=function(e){(0,en.Z)(r,e);var i=kC(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"texture",void 0),(0,I.Z)((0,he.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:V.NEAREST,min:V.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.lineType,w=C===void 0?"solid":C,O=a.dashArray,D=O===void 0?[10,5,0,0]:O,G=a.lineTexture,q=G===void 0?!1:G,te=a.iconStep,Se=te===void 0?100:te,ze=a.vertexHeightScale,$e=ze===void 0?20:ze,at=a.borderWidth,Et=at===void 0?0:at,Tt=a.borderColor,Jt=Tt===void 0?"#ccc":Tt,fr=a.raisingHeight,Dr=fr===void 0?0:fr,tn=a.heightfixed,wr=tn===void 0?!1:tn,xn=a.arrow,Tn=xn===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:xn;D.length===2&&D.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var $n=0,Ga=[0,0,0,0],as=[0,0,0,0];if(p&&v&&(Ga=be(p),as=be(v),$n=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var ks=this.layer.getEncodedData(),Ds=this.calDataFrame(this.cellLength,ks,this.cellProperties),Qs=Ds.data,ef=Ds.width,gv=Ds.height;this.rowCount=gv,this.dataTexture=this.cellLength>0&&Qs.length>0?this.createTexture2D({flipY:!0,data:Qs,format:V.LUMINANCE,type:V.FLOAT,width:ef,height:gv}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:pa()(s)?s:1,u_textureBlend:x==="normal"?0:1,u_line_type:UC[w],u_dash_array:D,u_texture:this.texture,u_line_texture:q?1:0,u_icon_step:Se,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:Et,u_borderColor:be(Jt),u_linearColor:$n,u_sourceColor:Ga,u_targetColor:as,u_heightfixed:Number(wr),u_vertexScale:$e,u_raisingHeight:Number(Dr),u_arrow:Number(Tn.enable),u_arrowHeight:Tn.arrowHeight||3,u_arrowWidth:Tn.arrowWidth||2,u_tailWidth:Tn.tailWidth===void 0?1:Tn.tailWidth}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=a.depth,C=x===void 0?!1:x,w=this.getShaders(),O=w.frag,D=w.vert,G=w.type;return this.layer.triangulation=Jd,[this.layer.buildLayerModel({moduleName:"line_"+G,vertexShader:D,fragmentShader:O,triangulation:Jd,primitive:V.TRIANGLES,blend:this.getBlend(),depth:{enable:C},stencil:rr(p,g)})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor,v=a.lineType;return v==="dash"?{frag:FC,vert:BC,type:"dash"}:s&&p?{frag:zC,vert:Iy,type:"linear"}:{frag:NC,vert:Iy,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:On.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(p,v,g,x,C,w){return w===void 0?[g[3],10]:[g[3],w]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:On.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){return[g[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(p,v,g,x){var C=p.size,w=C===void 0?1:C;return Array.isArray(w)?[w[0],w[1]]:[w,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(p,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:On.Attribute,descriptor:{name:"a_Miter",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){return[g[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),w=p.texture,O=C[w]||{x:0,y:0},D=O.x,G=O.y;return[D,G]}}})}}]),r}(Co);function ZC(e){var i=jC();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function jC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VC=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = texture2D(u_texture, vec2(d_distance_ratio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,GC=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,HC=function(e){(0,en.Z)(r,e);var i=ZC(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"colorTexture",void 0),(0,I.Z)((0,he.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var g=n.layer.getLayerConfig(),x=g.rampColors,C=yt(x);n.colorTexture=v({data:new Uint8Array(C.data),width:C.width,height:C.height,wrapS:V.CLAMP_TO_EDGE,wrapT:V.CLAMP_TO_EDGE,min:V.NEAREST,mag:V.NEAREST,flipY:!1})}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.vertexHeightScale,v=p===void 0?20:p,g=a.raisingHeight,x=g===void 0?0:g,C=a.heightfixed,w=C===void 0?!1:C;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var O=this.layer.getEncodedData(),D=this.calDataFrame(this.cellLength,O,this.cellProperties),G=D.data,q=D.width,te=D.height;this.rowCount=te,this.dataTexture=this.cellLength>0&&G.length>0?this.createTexture2D({flipY:!0,data:G,format:V.LUMINANCE,type:V.FLOAT,width:q,height:te}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:pa()(s)?s:1,u_texture:this.colorTexture,u_heightfixed:Number(w),u_vertexScale:v,u_raisingHeight:Number(x)}}},{key:"initModels",value:function(){return this.updateTexture(),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.colorTexture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=a.depth,C=x===void 0?!1:x,w=this.getShaders(),O=w.frag,D=w.vert,G=w.type;return this.layer.triangulation=Jd,[this.layer.buildLayerModel({moduleName:"line_"+G,vertexShader:D,fragmentShader:O,triangulation:Jd,primitive:V.TRIANGLES,blend:this.getBlend(),depth:{enable:C},stencil:rr(p,g)})]}},{key:"getShaders",value:function(){return{frag:VC,vert:GC,type:"linear_rampColors"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:On.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(s,p,v,g,x,C){return C===void 0?[v[3],10]:[v[3],C]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:On.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0],C[1]]:[C,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(s,p,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:On.Attribute,descriptor:{name:"a_Miter",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){return[v[4]]}}})}}]),r}(Co);function WC(e){var i=XC();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function XC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YC=`

uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,qC=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,Ry=`
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;


// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_color = a_Color;  

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  }
}
`,KC=function(e){(0,en.Z)(r,e);var i=WC(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.vertexHeightScale,x=g===void 0?20:g,C=0,w=[0,0,0,0],O=[0,0,0,0];if(p&&v&&(w=be(p),O=be(v),C=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var D=this.layer.getEncodedData(),G=this.calDataFrame(this.cellLength,D,this.cellProperties),q=G.data,te=G.width,Se=G.height;this.rowCount=Se,this.dataTexture=this.cellLength>0&&q.length>0?this.createTexture2D({flipY:!0,data:q,format:V.LUMINANCE,type:V.FLOAT,width:te,height:Se}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:pa()(s)?s:1,u_linearColor:C,u_sourceColor:w,u_targetColor:O,u_vertexScale:x}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor;return s&&p?{frag:YC,vert:Ry,type:"linear"}:{frag:qC,vert:Ry,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,w=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:"simpleline"+O,vertexShader:w,fragmentShader:C,triangulation:IE,primitive:V.LINES,blend:this.getBlend(),depth:{enable:!1},stencil:rr(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:On.Attribute,descriptor:{name:"a_Distance",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){return[v[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:On.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0],C[1]]:[C,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(s,p,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:On.Attribute,descriptor:{name:"a_Miter",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){return[v[4]]}}})}}]),r}(Co);function $C(e){var i=QC();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function QC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JC=`#define LineTypeSolid 0.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);

    
  
  
}
`,eA=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  // v_lightWeight = lightWeight;
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,tA=function(e){(0,en.Z)(r,e);var i=$C(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"texture",void 0),(0,I.Z)((0,he.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:V.NEAREST,min:V.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.heightfixed,w=C===void 0?!1:C,O=a.lineTexture,D=O===void 0?!1:O,G=a.iconStep,q=G===void 0?100:G,te=a.iconStepCount,Se=te===void 0?1:te;this.rendererService.getDirty()&&this.texture.bind();var ze=0,$e=[0,0,0,0],at=[0,0,0,0];if(p&&v&&($e=be(p),at=be(v),ze=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Et=this.layer.getEncodedData(),Tt=this.calDataFrame(this.cellLength,Et,this.cellProperties),Jt=Tt.data,fr=Tt.width,Dr=Tt.height;this.rowCount=Dr,this.dataTexture=this.cellLength>0&&Jt.length>0?this.createTexture2D({flipY:!0,data:Jt,format:V.LUMINANCE,type:V.FLOAT,width:fr,height:Dr}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_heightfixed:Number(w),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:pa()(s)?s:1,u_textureBlend:x==="normal"?0:1,u_texture:this.texture,u_line_texture:D?1:0,u_iconStepCount:Se,u_icon_step:q,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:ze,u_sourceColor:$e,u_targetColor:at}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:eA,fragmentShader:JC,triangulation:Jd,primitive:V.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:On.Attribute,descriptor:{name:"a_Distance",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){return[g[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:On.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){return[g[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(p,v,g,x){var C=p.size,w=C===void 0?1:C;return Array.isArray(w)?[w[0],w[1]]:[w,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(p,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:On.Attribute,descriptor:{name:"a_Miter",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){return[g[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),w=p.texture,O=C[w]||{x:0,y:0},D=O.x,G=O.y;return[D,G]}}})}}]),r}(Co),rA={arc:dC,arcmini:TC,arc3d:EC,greatcircle:LC,wall:tA,line:Oy,simple:KC,linearline:HC},nA=rA;function iA(e){var i=aA();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function aA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oA=function(e){(0,en.Z)(r,e);var i=iA(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"type","LineLayer"),n}return(0,wt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new nA[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return s[a]}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return p||"line"}}]),r}(Jp);function sA(e){var i=uA();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function uA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lA=`varying vec4 v_color;
uniform float u_opacity: 1.0;

varying float v_z;
varying float v_lightWeight;
uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_z);
    gl_FragColor.rgb *= v_lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_z): v_z;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,cA=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

varying float v_z;
varying float v_lightWeight;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_z = a_Position.z;

 

  // vec2 offset = project_pixel(size.xy);
  // vec2 offset = (size.xy);

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    // offset = project_pixel(offset);
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z) * u_r, 1.0);
  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  // float lightWeight = u_lightEnable > 0.0 ? calc_lighting(pos): 1.0;
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,Ly=function(e){(0,en.Z)(r,e);var i=sA(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"raiseCount",0),(0,I.Z)((0,he.Z)(n),"raiserepeat",0),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,p=s===void 0?{enable:!1,speed:.01,repeat:!1}:s,v=a.opacity,g=v===void 0?1:v,x=a.sourceColor,C=a.targetColor,w=a.pickLight,O=w===void 0?!1:w,D=a.heightfixed,G=D===void 0?!1:D,q=a.opacityLinear,te=q===void 0?{enable:!1,dir:"up"}:q,Se=a.lightEnable,ze=Se===void 0?!0:Se;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:g})){this.judgeStyleAttributes({opacity:g});var $e=this.layer.getEncodedData(),at=this.calDataFrame(this.cellLength,$e,this.cellProperties),Et=at.data,Tt=at.width,Jt=at.height;this.rowCount=Jt,this.dataTexture=this.cellLength>0&&Et.length>0?this.createTexture2D({flipY:!0,data:Et,format:V.LUMINANCE,type:V.FLOAT,width:Tt,height:Jt}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}var fr=0,Dr=[0,0,0,0],tn=[0,0,0,0];if(x&&C&&(Dr=be(x),tn=be(C),fr=1),this.raiseCount<1&&this.raiserepeat>0&&p.enable){var wr=p.speed,xn=wr===void 0?.01:wr,Tn=p.repeat,$n=Tn===void 0?!1:Tn;this.raiseCount+=xn,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(O),u_heightfixed:Number(G),u_r:p.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:pa()(g)?g:1,u_linearColor:fr,u_sourceColor:Dr,u_targetColor:tn,u_opacitylinear:Number(te.enable),u_opacitylinear_dir:te.dir==="up"?1:0,u_lightEnable:Number(ze)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.depth,p=s===void 0?!0:s,v=a.animateOption.repeat,g=v===void 0?1:v;return this.raiserepeat=g,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:cA,fragmentShader:lA,triangulation:uy,blend:this.getBlend(),cull:{enable:!0,face:Or(this.mapService.version)},depth:{enable:p}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(p,v,g,x){var C=p.size;if(C){var w=[];return Array.isArray(C)&&(w=C.length===2?[C[0],C[0],C[1]]:C),Array.isArray(C)||(w=[C,C,C]),w}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(p,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:On.Attribute,descriptor:{name:"a_Pos",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(p,v){var g=Lh(p.coordinates);return a?Jg([g[0],g[1]]):[g[0],g[1],0]}}})}}]),r}(Co);function fA(e){var i=pA();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function pA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ky=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
  
  // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,hA=`
uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Zv=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raiseHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, u_raisingHeight, 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,Dy=function(e){(0,en.Z)(r,e);var i=fA(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"meter2coord",1),(0,I.Z)((0,he.Z)(n),"isMeter",!1),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.strokeOpacity,g=v===void 0?1:v,x=a.strokeWidth,C=x===void 0?0:x,w=a.stroke,O=w===void 0?"rgba(0,0,0,0)":w,D=a.offsets,G=D===void 0?[0,0]:D,q=a.blend,te=a.blur,Se=te===void 0?0:te,ze=a.raisingHeight,$e=ze===void 0?0:ze;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:O,offsets:G})){this.judgeStyleAttributes({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:O,offsets:G});var at=this.layer.getEncodedData(),Et=this.calDataFrame(this.cellLength,at,this.cellProperties),Tt=Et.data,Jt=Et.width,fr=Et.height;this.rowCount=fr,this.dataTexture=this.cellLength>0&&Tt.length>0?this.createTexture2D({flipY:!0,data:Tt,format:V.LUMINANCE,type:V.FLOAT,width:Jt,height:fr}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_raisingHeight:Number($e),u_isMeter:Number(this.isMeter),u_blur:Se,u_additive:q==="additive"?1:0,u_globel:this.mapService.version===Ls.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:pa()(p)?p:1,u_stroke_opacity:pa()(g)?g:1,u_stroke_width:pa()(C)?C:0,u_stroke_color:this.getStrokeColor(O),u_offsets:this.isOffsetStatic(G)?G:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,p=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Fh)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,p=s===void 0?"l7size":s,v=this.mapService.version;return p==="meter"&&v!==Ls.L7MAP&&v!==Ls.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,Q.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],v=a[2],g=a[3],x=[(s+v)/2,(p+g)/2],C=this.mapService.version;if(C===Ls.MAPBOX&&window.mapboxgl.MercatorCoordinate){var w=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),O=1,D=O*w.meterInMercatorCoordinateUnits(),G=new window.mapboxgl.MercatorCoordinate(w.x-D,w.y,w.z),q=G.toLngLat();this.meter2coord=x[0]-q.lng;return}var te=this.mapService.meterToCoord(x,[s,p]),Se=this.mapService.meterToCoord(x,[v===s?v+.1:v,g===p?p+.1:g]);this.meter2coord=(te+Se)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=a.animateOption,C=x===void 0?{enable:!1}:x,w=this.getShaders(C),O=w.frag,D=w.vert,G=w.type,q=this.mapService.version==="GLOBEL";return this.layer.triangulation=q?sy:Fh,[this.layer.buildLayerModel({moduleName:"pointfill_"+G,vertexShader:D,fragmentShader:O,triangulation:q?sy:Fh,depth:{enable:q},blend:this.getBlend(),stencil:rr(p,g),cull:{enable:!0,face:Or(this.mapService.version)}})]}},{key:"getShaders",value:function(a){if(a.enable)switch(a.type){case"wave":return{frag:ky,vert:Zv,type:"wave"};default:return{frag:ky,vert:Zv,type:"wave"}}else return{frag:hA,vert:Zv,type:"normal"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this,s=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:On.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(v,g,x,C){var w;if(s){var O=(0,Q.Z)(x,3),D=O[0],G=O[1],q=O[2],te=Qa.fromValues(0,0,1),Se=Qa.fromValues(D,0,q),ze=D>=0?Qa.angle(te,Se):Math.PI*2-Qa.angle(te,Se),$e=Math.PI*2-Math.asin(G/100),at=gr();Hr(at,at,ze),Er(at,at,$e);var Et=Qa.fromValues(1,1,0);Qa.transformMat4(Et,Et,at),Qa.normalize(Et,Et);var Tt=Qa.fromValues(-1,1,0);Qa.transformMat4(Tt,Tt,at),Qa.normalize(Tt,Tt);var Jt=Qa.fromValues(-1,-1,0);Qa.transformMat4(Jt,Jt,at),Qa.normalize(Jt,Jt);var fr=Qa.fromValues(1,-1,0);Qa.transformMat4(fr,fr,at),Qa.normalize(fr,fr),w=[].concat((0,ar.Z)(Et),(0,ar.Z)(Tt),(0,ar.Z)(Jt),(0,ar.Z)(fr))}else w=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var Dr=C%4*3;return[w[Dr],w[Dr+1],w[Dr+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(v,g,x,C){var w=v.size,O=w===void 0?5:w;return Array.isArray(O)?[O[0]*a.meter2coord]:[O*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:On.Attribute,descriptor:{name:"a_Shape",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(v,g,x,C){var w=v.shape,O=w===void 0?2:w,D=a.layer.getLayerConfig().shape2d,G=D.indexOf(O);return[G]}}})}}]),r}(Co);function dA(e){var i=vA();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function vA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mA=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,gA=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying float v_radius;
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // radius(16-bit)
  v_radius = a_Size;

  // TODO: billboard
  // anti-alias
  

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,yA=function(e){(0,en.Z)(r,e);var i=dA(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"meter2coord",1),(0,I.Z)((0,he.Z)(n),"texture",void 0),(0,I.Z)((0,he.Z)(n),"isMeter",!1),(0,I.Z)((0,he.Z)(n),"radian",0),(0,I.Z)((0,he.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:V.LINEAR,min:V.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.strokeOpacity,g=v===void 0?1:v,x=a.strokeWidth,C=x===void 0?0:x,w=a.stroke,O=w===void 0?"rgba(0,0,0,0)":w,D=a.offsets,G=D===void 0?[0,0]:D,q=a.blend,te=a.rotation;this.rendererService.getDirty()&&this.texture.bind();var Se=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(Se=-1),this.radian=te!==void 0?Se*Math.PI*te/180:Se*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:O,offsets:G})){this.judgeStyleAttributes({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:O,offsets:G});var ze=this.layer.getEncodedData(),$e=this.calDataFrame(this.cellLength,ze,this.cellProperties),at=$e.data,Et=$e.width,Tt=$e.height;this.rowCount=Tt,this.dataTexture=this.cellLength>0&&at.length>0?this.createTexture2D({flipY:!0,data:at,format:V.LUMINANCE,type:V.FLOAT,width:Et,height:Tt}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_additive:q==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:pa()(p)?p:1,u_offsets:this.isOffsetStatic(G)?G:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Fh)}},{key:"initModels",value:function(){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var a=this.layer.getLayerConfig(),s=a.unit,p=s===void 0?"l7size":s,v=this.mapService.version;return p==="meter"&&v!==Ls.L7MAP&&v!==Ls.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,Q.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],v=a[2],g=a[3],x=[(s+v)/2,(p+g)/2],C=this.mapService.version;if(C===Ls.MAPBOX&&window.mapboxgl.MercatorCoordinate){var w=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),O=1,D=O*w.meterInMercatorCoordinateUnits(),G=new window.mapboxgl.MercatorCoordinate(w.x-D,w.y,w.z),q=G.toLngLat();this.meter2coord=x[0]-q.lng;return}var te=this.mapService.meterToCoord(x,[s,p]),Se=this.mapService.meterToCoord(x,[v===s?v+.1:v,g===p?p+.1:g]);this.meter2coord=(te+Se)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,w=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:"pointfill_"+O,vertexShader:w,fragmentShader:C,triangulation:Fh,depth:{enable:!1},blend:this.getBlend(),stencil:rr(p,g),cull:{enable:!0,face:Or(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:mA,vert:gA,type:"normal"}}},{key:"clearModels",value:function(){var a,s;this.iconService.off("imageUpdate",this.updateTexture),(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:On.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){var C=p.rotate,w=C===void 0?0:C;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),w=p.shape,O=C[w]||{x:0,y:0},D=O.x,G=O.y;return[D,G]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:On.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(p,v,g,x){var C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],w=x%4*3;return[C[w],C[w+1],C[w+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,w=C===void 0?5:C;return Array.isArray(w)?[w[0]*a.meter2coord]:[w*a.meter2coord]}}})}}]),r}(Co);function _A(e){var i=xA();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function xA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bA=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,EA=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,SA=function(e){(0,en.Z)(r,e);var i=_A(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"texture",void 0),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var a=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){a.updateTexture(),a.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:EA,fragmentShader:bA,triangulation:ly,primitive:V.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){var C=p.size;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(p,v,g,x){var C=a.fontService.mapping,w=p.shape,O=a.fontService.getGlyph(w),D=C[O],G=D.x,q=D.y;return[G,q]}}})}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.texture=a({data:s,mag:V.LINEAR,min:V.LINEAR,width:s.width,height:s.height})}},{key:"initIconFontGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.fontWeight,v=p===void 0?"normal":p,g=s.fontFamily,x=g===void 0?"sans-serif":g,C=this.layer.getEncodedData(),w=[];C.forEach(function(O){var D=O.shape,G=D===void 0?"":D;G=G.toString();var q=a.fontService.getGlyph(G);w.indexOf(q)===-1&&w.push(q)}),this.fontService.setFontOptions({characterSet:w,fontWeight:v,fontFamily:x,fontSize:48})}}]),r}(Co);function CA(e){var i=AA();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function AA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wA=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,TA=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Fy=function(e){(0,en.Z)(r,e);var i=CA(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"texture",void 0),(0,I.Z)((0,he.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:V.LINEAR,min:V.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.offsets,v=p===void 0?[0,0]:p;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,offsets:v})){this.judgeStyleAttributes({opacity:s,offsets:v});var g=this.layer.getEncodedData(),x=this.calDataFrame(this.cellLength,g,this.cellProperties),C=x.data,w=x.width,O=x.height;this.rowCount=O,this.dataTexture=this.cellLength>0&&C.length>0?this.createTexture2D({flipY:!0,data:C,format:V.LUMINANCE,type:V.FLOAT,width:w,height:O}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:pa()(s)?s:1,u_offsets:this.isOffsetStatic(v)?v:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:TA,fragmentShader:wA,triangulation:ly,primitive:V.POINTS,depth:{enable:!1},blend:this.getBlend(),stencil:rr(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,w=C===void 0?5:C;return Array.isArray(w)?[w[0]]:[w]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),w=p.shape,O=C[w]||{x:0,y:0},D=O.x,G=O.y;return[D,G]}}})}}]),r}(Co);function MA(e){var i=PA();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function PA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var IA=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,OA=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function By(e){var i=e.coordinates;return{vertices:(0,ar.Z)(i),indices:[0],size:i.length}}var Ny=function(e){(0,en.Z)(r,e);var i=MA(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.offsets,g=v===void 0?[0,0]:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,offsets:g})){this.judgeStyleAttributes({opacity:p,offsets:g});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),w=C.data,O=C.width,D=C.height;this.rowCount=D,this.dataTexture=this.cellLength>0&&w.length>0?this.createTexture2D({flipY:!0,data:w,format:V.LUMINANCE,type:V.FLOAT,width:O,height:D}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:pa()(p)?p:1,u_offsets:this.isOffsetStatic(g)?g:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return this.layer.triangulation=By,[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:OA,fragmentShader:IA,triangulation:By,depth:{enable:!1},primitive:V.POINTS,blend:this.getBlend(),stencil:rr(p,g)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:_c.additive}}}]),r}(Co);function RA(e){var i=LA();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function LA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kA=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  styleMappingMat[2].ba;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }



  gl_FragColor.a *= radar_v;
}
`,DA=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform float u_speed: 1.0;
uniform float u_time;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - a_Extrude.x - a_Extrude.y
    0.0, 0.0, 0.0, 0.0  // 
  );

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  styleMappingMat[2].ba = rotateMatrix * a_Extrude.xy;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> empty -> empty ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;


  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,FA=function(e){(0,en.Z)(r,e);var i=RA(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"meter2coord",1),(0,I.Z)((0,he.Z)(n),"isMeter",!1),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.strokeOpacity,g=v===void 0?1:v,x=a.strokeWidth,C=x===void 0?0:x,w=a.stroke,O=w===void 0?"rgba(0,0,0,0)":w,D=a.offsets,G=D===void 0?[0,0]:D,q=a.blend,te=a.speed,Se=te===void 0?1:te;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:O,offsets:G})){this.judgeStyleAttributes({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:O,offsets:G});var ze=this.layer.getEncodedData(),$e=this.calDataFrame(this.cellLength,ze,this.cellProperties),at=$e.data,Et=$e.width,Tt=$e.height;this.rowCount=Tt,this.dataTexture=this.cellLength>0&&at.length>0?this.createTexture2D({flipY:!0,data:at,format:V.LUMINANCE,type:V.FLOAT,width:Et,height:Tt}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_speed:Se,u_additive:q==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:pa()(p)?p:1,u_offsets:this.isOffsetStatic(G)?G:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,p=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Fh)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,p=s===void 0?"l7size":s,v=this.mapService.version;return p==="meter"&&v!==Ls.L7MAP&&v!==Ls.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,Q.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],v=a[2],g=a[3],x=[(s+v)/2,(p+g)/2],C=this.mapService.version;if(C===Ls.MAPBOX&&window.mapboxgl.MercatorCoordinate){var w=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),O=1,D=O*w.meterInMercatorCoordinateUnits(),G=new window.mapboxgl.MercatorCoordinate(w.x-D,w.y,w.z),q=G.toLngLat();this.meter2coord=x[0]-q.lng;return}var te=this.mapService.meterToCoord(x,[s,p]),Se=this.mapService.meterToCoord(x,[v===s?v+.1:v,g===p?p+.1:g]);this.meter2coord=(te+Se)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,w=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:"pointfill_"+O,vertexShader:w,fragmentShader:C,triangulation:Fh,depth:{enable:!1},blend:this.getBlend(),stencil:rr(p,g),cull:{enable:!0,face:Or(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:kA,vert:DA,type:"radar"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:On.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(p,v,g,x){var C;C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var w=x%4*3;return[C[w],C[w+1],C[w+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,w=C===void 0?5:C;return Array.isArray(w)?[w[0]*a.meter2coord]:[w*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:On.Attribute,descriptor:{name:"a_Shape",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(p,v,g,x){var C=p.shape,w=C===void 0?2:C,O=a.layer.getLayerConfig().shape2d,D=O.indexOf(w);return[D]}}})}}]),r}(Co);function BA(e){var i=NA();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function NA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zA=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);

  

  
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,UA=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function zy(e){var i=e.coordinates;return{vertices:(0,ar.Z)(i),indices:[0],size:i.length}}var ZA=function(e){(0,en.Z)(r,e);var i=BA(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.offsets,g=v===void 0?[0,0]:v,x=a.blend,C=a.strokeOpacity,w=C===void 0?1:C,O=a.strokeWidth,D=O===void 0?0:O,G=a.stroke,q=G===void 0?"#fff":G;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,offsets:g})){this.judgeStyleAttributes({opacity:p,offsets:g});var te=this.layer.getEncodedData(),Se=this.calDataFrame(this.cellLength,te,this.cellProperties),ze=Se.data,$e=Se.width,at=Se.height;this.rowCount=at,this.dataTexture=this.cellLength>0&&ze.length>0?this.createTexture2D({flipY:!0,data:ze,format:V.LUMINANCE,type:V.FLOAT,width:$e,height:at}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_additive:x==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:pa()(p)?p:1,u_offsets:this.isOffsetStatic(g)?g:[0,0],u_stroke_opacity:pa()(w)?w:1,u_stroke_width:pa()(D)?D:0,u_stroke_color:this.getStrokeColor(q)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return this.layer.triangulation=zy,[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:UA,fragmentShader:zA,triangulation:zy,depth:{enable:!1},primitive:V.POINTS,blend:this.getBlend(),stencil:rr(p,g)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:_c.additive}}}]),r}(Co);function jA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=VA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function VA(e,i){if(!!e){if(typeof e=="string")return Uy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Uy(e,i)}}function Uy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var GA=function(){function e(i,r,n){(0,ot.Z)(this,e),(0,I.Z)(this,"boxCells",[]),(0,I.Z)(this,"xCellCount",void 0),(0,I.Z)(this,"yCellCount",void 0),(0,I.Z)(this,"boxKeys",void 0),(0,I.Z)(this,"bboxes",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"xScale",void 0),(0,I.Z)(this,"yScale",void 0),(0,I.Z)(this,"boxUid",void 0);var a=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var s=0;s<this.xCellCount*this.yCellCount;s++)a.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,wt.Z)(e,[{key:"insert",value:function(r,n,a,s,p){this.forEachCell(n,a,s,p,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(p)}},{key:"query",value:function(r,n,a,s,p){return this.queryHitTest(r,n,a,s,!1,p)}},{key:"hitTest",value:function(r,n,a,s,p){return this.queryHitTest(r,n,a,s,!0,p)}},{key:"insertBoxCell",value:function(r,n,a,s,p,v){this.boxCells[p].push(v)}},{key:"queryHitTest",value:function(r,n,a,s,p,v){if(a<0||r>this.width||s<0||n>this.height)return p?!1:[];var g=[];if(r<=0&&n<=0&&this.width<=a&&this.height<=s){if(p)return!0;for(var x=0;x<this.boxKeys.length;x++)g.push({key:this.boxKeys[x],x1:this.bboxes[x*4],y1:this.bboxes[x*4+1],x2:this.bboxes[x*4+2],y2:this.bboxes[x*4+3]});return v?g.filter(v):g}var C={hitTest:p,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,a,s,this.queryCell,g,C,v),p?g.length>0:g}},{key:"queryCell",value:function(r,n,a,s,p,v,g,x){var C=g.seenUids,w=this.boxCells[p];if(w!==null){var O=this.bboxes,D=jA(w),G;try{for(D.s();!(G=D.n()).done;){var q=G.value;if(!C.box[q]){C.box[q]=!0;var te=q*4;if(r<=O[te+2]&&n<=O[te+3]&&a>=O[te+0]&&s>=O[te+1]&&(!x||x(this.boxKeys[q]))){if(g.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[q],x1:O[te],y1:O[te+1],x2:O[te+2],y2:O[te+3]})}}}}catch(Se){D.e(Se)}finally{D.f()}}return!1}},{key:"forEachCell",value:function(r,n,a,s,p,v,g,x){for(var C=this.convertToXCellCoord(r),w=this.convertToYCellCoord(n),O=this.convertToXCellCoord(a),D=this.convertToYCellCoord(s),G=C;G<=O;G++)for(var q=w;q<=D;q++){var te=this.xCellCount*q+G;if(p.call(this,r,n,a,s,te,v,g,x))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),HA=GA,WA=function(){function e(i,r){(0,ot.Z)(this,e),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"grid",void 0),(0,I.Z)(this,"viewportPadding",100),(0,I.Z)(this,"screenRightBoundary",void 0),(0,I.Z)(this,"screenBottomBoundary",void 0),(0,I.Z)(this,"gridRightBoundary",void 0),(0,I.Z)(this,"gridBottomBoundary",void 0),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new HA(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,wt.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,a=r.y1+r.anchorPointY+this.viewportPadding,s=r.x2+r.anchorPointX+this.viewportPadding,p=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,a,s,p)||this.grid.hitTest(n,a,s,p)?{box:[]}:{box:[n,a,s,p]}}},{key:"insertCollisionBox",value:function(r,n){var a={featureIndex:n};this.grid.insert(a,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,a){var s=mh(n,a,0,1),p=Vu(),v=Gt.apply(ue,(0,ar.Z)(r));return S(p,s,v),{x:(p[0]/p[3]+1)/2*this.width+this.viewportPadding,y:(-p[1]/p[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,a,s){return a>=0&&r<this.gridRightBoundary&&s>=0&&n<this.gridBottomBoundary}}]),e}();function Zy(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=XA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function XA(e,i){if(!!e){if(typeof e=="string")return jy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jy(e,i)}}function jy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Vy(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function Gy(e,i,r,n,a){if(!!a){var s=e[n],p=s.glyph;if(p)for(var v=i[p].advance*s.scale,g=(e[n].x+v)*a,x=r;x<=n;x++)e[x].x-=g}}function Hy(e,i,r,n,a,s,p){var v=(i-r)*a,g=(-n*p+.5)*s,x=Zy(e),C;try{for(x.s();!(C=x.n()).done;){var w=C.value;w.x+=v,w.y+=g}}catch(O){x.e(O)}finally{x.f()}}function YA(e,i,r,n,a,s,p){var v=-8,g=0,x=v,C=0,w=e.positionedGlyphs,O=s==="right"?1:s==="left"?0:.5,D=w.length;r.forEach(function(ze){if(ze.split("").forEach(function(at){var Et=i[at],Tt=0;Et&&(w.push({glyph:at,x:g,y:x+Tt,vertical:!1,scale:1,metrics:Et}),g+=Et.advance+p)}),w.length!==D){var $e=g-p;C=Math.max($e,C),Gy(w,i,D,w.length-1,O)}g=0,x-=n+5});var G=Vy(a),q=G.horizontalAlign,te=G.verticalAlign;Hy(w,O,q,te,C,n,r.length);var Se=x-v;e.top+=-te*Se,e.bottom=e.top-Se,e.left+=-q*C,e.right=e.left+C}function qA(e,i,r,n,a,s,p){var v=-8,g=0,x=v,C=0,w=e.positionedGlyphs,O=s==="right"?1:s==="left"?0:.5,D=w.length;r.forEach(function(ze){var $e=i[ze],at=0;if($e&&(w.push({glyph:ze,x:$e.advance/2,y:x+at,vertical:!1,scale:1,metrics:$e}),g+=$e.advance+p),w.length!==D){var Et=g-p;C=Math.max(Et,C),Gy(w,i,D,w.length-1,O)}g=0,x-=n+5});var G=Vy(a),q=G.horizontalAlign,te=G.verticalAlign;Hy(w,O,q,te,C,n,r.length);var Se=x-v;e.top+=-te*Se,e.bottom=e.top-Se,e.left+=-q*C,e.right=e.left+C}function KA(e,i,r,n,a,s){var p=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],v=arguments.length>7?arguments[7]:void 0,g=e.split(`
`),x=[],C={positionedGlyphs:x,top:p[1],bottom:p[1],left:p[0],right:p[0],lineCount:g.length,text:e};return v?qA(C,i,g,r,n,a,s):YA(C,i,g,r,n,a,s),x.length?C:!1}function $A(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,a=n===void 0?[]:n,s=[],p=Zy(a),v;try{for(p.s();!(v=p.n()).done;){var g=v.value,x=g.metrics,C=4,w=x.advance*g.scale/2,O=r?[g.x+w,g.y]:[0,0],D=r?[0,0]:[g.x+w+i[0],g.y+i[1]],G=(0-C)*g.scale-w+D[0],q=(0-C)*g.scale+D[1],te=G+x.width*g.scale,Se=q+x.height*g.scale,ze={x:G,y:q},$e={x:te,y:q},at={x:G,y:Se},Et={x:te,y:Se};s.push({tl:ze,tr:$e,bl:at,br:Et,tex:x,glyphOffset:O})}}catch(Tt){p.e(Tt)}finally{p.f()}return s}function QA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=JA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function JA(e,i){if(!!e){if(typeof e=="string")return Wy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Wy(e,i)}}function Wy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function ew(e){var i=tw();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function tw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Yy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function qy(e){var i=this,r=e.id,n=[],a=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var s=i.glyphInfoMap[r].centroid,p=s.length===2?[s[0],s[1],0]:s;return i.glyphInfoMap[r].glyphQuads.forEach(function(v,g){n.push.apply(n,(0,ar.Z)(p).concat([v.tex.x,v.tex.y+v.tex.height,v.tl.x,v.tl.y],(0,ar.Z)(p),[v.tex.x+v.tex.width,v.tex.y+v.tex.height,v.tr.x,v.tr.y],(0,ar.Z)(p),[v.tex.x+v.tex.width,v.tex.y,v.br.x,v.br.y],(0,ar.Z)(p),[v.tex.x,v.tex.y,v.bl.x,v.bl.y])),a.push(0+g*4,1+g*4,2+g*4,2+g*4,3+g*4,0+g*4)}),{vertices:n,indices:a,size:7}}var Ky=function(e){(0,en.Z)(r,e);var i=ew(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"glyphInfo",void 0),(0,I.Z)((0,he.Z)(n),"glyphInfoMap",{}),(0,I.Z)((0,he.Z)(n),"texture",void 0),(0,I.Z)((0,he.Z)(n),"currentZoom",-1),(0,I.Z)((0,he.Z)(n),"extent",void 0),(0,I.Z)((0,he.Z)(n),"textureHeight",0),(0,I.Z)((0,he.Z)(n),"textCount",0),(0,I.Z)((0,he.Z)(n),"preTextStyle",{}),(0,I.Z)((0,he.Z)(n),"buildModels",function(){var v=n.layer.getLayerConfig(),g=v.mask,x=g===void 0?!1:g,C=v.maskInside,w=C===void 0?!0:C;return n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel(),[n.layer.buildLayerModel({moduleName:"pointText",vertexShader:Yy,fragmentShader:Xy,triangulation:qy.bind((0,he.Z)(n)),depth:{enable:!1},blend:n.getBlend(),stencil:rr(x,w)})]}),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.stroke,g=v===void 0?"#fff":v,x=a.strokeWidth,C=x===void 0?0:x,w=a.textAnchor,O=w===void 0?"center":w,D=a.textAllowOverlap,G=D===void 0?!1:D,q=a.halo,te=q===void 0?.5:q,Se=a.gamma,ze=Se===void 0?2:Se,$e=a.raisingHeight,at=$e===void 0?0:$e,Et=this.fontService,Tt=Et.canvas,Jt=Et.mapping;if(Object.keys(Jt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Jt).length),this.preTextStyle={textAnchor:O,textAllowOverlap:G},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeWidth:C,stroke:g})){this.judgeStyleAttributes({opacity:p,strokeWidth:C,stroke:g});var fr=this.layer.getEncodedData(),Dr=this.calDataFrame(this.cellLength,fr,this.cellProperties),tn=Dr.data,wr=Dr.width,xn=Dr.height;this.rowCount=xn,this.dataTexture=this.cellLength>0&&tn.length>0?this.createTexture2D({flipY:!0,data:tn,format:V.LUMINANCE,type:V.FLOAT,width:wr,height:xn}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(at),u_opacity:pa()(p)?p:1,u_stroke_width:pa()(C)?C:0,u_stroke_color:this.getStrokeColor(g),u_sdf_map:this.texture,u_halo_blur:te,u_gamma_scale:ze,u_sdf_map_size:[Tt.width,Tt.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var a=this.layer.getLayerConfig(),s=a.textAnchor,p=s===void 0?"center":s,v=a.textAllowOverlap,g=v===void 0?!0:v;return this.preTextStyle={textAnchor:p,textAllowOverlap:g},this.buildModels()}},{key:"needUpdate",value:function(){var a=this.layer.getLayerConfig(),s=a.textAllowOverlap,p=s===void 0?!1:s,v=this.mapService.getZoom(),g=this.mapService.getBounds(),x=c(this.extent,g);return!p&&(Math.abs(this.currentZoom-v)>1||!x)||p!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:On.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){var x=s.rotate,C=x===void 0?0:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:On.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(s,p,v,g){return[v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?12:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:On.Attribute,descriptor:{name:"a_tex",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(s,p,v,g){return[v[3],v[4]]}}})}},{key:"textExtent",value:function(){var a=this.mapService.getBounds();return f(a,.5)}},{key:"initTextFont",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,p=s===void 0?"400":s,v=a.fontFamily,g=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),C=[];x.forEach(function(w){var O=w.shape,D=O===void 0?"":O;D=D.toString();var G=QA(D),q;try{for(G.s();!(q=G.n()).done;){var te=q.value;C.indexOf(te)===-1&&C.push(te)}}catch(Se){G.e(Se)}finally{G.f()}}),this.fontService.setFontOptions({characterSet:C,fontWeight:p,fontFamily:g,iconfont:!1})}},{key:"initIconFontTex",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,p=s===void 0?"400":s,v=a.fontFamily,g=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),C=[];x.forEach(function(w){var O=w.shape,D=O===void 0?"":O;D="".concat(D),C.indexOf(D)===-1&&C.push(D)}),this.fontService.setFontOptions({characterSet:C,fontWeight:p,fontFamily:g,iconfont:!0})}},{key:"generateGlyphLayout",value:function(a){var s=this,p=this.fontService.mapping,v=this.layer.getLayerConfig(),g=v.spacing,x=g===void 0?2:g,C=v.textAnchor,w=C===void 0?"center":C,O=this.layer.getEncodedData();this.glyphInfo=O.map(function(D){var G=D.shape,q=G===void 0?"":G,te=D.id,Se=D.size,ze=Se===void 0?1:Se,$e=D.textOffset,at=$e===void 0?[0,0]:$e,Et=KA(q.toString(),p,ze,w,"left",x,at,a),Tt=$A(Et,at,!1);return D.shaping=Et,D.glyphQuads=Tt,D.centroid=Lh(D.coordinates),D.originCentroid=D.version==="GAODE2.x"?Lh(D.originCoordinates):D.originCentroid=D.centroid,s.glyphInfoMap[te]={shaping:Et,glyphQuads:Tt,centroid:Lh(D.coordinates)},D})}},{key:"filterGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.padding,v=p===void 0?[4,4]:p,g=s.textAllowOverlap,x=g===void 0?!1:g;if(!x){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var C=this.rendererService.getViewportSize(),w=C.width,O=C.height,D=new WA(w,O),G=this.glyphInfo.filter(function(q){var te=q.shaping,Se=q.id,ze=Se===void 0?0:Se,$e=q.version==="GAODE2.x"?q.originCentroid:q.centroid,at=q.size,Et=at/24,Tt=a.mapService.lngLatToContainer($e),Jt=D.placeCollisionBox({x1:te.left*Et-v[0],x2:te.right*Et+v[0],y1:te.top*Et-v[1],y2:te.bottom*Et+v[1],anchorPointX:Tt.x,anchorPointY:Tt.y}),fr=Jt.box;return fr&&fr.length?(D.insertCollisionBox(fr,ze),!0):!1});G.forEach(function(q){a.glyphInfoMap[q.id]=q})}}},{key:"initGlyph",value:function(){var a=this.layer.getLayerConfig(),s=a.iconfont,p=s===void 0?!1:s;p?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(p)}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.textureHeight=s.height,this.texture&&this.texture.destroy(),this.texture=a({data:s,mag:V.LINEAR,min:V.LINEAR,width:s.width,height:s.height})}},{key:"reBuildModel",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Yy,fragmentShader:Xy,triangulation:qy.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:rr(p,g)})]}}]),r}(Co),rw={fillImage:yA,fill:Dy,radar:FA,image:Fy,normal:Ny,simplePoint:ZA,extrude:Ly,text:Ky,icon:SA},nw=rw;function iw(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=aw(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function aw(e,i){if(!!e){if(typeof e=="string")return $y(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $y(e,i)}}function $y(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function ow(e){var i=sw();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function sw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uw=function(e){(0,en.Z)(r,e);var i=ow(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"type","PointLayer"),n}return(0,wt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new nw[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var a=this.shapeOption,s=a.field,p=a.values,v=this.getLayerConfig(),g=v.shape2d,x=v.shape3d,C=this.iconService.getIconMap();if(s&&(g==null?void 0:g.indexOf(s))!==-1)return"fill";if(p&&p instanceof Array){var w=iw(p),O;try{for(w.s();!(O=w.n()).done;){var D=O.value;if(typeof D=="string"&&C.hasOwnProperty(D))return"image"}}catch(G){w.e(G)}finally{w.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return s[a]}},{key:"getModelType",value:function(){var a=["fillImage","fill","radar","image","normal","simplePoint","extrude","text","icon"];if(this.layerType&&a.includes(this.layerType))return this.layerType;var s=this.getEncodedData(),p=this.getLayerConfig(),v=p.shape2d,g=p.shape3d,x=this.iconService.getIconMap(),C=s.find(function(O){return O.hasOwnProperty("shape")});if(C){var w=C.shape;return w==="dot"?"normal":w==="simple"?"simplePoint":w==="radar"?"radar":w==="fillImage"?"fillImage":(v==null?void 0:v.indexOf(w))!==-1?"fill":(g==null?void 0:g.indexOf(w))!==-1?"extrude":x.hasOwnProperty(w)?"image":this.fontService.getGlyph(w)!==""?"icon":"text"}else return this.getModelTypeWillEmptyData()}}]),r}(Jp);function lw(e){var i=cw();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function cw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fw=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,pw=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  if(styleMappingMat[0][3] < 1.0 ) {
    // side
    styleMappingMat[0][0] = 0.0;
  } else {

  }

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,hw=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,dw=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,vw=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,mw=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,gw=function(e){(0,en.Z)(r,e);var i=lw(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"texture",void 0),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.heightfixed,g=v===void 0?!1:v,x=a.raisingHeight,C=x===void 0?0:x,w=a.topsurface,O=w===void 0?!0:w,D=a.sidesurface,G=D===void 0?!0:D,q=a.sourceColor,te=a.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var Se=this.layer.getEncodedData(),ze=this.calDataFrame(this.cellLength,Se,this.cellProperties),$e=ze.data,at=ze.width,Et=ze.height;this.rowCount=Et,this.dataTexture=this.cellLength>0&&$e.length>0?this.createTexture2D({flipY:!0,data:$e,format:V.LUMINANCE,type:V.FLOAT,width:at,height:Et}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}var Tt=0,Jt=[1,1,1,1],fr=[1,1,1,1];return q&&te&&(Jt=be(q),fr=be(te),Tt=1),{u_topsurface:Number(O),u_sidesurface:Number(G),u_heightfixed:Number(g),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(C),u_opacity:pa()(p)?p:1,u_linearColor:Tt,u_sourceColor:Jt,u_targetColor:fr,u_texture:this.texture}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,w=x.vert,O=x.type;return[this.layer.buildLayerModel({moduleName:O,vertexShader:w,fragmentShader:C,triangulation:fy,stencil:rr(p,g),cull:{enable:!0,face:V.BACK}})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.pickLight,p=a.mapTexture;return p?{frag:hw,vert:dw,type:"polygonExtrudeTexture"}:s?{frag:vw,vert:mw,type:"polygonExtrude"}:{frag:fw,vert:pw,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var a,s;(a=this.dataTexture)===null||a===void 0||a.destroy(),(s=this.texture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,Q.Z)(a,4),p=s[0],v=s[1],g=s[2],x=s[3],C=g-p,w=x-v;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:On.Attribute,descriptor:{name:"a_uvs",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(D,G,q,te,Se){var ze=q[0],$e=q[1];return[(ze-p)/C,($e-v)/w,q[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:On.Attribute,descriptor:{name:"a_Normal",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(D,G,q,te,Se){return Se}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:On.Attribute,descriptor:{name:"a_Size",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(D,G,q,te){var Se=D.size,ze=Se===void 0?10:Se;return Array.isArray(ze)?[ze[0]]:[ze]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.mapTexture,v=this.rendererService.createTexture2D;if(this.texture=v({height:0,width:0}),p){var g=new Image;g.crossOrigin="",g.src=p,g.onload=function(){a.texture=v({data:g,width:g.width,height:g.height,wrapS:V.CLAMP_TO_EDGE,wrapT:V.CLAMP_TO_EDGE,min:V.LINEAR,mag:V.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}}]),r}(Co);function yw(e){var i=_w();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function _w(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xw=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,bw=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Ew=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,Sw=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,Cw=function(e){(0,en.Z)(r,e);var i=yw(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.raisingHeight,p=s===void 0?0:s,v=a.opacity,g=v===void 0?1:v,x=a.opacityLinear,C=x===void 0?{enable:!1,dir:"in"}:x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:g})){this.judgeStyleAttributes({opacity:g});var w=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,w,this.cellProperties),D=O.data,G=O.width,q=O.height;this.rowCount=q,this.dataTexture=this.cellLength>0&&D.length>0?this.createTexture2D({flipY:!0,data:D,format:V.LUMINANCE,type:V.FLOAT,width:G,height:q}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(p),u_opacity:pa()(g)?g:1,u_opacitylinear:Number(C.enable),u_dir:C.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,p=s===void 0?{enable:!1,dir:"in"}:s,v=a.mask,g=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x;return this.layer.triangulation=p.enable?cy:e0,[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:p.enable?Ew:Sw,fragmentShader:p.enable?bw:xw,triangulation:p.enable?cy:e0,blend:this.getBlend(),depth:{enable:!1},cull:{enable:!0,face:V.BACK},stencil:rr(g,C)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,p=s===void 0?{enable:!1,dir:"in"}:s;p.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:On.Attribute,descriptor:{name:"a_linear",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:3,update:function(g,x,C,w,O){return[C[3],C[4],C[5]]}}})}}]),r}(Co);function Aw(e){var i=ww();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function ww(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Tw=`
uniform float u_time;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = styleMappingMat[0][0];
  gl_FragColor = vec4(col, opacity);

  // gl_FragColor = v_Color;
  
}
`,Mw=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,Pw=function(e){(0,en.Z)(r,e);var i=Aw(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"texture1",void 0),(0,I.Z)((0,he.Z)(n),"texture2",void 0),(0,I.Z)((0,he.Z)(n),"texture3",void 0),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.watercolor,g=v===void 0?"#6D99A8":v,x=a.watercolor2,C=x===void 0?"#0F121C":x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var w=this.layer.getEncodedData(),O=this.calDataFrame(this.cellLength,w,this.cellProperties),D=O.data,G=O.width,q=O.height;this.rowCount=q,this.dataTexture=this.cellLength>0&&D.length>0?this.createTexture2D({flipY:!0,data:D,format:V.LUMINANCE,type:V.FLOAT,width:G,height:q}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:be(g),u_watercolor2:be(C),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:pa()(p)?p:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_ocean",vertexShader:Mw,fragmentShader:Tw,triangulation:e0,depth:{enable:!1},stencil:rr(p,g)})]}},{key:"clearModels",value:function(){var a,s,p,v;(a=this.texture1)===null||a===void 0||a.destroy(),(s=this.texture2)===null||s===void 0||s.destroy(),(p=this.texture3)===null||p===void 0||p.destroy(),(v=this.dataTexture)===null||v===void 0||v.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,Q.Z)(a,4),p=s[0],v=s[1],g=s[2],x=s[3],C=g-p,w=x-v;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:On.Attribute,descriptor:{name:"a_uv",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(D,G,q,te,Se){var ze=(0,Q.Z)(q,2),$e=ze[0],at=ze[1];return[($e-p)/C,(at-v)/w]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.rendererService.createTexture2D,p={height:0,width:0};this.texture1=s(p),this.texture2=s(p),this.texture3=s(p),v(function(x){a.texture1=g(x[0]),a.texture2=g(x[1]),a.texture3=g(x[2]),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});function v(x){var C=0,w=[],O=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];O.map(function(D){var G=new Image;G.crossOrigin="",G.src=D,w.push(G),G.onload=function(){C++,C===3&&x(w)}})}function g(x){return s({data:x,width:x.width,height:x.height,wrapS:V.MIRRORED_REPEAT,wrapT:V.MIRRORED_REPEAT,min:V.LINEAR,mag:V.LINEAR})}}}]),r}(Co);function Iw(e){var i=Ow();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function Ow(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rw=`
uniform sampler2D u_texture;
uniform float u_time;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

  float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

  float water(vec3 p) {
    float t = u_time * u_speed;
    p.z += t * 2.; p.x += t * 2.;
    vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
    p.z += t * 3.; p.x += t * 0.52;
    vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
    p.z += t * 4.; p.x += t * 0.8;
    vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
    c1 += c2 - c3;
    float z = (c1.x + c1.y + c1.z) / 3.;
    return p.y + z / 4.;
  }

  float map(vec3 p) {
    float d = 100.0;
    d = water(p);
    return d;
  }

  float intersect(vec3 ro, vec3 rd) {
    float d = 0.0;
    for (int i = 0; i <= 100; i++) {
      float h = map(ro + rd * d);
      if (h < 0.1) return  d;
      d += h;
    }
    return 0.0;
  }
  
  vec3 norm(vec3 p) {
    float eps = .1;
    return normalize(vec3(
      map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
      map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
      map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
    ));
  } 

  float calSpc() {
    vec3 l1 = normalize(vec3(1, 1, 1));
    vec3 ro = vec3(-3, 20, -8);
    vec3 rc = vec3(0, 0, 0);
    vec3 ww = normalize(rc - ro);
    vec3 uu = normalize(cross(vec3(0,1,0), ww));
    vec3 vv = normalize(cross(rc - ro, uu));
    vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
    float d = intersect(ro, rd);
    vec3 p = ro + rd * d;
    vec3 n = norm(p);
    float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
    return spc;
  }

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,Lw=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,kw=function(e){(0,en.Z)(r,e);var i=Iw(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"texture",void 0),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.speed,g=v===void 0?.5:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),w=C.data,O=C.width,D=C.height;this.rowCount=D,this.dataTexture=this.cellLength>0&&w.length>0?this.createTexture2D({flipY:!0,data:w,format:V.LUMINANCE,type:V.FLOAT,width:O,height:D}):this.createTexture2D({flipY:!0,data:[1],format:V.LUMINANCE,type:V.FLOAT,width:1,height:1})}return{u_texture:this.texture,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_speed:g,u_opacity:pa()(p)?p:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_water",vertexShader:Lw,fragmentShader:Rw,triangulation:e0,depth:{enable:!1},stencil:rr(p,g)})]}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,Q.Z)(a,4),p=s[0],v=s[1],g=s[2],x=s[3],C=g-p,w=x-v;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:On.Attribute,descriptor:{name:"a_uv",buffer:{usage:V.STATIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(D,G,q,te,Se){var ze=(0,Q.Z)(q,2),$e=ze[0],at=ze[1];return[($e-p)/C,(at-v)/w]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.waterTexture,v=this.rendererService.createTexture2D;this.texture=v({height:0,width:0});var g=new Image;g.crossOrigin="",p?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),g.src=p):g.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",g.onload=function(){a.texture=v({data:g,width:g.width,height:g.height,wrapS:V.MIRRORED_REPEAT,wrapT:V.MIRRORED_REPEAT,min:V.LINEAR,mag:V.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}]),r}(Co),Dw={fill:Cw,line:Oy,extrude:gw,text:Ky,point_fill:Dy,point_image:Fy,point_normal:Ny,point_extrude:Ly,water:kw,ocean:Pw},Fw=Dw;function Bw(e){var i=Nw();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function Nw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Qy=function(e){(0,en.Z)(r,e);var i=Bw(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"type","PolygonLayer"),n}return(0,wt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new Fw[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return p==="fill"?"fill":p==="extrude"?"extrude":p==="water"?"water":p==="ocean"?"ocean":p==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var a=this.getEncodedData(),s=this.getLayerConfig(),p=s.shape2d,v=s.shape3d,g=this.iconService.getIconMap(),x=a.find(function(w){return w.hasOwnProperty("shape")});if(x){var C=x.shape;return C==="dot"?"point_normal":(p==null?void 0:p.indexOf(C))!==-1?"point_fill":(v==null?void 0:v.indexOf(C))!==-1?"point_extrude":g.hasOwnProperty(C)?"point_image":"text"}else return"fill"}}]),r}(Jp);function zw(e){var i=Uw();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function Uw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Zw=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,jw=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Jy=function(e){(0,en.Z)(r,e);var i=zw(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"texture",void 0),(0,I.Z)((0,he.Z)(n),"colorTexture",void 0),n}return(0,wt.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.clampLow,g=v===void 0?!0:v,x=a.clampHigh,C=x===void 0?!0:x,w=a.noDataValue,O=w===void 0?-9999999:w,D=a.domain,G=D===void 0?[0,1]:D;return this.updateColorTexure(),{u_opacity:p||1,u_texture:this.texture,u_domain:G,u_clampLow:g,u_clampHigh:typeof C!="undefined"?C:g,u_noDataValue:O,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.layer.getSource(),C=this.rendererService.createTexture2D,w=x.data.dataArray[0];this.texture=C({data:w.data,width:w.width,height:w.height,format:V.LUMINANCE,type:V.FLOAT});var O=this.layer.getLayerConfig(),D=O.rampColors,G=yt(D);return this.colorTexture=C({data:G.data,width:G.width,height:G.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:jw,fragmentShader:Zw,triangulation:hy,primitive:V.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:rr(p,g)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:On.Attribute,descriptor:{name:"a_Uv",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:2,update:function(s,p,v,g){return[v[3],v[4]]}}})}},{key:"updateColorTexure",value:function(){var a=this.rendererService.createTexture2D,s=this.layer.getLayerConfig(),p=s.rampColors,v=yt(p);this.colorTexture=a({data:v.data,width:v.width,height:v.height,flipY:!1})}}]),r}(Co),Vw={raster:Jy,raster3d:Jy},Gw=Vw;function Hw(e){var i=Ww();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function Ww(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Xw=function(e){(0,en.Z)(r,e);var i=Hw(r);function r(){var n;(0,ot.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,he.Z)(n),"type","RasterLayer"),n}return(0,wt.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new Gw[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={raster:{},raster3d:{}};return s[a]}},{key:"getModelType",value:function(){return"raster"}}]),r}(Jp),e_,t_,r_,n_,i_,i0,a_,o_,s_;function u_(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Yw(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?u_(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u_(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var qw=(e_=(0,Ur.b2)(),t_=(0,Ur.f3)(qt.IGlobalConfigService),r_=(0,Ur.f3)(qt.IMapService),n_=(0,Ur.f3)(qt.IFontService),e_(i_=(i0=function(){function e(){(0,ot.Z)(this,e),fi(this,"configService",a_,this),fi(this,"mapService",o_,this),fi(this,"fontService",s_,this)}return(0,wt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){a.generateMaping(r,{styleAttributeService:s})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,a.generateMaping(r,{styleAttributeService:s}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var p=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],g=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,C=v.filter(function(O){return O.needRemapping}),w=x;g!=null&&g.needRemapping&&g!==null&&g!==void 0&&g.scale&&(w=x.filter(function(O){return a.applyAttributeMapping(g,O,p)[0]})),C.length&&(g!=null&&g.needRemapping?(r.setEncodedData(a.mapping(v,w,void 0,p,r)),g.needRemapping=!1):r.setEncodedData(a.mapping(C,w,r.getEncodedData(),p,r)),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,n){var a=this,s=n.styleAttributeService,p=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],g=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,C=x;g!=null&&g.scale&&(C=x.filter(function(w){return a.applyAttributeMapping(g,w,p)[0]})),r.setEncodedData(this.mapping(v,C,void 0,p,r)),r.emit("dataUpdate",null)}},{key:"getArrowPoints",value:function(r,n){var a=[n[0]-r[0],n[1]-r[1]],s=E(a),p=[r[0]+s[0]*1e-4,r[1]+s[1]*1e-4];return p}},{key:"mapping",value:function(r,n,a,s,p){var v=this,g=p==null?void 0:p.getLayerConfig(),x=g.arrow,C=x===void 0?{enable:!1}:x,w=n.map(function(O,D){var G=a?a[D]:{},q=Yw({id:O._id,coordinates:O.coordinates},G);if(r.filter(function(ze){return ze.scale!==void 0}).forEach(function(ze){var $e=v.applyAttributeMapping(ze,O,s);ze.needRemapping=!1,ze.name==="color"&&($e=$e.map(function(at){return be(at)})),q[ze.name]=Array.isArray($e)&&$e.length===1?$e[0]:$e,ze.name==="shape"&&(q.shape=v.fontService.getIconFontKey(q[ze.name]))}),q.shape==="line"&&C.enable){var te=q.coordinates,Se=v.getArrowPoints(te[0],te[1]);q.coordinates.splice(1,0,Se,Se)}return q});return this.adjustData2Amap2Coordinates(w),this.adjustData2SimpleCoordinates(w),w}},{key:"adjustData2Amap2Coordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===Ls["GAODE2.x"]&&(typeof r[0].coordinates[0]=="number"?r.filter(function(a){return!a.originCoordinates}).map(function(a){a.version=Ls["GAODE2.x"],a.originCoordinates=Za()(a.coordinates),a.coordinates=n.mapService.lngLatToCoord(a.coordinates)}):r.filter(function(a){return!a.originCoordinates}).map(function(a){a.version=Ls["GAODE2.x"],a.originCoordinates=Za()(a.coordinates),a.coordinates=n.mapService.lngLatToCoords(a.coordinates)}))}},{key:"adjustData2SimpleCoordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===Ls.SIMPLE&&r.map(function(a){a.simpleCoordinate||(a.coordinates=n.unProjectCoordinates(a.coordinates),a.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(r){var n=this;if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var a=[];return r.map(function(p){var v=[];p.map(function(g){v.push(n.mapService.simpleMapCoord.unproject(g))}),a.push(v)}),a}else{var s=[];return r.map(function(p){s.push(n.mapService.simpleMapCoord.unproject(p))}),s}}},{key:"applyAttributeMapping",value:function(r,n,a){var s;if(!r.scale)return[];var p=(r==null||(s=r.scale)===null||s===void 0?void 0:s.scalers)||[],v=[];p.forEach(function(x){var C,w=x.field;(n.hasOwnProperty(w)||((C=r.scale)===null||C===void 0?void 0:C.type)==="variable")&&v.push(n[w])});var g=r.mapping?r.mapping(v):[];return r.name==="color"&&!He(g[0])?[a]:g}}]),e}(),a_=Hn(i0.prototype,"configService",[t_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o_=Hn(i0.prototype,"mapService",[r_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s_=Hn(i0.prototype,"fontService",[n_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i0))||i_),l_,c_,Kw=(l_=(0,Ur.b2)(),l_(c_=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"mapService",void 0)}return(0,wt.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(qt.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var a=r.getSource();if(!a){var s=r.sourceOption||{data:wd,options:Mu},p=s.data,v=s.options;r.setSource(new Bp(p,v))}n.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var a=n.updateClusterData(r),s=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,a||s})}},{key:"updateClusterData",value:function(r){var n=r.getSource(),a=n.cluster,s=n.clusterOptions,p=s.zoom,v=p===void 0?0:p,g=s.maxZoom,x=g===void 0?16:g,C=this.mapService.getZoom()-1,w=r.dataState.dataSourceNeedUpdate;return a&&(w||Math.abs(r.clusterZoom-C)>=1)?(v!==Math.floor(C)&&n.updateClusterData(Math.floor(C)),r.clusterZoom=C,!0):!1}}]),e}())||c_);function jv(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function f_(e){return e.length===1&&(e=$w(e)),{left:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)<0?n=s+1:a=s}return n},right:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)>0?a=s:n=s+1}return n}}}function $w(e){return function(i,r){return jv(e(i),r)}}var p_=f_(jv),Qw=p_.right,iP=p_.left,G0=Qw;function Jw(e,i){var r=e.length,n=-1,a,s,p;if(i==null){for(;++n<r;)if((a=e[n])!=null&&a>=a)for(s=p=a;++n<r;)(a=e[n])!=null&&(s>a&&(s=a),p<a&&(p=a))}else for(;++n<r;)if((a=i(e[n],n,e))!=null&&a>=a)for(s=p=a;++n<r;)(a=i(e[n],n,e))!=null&&(s>a&&(s=a),p<a&&(p=a));return[s,p]}var h_=Array.prototype,aP=h_.slice,oP=h_.map,Vv=Math.sqrt(50),Gv=Math.sqrt(10),Hv=Math.sqrt(2);function d_(e,i,r){var n,a=-1,s,p,v;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(s=e,e=i,i=s),(v=H0(e,i,r))===0||!isFinite(v))return[];if(v>0)for(e=Math.ceil(e/v),i=Math.floor(i/v),p=new Array(s=Math.ceil(i-e+1));++a<s;)p[a]=(e+a)*v;else for(e=Math.floor(e*v),i=Math.ceil(i*v),p=new Array(s=Math.ceil(e-i+1));++a<s;)p[a]=(e-a)/v;return n&&p.reverse(),p}function H0(e,i,r){var n=(i-e)/Math.max(0,r),a=Math.floor(Math.log(n)/Math.LN10),s=n/Math.pow(10,a);return a>=0?(s>=Vv?10:s>=Gv?5:s>=Hv?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(s>=Vv?10:s>=Gv?5:s>=Hv?2:1)}function Wv(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),a=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),s=n/a;return s>=Vv?a*=10:s>=Gv?a*=5:s>=Hv&&(a*=2),i<e?-a:a}function sP(){var e=identity,i=extent,r=sturges;function n(a){var s,p=a.length,v,g=new Array(p);for(s=0;s<p;++s)g[s]=e(a[s],s,a);var x=i(g),C=x[0],w=x[1],O=r(g,C,w);Array.isArray(O)||(O=tickStep(C,w,O),O=range(Math.ceil(C/O)*O,w,O));for(var D=O.length;O[0]<=C;)O.shift(),--D;for(;O[D-1]>w;)O.pop(),--D;var G=new Array(D+1),q;for(s=0;s<=D;++s)q=G[s]=[],q.x0=s>0?O[s-1]:C,q.x1=s<D?O[s]:w;for(s=0;s<p;++s)v=g[s],C<=v&&v<=w&&G[bisect(O,v,0,D)].push(a[s]);return G}return n.value=function(a){return arguments.length?(e=typeof a=="function"?a:constant(a),n):e},n.domain=function(a){return arguments.length?(i=typeof a=="function"?a:constant([a[0],a[1]]),n):i},n.thresholds=function(a){return arguments.length?(r=typeof a=="function"?a:Array.isArray(a)?constant(slice.call(a)):constant(a),n):r},n}function uP(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function eT(e){return e===null?NaN:+e}function tT(e,i,r){if(r==null&&(r=eT),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,a=(n-1)*i,s=Math.floor(a),p=+r(e[s],s,e),v=+r(e[s+1],s+1,e);return p+(v-p)*(a-s)}}var Sc="$";function W0(){}W0.prototype=v_.prototype={constructor:W0,has:function(e){return Sc+e in this},get:function(e){return this[Sc+e]},set:function(e,i){return this[Sc+e]=i,this},remove:function(e){var i=Sc+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===Sc&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===Sc&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===Sc&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===Sc&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===Sc&&++e;return e},empty:function(){for(var e in this)if(e[0]===Sc)return!1;return!0},each:function(e){for(var i in this)i[0]===Sc&&e(this[i],i.slice(1),this)}};function v_(e,i){var r=new W0;if(e instanceof W0)e.each(function(v,g){r.set(g,v)});else if(Array.isArray(e)){var n=-1,a=e.length,s;if(i==null)for(;++n<a;)r.set(n,e[n]);else for(;++n<a;)r.set(i(s=e[n],n,e),s)}else if(e)for(var p in e)r.set(p,e[p]);return r}var Xv=v_;function lP(){var e=[],i=[],r,n,a;function s(v,g,x,C){if(g>=e.length)return r!=null&&v.sort(r),n!=null?n(v):v;for(var w=-1,O=v.length,D=e[g++],G,q,te=map(),Se,ze=x();++w<O;)(Se=te.get(G=D(q=v[w])+""))?Se.push(q):te.set(G,[q]);return te.each(function($e,at){C(ze,at,s($e,g,x,C))}),ze}function p(v,g){if(++g>e.length)return v;var x,C=i[g-1];return n!=null&&g>=e.length?x=v.entries():(x=[],v.each(function(w,O){x.push({key:O,values:p(w,g)})})),C!=null?x.sort(function(w,O){return C(w.key,O.key)}):x}return a={object:function(v){return s(v,0,rT,nT)},map:function(v){return s(v,0,m_,g_)},entries:function(v){return p(s(v,0,m_,g_),0)},key:function(v){return e.push(v),a},sortKeys:function(v){return i[e.length-1]=v,a},sortValues:function(v){return r=v,a},rollup:function(v){return n=v,a}}}function rT(){return{}}function nT(e,i,r){e[i]=r}function m_(){return map()}function g_(e,i,r){e.set(i,r)}function X0(){}var Nh=Xv.prototype;X0.prototype=iT.prototype={constructor:X0,has:Nh.has,add:function(e){return e+="",this[Sc+e]=e,this},remove:Nh.remove,clear:Nh.clear,values:Nh.keys,size:Nh.size,empty:Nh.empty,each:Nh.each};function iT(e,i){var r=new X0;if(e instanceof X0)e.each(function(s){r.add(s)});else if(e){var n=-1,a=e.length;if(i==null)for(;++n<a;)r.add(e[n]);else for(;++n<a;)r.add(i(e[n],n,e))}return r}var cP=null,y_=Array.prototype,Y0=y_.map,zh=y_.slice;function nh(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function fP(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var __={name:"implicit"};function q0(){var e=Xv(),i=[],r=[],n=__;function a(s){var p=s+"",v=e.get(p);if(!v){if(n!==__)return n;e.set(p,v=i.push(s))}return r[(v-1)%r.length]}return a.domain=function(s){if(!arguments.length)return i.slice();i=[],e=Xv();for(var p=-1,v=s.length,g,x;++p<v;)e.has(x=(g=s[p])+"")||e.set(x,i.push(g));return a},a.range=function(s){return arguments.length?(r=zh.call(s),a):r.slice()},a.unknown=function(s){return arguments.length?(n=s,a):n},a.copy=function(){return q0(i,r).unknown(n)},nh.apply(a,arguments),a}function x_(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],a,s,p=!1,v=0,g=0,x=.5;delete e.unknown;function C(){var w=i().length,O=n[1]<n[0],D=n[O-0],G=n[1-O];a=(G-D)/Math.max(1,w-v+g*2),p&&(a=Math.floor(a)),D+=(G-D-a*(w-v))*x,s=a*(1-v),p&&(D=Math.round(D),s=Math.round(s));var q=sequence(w).map(function(te){return D+a*te});return r(O?q.reverse():q)}return e.domain=function(w){return arguments.length?(i(w),C()):i()},e.range=function(w){return arguments.length?(n=[+w[0],+w[1]],C()):n.slice()},e.rangeRound=function(w){return n=[+w[0],+w[1]],p=!0,C()},e.bandwidth=function(){return s},e.step=function(){return a},e.round=function(w){return arguments.length?(p=!!w,C()):p},e.padding=function(w){return arguments.length?(v=Math.min(1,g=+w),C()):v},e.paddingInner=function(w){return arguments.length?(v=Math.min(1,w),C()):v},e.paddingOuter=function(w){return arguments.length?(g=+w,C()):g},e.align=function(w){return arguments.length?(x=Math.max(0,Math.min(1,w)),C()):x},e.copy=function(){return x_(i(),n).round(p).paddingInner(v).paddingOuter(g).align(x)},initRange.apply(C(),arguments)}function b_(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return b_(i())},e}function pP(){return b_(x_.apply(null,arguments).paddingInner(1))}var aT=N(26257),oT=N(73626);function sT(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function uT(e){return function(){return e}}function Yv(e){return+e}var E_=[0,1];function Cc(e){return e}function qv(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:uT(isNaN(i)?NaN:.5)}function S_(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(a){return Math.max(i,Math.min(r,a))}}function lT(e,i,r){var n=e[0],a=e[1],s=i[0],p=i[1];return a<n?(n=qv(a,n),s=r(p,s)):(n=qv(n,a),s=r(s,p)),function(v){return s(n(v))}}function cT(e,i,r){var n=Math.min(e.length,i.length)-1,a=new Array(n),s=new Array(n),p=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++p<n;)a[p]=qv(e[p],e[p+1]),s[p]=r(i[p],i[p+1]);return function(v){var g=G0(e,v,1,n)-1;return s[g](a[g](v))}}function K0(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Kv(){var e=E_,i=E_,r=aT.Z,n,a,s,p=Cc,v,g,x;function C(){return v=Math.min(e.length,i.length)>2?cT:lT,g=x=null,w}function w(O){return isNaN(O=+O)?s:(g||(g=v(e.map(n),i,r)))(n(p(O)))}return w.invert=function(O){return p(a((x||(x=v(i,e.map(n),oT.Z)))(O)))},w.domain=function(O){return arguments.length?(e=Y0.call(O,Yv),p===Cc||(p=S_(e)),C()):e.slice()},w.range=function(O){return arguments.length?(i=zh.call(O),C()):i.slice()},w.rangeRound=function(O){return i=zh.call(O),r=sT,C()},w.clamp=function(O){return arguments.length?(p=O?S_(e):Cc,w):p!==Cc},w.interpolate=function(O){return arguments.length?(r=O,C()):r},w.unknown=function(O){return arguments.length?(s=O,w):s},function(O,D){return n=O,a=D,C()}}function C_(e,i){return Kv()(e,i)}var fT=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function $0(e){if(!(i=fT.exec(e)))throw new Error("invalid format: "+e);var i;return new $v({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}$0.prototype=$v.prototype;function $v(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}$v.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function pT(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Q0(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function dd(e){return e=Q0(Math.abs(e)),e?e[1]:NaN}function hT(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(dd(i)/3)))*3-dd(Math.abs(e)))}function dT(e,i){return function(r,n){for(var a=r.length,s=[],p=0,v=e[0],g=0;a>0&&v>0&&(g+v+1>n&&(v=Math.max(1,n-g)),s.push(r.substring(a-=v,a+v)),!((g+=v+1)>n));)v=e[p=(p+1)%e.length];return s.reverse().join(i)}}function vT(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function mT(e){e:for(var i=e.length,r=1,n=-1,a;r<i;++r)switch(e[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(a+1):e}var A_;function gT(e,i){var r=Q0(e,i);if(!r)return e+"";var n=r[0],a=r[1],s=a-(A_=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,p=n.length;return s===p?n:s>p?n+new Array(s-p+1).join("0"):s>0?n.slice(0,s)+"."+n.slice(s):"0."+new Array(1-s).join("0")+Q0(e,Math.max(0,i+s-1))[0]}function w_(e,i){var r=Q0(e,i);if(!r)return e+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}var T_={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:pT,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return w_(e*100,i)},r:w_,s:gT,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function M_(e){return e}var P_=Array.prototype.map,I_=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function yT(e){var i=e.grouping===void 0||e.thousands===void 0?M_:dT(P_.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?M_:vT(P_.call(e.numerals,String)),p=e.percent===void 0?"%":e.percent+"",v=e.minus===void 0?"-":e.minus+"",g=e.nan===void 0?"NaN":e.nan+"";function x(w){w=$0(w);var O=w.fill,D=w.align,G=w.sign,q=w.symbol,te=w.zero,Se=w.width,ze=w.comma,$e=w.precision,at=w.trim,Et=w.type;Et==="n"?(ze=!0,Et="g"):T_[Et]||($e===void 0&&($e=12),at=!0,Et="g"),(te||O==="0"&&D==="=")&&(te=!0,O="0",D="=");var Tt=q==="$"?r:q==="#"&&/[boxX]/.test(Et)?"0"+Et.toLowerCase():"",Jt=q==="$"?n:/[%p]/.test(Et)?p:"",fr=T_[Et],Dr=/[defgprs%]/.test(Et);$e=$e===void 0?6:/[gprs]/.test(Et)?Math.max(1,Math.min(21,$e)):Math.max(0,Math.min(20,$e));function tn(wr){var xn=Tt,Tn=Jt,$n,Ga,as;if(Et==="c")Tn=fr(wr)+Tn,wr="";else{wr=+wr;var ks=wr<0||1/wr<0;if(wr=isNaN(wr)?g:fr(Math.abs(wr),$e),at&&(wr=mT(wr)),ks&&+wr==0&&G!=="+"&&(ks=!1),xn=(ks?G==="("?G:v:G==="-"||G==="("?"":G)+xn,Tn=(Et==="s"?I_[8+A_/3]:"")+Tn+(ks&&G==="("?")":""),Dr){for($n=-1,Ga=wr.length;++$n<Ga;)if(as=wr.charCodeAt($n),48>as||as>57){Tn=(as===46?a+wr.slice($n+1):wr.slice($n))+Tn,wr=wr.slice(0,$n);break}}}ze&&!te&&(wr=i(wr,Infinity));var Ds=xn.length+wr.length+Tn.length,Qs=Ds<Se?new Array(Se-Ds+1).join(O):"";switch(ze&&te&&(wr=i(Qs+wr,Qs.length?Se-Tn.length:Infinity),Qs=""),D){case"<":wr=xn+wr+Tn+Qs;break;case"=":wr=xn+Qs+wr+Tn;break;case"^":wr=Qs.slice(0,Ds=Qs.length>>1)+xn+wr+Tn+Qs.slice(Ds);break;default:wr=Qs+xn+wr+Tn;break}return s(wr)}return tn.toString=function(){return w+""},tn}function C(w,O){var D=x((w=$0(w),w.type="f",w)),G=Math.max(-8,Math.min(8,Math.floor(dd(O)/3)))*3,q=Math.pow(10,-G),te=I_[8+G/3];return function(Se){return D(q*Se)+te}}return{format:x,formatPrefix:C}}var J0,Qv,O_;_T({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function _T(e){return J0=yT(e),Qv=J0.format,O_=J0.formatPrefix,J0}function xT(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,dd(i)-dd(e))+1}function bT(e){return Math.max(0,-dd(Math.abs(e)))}function ET(e,i,r,n){var a=Wv(e,i,r),s;switch(n=$0(n==null?",f":n),n.type){case"s":{var p=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(s=hT(a,p))&&(n.precision=s),O_(n,p)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(s=xT(a,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=s-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(s=bT(a))&&(n.precision=s-(n.type==="%")*2);break}}return Qv(n)}function ev(e){var i=e.domain;return e.ticks=function(r){var n=i();return d_(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var a=i();return ET(a[0],a[a.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),a=0,s=n.length-1,p=n[a],v=n[s],g;return v<p&&(g=p,p=v,v=g,g=a,a=s,s=g),g=H0(p,v,r),g>0?(p=Math.floor(p/g)*g,v=Math.ceil(v/g)*g,g=H0(p,v,r)):g<0&&(p=Math.ceil(p*g)/g,v=Math.floor(v*g)/g,g=H0(p,v,r)),g>0?(n[a]=Math.floor(p/g)*g,n[s]=Math.ceil(v/g)*g,i(n)):g<0&&(n[a]=Math.ceil(p*g)/g,n[s]=Math.floor(v*g)/g,i(n)),e},e}function R_(){var e=C_(Cc,Cc);return e.copy=function(){return K0(e,R_())},nh.apply(e,arguments),ev(e)}function L_(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Y0.call(n,Yv),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return L_(e).unknown(i)},e=arguments.length?Y0.call(e,Yv):[0,1],ev(r)}function k_(e,i){e=e.slice();var r=0,n=e.length-1,a=e[r],s=e[n],p;return s<a&&(p=r,r=n,n=p,p=a,a=s,s=p),e[r]=i.floor(a),e[n]=i.ceil(s),e}function D_(e){return Math.log(e)}function F_(e){return Math.exp(e)}function ST(e){return-Math.log(-e)}function CT(e){return-Math.exp(-e)}function AT(e){return isFinite(e)?+("1e"+e):e<0?0:e}function wT(e){return e===10?AT:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function TT(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function B_(e){return function(i){return-e(-i)}}function MT(e){var i=e(D_,F_),r=i.domain,n=10,a,s;function p(){return a=TT(n),s=wT(n),r()[0]<0?(a=B_(a),s=B_(s),e(ST,CT)):e(D_,F_),i}return i.base=function(v){return arguments.length?(n=+v,p()):n},i.domain=function(v){return arguments.length?(r(v),p()):r()},i.ticks=function(v){var g=r(),x=g[0],C=g[g.length-1],w;(w=C<x)&&(O=x,x=C,C=O);var O=a(x),D=a(C),G,q,te,Se=v==null?10:+v,ze=[];if(!(n%1)&&D-O<Se){if(O=Math.round(O)-1,D=Math.round(D)+1,x>0){for(;O<D;++O)for(q=1,G=s(O);q<n;++q)if(te=G*q,!(te<x)){if(te>C)break;ze.push(te)}}else for(;O<D;++O)for(q=n-1,G=s(O);q>=1;--q)if(te=G*q,!(te<x)){if(te>C)break;ze.push(te)}}else ze=d_(O,D,Math.min(D-O,Se)).map(s);return w?ze.reverse():ze},i.tickFormat=function(v,g){if(g==null&&(g=n===10?".0e":","),typeof g!="function"&&(g=Qv(g)),v===Infinity)return g;v==null&&(v=10);var x=Math.max(1,n*v/i.ticks().length);return function(C){var w=C/s(Math.round(a(C)));return w*n<n-.5&&(w*=n),w<=x?g(C):""}},i.nice=function(){return r(k_(r(),{floor:function(v){return s(Math.floor(a(v)))},ceil:function(v){return s(Math.ceil(a(v)))}}))},i}function N_(){var e=MT(Kv()).domain([1,10]);return e.copy=function(){return K0(e,N_()).base(e.base())},nh.apply(e,arguments),e}function z_(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function U_(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function PT(e){var i=1,r=e(z_(i),U_(i));return r.constant=function(n){return arguments.length?e(z_(i=+n),U_(i)):i},linearish(r)}function IT(){var e=PT(transformer());return e.copy=function(){return copy(e,IT()).constant(e.constant())},initRange.apply(e,arguments)}function Z_(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function OT(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function RT(e){return e<0?-e*e:e*e}function LT(e){var i=e(Cc,Cc),r=1;function n(){return r===1?e(Cc,Cc):r===.5?e(OT,RT):e(Z_(r),Z_(1/r))}return i.exponent=function(a){return arguments.length?(r=+a,n()):r},ev(i)}function Jv(){var e=LT(Kv());return e.copy=function(){return K0(e,Jv()).exponent(e.exponent())},nh.apply(e,arguments),e}function hP(){return Jv.apply(null,arguments).exponent(.5)}function j_(){var e=[],i=[],r=[],n;function a(){var p=0,v=Math.max(1,i.length);for(r=new Array(v-1);++p<v;)r[p-1]=tT(e,p/v);return s}function s(p){return isNaN(p=+p)?n:i[G0(r,p)]}return s.invertExtent=function(p){var v=i.indexOf(p);return v<0?[NaN,NaN]:[v>0?r[v-1]:e[0],v<r.length?r[v]:e[e.length-1]]},s.domain=function(p){if(!arguments.length)return e.slice();e=[];for(var v=0,g=p.length,x;v<g;++v)x=p[v],x!=null&&!isNaN(x=+x)&&e.push(x);return e.sort(jv),a()},s.range=function(p){return arguments.length?(i=zh.call(p),a()):i.slice()},s.unknown=function(p){return arguments.length?(n=p,s):n},s.quantiles=function(){return r.slice()},s.copy=function(){return j_().domain(e).range(i).unknown(n)},nh.apply(s,arguments)}function V_(){var e=0,i=1,r=1,n=[.5],a=[0,1],s;function p(g){return g<=g?a[G0(n,g,0,r)]:s}function v(){var g=-1;for(n=new Array(r);++g<r;)n[g]=((g+1)*i-(g-r)*e)/(r+1);return p}return p.domain=function(g){return arguments.length?(e=+g[0],i=+g[1],v()):[e,i]},p.range=function(g){return arguments.length?(r=(a=zh.call(g)).length-1,v()):a.slice()},p.invertExtent=function(g){var x=a.indexOf(g);return x<0?[NaN,NaN]:x<1?[e,n[0]]:x>=r?[n[r-1],i]:[n[x-1],n[x]]},p.unknown=function(g){return arguments.length&&(s=g),p},p.thresholds=function(){return n.slice()},p.copy=function(){return V_().domain([e,i]).range(a).unknown(s)},nh.apply(ev(p),arguments)}function G_(){var e=[.5],i=[0,1],r,n=1;function a(s){return s<=s?i[G0(e,s,0,n)]:r}return a.domain=function(s){return arguments.length?(e=zh.call(s),n=Math.min(e.length,i.length-1),a):e.slice()},a.range=function(s){return arguments.length?(i=zh.call(s),n=Math.min(e.length,i.length-1),a):i.slice()},a.invertExtent=function(s){var p=i.indexOf(s);return[e[p-1],e[p]]},a.unknown=function(s){return arguments.length?(r=s,a):r},a.copy=function(){return G_().domain(e).range(i).unknown(r)},nh.apply(a,arguments)}var em=new Date,tm=new Date;function fl(e,i,r,n){function a(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return a.floor=function(s){return e(s=new Date(+s)),s},a.ceil=function(s){return e(s=new Date(s-1)),i(s,1),e(s),s},a.round=function(s){var p=a(s),v=a.ceil(s);return s-p<v-s?p:v},a.offset=function(s,p){return i(s=new Date(+s),p==null?1:Math.floor(p)),s},a.range=function(s,p,v){var g=[],x;if(s=a.ceil(s),v=v==null?1:Math.floor(v),!(s<p)||!(v>0))return g;do g.push(x=new Date(+s)),i(s,v),e(s);while(x<s&&s<p);return g},a.filter=function(s){return fl(function(p){if(p>=p)for(;e(p),!s(p);)p.setTime(p-1)},function(p,v){if(p>=p)if(v<0)for(;++v<=0;)for(;i(p,-1),!s(p););else for(;--v>=0;)for(;i(p,1),!s(p););})},r&&(a.count=function(s,p){return em.setTime(+s),tm.setTime(+p),e(em),e(tm),Math.floor(r(em,tm))},a.every=function(s){return s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?a.filter(n?function(p){return n(p)%s==0}:function(p){return a.count(0,p)%s==0}):a}),a}var rm=fl(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});rm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:fl(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var vd=rm,dP=rm.range,H_=fl(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),kT=H_,vP=H_.range,tv=1e3,a0=6e4,W_=36e5,X_=864e5,Y_=6048e5;function Uh(e){return fl(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*a0)/Y_})}var nm=Uh(0),rv=Uh(1),DT=Uh(2),FT=Uh(3),md=Uh(4),BT=Uh(5),NT=Uh(6),mP=nm.range,gP=rv.range,yP=DT.range,_P=FT.range,xP=md.range,bP=BT.range,EP=NT.range,q_=fl(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*a0)/X_},function(e){return e.getDate()-1}),im=q_,SP=q_.range,K_=fl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*tv-e.getMinutes()*a0)},function(e,i){e.setTime(+e+i*W_)},function(e,i){return(i-e)/W_},function(e){return e.getHours()}),zT=K_,CP=K_.range,$_=fl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*tv)},function(e,i){e.setTime(+e+i*a0)},function(e,i){return(i-e)/a0},function(e){return e.getMinutes()}),UT=$_,AP=$_.range,Q_=fl(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*tv)},function(e,i){return(i-e)/tv},function(e){return e.getUTCSeconds()}),ZT=Q_,wP=Q_.range,nv=fl(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});nv.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?fl(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):nv};var jT=nv,TP=nv.range;function Zh(e){return fl(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/Y_})}var J_=Zh(0),iv=Zh(1),VT=Zh(2),GT=Zh(3),gd=Zh(4),HT=Zh(5),WT=Zh(6),MP=J_.range,PP=iv.range,IP=VT.range,OP=GT.range,RP=gd.range,LP=HT.range,kP=WT.range,e1=fl(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/X_},function(e){return e.getUTCDate()-1}),t1=e1,DP=e1.range,am=fl(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});am.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:fl(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var o0=am,FP=am.range;function om(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function sm(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function s0(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function XT(e){var i=e.dateTime,r=e.date,n=e.time,a=e.periods,s=e.days,p=e.shortDays,v=e.months,g=e.shortMonths,x=u0(a),C=l0(a),w=u0(s),O=l0(s),D=u0(p),G=l0(p),q=u0(v),te=l0(v),Se=u0(g),ze=l0(g),$e={a:ks,A:Ds,b:Qs,B:ef,c:null,d:s1,e:s1,f:m5,g:w5,G:M5,H:h5,I:d5,j:v5,L:u1,m:g5,M:y5,p:gv,q:C4,Q:d1,s:v1,S:_5,u:x5,U:b5,V:E5,w:S5,W:C5,x:null,X:null,y:A5,Y:T5,Z:P5,"%":h1},at={a:A4,A:w4,b:T4,B:M4,c:null,d:c1,e:c1,f:L5,g:V5,G:H5,H:I5,I:O5,j:R5,L:f1,m:k5,M:D5,p:P4,q:I4,Q:d1,s:v1,S:F5,u:B5,U:N5,V:z5,w:U5,W:Z5,x:null,X:null,y:j5,Y:G5,Z:W5,"%":h1},Et={a:tn,A:wr,b:xn,B:Tn,c:$n,d:a1,e:a1,f:l5,g:i1,G:n1,H:o1,I:o1,j:a5,L:u5,m:i5,M:o5,p:Dr,q:n5,Q:f5,s:p5,S:s5,u:QT,U:JT,V:e5,w:$T,W:t5,x:Ga,X:as,y:i1,Y:n1,Z:r5,"%":c5};$e.x=Tt(r,$e),$e.X=Tt(n,$e),$e.c=Tt(i,$e),at.x=Tt(r,at),at.X=Tt(n,at),at.c=Tt(i,at);function Tt(si,Na){return function(oo){var bn=[],Tl=-1,Yo=0,Yl=si.length,ql,Gh,ob;for(oo instanceof Date||(oo=new Date(+oo));++Tl<Yl;)si.charCodeAt(Tl)===37&&(bn.push(si.slice(Yo,Tl)),(Gh=r1[ql=si.charAt(++Tl)])!=null?ql=si.charAt(++Tl):Gh=ql==="e"?" ":"0",(ob=Na[ql])&&(ql=ob(oo,Gh)),bn.push(ql),Yo=Tl+1);return bn.push(si.slice(Yo,Tl)),bn.join("")}}function Jt(si,Na){return function(oo){var bn=s0(1900,void 0,1),Tl=fr(bn,si,oo+="",0),Yo,Yl;if(Tl!=oo.length)return null;if("Q"in bn)return new Date(bn.Q);if("s"in bn)return new Date(bn.s*1e3+("L"in bn?bn.L:0));if(Na&&!("Z"in bn)&&(bn.Z=0),"p"in bn&&(bn.H=bn.H%12+bn.p*12),bn.m===void 0&&(bn.m="q"in bn?bn.q:0),"V"in bn){if(bn.V<1||bn.V>53)return null;"w"in bn||(bn.w=1),"Z"in bn?(Yo=sm(s0(bn.y,0,1)),Yl=Yo.getUTCDay(),Yo=Yl>4||Yl===0?iv.ceil(Yo):iv(Yo),Yo=t1.offset(Yo,(bn.V-1)*7),bn.y=Yo.getUTCFullYear(),bn.m=Yo.getUTCMonth(),bn.d=Yo.getUTCDate()+(bn.w+6)%7):(Yo=om(s0(bn.y,0,1)),Yl=Yo.getDay(),Yo=Yl>4||Yl===0?rv.ceil(Yo):rv(Yo),Yo=im.offset(Yo,(bn.V-1)*7),bn.y=Yo.getFullYear(),bn.m=Yo.getMonth(),bn.d=Yo.getDate()+(bn.w+6)%7)}else("W"in bn||"U"in bn)&&("w"in bn||(bn.w="u"in bn?bn.u%7:"W"in bn?1:0),Yl="Z"in bn?sm(s0(bn.y,0,1)).getUTCDay():om(s0(bn.y,0,1)).getDay(),bn.m=0,bn.d="W"in bn?(bn.w+6)%7+bn.W*7-(Yl+5)%7:bn.w+bn.U*7-(Yl+6)%7);return"Z"in bn?(bn.H+=bn.Z/100|0,bn.M+=bn.Z%100,sm(bn)):om(bn)}}function fr(si,Na,oo,bn){for(var Tl=0,Yo=Na.length,Yl=oo.length,ql,Gh;Tl<Yo;){if(bn>=Yl)return-1;if(ql=Na.charCodeAt(Tl++),ql===37){if(ql=Na.charAt(Tl++),Gh=Et[ql in r1?Na.charAt(Tl++):ql],!Gh||(bn=Gh(si,oo,bn))<0)return-1}else if(ql!=oo.charCodeAt(bn++))return-1}return bn}function Dr(si,Na,oo){var bn=x.exec(Na.slice(oo));return bn?(si.p=C[bn[0].toLowerCase()],oo+bn[0].length):-1}function tn(si,Na,oo){var bn=D.exec(Na.slice(oo));return bn?(si.w=G[bn[0].toLowerCase()],oo+bn[0].length):-1}function wr(si,Na,oo){var bn=w.exec(Na.slice(oo));return bn?(si.w=O[bn[0].toLowerCase()],oo+bn[0].length):-1}function xn(si,Na,oo){var bn=Se.exec(Na.slice(oo));return bn?(si.m=ze[bn[0].toLowerCase()],oo+bn[0].length):-1}function Tn(si,Na,oo){var bn=q.exec(Na.slice(oo));return bn?(si.m=te[bn[0].toLowerCase()],oo+bn[0].length):-1}function $n(si,Na,oo){return fr(si,i,Na,oo)}function Ga(si,Na,oo){return fr(si,r,Na,oo)}function as(si,Na,oo){return fr(si,n,Na,oo)}function ks(si){return p[si.getDay()]}function Ds(si){return s[si.getDay()]}function Qs(si){return g[si.getMonth()]}function ef(si){return v[si.getMonth()]}function gv(si){return a[+(si.getHours()>=12)]}function C4(si){return 1+~~(si.getMonth()/3)}function A4(si){return p[si.getUTCDay()]}function w4(si){return s[si.getUTCDay()]}function T4(si){return g[si.getUTCMonth()]}function M4(si){return v[si.getUTCMonth()]}function P4(si){return a[+(si.getUTCHours()>=12)]}function I4(si){return 1+~~(si.getUTCMonth()/3)}return{format:function(si){var Na=Tt(si+="",$e);return Na.toString=function(){return si},Na},parse:function(si){var Na=Jt(si+="",!1);return Na.toString=function(){return si},Na},utcFormat:function(si){var Na=Tt(si+="",at);return Na.toString=function(){return si},Na},utcParse:function(si){var Na=Jt(si+="",!0);return Na.toString=function(){return si},Na}}}var r1={"-":"",_:" ","0":"0"},gu=/^\s*\d+/,YT=/^%/,qT=/[\\^$*+?|[\]().{}]/g;function ao(e,i,r){var n=e<0?"-":"",a=(n?-e:e)+"",s=a.length;return n+(s<r?new Array(r-s+1).join(i)+a:a)}function KT(e){return e.replace(qT,"\\$&")}function u0(e){return new RegExp("^(?:"+e.map(KT).join("|")+")","i")}function l0(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function $T(e,i,r){var n=gu.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function QT(e,i,r){var n=gu.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function JT(e,i,r){var n=gu.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function e5(e,i,r){var n=gu.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function t5(e,i,r){var n=gu.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function n1(e,i,r){var n=gu.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function i1(e,i,r){var n=gu.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function r5(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function n5(e,i,r){var n=gu.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function i5(e,i,r){var n=gu.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function a1(e,i,r){var n=gu.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function a5(e,i,r){var n=gu.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function o1(e,i,r){var n=gu.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function o5(e,i,r){var n=gu.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function s5(e,i,r){var n=gu.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function u5(e,i,r){var n=gu.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function l5(e,i,r){var n=gu.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function c5(e,i,r){var n=YT.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function f5(e,i,r){var n=gu.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function p5(e,i,r){var n=gu.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function s1(e,i){return ao(e.getDate(),i,2)}function h5(e,i){return ao(e.getHours(),i,2)}function d5(e,i){return ao(e.getHours()%12||12,i,2)}function v5(e,i){return ao(1+im.count(vd(e),e),i,3)}function u1(e,i){return ao(e.getMilliseconds(),i,3)}function m5(e,i){return u1(e,i)+"000"}function g5(e,i){return ao(e.getMonth()+1,i,2)}function y5(e,i){return ao(e.getMinutes(),i,2)}function _5(e,i){return ao(e.getSeconds(),i,2)}function x5(e){var i=e.getDay();return i===0?7:i}function b5(e,i){return ao(nm.count(vd(e)-1,e),i,2)}function l1(e){var i=e.getDay();return i>=4||i===0?md(e):md.ceil(e)}function E5(e,i){return e=l1(e),ao(md.count(vd(e),e)+(vd(e).getDay()===4),i,2)}function S5(e){return e.getDay()}function C5(e,i){return ao(rv.count(vd(e)-1,e),i,2)}function A5(e,i){return ao(e.getFullYear()%100,i,2)}function w5(e,i){return e=l1(e),ao(e.getFullYear()%100,i,2)}function T5(e,i){return ao(e.getFullYear()%1e4,i,4)}function M5(e,i){var r=e.getDay();return e=r>=4||r===0?md(e):md.ceil(e),ao(e.getFullYear()%1e4,i,4)}function P5(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+ao(i/60|0,"0",2)+ao(i%60,"0",2)}function c1(e,i){return ao(e.getUTCDate(),i,2)}function I5(e,i){return ao(e.getUTCHours(),i,2)}function O5(e,i){return ao(e.getUTCHours()%12||12,i,2)}function R5(e,i){return ao(1+t1.count(o0(e),e),i,3)}function f1(e,i){return ao(e.getUTCMilliseconds(),i,3)}function L5(e,i){return f1(e,i)+"000"}function k5(e,i){return ao(e.getUTCMonth()+1,i,2)}function D5(e,i){return ao(e.getUTCMinutes(),i,2)}function F5(e,i){return ao(e.getUTCSeconds(),i,2)}function B5(e){var i=e.getUTCDay();return i===0?7:i}function N5(e,i){return ao(J_.count(o0(e)-1,e),i,2)}function p1(e){var i=e.getUTCDay();return i>=4||i===0?gd(e):gd.ceil(e)}function z5(e,i){return e=p1(e),ao(gd.count(o0(e),e)+(o0(e).getUTCDay()===4),i,2)}function U5(e){return e.getUTCDay()}function Z5(e,i){return ao(iv.count(o0(e)-1,e),i,2)}function j5(e,i){return ao(e.getUTCFullYear()%100,i,2)}function V5(e,i){return e=p1(e),ao(e.getUTCFullYear()%100,i,2)}function G5(e,i){return ao(e.getUTCFullYear()%1e4,i,4)}function H5(e,i){var r=e.getUTCDay();return e=r>=4||r===0?gd(e):gd.ceil(e),ao(e.getUTCFullYear()%1e4,i,4)}function W5(){return"+0000"}function h1(){return"%"}function d1(e){return+e}function v1(e){return Math.floor(+e/1e3)}var yd,m1,X5,Y5,q5;K5({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function K5(e){return yd=XT(e),m1=yd.format,X5=yd.parse,Y5=yd.utcFormat,q5=yd.utcParse,yd}var c0=1e3,f0=c0*60,p0=f0*60,h0=p0*24,$5=h0*7,g1=h0*30,um=h0*365;function Q5(e){return new Date(e)}function J5(e){return e instanceof Date?+e:+new Date(+e)}function y1(e,i,r,n,a,s,p,v,g){var x=C_(Cc,Cc),C=x.invert,w=x.domain,O=g(".%L"),D=g(":%S"),G=g("%I:%M"),q=g("%I %p"),te=g("%a %d"),Se=g("%b %d"),ze=g("%B"),$e=g("%Y"),at=[[p,1,c0],[p,5,5*c0],[p,15,15*c0],[p,30,30*c0],[s,1,f0],[s,5,5*f0],[s,15,15*f0],[s,30,30*f0],[a,1,p0],[a,3,3*p0],[a,6,6*p0],[a,12,12*p0],[n,1,h0],[n,2,2*h0],[r,1,$5],[i,1,g1],[i,3,3*g1],[e,1,um]];function Et(Jt){return(p(Jt)<Jt?O:s(Jt)<Jt?D:a(Jt)<Jt?G:n(Jt)<Jt?q:i(Jt)<Jt?r(Jt)<Jt?te:Se:e(Jt)<Jt?ze:$e)(Jt)}function Tt(Jt,fr,Dr,tn){if(Jt==null&&(Jt=10),typeof Jt=="number"){var wr=Math.abs(Dr-fr)/Jt,xn=f_(function(Tn){return Tn[2]}).right(at,wr);xn===at.length?(tn=Wv(fr/um,Dr/um,Jt),Jt=e):xn?(xn=at[wr/at[xn-1][2]<at[xn][2]/wr?xn-1:xn],tn=xn[1],Jt=xn[0]):(tn=Math.max(Wv(fr,Dr,Jt),1),Jt=v)}return tn==null?Jt:Jt.every(tn)}return x.invert=function(Jt){return new Date(C(Jt))},x.domain=function(Jt){return arguments.length?w(Y0.call(Jt,J5)):w().map(Q5)},x.ticks=function(Jt,fr){var Dr=w(),tn=Dr[0],wr=Dr[Dr.length-1],xn=wr<tn,Tn;return xn&&(Tn=tn,tn=wr,wr=Tn),Tn=Tt(Jt,tn,wr,fr),Tn=Tn?Tn.range(tn,wr+1):[],xn?Tn.reverse():Tn},x.tickFormat=function(Jt,fr){return fr==null?Et:g(fr)},x.nice=function(Jt,fr){var Dr=w();return(Jt=Tt(Jt,Dr[0],Dr[Dr.length-1],fr))?w(k_(Dr,Jt)):x},x.copy=function(){return K0(x,y1(e,i,r,n,a,s,p,v,g))},x}function eM(){return nh.apply(y1(vd,kT,nm,im,zT,UT,ZT,jT,m1).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function BP(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function av(){var e=0,i=1,r,n,a,s,p=identity,v=!1,g;function x(C){return isNaN(C=+C)?g:p(a===0?.5:(C=(s(C)-r)*a,v?Math.max(0,Math.min(1,C)):C))}return x.domain=function(C){return arguments.length?(r=s(e=+C[0]),n=s(i=+C[1]),a=r===n?0:1/(n-r),x):[e,i]},x.clamp=function(C){return arguments.length?(v=!!C,x):v},x.interpolator=function(C){return arguments.length?(p=C,x):p},x.unknown=function(C){return arguments.length?(g=C,x):g},function(C){return s=C,r=C(e),n=C(i),a=r===n?0:1/(n-r),x}}function ov(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function tM(){var e=linearish(av()(identity));return e.copy=function(){return ov(e,tM())},initInterpolator.apply(e,arguments)}function rM(){var e=loggish(av()).domain([1,10]);return e.copy=function(){return ov(e,rM()).base(e.base())},initInterpolator.apply(e,arguments)}function nM(){var e=symlogish(av());return e.copy=function(){return ov(e,nM()).constant(e.constant())},initInterpolator.apply(e,arguments)}function _1(){var e=powish(av());return e.copy=function(){return ov(e,_1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function NP(){return _1.apply(null,arguments).exponent(.5)}function iM(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var a=0,s=n.length,p;a<s;++a)p=n[a],p!=null&&!isNaN(p=+p)&&e.push(p);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return iM(i).domain(e)},initInterpolator.apply(r,arguments)}function sv(){var e=0,i=.5,r=1,n,a,s,p,v,g=identity,x,C=!1,w;function O(D){return isNaN(D=+D)?w:(D=.5+((D=+x(D))-a)*(D<a?p:v),g(C?Math.max(0,Math.min(1,D)):D))}return O.domain=function(D){return arguments.length?(n=x(e=+D[0]),a=x(i=+D[1]),s=x(r=+D[2]),p=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),O):[e,i,r]},O.clamp=function(D){return arguments.length?(C=!!D,O):C},O.interpolator=function(D){return arguments.length?(g=D,O):g},O.unknown=function(D){return arguments.length?(w=D,O):w},function(D){return x=D,n=D(e),a=D(i),s=D(r),p=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),O}}function aM(){var e=linearish(sv()(identity));return e.copy=function(){return copy(e,aM())},initInterpolator.apply(e,arguments)}function oM(){var e=loggish(sv()).domain([.1,1,10]);return e.copy=function(){return copy(e,oM()).base(e.base())},initInterpolator.apply(e,arguments)}function sM(){var e=symlogish(sv());return e.copy=function(){return copy(e,sM()).constant(e.constant())},initInterpolator.apply(e,arguments)}function x1(){var e=powish(sv());return e.copy=function(){return copy(e,x1()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function zP(){return x1.apply(null,arguments).exponent(.5)}var Qc,b1,E1,S1,lm,C1,uM=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,lM=(Qc={},(0,I.Z)(Qc,ou.LINEAR,R_),(0,I.Z)(Qc,ou.POWER,Jv),(0,I.Z)(Qc,ou.LOG,N_),(0,I.Z)(Qc,ou.IDENTITY,L_),(0,I.Z)(Qc,ou.TIME,eM),(0,I.Z)(Qc,ou.QUANTILE,j_),(0,I.Z)(Qc,ou.QUANTIZE,V_),(0,I.Z)(Qc,ou.THRESHOLD,G_),(0,I.Z)(Qc,ou.CAT,q0),Qc),cM=(b1=(0,Ur.b2)(),E1=(0,Ur.f3)(qt.IGlobalConfigService),b1(S1=(lm=function(){function e(){(0,ot.Z)(this,e),fi(this,"configService",C1,this),(0,I.Z)(this,"scaleCache",{}),(0,I.Z)(this,"scaleOptions",{})}return(0,wt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;v.length!==0&&a.caculateScalesForAttributes(p||[],v)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;return a.caculateScalesForAttributes(p||[],v),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){a.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes();if(p){var v=r.getSource().data.dataArray;if(v.length===0)return;var g=p.filter(function(x){return x.needRescale});g.length&&a.caculateScalesForAttributes(g,v)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var a=this;this.scaleCache={},r.forEach(function(s){if(s.scale){var p=s.scale,v=s.name;p.names=a.parseFields(s.scale.field||[]);var g=[];p.names.forEach(function(x){g.push(a.getOrCreateScale(x,s,n))}),g.some(function(x){return x.type===Kp.VARIABLE})?(p.type=Kp.VARIABLE,g.forEach(function(x){if(!p.callback){var C;if(p.values&&p.values!=="text"){var w;if(((w=x.option)===null||w===void 0?void 0:w.type)==="linear"&&p.values.length>2){var O=x.scale.ticks(p.values.length);v==="color"&&x.scale.domain(O)}x.scale.range(p.values)}else((C=x.option)===null||C===void 0?void 0:C.type)==="cat"&&x.scale.range(x.option.domain)}})):(p.type=Kp.CONSTANT,p.defaultValues=g.map(function(x,C){return x.scale(p.names[C])})),p.scalers=g.map(function(x){return{field:x.field,func:x.scale,option:x.option}}),s.needRescale=!1}})}},{key:"getOrCreateScale",value:function(r,n,a){var s,p=[r,n.name].join("_"),v=(s=n.scale)===null||s===void 0?void 0:s.values,g=this.createScale(r,n.name,v,a);return g}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:ua()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,a,s){var p,v,g=this.scaleOptions[n]&&((p=this.scaleOptions[n])===null||p===void 0?void 0:p.field)===r?this.scaleOptions[n]:this.scaleOptions[r],x={field:r,scale:void 0,type:Kp.VARIABLE,option:g};if(!s||!s.length)return g&&g.type?x.scale=this.createDefaultScale(g):(x.scale=q0([r]),x.type=Kp.CONSTANT),x;var C=(v=s.find(function(D){return!Al()(D[r])}))===null||v===void 0?void 0:v[r];if(this.isNumber(r)||Al()(C)&&!g)x.scale=q0([r]),x.type=Kp.CONSTANT;else{var w=g&&g.type||this.getDefaultType(C);a==="text"&&(w=ou.CAT);var O=this.createDefaultScaleConfig(w,r,s);Object.assign(O,g),x.scale=this.createDefaultScale(O),x.option=O}return x}},{key:"getDefaultType",value:function(r){var n=ou.LINEAR;return typeof r=="string"&&(n=uM.test(r)?ou.TIME:ou.CAT),n}},{key:"createDefaultScaleConfig",value:function(r,n,a){var s={type:r},p=(a==null?void 0:a.map(function(v){return v[n]}))||[];return r!==ou.CAT&&r!==ou.QUANTILE?s.domain=Jw(p):r===ou.CAT?s.domain=id()(p):r===ou.QUANTILE&&(s.domain=p),s}},{key:"createDefaultScale",value:function(r){var n=r.type,a=r.domain,s=lM[n]();return a&&s.domain(a),s}}]),e}(),C1=Hn(lm.prototype,"configService",[E1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lm))||S1),A1,w1,T1,M1,uv,P1,I1;function O1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function fM(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?O1(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var pM=(A1=(0,Ur.b2)(),w1=(0,Ur.f3)(qt.ICameraService),T1=(0,Ur.f3)(qt.IRendererService),A1(M1=(uv=function(){function e(){(0,ot.Z)(this,e),fi(this,"cameraService",P1,this),fi(this,"rendererService",I1,this)}return(0,wt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(n){n.addUniforms(fM({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),P1=Hn(uv.prototype,"cameraService",[w1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I1=Hn(uv.prototype,"rendererService",[T1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uv))||M1),R1,L1,hM=(R1=(0,Ur.b2)(),R1(L1=function(){function e(){(0,ot.Z)(this,e)}return(0,wt.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||L1),k1,D1,dM=(k1=(0,Ur.b2)(),k1(D1=function(){function e(){(0,ot.Z)(this,e)}return(0,wt.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var n=r.getLayerConfig(),a=n.autoFit,s=n.fitBoundsOptions;a&&setTimeout(function(){r.fitBounds(s)},100)})}}]),e}())||D1),F1,B1,vM=["type"];function N1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function d0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?N1(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var z1={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},mM={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},gM={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},yM={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},UP=null;function _M(e){var i={u_DirectionalLights:new Array(3).fill(d0({},gM)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(d0({},yM)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[mM]),e.forEach(function(r,n){var a=r.type,s=a===void 0?"directional":a,p=(0,gc.Z)(r,vM),v=z1[s].lights,g=z1[s].num,x=i[g];i[v][x]=d0(d0({},i[v][x]),p),i[g]++}),i}var xM=(F1=(0,Ur.b2)(),F1(B1=function(){function e(){(0,ot.Z)(this,e)}return(0,wt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),a=n.enableLighting;a&&r.models.forEach(function(s){return s.addUniforms(d0({},_M()))})})}}]),e}())||B1),U1,Z1,j1,cm,V1,bM=(U1=(0,Ur.b2)(),Z1=(0,Ur.f3)(qt.IGlobalConfigService),U1(j1=(cm=function(){function e(){(0,ot.Z)(this,e),fi(this,"configService",V1,this),(0,I.Z)(this,"enabled",void 0)}return(0,wt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.rendererService,p=n.postProcessingPassFactory,v=n.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var g=r.getLayerConfig(),x=g.enableMultiPassRenderer,C=g.passes,w=C===void 0?[]:C;a.enabled=!!x&&r.getLayerConfig().enableMultiPassRenderer!==!1,a.enabled&&(r.multiPassRenderer=jg(r,w,p,v),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(a.enabled){var g=s.getViewportSize(),x=g.width,C=g.height;r.multiPassRenderer.resize(x,C)}})}}]),e}(),V1=Hn(cm.prototype,"configService",[Z1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cm))||j1),G1,H1,lv={NONE:0,ENCODE:1,HIGHLIGHT:2},EM=(G1=(0,Ur.b2)(),G1(H1=function(){function e(){(0,ot.Z)(this,e)}return(0,wt.Z)(e,[{key:"apply",value:function(r,n){var a=n.rendererService,s=n.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var p=!0;s.registerStyleAttribute({name:"pickingColor",type:On.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:V.FLOAT},size:3,update:function(g,x){var C=g.id;return p?et(C):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var p=r.getLayerConfig(),v=p.enablePicking;v&&r.isVisible()&&r.models.forEach(function(g){return g.addUniforms({u_PickingStage:lv.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var p=r.getLayerConfig(),v=p.enablePicking;v&&r.isVisible()&&r.models.forEach(function(g){return g.addUniforms({u_PickingStage:lv.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(p){var v=r.getLayerConfig(),g=v.highlightColor,x=v.activeMix,C=x===void 0?0:x,w=typeof g=="string"?be(g):g||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:je(new Uint8Array(p))}),r.models.forEach(function(O){return O.addUniforms({u_PickingStage:lv.HIGHLIGHT,u_PickingColor:p,u_HighlightColor:w.map(function(D){return D*255}),u_activeMix:C})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(p){var v=r.getLayerConfig(),g=v.selectColor,x=v.selectMix,C=x===void 0?0:x,w=typeof g=="string"?be(g):g||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:je(new Uint8Array(p))}),r.models.forEach(function(O){return O.addUniforms({u_PickingStage:lv.HIGHLIGHT,u_PickingColor:p,u_HighlightColor:w.map(function(D){return D*255}),u_activeMix:C,u_CurrentSelectedId:p,u_SelectColor:w.map(function(D){return D*255}),u_EnableSelect:1})})})}}]),e}())||H1),W1,X1,SM=(W1=(0,Ur.b2)(),W1(X1=function(){function e(){(0,ot.Z)(this,e)}return(0,wt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){a.registerBuiltinAttributes(s)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:On.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:V.FLOAT},size:3,update:function(a,s,p){return p.length===2?[p[0],p[1],0]:[p[0],p[1],p[2]]}}}),r.registerStyleAttribute({name:"filter",type:On.Attribute,descriptor:{name:"filter",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(a,s){var p=a.filter;return p?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:On.Attribute,descriptor:{name:"a_Color",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:4,update:function(a,s){var p=a.color;return!p||!p.length?[1,1,1,1]:p}}}),r.registerStyleAttribute({name:"vertexId",type:On.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:V.DYNAMIC_DRAW,data:[],type:V.FLOAT},size:1,update:function(a,s,p,v){return[s]}}})}}]),e}())||X1),Y1,q1,K1,$1,Q1,J1,_d,ex,tx,rx,nx,CM=(Y1=(0,Ur.b2)(),q1=(0,Ur.f3)(qt.ICameraService),K1=(0,Ur.f3)(qt.ICoordinateSystemService),$1=(0,Ur.f3)(qt.IRendererService),Q1=(0,Ur.f3)(qt.IMapService),Y1(J1=(_d=function(){function e(){(0,ot.Z)(this,e),fi(this,"cameraService",ex,this),fi(this,"coordinateSystemService",tx,this),fi(this,"rendererService",rx,this),fi(this,"mapService",nx,this)}return(0,wt.Z)(e,[{key:"apply",value:function(r){var n=this,a=this.mapService.version,s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],p=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){n.coordinateSystemService.refresh(),a==="GAODE2.x"&&(s=n.mapService.map.customCoords.getMVPMatrix(),p=n.mapService.getCustomCoordCenter());var v=n.rendererService.getViewportSize(),g=v.width,x=v.height;r.models.forEach(function(C){var w;C.addUniforms((w={},(0,I.Z)(w,Rh.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,I.Z)(w,Rh.ViewMatrix,n.cameraService.getViewMatrix()),(0,I.Z)(w,Rh.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,I.Z)(w,Rh.Zoom,n.cameraService.getZoom()),(0,I.Z)(w,Rh.ZoomScale,n.cameraService.getZoomScale()),(0,I.Z)(w,Rh.FocalDistance,n.cameraService.getFocalDistance()),(0,I.Z)(w,Rh.CameraPosition,n.cameraService.getCameraPosition()),(0,I.Z)(w,Pn.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,I.Z)(w,Pn.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,I.Z)(w,Pn.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,I.Z)(w,Pn.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,I.Z)(w,Pn.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,I.Z)(w,Pn.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,I.Z)(w,Pn.Mvp,s),(0,I.Z)(w,"u_SceneCenterMKT",p),(0,I.Z)(w,"u_ViewportSize",[g,x]),(0,I.Z)(w,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,I.Z)(w,"u_DevicePixelRatio",Ea.devicePixelRatio),(0,I.Z)(w,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,I.Z)(w,"u_shaderPick",Number(r.getShaderPickStat())),w))})})}}]),e}(),ex=Hn(_d.prototype,"cameraService",[q1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tx=Hn(_d.prototype,"coordinateSystemService",[K1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rx=Hn(_d.prototype,"rendererService",[$1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nx=Hn(_d.prototype,"mapService",[Q1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_d))||J1),ix,ax,AM=(ix=(0,Ur.b2)(),ix(ax=function(){function e(){(0,ot.Z)(this,e)}return(0,wt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||ax),ox,sx,wM=(ox=(0,Ur.b2)(),ox(sx=function(){function e(){(0,ot.Z)(this,e)}return(0,wt.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){a.initStyleAttribute(r,{styleAttributeService:s})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||a.updateStyleAtrribute(r,{styleAttributeService:s})})}},{key:"updateStyleAtrribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[],p=a.getLayerStyleAttribute("filter"),v=a.getLayerStyleAttribute("shape");if(p&&p.needRegenerateVertices){r.layerModelNeedUpdate=!0,s.forEach(function(g){return g.needRegenerateVertices=!1});return}s.filter(function(g){return g.needRegenerateVertices}).forEach(function(g){a.updateAttributeByFeatureRange(g.name,r.getEncodedData(),g.featureRange.startIndex,g.featureRange.endIndex),g.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[];s.filter(function(p){return p.needRegenerateVertices}).forEach(function(p){a.updateAttributeByFeatureRange(p.name,r.getEncodedData(),p.featureRange.startIndex,p.featureRange.endIndex),p.needRegenerateVertices=!1})}}]),e}())||sx);Xl.bind(qt.ILayerPlugin).to(Kw).inRequestScope(),Xl.bind(qt.ILayerPlugin).to(SM).inRequestScope(),Xl.bind(qt.ILayerPlugin).to(cM).inRequestScope(),Xl.bind(qt.ILayerPlugin).to(qw).inRequestScope(),Xl.bind(qt.ILayerPlugin).to(dM).inRequestScope(),Xl.bind(qt.ILayerPlugin).to(wM).inRequestScope(),Xl.bind(qt.ILayerPlugin).to(AM).inRequestScope(),Xl.bind(qt.ILayerPlugin).to(bM).inRequestScope(),Xl.bind(qt.ILayerPlugin).to(CM).inRequestScope(),Xl.bind(qt.ILayerPlugin).to(pM).inRequestScope(),Xl.bind(qt.ILayerPlugin).to(xM).inRequestScope(),Xl.bind(qt.ILayerPlugin).to(EM).inRequestScope(),Xl.bind(qt.ILayerPlugin).to(hM).inRequestScope();var ZP="2.8.35";function ux(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function jP(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ux(Object(r),!0).forEach(function(n){TM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ux(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function TM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function VP(e,i){return OM(e)||IM(e,i)||PM(e,i)||MM()}function MM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function PM(e,i){if(!!e){if(typeof e=="string")return lx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return lx(e,i)}}function lx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function IM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function OM(e){if(Array.isArray(e))return e}var GP=null,HP=null,cx,fm,fx;function px(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function hx(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?px(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):px(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var RM=(cx=kv(qt.IGlobalConfigService),fm=function(){function e(i){(0,ot.Z)(this,e),fi(this,"configService",fx,this),(0,I.Z)(this,"config",void 0),this.config=i}return(0,wt.Z)(e,[{key:"setContainer",value:function(r,n,a,s){r.bind(qt.MapConfig).toConstantValue(hx(hx({},this.config),{},{id:n,canvas:a,hasBaseMap:s})),r.bind(qt.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),fx=Hn(fm.prototype,"configService",[cx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fm),LM=N(6158),v0=N.n(LM);function m0(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function cv(e,i){var r=S([],i,e);return Wc(r,r,1/r[3]),r}function WP(e,i){var r=e%i;return r<0?i+r:r}function XP(e,i,r){return r*i+(1-r)*e}function jh(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var Jc=Math.PI,dx=Jc/4,gp=Jc/180,vx=180/Jc,pm=512,hm=4003e4,kM=1.5;function mx(e){return Math.pow(2,e)}function DM(e){return Math.log2(e)}function fv(e,i){var r=(0,Q.Z)(e,2),n=r[0],a=r[1];jh(Number.isFinite(n)&&Number.isFinite(i)),jh(Number.isFinite(a)&&a>=-90&&a<=90,"invalid latitude"),i*=pm;var s=n*gp,p=a*gp,v=i*(s+Jc)/(2*Jc),g=i*(Jc-Math.log(Math.tan(dx+p*.5)))/(2*Jc);return[v,g]}function dm(e,i){var r=(0,Q.Z)(e,2),n=r[0],a=r[1];i*=pm;var s=n/i*(2*Jc)-Jc,p=2*(Math.atan(Math.exp(Jc-a/i*(2*Jc)))-dx);return[s*vx,p*vx]}function YP(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*gp);return DM(hm*r)-9}function gx(e){var i=e.latitude,r=e.longitude,n=e.zoom,a=e.scale,s=e.highPrecision,p=s===void 0?!1:s;a=a!==void 0?a:mx(n),jh(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(a));var v={},g=pm*a,x=Math.cos(i*gp),C=g/360,w=C/x,O=g/hm/x;if(v.pixelsPerMeter=[O,-O,O],v.metersPerPixel=[1/O,-1/O,1/O],v.pixelsPerDegree=[C,-w,O],v.degreesPerPixel=[1/C,-1/w,1/O],p){var D=gp*Math.tan(i*gp)/x,G=C*D/2,q=g/hm*D,te=q/w*O;v.pixelsPerDegree2=[0,-G,q],v.pixelsPerMeter2=[te,0,te]}return v}function qP(e,i){var r=_slicedToArray(e,3),n=r[0],a=r[1],s=r[2],p=_slicedToArray(i,3),v=p[0],g=p[1],x=p[2],C=1,w=gx({longitude:n,latitude:a,scale:C,highPrecision:!0}),O=w.pixelsPerMeter,D=w.pixelsPerMeter2,G=fv(e,C);G[0]+=v*(O[0]+D[0]*g),G[1]+=g*(O[1]+D[1]*g);var q=dm(G,C),te=(s||0)+(x||0);return Number.isFinite(s)||Number.isFinite(x)?[q[0],q[1],te]:q}function FM(e){var i=e.height,r=e.pitch,n=e.bearing,a=e.altitude,s=e.center,p=s===void 0?null:s,v=e.flipY,g=v===void 0?!1:v,x=m0();return ir(x,x,[0,0,-a]),dn(x,x,[1,1,1/i]),Er(x,x,-r*gp),Yr(x,x,n*gp),g&&dn(x,x,[1,-1,1]),p&&ir(x,x,Qa.negate([],p)),x}function BM(e){var i=e.width,r=e.height,n=e.altitude,a=n===void 0?kM:n,s=e.pitch,p=s===void 0?0:s,v=e.nearZMultiplier,g=v===void 0?1:v,x=e.farZMultiplier,C=x===void 0?1:x,w=p*gp,O=Math.atan(.5/a),D=Math.sin(O)*a/Math.sin(Math.PI/2-w-O),G=Math.cos(Math.PI/2-w)*D+a;return{fov:2*Math.atan(r/2/a),aspect:i/r,focalDistance:a,near:g,far:G*C}}function NM(e){var i=e.width,r=e.height,n=e.pitch,a=e.altitude,s=e.nearZMultiplier,p=e.farZMultiplier,v=BM({width:i,height:r,altitude:a,pitch:n,nearZMultiplier:s,farZMultiplier:p}),g=v.fov,x=v.aspect,C=v.near,w=v.far,O=ls([],g,x,C,w);return O}function zM(e,i){var r=(0,Q.Z)(e,3),n=r[0],a=r[1],s=r[2],p=s===void 0?0:s;return jh(Number.isFinite(n)&&Number.isFinite(a)&&Number.isFinite(p)),cv(i,[n,a,p,1])}function yx(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,Q.Z)(e,3),a=n[0],s=n[1],p=n[2];if(jh(Number.isFinite(a)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(p)){var v=cv(i,[a,s,p,1]);return v}var g=cv(i,[a,s,0,1]),x=cv(i,[a,s,1,1]),C=g[2],w=x[2],O=C===w?0:((r||0)-C)/(w-C);return xi.t7([],g,x,O)}var _x=m0(),UM=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,a=i.viewMatrix,s=a===void 0?_x:a,p=i.projectionMatrix,v=p===void 0?_x:p;(0,ot.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=s,this.projectionMatrix=v;var g=m0();Xt(g,g,this.projectionMatrix),Xt(g,g,this.viewMatrix),this.viewProjectionMatrix=g;var x=m0();dn(x,x,[this.width/2,-this.height/2,1]),ir(x,x,[1,-1,0]),Xt(x,x,this.viewProjectionMatrix);var C=Rr(m0(),x);if(!C)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=x,this.pixelUnprojectionMatrix=C,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,wt.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&Fi(r.projectionMatrix,this.projectionMatrix)&&Fi(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,p=this.projectPosition(r),v=zM(p,this.pixelProjectionMatrix),g=(0,Q.Z)(v,2),x=g[0],C=g[1],w=s?C:this.height-C;return r.length===2?[x,w]:[x,w,v[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,p=n.targetZ,v=(0,Q.Z)(r,3),g=v[0],x=v[1],C=v[2],w=s?x:this.height-x,O=p&&p*this.pixelsPerMeter,D=yx([g,w,C],this.pixelUnprojectionMatrix,O),G=this.unprojectPosition(D),q=(0,Q.Z)(G,3),te=q[0],Se=q[1],ze=q[2];return Number.isFinite(C)?[te,Se,ze]:Number.isFinite(p)?[te,Se,p]:[te,Se]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),a=(0,Q.Z)(n,2),s=a[0],p=a[1],v=(r[2]||0)*this.pixelsPerMeter;return[s,p,v]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),a=(0,Q.Z)(n,2),s=a[0],p=a[1],v=(r[2]||0)/this.pixelsPerMeter;return[s,p,v]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function ZM(e){var i=e.width,r=e.height,n=e.bounds,a=e.minExtent,s=a===void 0?0:a,p=e.maxZoom,v=p===void 0?24:p,g=e.padding,x=g===void 0?0:g,C=e.offset,w=C===void 0?[0,0]:C,O=(0,Q.Z)(n,2),D=(0,Q.Z)(O[0],2),G=D[0],q=D[1],te=(0,Q.Z)(O[1],2),Se=te[0],ze=te[1];if(Number.isFinite(x)){var $e=x;x={top:$e,bottom:$e,left:$e,right:$e}}else jh(Number.isFinite(x.top)&&Number.isFinite(x.bottom)&&Number.isFinite(x.left)&&Number.isFinite(x.right));var at=new xx({width:i,height:r,longitude:0,latitude:0,zoom:0}),Et=at.project([G,ze]),Tt=at.project([Se,q]),Jt=[Math.max(Math.abs(Tt[0]-Et[0]),s),Math.max(Math.abs(Tt[1]-Et[1]),s)],fr=[i-x.left-x.right-Math.abs(w[0])*2,r-x.top-x.bottom-Math.abs(w[1])*2];jh(fr[0]>0&&fr[1]>0);var Dr=fr[0]/Jt[0],tn=fr[1]/Jt[1],wr=(x.right-x.left)/2/Dr,xn=(x.bottom-x.top)/2/tn,Tn=[(Tt[0]+Et[0])/2+wr,(Tt[1]+Et[1])/2+xn],$n=at.unproject(Tn),Ga=at.zoom+Math.log2(Math.abs(Math.min(Dr,tn)));return{longitude:$n[0],latitude:$n[1],zoom:Math.min(Ga,v)}}var xx=function(e){(0,en.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=n.width,s=n.height,p=n.latitude,v=p===void 0?0:p,g=n.longitude,x=g===void 0?0:g,C=n.zoom,w=C===void 0?0:C,O=n.pitch,D=O===void 0?0:O,G=n.bearing,q=G===void 0?0:G,te=n.altitude,Se=te===void 0?1.5:te,ze=n.nearZMultiplier,$e=n.farZMultiplier;(0,ot.Z)(this,i),a=a||1,s=s||1;var at=mx(w);Se=Math.max(.75,Se);var Et=fv([x,v],at);Et[2]=0;var Tt=NM({width:a,height:s,pitch:D,bearing:q,altitude:Se,nearZMultiplier:ze||1/s,farZMultiplier:$e||1.01}),Jt=FM({height:s,center:Et,pitch:D,bearing:q,altitude:Se,flipY:!0});return r=(0,$r.Z)(this,(0,Rt.Z)(i).call(this,{width:a,height:s,viewMatrix:Jt,projectionMatrix:Tt})),r.latitude=v,r.longitude=x,r.zoom=w,r.pitch=D,r.bearing=q,r.altitude=Se,r.scale=at,r.center=Et,r.pixelsPerMeter=gx((0,he.Z)((0,he.Z)(r))).pixelsPerMeter[2],Object.freeze((0,he.Z)((0,he.Z)(r))),r}return(0,wt.Z)(i,[{key:"projectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return fv(n,a)}},{key:"unprojectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return dm(n,a)}},{key:"getMapCenterByLngLatPosition",value:function(n){var a=n.lngLat,s=n.pos,p=yx(s,this.pixelUnprojectionMatrix),v=fv(a,this.scale),g=xi.IH([],v,xi.tk([],p)),x=xi.IH([],this.center,g);return dm(x,this.scale)}},{key:"getLocationAtPoint",value:function(n){var a=n.lngLat,s=n.pos;return this.getMapCenterByLngLatPosition({lngLat:a,pos:s})}},{key:"fitBounds",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.width,p=this.height,v=ZM(Object.assign({width:s,height:p,bounds:n},a)),g=v.longitude,x=v.latitude,C=v.zoom;return new i({width:s,height:p,longitude:g,latitude:x,zoom:C})}}]),i}(UM),jM=function(){function e(){(0,ot.Z)(this,e),(0,I.Z)(this,"viewport",void 0)}return(0,wt.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,a=r.zoom,s=r.pitch,p=r.bearing,v=r.viewportHeight,g=r.viewportWidth;this.viewport=new xx({width:g,height:v,longitude:n&&n[0],latitude:n&&n[1],zoom:a,pitch:s,bearing:p})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),VM=function(){function e(i){(0,ot.Z)(this,e),(0,I.Z)(this,"size",1e4),this.size=i||1e4}return(0,wt.Z)(e,[{key:"setSize",value:function(r){this.size=r}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(r){return(180+r)/360*this.size}},{key:"mercatorYfromLat",value:function(r){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(r){return r/this.size*360-180}},{key:"latFromMercatorY",value:function(r){var n=180-(1-r/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(r){var n=this.mercatorXfromLng(r[0]),a=this.mercatorYfromLat(r[1]);return[n,a]}},{key:"unproject",value:function(r){var n=this.lngFromMercatorX(r[0]),a=this.latFromMercatorY(r[1]);return[n,a]}}]),e}(),bx={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},GM=["id","attributionControl","style","token","rotation","mapInstance"],Ex,Sx,Cx,Ax,Tx,Mx,xd,Px,Ix,Ox,Rx;function Lx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function HM(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Lx(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Lx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function WM(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),a.appendChild(p),p}}WM(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=v0();var kx={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},XM=0,YM=12,Dx="pk.eyJ1IjoiMTg5Njk5NDg2MTkiLCJhIjoiY2s5OXVzdHlzMDVneDNscDVjdzVmeXl0dyJ9.81SQ5qaJS0xExYLbDZAGpQ",qM=(Ex=(0,Ur.b2)(),Sx=(0,Ur.f3)(qt.MapConfig),Cx=(0,Ur.f3)(qt.IGlobalConfigService),Ax=(0,Ur.f3)(qt.ICoordinateSystemService),Tx=(0,Ur.f3)(qt.IEventEmitter),Ex(Mx=(xd=function(){function e(){var i=this;(0,ot.Z)(this,e),(0,I.Z)(this,"version",Ls.MAPBOX),(0,I.Z)(this,"map",void 0),(0,I.Z)(this,"simpleMapCoord",new VM),(0,I.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),fi(this,"config",Px,this),fi(this,"configService",Ix,this),fi(this,"coordinateSystemService",Ox,this),fi(this,"eventEmitter",Rx,this),(0,I.Z)(this,"viewport",void 0),(0,I.Z)(this,"markerContainer",void 0),(0,I.Z)(this,"cameraChangedCallback",void 0),(0,I.Z)(this,"$mapContainer",void 0),(0,I.Z)(this,"handleCameraChanged",function(){var r=i.map.getCenter().wrap(),n=r.lat,a=r.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[a,n],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0});var s=i.config.offsetZoom,p=s===void 0?YM:s;i.viewport.getZoom()>p?i.coordinateSystemService.setCoordinateSystem(zr.LNGLAT_OFFSET):i.coordinateSystemService.setCoordinateSystem(zr.LNGLAT),i.cameraChangedCallback(i.viewport)})}return(0,wt.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=va("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,n){D2.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(kx[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(kx[r]||r,n),this.eventEmitter.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r,n){this.panTo([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToCoord",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},a=this.lngLatToMercator(r,0),s=a.x,p=a.y;return[s-n.x,p-n.y]}},{key:"lngLatToMercator",value:function(r,n){var a=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),s=a.x,p=s===void 0?0:s,v=a.y,g=v===void 0?0:v,x=a.z,C=x===void 0?0:x;return{x:p,y:g,z:C}}},{key:"getModelMatrix",value:function(r,n,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},v=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),g=v.meterInMercatorCoordinateUnits(),x=gr();return ir(x,x,Qa.fromValues(v.x-p.x,v.y-p.y,v.z||0-p.z)),dn(x,x,Qa.fromValues(g*s[0],-g*s[1],g*s[2])),Er(x,x,a[0]),Hr(x,x,a[1]),Yr(x,x,a[2]),x}},{key:"init",value:function(){var i=(0,Ta.Z)(di().mark(function n(){var a,s,p,v,g,x,C,w,O,D,G,q,te;return di().wrap(function(ze){for(;;)switch(ze.prev=ze.next){case 0:a=this.config,s=a.id,p=s===void 0?"map":s,v=a.attributionControl,g=v===void 0?!1:v,x=a.style,C=x===void 0?"light":x,w=a.token,O=w===void 0?Dx:w,D=a.rotation,G=D===void 0?0:D,q=a.mapInstance,te=(0,gc.Z)(a,GM),this.viewport=new jM,!q&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),O===Dx&&C!=="blank"&&!window.mapboxgl.accessToken&&!q&&console.warn(this.configService.getSceneWarninfo("MapToken")),!q&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=O),q?(this.map=q,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(p),this.map=new window.mapboxgl.Map(HM({container:this.$mapContainer,style:this.getMapStyle(C),attributionControl:g,bearing:G},te))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return ze.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,n;(r=this.$mapContainer)===null||r===void 0||(n=r.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),p=1;p<a;p++)s[p-1]=arguments[p];(n=this.eventEmitter).emit.apply(n,[r].concat(s))}},{key:"once",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),p=1;p<a;p++)s[p-1]=arguments[p];(n=this.eventEmitter).once.apply(n,[r].concat(s))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(r,n){var a=new(v0()).LngLat(r[0],r[1]),s=new(v0()).LngLat(n[0],n[1]),p=a.distanceTo(s),v=v0().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),g=v0().MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),x=v.x,C=v.y,w=g.x,O=g.y,D=Math.sqrt(Math.pow(x-w,2)+Math.pow(C-O,2))*4194304*2;return D/p}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),a=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return a}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var n=r;typeof r=="string"&&(n=document.getElementById(r));var a=document.createElement("div");return a.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,a.id="l7_mapbox_div"+XM++,n.appendChild(a),a}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:bx[r]?bx[r]:r}}]),e}(),Px=Hn(xd.prototype,"config",[Sx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ix=Hn(xd.prototype,"configService",[Cx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ox=Hn(xd.prototype,"coordinateSystemService",[Ax],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rx=Hn(xd.prototype,"eventEmitter",[Tx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xd))||Mx);function KM(e){var i=$M();return function(){var n=(0,Rt.Z)(e),a;if(i){var s=(0,Rt.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,$r.Z)(this,a)}}function $M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function QM(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),a.appendChild(p),p}}QM(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var JM=function(e){(0,en.Z)(r,e);var i=KM(r);function r(){return(0,ot.Z)(this,r),i.apply(this,arguments)}return(0,wt.Z)(r,[{key:"getServiceConstructor",value:function(){return qM}}]),r}(RM);function Fx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Bx(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Fx(Object(r),!0).forEach(function(n){e3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function e3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function t3(e,i){return a3(e)||i3(e,i)||n3(e,i)||r3()}function r3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function n3(e,i){if(!!e){if(typeof e=="string")return Nx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Nx(e,i)}}function Nx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function i3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function a3(e){if(Array.isArray(e))return e}var o3=Le.memo(function(e){var i=e.style,r=e.className,n=e.map,a=e.option,s=e.onSceneLoaded,p=(0,Le.createRef)(),v=(0,Le.useState)(),g=t3(v,2),x=g[0],C=g[1];return(0,Le.useEffect)(function(){var w=new fS(Bx(Bx({id:p.current},a),{},{map:new JM(n)}));return w.on("loaded",function(){C(w),s&&s(w)}),function(){w.destroy()}},[]),(0,Le.useEffect)(function(){x&&n.style&&x.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,Le.useEffect)(function(){x&&n.zoom&&x.setZoom(n.zoom)},[n.zoom]),(0,Le.useEffect)(function(){x&&n.center&&x.setCenter(n.center)},[JSON.stringify(n.center)]),(0,Le.useEffect)(function(){x&&n.pitch!==void 0&&x.setPitch(n.pitch||0)},[n.pitch]),(0,Le.useEffect)(function(){x&&n.rotation&&x.setRotation(n.rotation)},[n.rotation]),Le.createElement(Cr.Provider,{value:x},(0,Le.createElement)("div",{ref:p,style:i,className:r},x&&e.children))}),s3=o3;function zx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function KP(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?zx(Object(r),!0).forEach(function(n){u3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function u3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function $P(e,i){return p3(e)||f3(e,i)||c3(e,i)||l3()}function l3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function c3(e,i){if(!!e){if(typeof e=="string")return Ux(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ux(e,i)}}function Ux(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function f3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function p3(e){if(Array.isArray(e))return e}var QP=null,JP=null;function Zx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function eI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Zx(Object(r),!0).forEach(function(n){h3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function h3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function tI(e,i){return g3(e)||m3(e,i)||v3(e,i)||d3()}function d3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function v3(e,i){if(!!e){if(typeof e=="string")return jx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jx(e,i)}}function jx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function m3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function g3(e){if(Array.isArray(e))return e}var rI=null,nI=null;function iI(e,i){return b3(e)||x3(e,i)||_3(e,i)||y3()}function y3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _3(e,i){if(!!e){if(typeof e=="string")return Vx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Vx(e,i)}}function Vx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function x3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function b3(e){if(Array.isArray(e))return e}var aI=null,oI=null;function Gx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function sI(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Gx(Object(r),!0).forEach(function(n){E3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function E3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function uI(e,i){if(e==null)return{};var r=S3(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function S3(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var lI=null,Hx=N(73935);function Wx(e,i){return T3(e)||w3(e,i)||A3(e,i)||C3()}function C3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function A3(e,i){if(!!e){if(typeof e=="string")return Xx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xx(e,i)}}function Xx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function w3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function T3(e){if(Array.isArray(e))return e}var Yx=Le.useEffect,qx=Le.useState,M3=/\B([A-Z])/g,P3=function(i){return i.replace(M3,"-$1").toLowerCase()};function cI(e){var i=e.className,r=e.style,n=e.children,a=e.position,s=qx(),p=Wx(s,2),v=p[0],g=p[1],x=useSceneValue(),C=qx(function(){return document.createElement("div")}),w=Wx(C,1),O=w[0];return Yx(function(){var D=new Control({position:a});return D.onAdd=function(){if(i&&(O.className=i),r){var G=Object.keys(r).map(function(q){return"".concat(P3(q),":").concat(r[q])}).join(";");O.style.cssText=G}return O},D.onRemove=function(){},g(D),x.addControl(D),function(){x.removeControl(D)}},[]),Yx(function(){v&&v.setPosition(a||"bottomleft")},[a]),createPortal(n,O)}var Kx=(0,Le.createContext)({});function fI(){return useContext(Kx)}var Df=N(96486),pI=Le.useEffect,I3=Le.memo(function(i){var r=i.layer,n=i.active;return r.active(n.option),null},Df.isEqual),hI=Le.useEffect,O3=Le.memo(function(i){var r=i.layer,n=i.animate;return r.animate(n),null},Df.isEqual),dI=Le.useEffect,R3=Le.memo(function(i){var r=i.layer,n=i.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},Df.isEqual),L3=Le.memo(function(i){var r=i.layer,n=i.filter;return n.field&&r.filter(n.field,n.values),null},Df.isEqual),k3=Le.memo(function(i){var r=i.layer,n=i.scale;return r.scale(n.values),null},Df.isEqual),vI=Le.useEffect,D3=Le.memo(function(i){var r=i.layer,n=i.select;return r.select(n.option),null},Df.isEqual),F3=Le.memo(function(i){var r=i.layer,n=i.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},Df.isEqual),B3=Le.memo(function(i){var r=i.layer,n=i.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},Df.isEqual),N3=["data"];function z3(e,i){if(e==null)return{};var r=U3(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function U3(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var Z3=Le.memo(function(i){var r=i.layer,n=i.source,a=n.data,s=z3(n,N3);return r.inited?r.setData(a,s):r.source(a,s),s.autoFit&&r.fitBounds(s&&s.fitBoundsOptions),null},Df.isEqual),mI=Le.useEffect,j3=Le.memo(function(i){var r=i.layer,n=i.style;return r.style(n),null},Df.isEqual);function V3(e,i){return X3(e)||W3(e,i)||H3(e,i)||G3()}function G3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function H3(e,i){if(!!e){if(typeof e=="string")return $x(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $x(e,i)}}function $x(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function W3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function X3(e){if(Array.isArray(e))return e}var g0=Le.useEffect,Y3=Le.useState;function Qx(e,i){var r=i.source,n=i.color,a=i.shape,s=i.style,p=i.size,v=i.scale,g=i.active,x=i.select,C=i.filter,w=i.animate,O=i.options,D=i.onLayerLoaded,G=Yn(),q=Y3(function(){var ze;switch(e){case"polygonLayer":ze=new Qy(O);break;case"lineLayer":ze=new oA(O);break;case"pointLayer":ze=new uw(O);break;case"heatmapLayer":ze=new YS(O);break;case"rasterLayer":ze=new Xw(O);break;case"imageLayer":ze=new iC(O);break;case"citybuildingLayer":ze=new _S(O);break;default:ze=new Qy(O)}return ze.on("inited",function(){D&&D(ze,G)}),ze}),te=V3(q,1),Se=te[0];return g0(function(){return G.addLayer(Se),function(){G.removeLayer(Se)}},[]),g0(function(){Se.inited&&O&&Se.updateLayerConfig(O)},[O==null?void 0:O.minZoom,O==null?void 0:O.maxZoom,O==null?void 0:O.visible]),g0(function(){Se.inited&&(O==null?void 0:O.zIndex)&&Se.setIndex(O.zIndex)},[O==null?void 0:O.zIndex]),g0(function(){Se.inited&&(O==null?void 0:O.blend)&&Se.setBlend(O.blend)},[O==null?void 0:O.blend]),g0(function(){G.render()}),Le.createElement(Kx.Provider,{value:Se},Le.createElement(Z3,{layer:Se,source:r}),v&&Le.createElement(k3,{layer:Se,scale:v}),n&&Le.createElement(R3,{layer:Se,color:n}),p&&Le.createElement(B3,{layer:Se,size:p}),a&&Le.createElement(F3,{layer:Se,shape:a}),s&&Le.createElement(j3,{layer:Se,style:s}),g&&Le.createElement(I3,{layer:Se,active:g}),x&&Le.createElement(D3,{layer:Se,select:x}),C&&Le.createElement(L3,{layer:Se,filter:C}),w&&Le.createElement(O3,{layer:Se,animate:w}),i.children)}var gI=null,yI=null,Jx=Le.memo(function(i){return Qx("pointLayer",i)}),q3=Le.memo(function(i){return Qx("heatmapLayer",i)}),_I=null,xI=null,bI=null,EI=Le.useEffect,SI=null,CI=null;function pv(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?pv=function(r){return typeof r}:pv=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},pv(e)}function eb(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function hv(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?eb(Object(r),!0).forEach(function(n){K3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eb(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function K3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function $3(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function tb(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Q3(e,i,r){return i&&tb(e.prototype,i),r&&tb(e,r),e}function J3(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&vm(e,i)}function vm(e,i){return vm=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},vm(e,i)}function e4(e){var i=n4();return function(){var n=dv(e),a;if(i){var s=dv(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return t4(this,a)}}function t4(e,i){if(i&&(pv(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return r4(e)}function r4(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function n4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function dv(e){return dv=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},dv(e)}var AI=function(e){J3(r,e);var i=e4(r);function r(n){var a;return $3(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.popup=void 0,a.el=document.createElement("div"),a}return Q3(r,[{key:"componentDidMount",value:function(){var a,s=this.props,p=s.lnglat,v=s.children,g=s.option,x=s.lngLat,C=new Ng(hv(hv({},g),{},{stopPropagation:(a=this.props.option)===null||a===void 0?void 0:a.stopPropagation}));p&&C.setLnglat(p),x&&C.setLnglat(x),v&&C.setDOMContent(this.el),this.popup=C,this.scene.addPopup(C)}},{key:"componentDidUpdate",value:function(a){var s,p,v,g,x,C,w=Array.isArray(a.lnglat)?a.lnglat:[a==null||(s=a.lnglat)===null||s===void 0?void 0:s.lng,a==null||(p=a.lnglat)===null||p===void 0?void 0:p.lat],O=Array.isArray(this.props.lnglat)?this.props.lnglat:[(v=this.props)===null||v===void 0||(g=v.lnglat)===null||g===void 0?void 0:g.lng,(x=this.props)===null||x===void 0||(C=x.lnglat)===null||C===void 0?void 0:C.lat],D=w.toString()!==O.toString();if(D){var G;this.popup.remove(),this.popup=new Ng(hv(hv({},this.props.option),{},{stopPropagation:(G=this.props.option)===null||G===void 0?void 0:G.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var a=this;return Le.createElement(Cr.Consumer,{},function(s){return s&&(a.scene=s),(0,Hx.createPortal)(a.props.children,a.el)})}}]),r}(Le.PureComponent);function vv(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?vv=function(r){return typeof r}:vv=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},vv(e)}function i4(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function rb(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a4(e,i,r){return i&&rb(e.prototype,i),r&&rb(e,r),e}function o4(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&mm(e,i)}function mm(e,i){return mm=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},mm(e,i)}function s4(e){var i=c4();return function(){var n=mv(e),a;if(i){var s=mv(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return u4(this,a)}}function u4(e,i){if(i&&(vv(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return l4(e)}function l4(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c4(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function mv(e){return mv=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},mv(e)}var wI=function(e){o4(r,e);var i=s4(r);function r(n){var a;return i4(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.marker=void 0,a.el=document.createElement("div"),a}return a4(r,[{key:"componentDidMount",value:function(){var a=this.props,s=a.lnglat,p=a.children,v=a.option,g=a.onMarkerLoaded,x=new Lg(v);s&&x.setLnglat(s),p&&x.setElement(this.el),this.marker=x,g&&g(x),this.scene.addMarker(x)}},{key:"componentDidUpdate",value:function(a){var s,p=(a==null?void 0:a.lnglat.toString())!==((s=this.props)===null||s===void 0?void 0:s.lnglat.toString());p&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var a=this;return Le.createElement(Cr.Consumer,{},function(s){return s&&(a.scene=s),(0,Hx.createPortal)(a.props.children,a.el)})}}]),r}(Le.PureComponent),TI=Le.useEffect,MI=null,PI=null,II=Le.useEffect,OI=null,f4=N(83832),vi=N(85893),p4=["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],h4=function(e){(0,St.Z)(r,e);var i=(0,vt.Z)(r);function r(){var n;(0,Xe.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),n.state={data:null,grid:null,loading:!1},n}return(0,ke.Z)(r,[{key:"componentDidMount",value:function(){var n=(0,Te.Z)(Yt().mark(function s(){var p,v,g,x;return Yt().wrap(function(w){for(;;)switch(w.prev=w.next){case 0:return w.next=2,Promise.all([fetch("https://gw.alipayobjects.com/os/bmw-prod/c5dba875-b6ea-4e88-b778-66a862906c93.json").then(function(O){return O.json()}),fetch("https://gw.alipayobjects.com/os/bmw-prod/8990e8b4-c58e-419b-afb9-8ea3daff2dd1.json").then(function(O){return O.json()})]);case 2:p=w.sent,v=(0,Jr.Z)(p,2),g=v[0],x=v[1],this.setState({data:g,grid:x,loading:!0});case 7:case"end":return w.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"render",value:function(){var a=this.state,s=a.data,p=a.grid,v=a.loading;return v===!1?(0,vi.jsx)(f4.Z,{}):(0,vi.jsxs)(s3,{map:{center:[110.19382669582967,50.258134],pitch:0,style:"blank",zoom:1},style:{position:"relative",width:"100%",height:"452px"},children:[p&&(0,vi.jsx)(q3,{source:{data:p,transforms:[{type:"hexagon",size:8e5,field:"capacity",method:"sum"}]},color:{values:"#ddd"},shape:{values:"hexagon"},style:{coverage:.7,opacity:.8}},"1"),s&&[(0,vi.jsx)(Jx,{options:{autoFit:!0},source:{data:s},scale:{values:{color:{field:"cum_conf",type:"quantile"},size:{field:"cum_conf",type:"log"}}},color:{field:"cum_conf",values:p4},shape:{values:"circle"},active:{option:{color:"#0c2c84"}},size:{field:"cum_conf",values:[0,30]},style:{opacity:.8}},"2"),(0,vi.jsx)(Jx,{source:{data:s},color:{values:"#fff"},shape:{field:"Short_Name_ZH",values:"text"},filter:{field:"cum_conf",values:function(x){return x>2e3}},size:{values:12},style:{opacity:1,strokeOpacity:1,strokeWidth:0}},"5")]]})}}]),r}(Le.Component),nb=N(86582),d4=N(93343),v4=N(70499),Vh=N.n(v4);function m4(e){return e*1<10?"0".concat(e):e}function ib(){for(var e=[],i=0;i<24;i+=1)e.push({x:"".concat(m4(i),":00"),y:Math.floor(Math.random()*200)+i*50});return e}var g4=function(e){(0,St.Z)(r,e);var i=(0,vt.Z)(r);function r(){var n;(0,Xe.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),n.state={activeData:ib()},n.timer=void 0,n.requestRef=void 0,n.loopData=function(){n.requestRef=requestAnimationFrame(function(){n.timer=window.setTimeout(function(){n.setState({activeData:ib()},function(){n.loopData()})},1e3)})},n}return(0,ke.Z)(r,[{key:"componentDidMount",value:function(){this.loopData()}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timer),this.requestRef&&cancelAnimationFrame(this.requestRef)}},{key:"render",value:function(){var a=this.state.activeData,s=a===void 0?[]:a;return(0,vi.jsxs)("div",{className:Vh().activeChart,children:[(0,vi.jsx)(ae.Z,{title:"\u76EE\u6807\u8BC4\u4F30",value:"\u6709\u671B\u8FBE\u5230\u9884\u671F"}),(0,vi.jsx)("div",{style:{marginTop:32},children:(0,vi.jsx)(d4.Z,{autoFit:!0,data:s.map(function(p){return p.y}),height:84})}),s&&(0,vi.jsxs)("div",{children:[(0,vi.jsxs)("div",{className:Vh().activeChartGrid,children:[(0,vi.jsxs)("p",{children:[(0,nb.Z)(s).sort()[s.length-1].y+200," \u4EBF\u5143"]}),(0,vi.jsxs)("p",{children:[(0,nb.Z)(s).sort()[Math.floor(s.length/2)].y," \u4EBF\u5143"]})]}),(0,vi.jsx)("div",{className:Vh().dashedLine,children:(0,vi.jsx)("div",{className:Vh().line})}),(0,vi.jsx)("div",{className:Vh().dashedLine,children:(0,vi.jsx)("div",{className:Vh().line})})]}),s&&(0,vi.jsxs)("div",{className:Vh().activeChartLegend,children:[(0,vi.jsx)("span",{children:"00:00"}),(0,vi.jsx)("span",{children:s[Math.floor(s.length/2)].x}),(0,vi.jsx)("span",{children:s[s.length-1].x})]})]})}}]),r}(Le.Component);function y4(){return gm.apply(this,arguments)}function gm(){return gm=(0,Te.Z)(Yt().mark(function e(){return Yt().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,tt.WY)("/api/tags"));case 1:case"end":return r.stop()}},e)})),gm.apply(this,arguments)}var _4=N(19134),ab=N.n(_4),x4=ae.Z.Countdown,b4=Date.now()+1e3*60*60*24*2+1e3*30,E4=function(){var i=(0,tt.QT)(y4),r=i.loading,n=i.data,a=(n==null?void 0:n.list)||[];return(0,vi.jsx)(Kt.Z,{children:(0,vi.jsxs)(vi.Fragment,{children:[(0,vi.jsxs)(j.Z,{gutter:24,children:[(0,vi.jsx)(se.Z,{xl:18,lg:24,md:24,sm:24,xs:24,style:{marginBottom:24},children:(0,vi.jsxs)(m.Z,{title:"\u6D3B\u52A8\u5B9E\u65F6\u4EA4\u6613\u60C5\u51B5",bordered:!1,children:[(0,vi.jsxs)(j.Z,{children:[(0,vi.jsx)(se.Z,{md:6,sm:12,xs:24,children:(0,vi.jsx)(ae.Z,{title:"\u4ECA\u65E5\u4EA4\u6613\u603B\u989D",suffix:"\u5143",value:Br()(124543233).format("0,0")})}),(0,vi.jsx)(se.Z,{md:6,sm:12,xs:24,children:(0,vi.jsx)(ae.Z,{title:"\u9500\u552E\u76EE\u6807\u5B8C\u6210\u7387",value:"92%"})}),(0,vi.jsx)(se.Z,{md:6,sm:12,xs:24,children:(0,vi.jsx)(x4,{title:"\u6D3B\u52A8\u5269\u4F59\u65F6\u95F4",value:b4,format:"HH:mm:ss:SSS"})}),(0,vi.jsx)(se.Z,{md:6,sm:12,xs:24,children:(0,vi.jsx)(ae.Z,{title:"\u6BCF\u79D2\u4EA4\u6613\u603B\u989D",suffix:"\u5143",value:Br()(234).format("0,0")})})]}),(0,vi.jsx)("div",{className:ab().mapChart,children:(0,vi.jsx)(h4,{})})]})}),(0,vi.jsxs)(se.Z,{xl:6,lg:24,md:24,sm:24,xs:24,children:[(0,vi.jsx)(m.Z,{title:"\u6D3B\u52A8\u60C5\u51B5\u9884\u6D4B",style:{marginBottom:24},bordered:!1,children:(0,vi.jsx)(g4,{})}),(0,vi.jsx)(m.Z,{title:"\u5238\u6838\u6548\u7387",style:{marginBottom:24},bodyStyle:{textAlign:"center"},bordered:!1,children:(0,vi.jsx)(dt,{height:180,autoFit:!0,percent:.87,range:{ticks:[0,1/4,2/4,3/4,1]},axis:{label:{formatter:function(p){return Number(p)*100}}},statistic:{content:{content:"\u4F18",style:{color:"#30bf78"}}}})})]})]}),(0,vi.jsxs)(j.Z,{gutter:24,children:[(0,vi.jsx)(se.Z,{xl:12,lg:24,sm:24,xs:24,style:{marginBottom:24},children:(0,vi.jsx)(m.Z,{title:"\u5404\u54C1\u7C7B\u5360\u6BD4",bordered:!1,className:ab().pieCard,children:(0,vi.jsxs)(j.Z,{style:{padding:"16px 0"},children:[(0,vi.jsx)(se.Z,{span:8,children:(0,vi.jsx)(Qe.Z,{autoFit:!0,height:128,percent:.28})}),(0,vi.jsx)(se.Z,{span:8,children:(0,vi.jsx)(Qe.Z,{color:"#5DDECF",autoFit:!0,height:128,percent:.22})}),(0,vi.jsx)(se.Z,{span:8,children:(0,vi.jsx)(Qe.Z,{color:"#2FC25B",autoFit:!0,height:128,percent:.32})})]})})}),(0,vi.jsx)(se.Z,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24},children:(0,vi.jsx)(m.Z,{title:"\u70ED\u95E8\u641C\u7D22",loading:r,bordered:!1,bodyStyle:{overflow:"hidden"},children:(0,vi.jsx)($t,{data:a,autoFit:!0,wordField:"name",weightField:"value",colorField:"name",height:162,wordStyle:{fontSize:[10,20]}})})}),(0,vi.jsx)(se.Z,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24},children:(0,vi.jsx)(m.Z,{title:"\u8D44\u6E90\u5269\u4F59",bodyStyle:{textAlign:"center",fontSize:0},bordered:!1,children:(0,vi.jsx)(xt,{height:161,percent:.35,autoFit:!0,outline:{border:2,distance:4},padding:[0,0,0,0],statistic:{content:{style:{fontSize:"16px"}}}})})})]})]})})},S4=E4},9187:function(Mt){"use strict";Mt.exports=J,Mt.exports.default=J;function J(Te,Xe,ke){ke=ke||2;var St=Xe&&Xe.length,vt=St?Xe[0]*ke:Te.length,zt=N(Te,0,vt,ke,!0),Yt=[];if(!zt||zt.next===zt.prev)return Yt;var Cr,Yn,hn,Ki,Zn,Wn,mi;if(St&&(zt=se(Te,Xe,zt,ke)),Te.length>80*ke){Cr=hn=Te[0],Yn=Ki=Te[1];for(var qn=ke;qn<vt;qn+=ke)Zn=Te[qn],Wn=Te[qn+1],Zn<Cr&&(Cr=Zn),Wn<Yn&&(Yn=Wn),Zn>hn&&(hn=Zn),Wn>Ki&&(Ki=Wn);mi=Math.max(hn-Cr,Ki-Yn),mi=mi!==0?1/mi:0}return ye(zt,Yt,ke,Cr,Yn,mi),Yt}function N(Te,Xe,ke,St,vt){var zt,Yt;if(vt===Jr(Te,Xe,ke,St)>0)for(zt=Xe;zt<ke;zt+=St)Yt=Kt(zt,Te[zt],Te[zt+1],Yt);else for(zt=ke-St;zt>=Xe;zt-=St)Yt=Kt(zt,Te[zt],Te[zt+1],Yt);return Yt&&dt(Yt,Yt.next)&&(Sr(Yt),Yt=Yt.next),Yt}function ue(Te,Xe){if(!Te)return Te;Xe||(Xe=Te);var ke=Te,St;do if(St=!1,!ke.steiner&&(dt(ke,ke.next)||lt(ke.prev,ke,ke.next)===0)){if(Sr(ke),ke=Xe=ke.prev,ke===ke.next)break;St=!0}else ke=ke.next;while(St||ke!==Xe);return Xe}function ye(Te,Xe,ke,St,vt,zt,Yt){if(!!Te){!Yt&&zt&&it(Te,St,vt,zt);for(var Cr=Te,Yn,hn;Te.prev!==Te.next;){if(Yn=Te.prev,hn=Te.next,zt?ve(Te,St,vt,zt):m(Te)){Xe.push(Yn.i/ke),Xe.push(Te.i/ke),Xe.push(hn.i/ke),Sr(Te),Te=hn.next,Cr=hn.next;continue}if(Te=hn,Te===Cr){Yt?Yt===1?(Te=j(ue(Te),Xe,ke),ye(Te,Xe,ke,St,vt,zt,2)):Yt===2&&le(Te,Xe,ke,St,vt,zt):ye(ue(Te),Xe,ke,St,vt,zt,1);break}}}}function m(Te){var Xe=Te.prev,ke=Te,St=Te.next;if(lt(Xe,ke,St)>=0)return!1;for(var vt=Te.next.next;vt!==Te.prev;){if(er(Xe.x,Xe.y,ke.x,ke.y,St.x,St.y,vt.x,vt.y)&&lt(vt.prev,vt,vt.next)>=0)return!1;vt=vt.next}return!0}function ve(Te,Xe,ke,St){var vt=Te.prev,zt=Te,Yt=Te.next;if(lt(vt,zt,Yt)>=0)return!1;for(var Cr=vt.x<zt.x?vt.x<Yt.x?vt.x:Yt.x:zt.x<Yt.x?zt.x:Yt.x,Yn=vt.y<zt.y?vt.y<Yt.y?vt.y:Yt.y:zt.y<Yt.y?zt.y:Yt.y,hn=vt.x>zt.x?vt.x>Yt.x?vt.x:Yt.x:zt.x>Yt.x?zt.x:Yt.x,Ki=vt.y>zt.y?vt.y>Yt.y?vt.y:Yt.y:zt.y>Yt.y?zt.y:Yt.y,Zn=sr(Cr,Yn,Xe,ke,St),Wn=sr(hn,Ki,Xe,ke,St),mi=Te.prevZ,qn=Te.nextZ;mi&&mi.z>=Zn&&qn&&qn.z<=Wn;){if(mi!==Te.prev&&mi!==Te.next&&er(vt.x,vt.y,zt.x,zt.y,Yt.x,Yt.y,mi.x,mi.y)&&lt(mi.prev,mi,mi.next)>=0||(mi=mi.prevZ,qn!==Te.prev&&qn!==Te.next&&er(vt.x,vt.y,zt.x,zt.y,Yt.x,Yt.y,qn.x,qn.y)&&lt(qn.prev,qn,qn.next)>=0))return!1;qn=qn.nextZ}for(;mi&&mi.z>=Zn;){if(mi!==Te.prev&&mi!==Te.next&&er(vt.x,vt.y,zt.x,zt.y,Yt.x,Yt.y,mi.x,mi.y)&&lt(mi.prev,mi,mi.next)>=0)return!1;mi=mi.prevZ}for(;qn&&qn.z<=Wn;){if(qn!==Te.prev&&qn!==Te.next&&er(vt.x,vt.y,zt.x,zt.y,Yt.x,Yt.y,qn.x,qn.y)&&lt(qn.prev,qn,qn.next)>=0)return!1;qn=qn.nextZ}return!0}function j(Te,Xe,ke){var St=Te;do{var vt=St.prev,zt=St.next.next;!dt(vt,zt)&&tr(vt,St,St.next,zt)&&Je(vt,zt)&&Je(zt,vt)&&(Xe.push(vt.i/ke),Xe.push(St.i/ke),Xe.push(zt.i/ke),Sr(St),Sr(St.next),St=Te=zt),St=St.next}while(St!==Te);return ue(St)}function le(Te,Xe,ke,St,vt,zt){var Yt=Te;do{for(var Cr=Yt.next.next;Cr!==Yt.prev;){if(Yt.i!==Cr.i&&It(Yt,Cr)){var Yn=Qe(Yt,Cr);Yt=ue(Yt,Yt.next),Yn=ue(Yn,Yn.next),ye(Yt,Xe,ke,St,vt,zt),ye(Yn,Xe,ke,St,vt,zt);return}Cr=Cr.next}Yt=Yt.next}while(Yt!==Te)}function se(Te,Xe,ke,St){var vt=[],zt,Yt,Cr,Yn,hn;for(zt=0,Yt=Xe.length;zt<Yt;zt++)Cr=Xe[zt]*St,Yn=zt<Yt-1?Xe[zt+1]*St:Te.length,hn=N(Te,Cr,Yn,St,!1),hn===hn.next&&(hn.steiner=!0),vt.push(At(hn));for(vt.sort(Ne),zt=0;zt<vt.length;zt++)ke=ae(vt[zt],ke),ke=ue(ke,ke.next);return ke}function Ne(Te,Xe){return Te.x-Xe.x}function ae(Te,Xe){var ke=tt(Te,Xe);if(!ke)return Xe;var St=Qe(ke,Te),vt=ue(ke,ke.next);return ue(St,St.next),Xe===ke?vt:Xe}function tt(Te,Xe){var ke=Xe,St=Te.x,vt=Te.y,zt=-Infinity,Yt;do{if(vt<=ke.y&&vt>=ke.next.y&&ke.next.y!==ke.y){var Cr=ke.x+(vt-ke.y)*(ke.next.x-ke.x)/(ke.next.y-ke.y);if(Cr<=St&&Cr>zt){if(zt=Cr,Cr===St){if(vt===ke.y)return ke;if(vt===ke.next.y)return ke.next}Yt=ke.x<ke.next.x?ke:ke.next}}ke=ke.next}while(ke!==Xe);if(!Yt)return null;if(St===zt)return Yt;var Yn=Yt,hn=Yt.x,Ki=Yt.y,Zn=Infinity,Wn;ke=Yt;do St>=ke.x&&ke.x>=hn&&St!==ke.x&&er(vt<Ki?St:zt,vt,hn,Ki,vt<Ki?zt:St,vt,ke.x,ke.y)&&(Wn=Math.abs(vt-ke.y)/(St-ke.x),Je(ke,Te)&&(Wn<Zn||Wn===Zn&&(ke.x>Yt.x||ke.x===Yt.x&&Le(Yt,ke)))&&(Yt=ke,Zn=Wn)),ke=ke.next;while(ke!==Yn);return Yt}function Le(Te,Xe){return lt(Te.prev,Te,Xe.prev)<0&&lt(Xe.next,Te,Te.next)<0}function it(Te,Xe,ke,St){var vt=Te;do vt.z===null&&(vt.z=sr(vt.x,vt.y,Xe,ke,St)),vt.prevZ=vt.prev,vt.nextZ=vt.next,vt=vt.next;while(vt!==Te);vt.prevZ.nextZ=null,vt.prevZ=null,Vt(vt)}function Vt(Te){var Xe,ke,St,vt,zt,Yt,Cr,Yn,hn=1;do{for(ke=Te,Te=null,zt=null,Yt=0;ke;){for(Yt++,St=ke,Cr=0,Xe=0;Xe<hn&&(Cr++,St=St.nextZ,!!St);Xe++);for(Yn=hn;Cr>0||Yn>0&&St;)Cr!==0&&(Yn===0||!St||ke.z<=St.z)?(vt=ke,ke=ke.nextZ,Cr--):(vt=St,St=St.nextZ,Yn--),zt?zt.nextZ=vt:Te=vt,vt.prevZ=zt,zt=vt;ke=St}zt.nextZ=null,hn*=2}while(Yt>1);return Te}function sr(Te,Xe,ke,St,vt){return Te=32767*(Te-ke)*vt,Xe=32767*(Xe-St)*vt,Te=(Te|Te<<8)&16711935,Te=(Te|Te<<4)&252645135,Te=(Te|Te<<2)&858993459,Te=(Te|Te<<1)&1431655765,Xe=(Xe|Xe<<8)&16711935,Xe=(Xe|Xe<<4)&252645135,Xe=(Xe|Xe<<2)&858993459,Xe=(Xe|Xe<<1)&1431655765,Te|Xe<<1}function At(Te){var Xe=Te,ke=Te;do(Xe.x<ke.x||Xe.x===ke.x&&Xe.y<ke.y)&&(ke=Xe),Xe=Xe.next;while(Xe!==Te);return ke}function er(Te,Xe,ke,St,vt,zt,Yt,Cr){return(vt-Yt)*(Xe-Cr)-(Te-Yt)*(zt-Cr)>=0&&(Te-Yt)*(St-Cr)-(ke-Yt)*(Xe-Cr)>=0&&(ke-Yt)*(zt-Cr)-(vt-Yt)*(St-Cr)>=0}function It(Te,Xe){return Te.next.i!==Xe.i&&Te.prev.i!==Xe.i&&!gt(Te,Xe)&&(Je(Te,Xe)&&Je(Xe,Te)&&xt(Te,Xe)&&(lt(Te.prev,Te,Xe.prev)||lt(Te,Xe.prev,Xe))||dt(Te,Xe)&&lt(Te.prev,Te,Te.next)>0&&lt(Xe.prev,Xe,Xe.next)>0)}function lt(Te,Xe,ke){return(Xe.y-Te.y)*(ke.x-Xe.x)-(Xe.x-Te.x)*(ke.y-Xe.y)}function dt(Te,Xe){return Te.x===Xe.x&&Te.y===Xe.y}function tr(Te,Xe,ke,St){var vt=$t(lt(Te,Xe,ke)),zt=$t(lt(Te,Xe,St)),Yt=$t(lt(ke,St,Te)),Cr=$t(lt(ke,St,Xe));return!!(vt!==zt&&Yt!==Cr||vt===0&&Y(Te,ke,Xe)||zt===0&&Y(Te,St,Xe)||Yt===0&&Y(ke,Te,St)||Cr===0&&Y(ke,Xe,St))}function Y(Te,Xe,ke){return Xe.x<=Math.max(Te.x,ke.x)&&Xe.x>=Math.min(Te.x,ke.x)&&Xe.y<=Math.max(Te.y,ke.y)&&Xe.y>=Math.min(Te.y,ke.y)}function $t(Te){return Te>0?1:Te<0?-1:0}function gt(Te,Xe){var ke=Te;do{if(ke.i!==Te.i&&ke.next.i!==Te.i&&ke.i!==Xe.i&&ke.next.i!==Xe.i&&tr(ke,ke.next,Te,Xe))return!0;ke=ke.next}while(ke!==Te);return!1}function Je(Te,Xe){return lt(Te.prev,Te,Te.next)<0?lt(Te,Xe,Te.next)>=0&&lt(Te,Te.prev,Xe)>=0:lt(Te,Xe,Te.prev)<0||lt(Te,Te.next,Xe)<0}function xt(Te,Xe){var ke=Te,St=!1,vt=(Te.x+Xe.x)/2,zt=(Te.y+Xe.y)/2;do ke.y>zt!=ke.next.y>zt&&ke.next.y!==ke.y&&vt<(ke.next.x-ke.x)*(zt-ke.y)/(ke.next.y-ke.y)+ke.x&&(St=!St),ke=ke.next;while(ke!==Te);return St}function Qe(Te,Xe){var ke=new Br(Te.i,Te.x,Te.y),St=new Br(Xe.i,Xe.x,Xe.y),vt=Te.next,zt=Xe.prev;return Te.next=Xe,Xe.prev=Te,ke.next=vt,vt.prev=ke,St.next=ke,ke.prev=St,zt.next=St,St.prev=zt,St}function Kt(Te,Xe,ke,St){var vt=new Br(Te,Xe,ke);return St?(vt.next=St.next,vt.prev=St,St.next.prev=vt,St.next=vt):(vt.prev=vt,vt.next=vt),vt}function Sr(Te){Te.next.prev=Te.prev,Te.prev.next=Te.next,Te.prevZ&&(Te.prevZ.nextZ=Te.nextZ),Te.nextZ&&(Te.nextZ.prevZ=Te.prevZ)}function Br(Te,Xe,ke){this.i=Te,this.x=Xe,this.y=ke,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}J.deviation=function(Te,Xe,ke,St){var vt=Xe&&Xe.length,zt=vt?Xe[0]*ke:Te.length,Yt=Math.abs(Jr(Te,0,zt,ke));if(vt)for(var Cr=0,Yn=Xe.length;Cr<Yn;Cr++){var hn=Xe[Cr]*ke,Ki=Cr<Yn-1?Xe[Cr+1]*ke:Te.length;Yt-=Math.abs(Jr(Te,hn,Ki,ke))}var Zn=0;for(Cr=0;Cr<St.length;Cr+=3){var Wn=St[Cr]*ke,mi=St[Cr+1]*ke,qn=St[Cr+2]*ke;Zn+=Math.abs((Te[Wn]-Te[qn])*(Te[mi+1]-Te[Wn+1])-(Te[Wn]-Te[mi])*(Te[qn+1]-Te[Wn+1]))}return Yt===0&&Zn===0?0:Math.abs((Zn-Yt)/Yt)};function Jr(Te,Xe,ke,St){for(var vt=0,zt=Xe,Yt=ke-St;zt<ke;zt+=St)vt+=(Te[Yt]-Te[zt])*(Te[zt+1]+Te[Yt+1]),Yt=zt;return vt}J.flatten=function(Te){for(var Xe=Te[0][0].length,ke={vertices:[],holes:[],dimensions:Xe},St=0,vt=0;vt<Te.length;vt++){for(var zt=0;zt<Te[vt].length;zt++)for(var Yt=0;Yt<Xe;Yt++)ke.vertices.push(Te[vt][zt][Yt]);vt>0&&(St+=Te[vt-1].length,ke.holes.push(St))}return ke}},67709:function(Mt){function J(ue){var ye=ue.target||ue.srcElement;ye.__resizeRAF__&&cancelAnimationFrame(ye.__resizeRAF__),ye.__resizeRAF__=requestAnimationFrame(function(){var m=ye.__resizeTrigger__,ve=m&&m.__resizeListeners__;ve&&ve.forEach(function(j){j.call(m,ue)})})}var N=function(ye,m){var ve=this,j=ve.document,le,se=j.attachEvent;typeof navigator!="undefined"&&(le=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Ne(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",J)}if(!ye.__resizeListeners__)if(ye.__resizeListeners__=[],se)ye.__resizeTrigger__=ye,ye.attachEvent("onresize",J);else{getComputedStyle(ye).position==="static"&&(ye.style.position="relative");var ae=ye.__resizeTrigger__=j.createElement("object");ae.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),ae.setAttribute("class","resize-sensor"),ae.setAttribute("tabindex","-1"),ae.setAttribute("title",""),ae.__resizeElement__=ye,ae.onload=Ne,ae.type="text/html",le&&ye.appendChild(ae),ae.data="about:blank",le||ye.appendChild(ae)}ye.__resizeListeners__.push(m)};Mt.exports=typeof window=="undefined"?N:N.bind(window),Mt.exports.unbind=function(ue,ye){var m=document.attachEvent,ve=ue.__resizeListeners__||[];if(ye){var j=ve.indexOf(ye);j!==-1&&ve.splice(j,1)}else ve=ue.__resizeListeners__=[];if(!ve.length){if(m)ue.detachEvent("onresize",J);else if(ue.__resizeTrigger__){var le=ue.__resizeTrigger__.contentDocument,se=le&&le.defaultView;se&&(se.removeEventListener("resize",J),delete se.__resizeTrigger__),ue.__resizeTrigger__=!ue.removeChild(ue.__resizeTrigger__)}delete ue.__resizeListeners__}}},26729:function(Mt){"use strict";var J=Object.prototype.hasOwnProperty,N="~";function ue(){}Object.create&&(ue.prototype=Object.create(null),new ue().__proto__||(N=!1));function ye(le,se,Ne){this.fn=le,this.context=se,this.once=Ne||!1}function m(le,se,Ne,ae,tt){if(typeof Ne!="function")throw new TypeError("The listener must be a function");var Le=new ye(Ne,ae||le,tt),it=N?N+se:se;return le._events[it]?le._events[it].fn?le._events[it]=[le._events[it],Le]:le._events[it].push(Le):(le._events[it]=Le,le._eventsCount++),le}function ve(le,se){--le._eventsCount==0?le._events=new ue:delete le._events[se]}function j(){this._events=new ue,this._eventsCount=0}j.prototype.eventNames=function(){var se=[],Ne,ae;if(this._eventsCount===0)return se;for(ae in Ne=this._events)J.call(Ne,ae)&&se.push(N?ae.slice(1):ae);return Object.getOwnPropertySymbols?se.concat(Object.getOwnPropertySymbols(Ne)):se},j.prototype.listeners=function(se){var Ne=N?N+se:se,ae=this._events[Ne];if(!ae)return[];if(ae.fn)return[ae.fn];for(var tt=0,Le=ae.length,it=new Array(Le);tt<Le;tt++)it[tt]=ae[tt].fn;return it},j.prototype.listenerCount=function(se){var Ne=N?N+se:se,ae=this._events[Ne];return ae?ae.fn?1:ae.length:0},j.prototype.emit=function(se,Ne,ae,tt,Le,it){var Vt=N?N+se:se;if(!this._events[Vt])return!1;var sr=this._events[Vt],At=arguments.length,er,It;if(sr.fn){switch(sr.once&&this.removeListener(se,sr.fn,void 0,!0),At){case 1:return sr.fn.call(sr.context),!0;case 2:return sr.fn.call(sr.context,Ne),!0;case 3:return sr.fn.call(sr.context,Ne,ae),!0;case 4:return sr.fn.call(sr.context,Ne,ae,tt),!0;case 5:return sr.fn.call(sr.context,Ne,ae,tt,Le),!0;case 6:return sr.fn.call(sr.context,Ne,ae,tt,Le,it),!0}for(It=1,er=new Array(At-1);It<At;It++)er[It-1]=arguments[It];sr.fn.apply(sr.context,er)}else{var lt=sr.length,dt;for(It=0;It<lt;It++)switch(sr[It].once&&this.removeListener(se,sr[It].fn,void 0,!0),At){case 1:sr[It].fn.call(sr[It].context);break;case 2:sr[It].fn.call(sr[It].context,Ne);break;case 3:sr[It].fn.call(sr[It].context,Ne,ae);break;case 4:sr[It].fn.call(sr[It].context,Ne,ae,tt);break;default:if(!er)for(dt=1,er=new Array(At-1);dt<At;dt++)er[dt-1]=arguments[dt];sr[It].fn.apply(sr[It].context,er)}}return!0},j.prototype.on=function(se,Ne,ae){return m(this,se,Ne,ae,!1)},j.prototype.once=function(se,Ne,ae){return m(this,se,Ne,ae,!0)},j.prototype.removeListener=function(se,Ne,ae,tt){var Le=N?N+se:se;if(!this._events[Le])return this;if(!Ne)return ve(this,Le),this;var it=this._events[Le];if(it.fn)it.fn===Ne&&(!tt||it.once)&&(!ae||it.context===ae)&&ve(this,Le);else{for(var Vt=0,sr=[],At=it.length;Vt<At;Vt++)(it[Vt].fn!==Ne||tt&&!it[Vt].once||ae&&it[Vt].context!==ae)&&sr.push(it[Vt]);sr.length?this._events[Le]=sr.length===1?sr[0]:sr:ve(this,Le)}return this},j.prototype.removeAllListeners=function(se){var Ne;return se?(Ne=N?N+se:se,this._events[Ne]&&ve(this,Ne)):(this._events=new ue,this._eventsCount=0),this},j.prototype.off=j.prototype.removeListener,j.prototype.addListener=j.prototype.on,j.prefixed=N,j.EventEmitter=j,Mt.exports=j},7375:function(Mt,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0});var N=Symbol.for("INJECTION");function ue(le,se,Ne,ae){function tt(){return ae&&!Reflect.hasMetadata(N,this,se)&&Reflect.defineMetadata(N,Ne(),this,se),Reflect.hasMetadata(N,this,se)?Reflect.getMetadata(N,this,se):Ne()}function Le(it){Reflect.defineMetadata(N,it,this,se)}Object.defineProperty(le,se,{configurable:!0,enumerable:!0,get:tt,set:Le})}function ye(le,se){return function(Ne){return function(ae,tt){var Le=function(){return le.get(Ne)};ue(ae,tt,Le,se)}}}J.makePropertyInjectDecorator=ye;function m(le,se){return function(Ne,ae){return function(tt,Le){var it=function(){return le.getNamed(Ne,ae)};ue(tt,Le,it,se)}}}J.makePropertyInjectNamedDecorator=m;function ve(le,se){return function(Ne,ae,tt){return function(Le,it){var Vt=function(){return le.getTagged(Ne,ae,tt)};ue(Le,it,Vt,se)}}}J.makePropertyInjectTaggedDecorator=ve;function j(le,se){return function(Ne){return function(ae,tt){var Le=function(){return le.getAll(Ne)};ue(ae,tt,Le,se)}}}J.makePropertyMultiInjectDecorator=j},84879:function(Mt,J,N){"use strict";var ue;ue={value:!0};var ye=N(7375);function m(ve,j){j===void 0&&(j=!0);var le=ye.makePropertyInjectDecorator(ve,j),se=ye.makePropertyInjectNamedDecorator(ve,j),Ne=ye.makePropertyInjectTaggedDecorator(ve,j),ae=ye.makePropertyMultiInjectDecorator(ve,j);return{lazyInject:le,lazyInjectNamed:se,lazyInjectTagged:Ne,lazyMultiInject:ae}}J.Z=m},99934:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.tagProperty=J.tagParameter=J.decorate=void 0;var ue=N(16674),ye=N(6867);function m(ae,tt,Le,it){var Vt=ye.TAGGED;j(Vt,ae,tt,it,Le)}J.tagParameter=m;function ve(ae,tt,Le){var it=ye.TAGGED_PROP;j(it,ae.constructor,tt,Le)}J.tagProperty=ve;function j(ae,tt,Le,it,Vt){var sr={},At=typeof Vt=="number",er=Vt!==void 0&&At?Vt.toString():Le;if(At&&Le!==void 0)throw new Error(ue.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(ae,tt)&&(sr=Reflect.getMetadata(ae,tt));var It=sr[er];if(!Array.isArray(It))It=[];else for(var lt=0,dt=It;lt<dt.length;lt++){var tr=dt[lt];if(tr.key===it.key)throw new Error(ue.DUPLICATED_METADATA+" "+tr.key.toString())}It.push(it),sr[er]=It,Reflect.defineMetadata(ae,sr,tt)}function le(ae,tt){Reflect.decorate(ae,tt)}function se(ae,tt){return function(Le,it){tt(Le,it,ae)}}function Ne(ae,tt,Le){typeof Le=="number"?le([se(Le,ae)],tt):typeof Le=="string"?Reflect.decorate([ae],tt,Le):le([ae],tt)}J.decorate=Ne},5744:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.inject=J.LazyServiceIdentifer=void 0;var ue=N(16674),ye=N(6867),m=N(47738),ve=N(99934),j=function(){function se(Ne){this._cb=Ne}return se.prototype.unwrap=function(){return this._cb()},se}();J.LazyServiceIdentifer=j;function le(se){return function(Ne,ae,tt){if(se===void 0)throw new Error(ue.UNDEFINED_INJECT_ANNOTATION(Ne.name));var Le=new m.Metadata(ye.INJECT_TAG,se);typeof tt=="number"?ve.tagParameter(Ne,ae,tt,Le):ve.tagProperty(Ne,ae,Le)}}J.inject=le},64315:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.injectable=void 0;var ue=N(16674),ye=N(6867);function m(){return function(ve){if(Reflect.hasOwnMetadata(ye.PARAM_TYPES,ve))throw new Error(ue.DUPLICATED_INJECTABLE_DECORATOR);var j=Reflect.getMetadata(ye.DESIGN_PARAM_TYPES,ve)||[];return Reflect.defineMetadata(ye.PARAM_TYPES,j,ve),ve}}J.injectable=m},71693:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.multiInject=void 0;var ue=N(6867),ye=N(47738),m=N(99934);function ve(j){return function(le,se,Ne){var ae=new ye.Metadata(ue.MULTI_INJECT_TAG,j);typeof Ne=="number"?m.tagParameter(le,se,Ne,ae):m.tagProperty(le,se,ae)}}J.multiInject=ve},38085:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.named=void 0;var ue=N(6867),ye=N(47738),m=N(99934);function ve(j){return function(le,se,Ne){var ae=new ye.Metadata(ue.NAMED_TAG,j);typeof Ne=="number"?m.tagParameter(le,se,Ne,ae):m.tagProperty(le,se,ae)}}J.named=ve},6515:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.optional=void 0;var ue=N(6867),ye=N(47738),m=N(99934);function ve(){return function(j,le,se){var Ne=new ye.Metadata(ue.OPTIONAL_TAG,!0);typeof se=="number"?m.tagParameter(j,le,se,Ne):m.tagProperty(j,le,Ne)}}J.optional=ve},7014:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.postConstruct=void 0;var ue=N(16674),ye=N(6867),m=N(47738);function ve(){return function(j,le,se){var Ne=new m.Metadata(ye.POST_CONSTRUCT,le);if(Reflect.hasOwnMetadata(ye.POST_CONSTRUCT,j.constructor))throw new Error(ue.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(ye.POST_CONSTRUCT,Ne,j.constructor)}}J.postConstruct=ve},32052:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.tagged=void 0;var ue=N(47738),ye=N(99934);function m(ve,j){return function(le,se,Ne){var ae=new ue.Metadata(ve,j);typeof Ne=="number"?ye.tagParameter(le,se,Ne,ae):ye.tagProperty(le,se,ae)}}J.tagged=m},55638:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.targetName=void 0;var ue=N(6867),ye=N(47738),m=N(99934);function ve(j){return function(le,se,Ne){var ae=new ye.Metadata(ue.NAME_TAG,j);m.tagParameter(le,se,Ne,ae)}}J.targetName=ve},86757:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.unmanaged=void 0;var ue=N(6867),ye=N(47738),m=N(99934);function ve(){return function(j,le,se){var Ne=new ye.Metadata(ue.UNMANAGED_TAG,!0);m.tagParameter(j,le,se,Ne)}}J.unmanaged=ve},44290:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Binding=void 0;var ue=N(28421),ye=N(37791),m=function(){function ve(j,le){this.id=ye.id(),this.activated=!1,this.serviceIdentifier=j,this.scope=le,this.type=ue.BindingTypeEnum.Invalid,this.constraint=function(se){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return ve.prototype.clone=function(){var j=new ve(this.serviceIdentifier,this.scope);return j.activated=j.scope===ue.BindingScopeEnum.Singleton?this.activated:!1,j.implementationType=this.implementationType,j.dynamicValue=this.dynamicValue,j.scope=this.scope,j.type=this.type,j.factory=this.factory,j.provider=this.provider,j.constraint=this.constraint,j.onActivation=this.onActivation,j.cache=this.cache,j},ve}();J.Binding=m},23184:function(Mt,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingCount=void 0;var N={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};J.BindingCount=N},16674:function(Mt,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.STACK_OVERFLOW=J.CIRCULAR_DEPENDENCY_IN_FACTORY=J.POST_CONSTRUCT_ERROR=J.MULTIPLE_POST_CONSTRUCT_METHODS=J.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=J.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=J.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=J.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=J.ARGUMENTS_LENGTH_MISMATCH=J.INVALID_DECORATOR_OPERATION=J.INVALID_TO_SELF_VALUE=J.INVALID_FUNCTION_BINDING=J.INVALID_MIDDLEWARE_RETURN=J.NO_MORE_SNAPSHOTS_AVAILABLE=J.INVALID_BINDING_TYPE=J.NOT_IMPLEMENTED=J.CIRCULAR_DEPENDENCY=J.UNDEFINED_INJECT_ANNOTATION=J.MISSING_INJECT_ANNOTATION=J.MISSING_INJECTABLE_ANNOTATION=J.NOT_REGISTERED=J.CANNOT_UNBIND=J.AMBIGUOUS_MATCH=J.KEY_NOT_FOUND=J.NULL_ARGUMENT=J.DUPLICATED_METADATA=J.DUPLICATED_INJECTABLE_DECORATOR=void 0,J.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",J.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",J.NULL_ARGUMENT="NULL argument",J.KEY_NOT_FOUND="Key Not Found",J.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",J.CANNOT_UNBIND="Could not unbind serviceIdentifier:",J.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",J.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",J.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var N=function(ve){return"@inject called with undefined this could mean that the class "+ve+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};J.UNDEFINED_INJECT_ANNOTATION=N,J.CIRCULAR_DEPENDENCY="Circular dependency found:",J.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",J.INVALID_BINDING_TYPE="Invalid binding type:",J.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",J.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",J.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",J.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",J.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var ue=function(){for(var ve=[],j=0;j<arguments.length;j++)ve[j]=arguments[j];return"The number of constructor arguments in the derived class "+(ve[0]+" must be >= than the number of constructor arguments of its base class.")};J.ARGUMENTS_LENGTH_MISMATCH=ue,J.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",J.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",J.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",J.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",J.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var ye=function(){for(var ve=[],j=0;j<arguments.length;j++)ve[j]=arguments[j];return"@postConstruct error in class "+ve[0]+": "+ve[1]};J.POST_CONSTRUCT_ERROR=ye;var m=function(){for(var ve=[],j=0;j<arguments.length;j++)ve[j]=arguments[j];return"It looks like there is a circular dependency "+("in one of the '"+ve[0]+"' bindings. Please investigate bindings with")+("service identifier '"+ve[1]+"'.")};J.CIRCULAR_DEPENDENCY_IN_FACTORY=m,J.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Mt,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.TargetTypeEnum=J.BindingTypeEnum=J.BindingScopeEnum=void 0;var N={Request:"Request",Singleton:"Singleton",Transient:"Transient"};J.BindingScopeEnum=N;var ue={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};J.BindingTypeEnum=ue;var ye={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};J.TargetTypeEnum=ye},6867:function(Mt,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.NON_CUSTOM_TAG_KEYS=J.POST_CONSTRUCT=J.DESIGN_PARAM_TYPES=J.PARAM_TYPES=J.TAGGED_PROP=J.TAGGED=J.MULTI_INJECT_TAG=J.INJECT_TAG=J.OPTIONAL_TAG=J.UNMANAGED_TAG=J.NAME_TAG=J.NAMED_TAG=void 0,J.NAMED_TAG="named",J.NAME_TAG="name",J.UNMANAGED_TAG="unmanaged",J.OPTIONAL_TAG="optional",J.INJECT_TAG="inject",J.MULTI_INJECT_TAG="multi_inject",J.TAGGED="inversify:tagged",J.TAGGED_PROP="inversify:tagged_props",J.PARAM_TYPES="inversify:paramtypes",J.DESIGN_PARAM_TYPES="design:paramtypes",J.POST_CONSTRUCT="post_construct";function N(){return[J.INJECT_TAG,J.MULTI_INJECT_TAG,J.NAME_TAG,J.UNMANAGED_TAG,J.NAMED_TAG,J.OPTIONAL_TAG]}J.NON_CUSTOM_TAG_KEYS=N()},51389:function(Mt,J,N){"use strict";var ue=this&&this.__awaiter||function(It,lt,dt,tr){function Y($t){return $t instanceof dt?$t:new dt(function(gt){gt($t)})}return new(dt||(dt=Promise))(function($t,gt){function Je(Kt){try{Qe(tr.next(Kt))}catch(Sr){gt(Sr)}}function xt(Kt){try{Qe(tr.throw(Kt))}catch(Sr){gt(Sr)}}function Qe(Kt){Kt.done?$t(Kt.value):Y(Kt.value).then(Je,xt)}Qe((tr=tr.apply(It,lt||[])).next())})},ye=this&&this.__generator||function(It,lt){var dt={label:0,sent:function(){if($t[0]&1)throw $t[1];return $t[1]},trys:[],ops:[]},tr,Y,$t,gt;return gt={next:Je(0),throw:Je(1),return:Je(2)},typeof Symbol=="function"&&(gt[Symbol.iterator]=function(){return this}),gt;function Je(Qe){return function(Kt){return xt([Qe,Kt])}}function xt(Qe){if(tr)throw new TypeError("Generator is already executing.");for(;dt;)try{if(tr=1,Y&&($t=Qe[0]&2?Y.return:Qe[0]?Y.throw||(($t=Y.return)&&$t.call(Y),0):Y.next)&&!($t=$t.call(Y,Qe[1])).done)return $t;switch(Y=0,$t&&(Qe=[Qe[0]&2,$t.value]),Qe[0]){case 0:case 1:$t=Qe;break;case 4:return dt.label++,{value:Qe[1],done:!1};case 5:dt.label++,Y=Qe[1],Qe=[0];continue;case 7:Qe=dt.ops.pop(),dt.trys.pop();continue;default:if($t=dt.trys,!($t=$t.length>0&&$t[$t.length-1])&&(Qe[0]===6||Qe[0]===2)){dt=0;continue}if(Qe[0]===3&&(!$t||Qe[1]>$t[0]&&Qe[1]<$t[3])){dt.label=Qe[1];break}if(Qe[0]===6&&dt.label<$t[1]){dt.label=$t[1],$t=Qe;break}if($t&&dt.label<$t[2]){dt.label=$t[2],dt.ops.push(Qe);break}$t[2]&&dt.ops.pop(),dt.trys.pop();continue}Qe=lt.call(It,dt)}catch(Kt){Qe=[6,Kt],Y=0}finally{tr=$t=0}if(Qe[0]&5)throw Qe[1];return{value:Qe[0]?Qe[1]:void 0,done:!0}}},m=this&&this.__spreadArray||function(It,lt){for(var dt=0,tr=lt.length,Y=It.length;dt<tr;dt++,Y++)It[Y]=lt[dt];return It};Object.defineProperty(J,"__esModule",{value:!0}),J.Container=void 0;var ve=N(44290),j=N(16674),le=N(28421),se=N(6867),Ne=N(51377),ae=N(86311),tt=N(31927),Le=N(15451),it=N(37791),Vt=N(55800),sr=N(85700),At=N(80175),er=function(){function It(lt){this._appliedMiddleware=[];var dt=lt||{};if(typeof dt!="object")throw new Error(""+j.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(dt.defaultScope===void 0)dt.defaultScope=le.BindingScopeEnum.Transient;else if(dt.defaultScope!==le.BindingScopeEnum.Singleton&&dt.defaultScope!==le.BindingScopeEnum.Transient&&dt.defaultScope!==le.BindingScopeEnum.Request)throw new Error(""+j.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(dt.autoBindInjectable===void 0)dt.autoBindInjectable=!1;else if(typeof dt.autoBindInjectable!="boolean")throw new Error(""+j.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(dt.skipBaseClassChecks===void 0)dt.skipBaseClassChecks=!1;else if(typeof dt.skipBaseClassChecks!="boolean")throw new Error(""+j.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:dt.autoBindInjectable,defaultScope:dt.defaultScope,skipBaseClassChecks:dt.skipBaseClassChecks},this.id=it.id(),this._bindingDictionary=new At.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Ne.MetadataReader}return It.merge=function(lt,dt){for(var tr=[],Y=2;Y<arguments.length;Y++)tr[Y-2]=arguments[Y];var $t=new It,gt=m([lt,dt],tr).map(function(Qe){return ae.getBindingDictionary(Qe)}),Je=ae.getBindingDictionary($t);function xt(Qe,Kt){Qe.traverse(function(Sr,Br){Br.forEach(function(Jr){Kt.add(Jr.serviceIdentifier,Jr.clone())})})}return gt.forEach(function(Qe){xt(Qe,Je)}),$t},It.prototype.load=function(){for(var lt=[],dt=0;dt<arguments.length;dt++)lt[dt]=arguments[dt];for(var tr=this._getContainerModuleHelpersFactory(),Y=0,$t=lt;Y<$t.length;Y++){var gt=$t[Y],Je=tr(gt.id);gt.registry(Je.bindFunction,Je.unbindFunction,Je.isboundFunction,Je.rebindFunction)}},It.prototype.loadAsync=function(){for(var lt=[],dt=0;dt<arguments.length;dt++)lt[dt]=arguments[dt];return ue(this,void 0,void 0,function(){var tr,Y,$t,gt,Je;return ye(this,function(xt){switch(xt.label){case 0:tr=this._getContainerModuleHelpersFactory(),Y=0,$t=lt,xt.label=1;case 1:return Y<$t.length?(gt=$t[Y],Je=tr(gt.id),[4,gt.registry(Je.bindFunction,Je.unbindFunction,Je.isboundFunction,Je.rebindFunction)]):[3,4];case 2:xt.sent(),xt.label=3;case 3:return Y++,[3,1];case 4:return[2]}})})},It.prototype.unload=function(){for(var lt=this,dt=[],tr=0;tr<arguments.length;tr++)dt[tr]=arguments[tr];var Y=function($t){return function(gt){return gt.moduleId===$t}};dt.forEach(function($t){var gt=Y($t.id);lt._bindingDictionary.removeByCondition(gt)})},It.prototype.bind=function(lt){var dt=this.options.defaultScope||le.BindingScopeEnum.Transient,tr=new ve.Binding(lt,dt);return this._bindingDictionary.add(lt,tr),new Le.BindingToSyntax(tr)},It.prototype.rebind=function(lt){return this.unbind(lt),this.bind(lt)},It.prototype.unbind=function(lt){try{this._bindingDictionary.remove(lt)}catch(dt){throw new Error(j.CANNOT_UNBIND+" "+Vt.getServiceIdentifierAsString(lt))}},It.prototype.unbindAll=function(){this._bindingDictionary=new At.Lookup},It.prototype.isBound=function(lt){var dt=this._bindingDictionary.hasKey(lt);return!dt&&this.parent&&(dt=this.parent.isBound(lt)),dt},It.prototype.isBoundNamed=function(lt,dt){return this.isBoundTagged(lt,se.NAMED_TAG,dt)},It.prototype.isBoundTagged=function(lt,dt,tr){var Y=!1;if(this._bindingDictionary.hasKey(lt)){var $t=this._bindingDictionary.get(lt),gt=ae.createMockRequest(this,lt,dt,tr);Y=$t.some(function(Je){return Je.constraint(gt)})}return!Y&&this.parent&&(Y=this.parent.isBoundTagged(lt,dt,tr)),Y},It.prototype.snapshot=function(){this._snapshots.push(sr.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},It.prototype.restore=function(){var lt=this._snapshots.pop();if(lt===void 0)throw new Error(j.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=lt.bindings,this._middleware=lt.middleware},It.prototype.createChild=function(lt){var dt=new It(lt||this.options);return dt.parent=this,dt},It.prototype.applyMiddleware=function(){for(var lt=[],dt=0;dt<arguments.length;dt++)lt[dt]=arguments[dt];this._appliedMiddleware=this._appliedMiddleware.concat(lt);var tr=this._middleware?this._middleware:this._planAndResolve();this._middleware=lt.reduce(function(Y,$t){return $t(Y)},tr)},It.prototype.applyCustomMetadataReader=function(lt){this._metadataReader=lt},It.prototype.get=function(lt){return this._get(!1,!1,le.TargetTypeEnum.Variable,lt)},It.prototype.getTagged=function(lt,dt,tr){return this._get(!1,!1,le.TargetTypeEnum.Variable,lt,dt,tr)},It.prototype.getNamed=function(lt,dt){return this.getTagged(lt,se.NAMED_TAG,dt)},It.prototype.getAll=function(lt){return this._get(!0,!0,le.TargetTypeEnum.Variable,lt)},It.prototype.getAllTagged=function(lt,dt,tr){return this._get(!1,!0,le.TargetTypeEnum.Variable,lt,dt,tr)},It.prototype.getAllNamed=function(lt,dt){return this.getAllTagged(lt,se.NAMED_TAG,dt)},It.prototype.resolve=function(lt){var dt=this.createChild();return dt.bind(lt).toSelf(),this._appliedMiddleware.forEach(function(tr){dt.applyMiddleware(tr)}),dt.get(lt)},It.prototype._getContainerModuleHelpersFactory=function(){var lt=this,dt=function(Je,xt){Je._binding.moduleId=xt},tr=function(Je){return function(xt){var Qe=lt.bind.bind(lt),Kt=Qe(xt);return dt(Kt,Je),Kt}},Y=function(Je){return function(xt){var Qe=lt.unbind.bind(lt);Qe(xt)}},$t=function(Je){return function(xt){var Qe=lt.isBound.bind(lt);return Qe(xt)}},gt=function(Je){return function(xt){var Qe=lt.rebind.bind(lt),Kt=Qe(xt);return dt(Kt,Je),Kt}};return function(Je){return{bindFunction:tr(Je),isboundFunction:$t(Je),rebindFunction:gt(Je),unbindFunction:Y(Je)}}},It.prototype._get=function(lt,dt,tr,Y,$t,gt){var Je=null,xt={avoidConstraints:lt,contextInterceptor:function(Qe){return Qe},isMultiInject:dt,key:$t,serviceIdentifier:Y,targetType:tr,value:gt};if(this._middleware){if(Je=this._middleware(xt),Je==null)throw new Error(j.INVALID_MIDDLEWARE_RETURN)}else Je=this._planAndResolve()(xt);return Je},It.prototype._planAndResolve=function(){var lt=this;return function(dt){var tr=ae.plan(lt._metadataReader,lt,dt.isMultiInject,dt.targetType,dt.serviceIdentifier,dt.key,dt.value,dt.avoidConstraints);tr=dt.contextInterceptor(tr);var Y=tt.resolve(tr);return Y}},It}();J.Container=er},33244:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.AsyncContainerModule=J.ContainerModule=void 0;var ue=N(37791),ye=function(){function ve(j){this.id=ue.id(),this.registry=j}return ve}();J.ContainerModule=ye;var m=function(){function ve(j){this.id=ue.id(),this.registry=j}return ve}();J.AsyncContainerModule=m},85700:function(Mt,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.ContainerSnapshot=void 0;var N=function(){function ue(){}return ue.of=function(ye,m){var ve=new ue;return ve.bindings=ye,ve.middleware=m,ve},ue}();J.ContainerSnapshot=N},80175:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Lookup=void 0;var ue=N(16674),ye=function(){function m(){this._map=new Map}return m.prototype.getMap=function(){return this._map},m.prototype.add=function(ve,j){if(ve==null)throw new Error(ue.NULL_ARGUMENT);if(j==null)throw new Error(ue.NULL_ARGUMENT);var le=this._map.get(ve);le!==void 0?(le.push(j),this._map.set(ve,le)):this._map.set(ve,[j])},m.prototype.get=function(ve){if(ve==null)throw new Error(ue.NULL_ARGUMENT);var j=this._map.get(ve);if(j!==void 0)return j;throw new Error(ue.KEY_NOT_FOUND)},m.prototype.remove=function(ve){if(ve==null)throw new Error(ue.NULL_ARGUMENT);if(!this._map.delete(ve))throw new Error(ue.KEY_NOT_FOUND)},m.prototype.removeByCondition=function(ve){var j=this;this._map.forEach(function(le,se){var Ne=le.filter(function(ae){return!ve(ae)});Ne.length>0?j._map.set(se,Ne):j._map.delete(se)})},m.prototype.hasKey=function(ve){if(ve==null)throw new Error(ue.NULL_ARGUMENT);return this._map.has(ve)},m.prototype.clone=function(){var ve=new m;return this._map.forEach(function(j,le){j.forEach(function(se){return ve.add(le,se.clone())})}),ve},m.prototype.traverse=function(ve){this._map.forEach(function(j,le){ve(le,j)})},m}();J.Lookup=ye},86700:function(Mt,J,N){"use strict";var ue;ue={value:!0},ue=ue=ue=ue=ue=ue=J.GW=ue=ue=J.zY=ue=ue=ue=ue=ue=J.f3=ue=ue=J.b2=ue=ue=ue=ue=ue=J.W2=ue=void 0;var ye=N(6867);ue=ye;var m=N(51389);Object.defineProperty(J,"W2",{enumerable:!0,get:function(){return m.Container}});var ve=N(28421);ue={enumerable:!0,get:function(){return ve.BindingScopeEnum}},ue={enumerable:!0,get:function(){return ve.BindingTypeEnum}},ue={enumerable:!0,get:function(){return ve.TargetTypeEnum}};var j=N(33244);ue={enumerable:!0,get:function(){return j.AsyncContainerModule}},ue={enumerable:!0,get:function(){return j.ContainerModule}};var le=N(64315);Object.defineProperty(J,"b2",{enumerable:!0,get:function(){return le.injectable}});var se=N(32052);ue={enumerable:!0,get:function(){return se.tagged}};var Ne=N(38085);ue={enumerable:!0,get:function(){return Ne.named}};var ae=N(5744);Object.defineProperty(J,"f3",{enumerable:!0,get:function(){return ae.inject}}),ue={enumerable:!0,get:function(){return ae.LazyServiceIdentifer}};var tt=N(6515);ue={enumerable:!0,get:function(){return tt.optional}};var Le=N(86757);ue={enumerable:!0,get:function(){return Le.unmanaged}};var it=N(71693);ue={enumerable:!0,get:function(){return it.multiInject}};var Vt=N(55638);ue={enumerable:!0,get:function(){return Vt.targetName}};var sr=N(7014);Object.defineProperty(J,"zY",{enumerable:!0,get:function(){return sr.postConstruct}});var At=N(51377);ue={enumerable:!0,get:function(){return At.MetadataReader}};var er=N(37791);ue={enumerable:!0,get:function(){return er.id}};var It=N(99934);Object.defineProperty(J,"GW",{enumerable:!0,get:function(){return It.decorate}});var lt=N(80758);ue={enumerable:!0,get:function(){return lt.traverseAncerstors}},ue={enumerable:!0,get:function(){return lt.taggedConstraint}},ue={enumerable:!0,get:function(){return lt.namedConstraint}},ue={enumerable:!0,get:function(){return lt.typeConstraint}};var dt=N(55800);ue={enumerable:!0,get:function(){return dt.getServiceIdentifierAsString}};var tr=N(70600);ue={enumerable:!0,get:function(){return tr.multiBindToService}}},95228:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Context=void 0;var ue=N(37791),ye=function(){function m(ve){this.id=ue.id(),this.container=ve}return m.prototype.addPlan=function(ve){this.plan=ve},m.prototype.setCurrentRequest=function(ve){this.currentRequest=ve},m}();J.Context=ye},47738:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Metadata=void 0;var ue=N(6867),ye=function(){function m(ve,j){this.key=ve,this.value=j}return m.prototype.toString=function(){return this.key===ue.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},m}();J.Metadata=ye},51377:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.MetadataReader=void 0;var ue=N(6867),ye=function(){function m(){}return m.prototype.getConstructorMetadata=function(ve){var j=Reflect.getMetadata(ue.PARAM_TYPES,ve),le=Reflect.getMetadata(ue.TAGGED,ve);return{compilerGeneratedMetadata:j,userGeneratedMetadata:le||{}}},m.prototype.getPropertiesMetadata=function(ve){var j=Reflect.getMetadata(ue.TAGGED_PROP,ve)||[];return j},m}();J.MetadataReader=ye},55314:function(Mt,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Plan=void 0;var N=function(){function ue(ye,m){this.parentContext=ye,this.rootRequest=m}return ue}();J.Plan=N},86311:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.getBindingDictionary=J.createMockRequest=J.plan=void 0;var ue=N(23184),ye=N(16674),m=N(28421),ve=N(6867),j=N(85265),le=N(55800),se=N(95228),Ne=N(47738),ae=N(55314),tt=N(6e3),Le=N(6748),it=N(18924);function Vt(Y){return Y._bindingDictionary}J.getBindingDictionary=Vt;function sr(Y,$t,gt,Je,xt,Qe){var Kt=Y?ve.MULTI_INJECT_TAG:ve.INJECT_TAG,Sr=new Ne.Metadata(Kt,gt),Br=new it.Target($t,Je,gt,Sr);if(xt!==void 0){var Jr=new Ne.Metadata(xt,Qe);Br.metadata.push(Jr)}return Br}function At(Y,$t,gt,Je,xt){var Qe=lt(gt.container,xt.serviceIdentifier),Kt=[];return Qe.length===ue.BindingCount.NoBindingsAvailable&&gt.container.options.autoBindInjectable&&typeof xt.serviceIdentifier=="function"&&Y.getConstructorMetadata(xt.serviceIdentifier).compilerGeneratedMetadata&&(gt.container.bind(xt.serviceIdentifier).toSelf(),Qe=lt(gt.container,xt.serviceIdentifier)),$t?Kt=Qe:Kt=Qe.filter(function(Sr){var Br=new Le.Request(Sr.serviceIdentifier,gt,Je,Sr,xt);return Sr.constraint(Br)}),er(xt.serviceIdentifier,Kt,xt,gt.container),Kt}function er(Y,$t,gt,Je){switch($t.length){case ue.BindingCount.NoBindingsAvailable:if(gt.isOptional())return $t;var xt=le.getServiceIdentifierAsString(Y),Qe=ye.NOT_REGISTERED;throw Qe+=le.listMetadataForTarget(xt,gt),Qe+=le.listRegisteredBindingsForServiceIdentifier(Je,xt,lt),new Error(Qe);case ue.BindingCount.OnlyOneBindingAvailable:if(!gt.isArray())return $t;case ue.BindingCount.MultipleBindingsAvailable:default:if(gt.isArray())return $t;var xt=le.getServiceIdentifierAsString(Y),Qe=ye.AMBIGUOUS_MATCH+" "+xt;throw Qe+=le.listRegisteredBindingsForServiceIdentifier(Je,xt,lt),new Error(Qe)}}function It(Y,$t,gt,Je,xt,Qe){var Kt,Sr;if(xt===null){Kt=At(Y,$t,Je,null,Qe),Sr=new Le.Request(gt,Je,null,Kt,Qe);var Br=new ae.Plan(Je,Sr);Je.addPlan(Br)}else Kt=At(Y,$t,Je,xt,Qe),Sr=xt.addChildRequest(Qe.serviceIdentifier,Kt,Qe);Kt.forEach(function(Jr){var Te=null;if(Qe.isArray())Te=Sr.addChildRequest(Jr.serviceIdentifier,Jr,Qe);else{if(Jr.cache)return;Te=Sr}if(Jr.type===m.BindingTypeEnum.Instance&&Jr.implementationType!==null){var Xe=tt.getDependencies(Y,Jr.implementationType);if(!Je.container.options.skipBaseClassChecks){var ke=tt.getBaseClassDependencyCount(Y,Jr.implementationType);if(Xe.length<ke){var St=ye.ARGUMENTS_LENGTH_MISMATCH(tt.getFunctionName(Jr.implementationType));throw new Error(St)}}Xe.forEach(function(vt){It(Y,!1,vt.serviceIdentifier,Je,Te,vt)})}})}function lt(Y,$t){var gt=[],Je=Vt(Y);return Je.hasKey($t)?gt=Je.get($t):Y.parent!==null&&(gt=lt(Y.parent,$t)),gt}function dt(Y,$t,gt,Je,xt,Qe,Kt,Sr){Sr===void 0&&(Sr=!1);var Br=new se.Context($t),Jr=sr(gt,Je,xt,"",Qe,Kt);try{return It(Y,Sr,xt,Br,null,Jr),Br}catch(Te){throw j.isStackOverflowExeption(Te)&&Br.plan&&le.circularDependencyToException(Br.plan.rootRequest),Te}}J.plan=dt;function tr(Y,$t,gt,Je){var xt=new it.Target(m.TargetTypeEnum.Variable,"",$t,new Ne.Metadata(gt,Je)),Qe=new se.Context(Y),Kt=new Le.Request($t,Qe,null,[],xt);return Kt}J.createMockRequest=tr},88460:function(Mt,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.QueryableString=void 0;var N=function(){function ue(ye){this.str=ye}return ue.prototype.startsWith=function(ye){return this.str.indexOf(ye)===0},ue.prototype.endsWith=function(ye){var m="",ve=ye.split("").reverse().join("");return m=this.str.split("").reverse().join(""),this.startsWith.call({str:m},ve)},ue.prototype.contains=function(ye){return this.str.indexOf(ye)!==-1},ue.prototype.equals=function(ye){return this.str===ye},ue.prototype.value=function(){return this.str},ue}();J.QueryableString=N},6e3:function(Mt,J,N){"use strict";var ue=this&&this.__spreadArray||function(At,er){for(var It=0,lt=er.length,dt=At.length;It<lt;It++,dt++)At[dt]=er[It];return At};Object.defineProperty(J,"__esModule",{value:!0}),J.getFunctionName=J.getBaseClassDependencyCount=J.getDependencies=void 0;var ye=N(5744),m=N(16674),ve=N(28421),j=N(6867),le=N(55800);Object.defineProperty(J,"getFunctionName",{enumerable:!0,get:function(){return le.getFunctionName}});var se=N(18924);function Ne(At,er){var It=le.getFunctionName(er),lt=ae(At,It,er,!1);return lt}J.getDependencies=Ne;function ae(At,er,It,lt){var dt=At.getConstructorMetadata(It),tr=dt.compilerGeneratedMetadata;if(tr===void 0){var Y=m.MISSING_INJECTABLE_ANNOTATION+" "+er+".";throw new Error(Y)}var $t=dt.userGeneratedMetadata,gt=Object.keys($t),Je=It.length===0&&gt.length>0,xt=gt.length>It.length,Qe=Je||xt?gt.length:It.length,Kt=Le(lt,er,tr,$t,Qe),Sr=it(At,It),Br=ue(ue([],Kt),Sr);return Br}function tt(At,er,It,lt,dt){var tr=dt[At.toString()]||[],Y=sr(tr),$t=Y.unmanaged!==!0,gt=lt[At],Je=Y.inject||Y.multiInject;if(gt=Je||gt,gt instanceof ye.LazyServiceIdentifer&&(gt=gt.unwrap()),$t){var xt=gt===Object,Qe=gt===Function,Kt=gt===void 0,Sr=xt||Qe||Kt;if(!er&&Sr){var Br=m.MISSING_INJECT_ANNOTATION+" argument "+At+" in class "+It+".";throw new Error(Br)}var Jr=new se.Target(ve.TargetTypeEnum.ConstructorArgument,Y.targetName,gt);return Jr.metadata=tr,Jr}return null}function Le(At,er,It,lt,dt){for(var tr=[],Y=0;Y<dt;Y++){var $t=Y,gt=tt($t,At,er,It,lt);gt!==null&&tr.push(gt)}return tr}function it(At,er){for(var It=At.getPropertiesMetadata(er),lt=[],dt=Object.keys(It),tr=0,Y=dt;tr<Y.length;tr++){var $t=Y[tr],gt=It[$t],Je=sr(It[$t]),xt=Je.targetName||$t,Qe=Je.inject||Je.multiInject,Kt=new se.Target(ve.TargetTypeEnum.ClassProperty,xt,Qe);Kt.metadata=gt,lt.push(Kt)}var Sr=Object.getPrototypeOf(er.prototype).constructor;if(Sr!==Object){var Br=it(At,Sr);lt=ue(ue([],lt),Br)}return lt}function Vt(At,er){var It=Object.getPrototypeOf(er.prototype).constructor;if(It!==Object){var lt=le.getFunctionName(It),dt=ae(At,lt,It,!0),tr=dt.map(function(gt){return gt.metadata.filter(function(Je){return Je.key===j.UNMANAGED_TAG})}),Y=[].concat.apply([],tr).length,$t=dt.length-Y;return $t>0?$t:Vt(At,It)}else return 0}J.getBaseClassDependencyCount=Vt;function sr(At){var er={};return At.forEach(function(It){er[It.key.toString()]=It.value}),{inject:er[j.INJECT_TAG],multiInject:er[j.MULTI_INJECT_TAG],targetName:er[j.NAME_TAG],unmanaged:er[j.UNMANAGED_TAG]}}},6748:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Request=void 0;var ue=N(37791),ye=function(){function m(ve,j,le,se,Ne){this.id=ue.id(),this.serviceIdentifier=ve,this.parentContext=j,this.parentRequest=le,this.target=Ne,this.childRequests=[],this.bindings=Array.isArray(se)?se:[se],this.requestScope=le===null?new Map:null}return m.prototype.addChildRequest=function(ve,j,le){var se=new m(ve,this.parentContext,this,j,le);return this.childRequests.push(se),se},m}();J.Request=ye},18924:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.Target=void 0;var ue=N(6867),ye=N(37791),m=N(47738),ve=N(88460),j=function(){function le(se,Ne,ae,tt){this.id=ye.id(),this.type=se,this.serviceIdentifier=ae,this.name=new ve.QueryableString(Ne||""),this.metadata=new Array;var Le=null;typeof tt=="string"?Le=new m.Metadata(ue.NAMED_TAG,tt):tt instanceof m.Metadata&&(Le=tt),Le!==null&&this.metadata.push(Le)}return le.prototype.hasTag=function(se){for(var Ne=0,ae=this.metadata;Ne<ae.length;Ne++){var tt=ae[Ne];if(tt.key===se)return!0}return!1},le.prototype.isArray=function(){return this.hasTag(ue.MULTI_INJECT_TAG)},le.prototype.matchesArray=function(se){return this.matchesTag(ue.MULTI_INJECT_TAG)(se)},le.prototype.isNamed=function(){return this.hasTag(ue.NAMED_TAG)},le.prototype.isTagged=function(){return this.metadata.some(function(se){return ue.NON_CUSTOM_TAG_KEYS.every(function(Ne){return se.key!==Ne})})},le.prototype.isOptional=function(){return this.matchesTag(ue.OPTIONAL_TAG)(!0)},le.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(se){return se.key===ue.NAMED_TAG})[0]:null},le.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(se){return ue.NON_CUSTOM_TAG_KEYS.every(function(Ne){return se.key!==Ne})}):null},le.prototype.matchesNamedTag=function(se){return this.matchesTag(ue.NAMED_TAG)(se)},le.prototype.matchesTag=function(se){var Ne=this;return function(ae){for(var tt=0,Le=Ne.metadata;tt<Le.length;tt++){var it=Le[tt];if(it.key===se&&it.value===ae)return!0}return!1}},le}();J.Target=j},52279:function(Mt,J,N){"use strict";var ue=this&&this.__spreadArray||function(ae,tt){for(var Le=0,it=tt.length,Vt=ae.length;Le<it;Le++,Vt++)ae[Vt]=tt[Le];return ae};Object.defineProperty(J,"__esModule",{value:!0}),J.resolveInstance=void 0;var ye=N(16674),m=N(28421),ve=N(6867);function j(ae,tt,Le){var it=tt.filter(function(sr){return sr.target!==null&&sr.target.type===m.TargetTypeEnum.ClassProperty}),Vt=it.map(Le);return it.forEach(function(sr,At){var er="";er=sr.target.name.value();var It=Vt[At];ae[er]=It}),ae}function le(ae,tt){return new(ae.bind.apply(ae,ue([void 0],tt)))}function se(ae,tt){if(Reflect.hasMetadata(ve.POST_CONSTRUCT,ae)){var Le=Reflect.getMetadata(ve.POST_CONSTRUCT,ae);try{tt[Le.value]()}catch(it){throw new Error(ye.POST_CONSTRUCT_ERROR(ae.name,it.message))}}}function Ne(ae,tt,Le){var it=null;if(tt.length>0){var Vt=tt.filter(function(At){return At.target!==null&&At.target.type===m.TargetTypeEnum.ConstructorArgument}),sr=Vt.map(Le);it=le(ae,sr),it=j(it,tt,Le)}else it=new ae;return se(ae,it),it}J.resolveInstance=Ne},31927:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.resolve=void 0;var ue=N(16674),ye=N(28421),m=N(85265),ve=N(55800),j=N(52279),le=function(ae,tt,Le){try{return Le()}catch(it){throw m.isStackOverflowExeption(it)?new Error(ue.CIRCULAR_DEPENDENCY_IN_FACTORY(ae,tt.toString())):it}},se=function(ae){return function(tt){tt.parentContext.setCurrentRequest(tt);var Le=tt.bindings,it=tt.childRequests,Vt=tt.target&&tt.target.isArray(),sr=!tt.parentRequest||!tt.parentRequest.target||!tt.target||!tt.parentRequest.target.matchesArray(tt.target.serviceIdentifier);if(Vt&&sr)return it.map(function(tr){var Y=se(ae);return Y(tr)});var At=null;if(tt.target.isOptional()&&Le.length===0)return;var er=Le[0],It=er.scope===ye.BindingScopeEnum.Singleton,lt=er.scope===ye.BindingScopeEnum.Request;if(It&&er.activated)return er.cache;if(lt&&ae!==null&&ae.has(er.id))return ae.get(er.id);if(er.type===ye.BindingTypeEnum.ConstantValue)At=er.cache,er.activated=!0;else if(er.type===ye.BindingTypeEnum.Function)At=er.cache,er.activated=!0;else if(er.type===ye.BindingTypeEnum.Constructor)At=er.implementationType;else if(er.type===ye.BindingTypeEnum.DynamicValue&&er.dynamicValue!==null)At=le("toDynamicValue",er.serviceIdentifier,function(){return er.dynamicValue(tt.parentContext)});else if(er.type===ye.BindingTypeEnum.Factory&&er.factory!==null)At=le("toFactory",er.serviceIdentifier,function(){return er.factory(tt.parentContext)});else if(er.type===ye.BindingTypeEnum.Provider&&er.provider!==null)At=le("toProvider",er.serviceIdentifier,function(){return er.provider(tt.parentContext)});else if(er.type===ye.BindingTypeEnum.Instance&&er.implementationType!==null)At=j.resolveInstance(er.implementationType,it,se(ae));else{var dt=ve.getServiceIdentifierAsString(tt.serviceIdentifier);throw new Error(ue.INVALID_BINDING_TYPE+" "+dt)}return typeof er.onActivation=="function"&&(At=er.onActivation(tt.parentContext,At)),It&&(er.cache=At,er.activated=!0),lt&&ae!==null&&!ae.has(er.id)&&ae.set(er.id,At),At}};function Ne(ae){var tt=se(ae.plan.rootRequest.requestScope);return tt(ae.plan.rootRequest)}J.resolve=Ne},83366:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingInSyntax=void 0;var ue=N(28421),ye=N(71325),m=function(){function ve(j){this._binding=j}return ve.prototype.inRequestScope=function(){return this._binding.scope=ue.BindingScopeEnum.Request,new ye.BindingWhenOnSyntax(this._binding)},ve.prototype.inSingletonScope=function(){return this._binding.scope=ue.BindingScopeEnum.Singleton,new ye.BindingWhenOnSyntax(this._binding)},ve.prototype.inTransientScope=function(){return this._binding.scope=ue.BindingScopeEnum.Transient,new ye.BindingWhenOnSyntax(this._binding)},ve}();J.BindingInSyntax=m},74889:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingInWhenOnSyntax=void 0;var ue=N(83366),ye=N(51811),m=N(98370),ve=function(){function j(le){this._binding=le,this._bindingWhenSyntax=new m.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ye.BindingOnSyntax(this._binding),this._bindingInSyntax=new ue.BindingInSyntax(le)}return j.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},j.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},j.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},j.prototype.when=function(le){return this._bindingWhenSyntax.when(le)},j.prototype.whenTargetNamed=function(le){return this._bindingWhenSyntax.whenTargetNamed(le)},j.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},j.prototype.whenTargetTagged=function(le,se){return this._bindingWhenSyntax.whenTargetTagged(le,se)},j.prototype.whenInjectedInto=function(le){return this._bindingWhenSyntax.whenInjectedInto(le)},j.prototype.whenParentNamed=function(le){return this._bindingWhenSyntax.whenParentNamed(le)},j.prototype.whenParentTagged=function(le,se){return this._bindingWhenSyntax.whenParentTagged(le,se)},j.prototype.whenAnyAncestorIs=function(le){return this._bindingWhenSyntax.whenAnyAncestorIs(le)},j.prototype.whenNoAncestorIs=function(le){return this._bindingWhenSyntax.whenNoAncestorIs(le)},j.prototype.whenAnyAncestorNamed=function(le){return this._bindingWhenSyntax.whenAnyAncestorNamed(le)},j.prototype.whenAnyAncestorTagged=function(le,se){return this._bindingWhenSyntax.whenAnyAncestorTagged(le,se)},j.prototype.whenNoAncestorNamed=function(le){return this._bindingWhenSyntax.whenNoAncestorNamed(le)},j.prototype.whenNoAncestorTagged=function(le,se){return this._bindingWhenSyntax.whenNoAncestorTagged(le,se)},j.prototype.whenAnyAncestorMatches=function(le){return this._bindingWhenSyntax.whenAnyAncestorMatches(le)},j.prototype.whenNoAncestorMatches=function(le){return this._bindingWhenSyntax.whenNoAncestorMatches(le)},j.prototype.onActivation=function(le){return this._bindingOnSyntax.onActivation(le)},j}();J.BindingInWhenOnSyntax=ve},51811:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingOnSyntax=void 0;var ue=N(98370),ye=function(){function m(ve){this._binding=ve}return m.prototype.onActivation=function(ve){return this._binding.onActivation=ve,new ue.BindingWhenSyntax(this._binding)},m}();J.BindingOnSyntax=ye},15451:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingToSyntax=void 0;var ue=N(16674),ye=N(28421),m=N(74889),ve=N(71325),j=function(){function le(se){this._binding=se}return le.prototype.to=function(se){return this._binding.type=ye.BindingTypeEnum.Instance,this._binding.implementationType=se,new m.BindingInWhenOnSyntax(this._binding)},le.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+ue.INVALID_TO_SELF_VALUE);var se=this._binding.serviceIdentifier;return this.to(se)},le.prototype.toConstantValue=function(se){return this._binding.type=ye.BindingTypeEnum.ConstantValue,this._binding.cache=se,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=ye.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},le.prototype.toDynamicValue=function(se){return this._binding.type=ye.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=se,this._binding.implementationType=null,new m.BindingInWhenOnSyntax(this._binding)},le.prototype.toConstructor=function(se){return this._binding.type=ye.BindingTypeEnum.Constructor,this._binding.implementationType=se,this._binding.scope=ye.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},le.prototype.toFactory=function(se){return this._binding.type=ye.BindingTypeEnum.Factory,this._binding.factory=se,this._binding.scope=ye.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},le.prototype.toFunction=function(se){if(typeof se!="function")throw new Error(ue.INVALID_FUNCTION_BINDING);var Ne=this.toConstantValue(se);return this._binding.type=ye.BindingTypeEnum.Function,this._binding.scope=ye.BindingScopeEnum.Singleton,Ne},le.prototype.toAutoFactory=function(se){return this._binding.type=ye.BindingTypeEnum.Factory,this._binding.factory=function(Ne){var ae=function(){return Ne.container.get(se)};return ae},this._binding.scope=ye.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},le.prototype.toProvider=function(se){return this._binding.type=ye.BindingTypeEnum.Provider,this._binding.provider=se,this._binding.scope=ye.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},le.prototype.toService=function(se){this.toDynamicValue(function(Ne){return Ne.container.get(se)})},le}();J.BindingToSyntax=j},71325:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingWhenOnSyntax=void 0;var ue=N(51811),ye=N(98370),m=function(){function ve(j){this._binding=j,this._bindingWhenSyntax=new ye.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ue.BindingOnSyntax(this._binding)}return ve.prototype.when=function(j){return this._bindingWhenSyntax.when(j)},ve.prototype.whenTargetNamed=function(j){return this._bindingWhenSyntax.whenTargetNamed(j)},ve.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},ve.prototype.whenTargetTagged=function(j,le){return this._bindingWhenSyntax.whenTargetTagged(j,le)},ve.prototype.whenInjectedInto=function(j){return this._bindingWhenSyntax.whenInjectedInto(j)},ve.prototype.whenParentNamed=function(j){return this._bindingWhenSyntax.whenParentNamed(j)},ve.prototype.whenParentTagged=function(j,le){return this._bindingWhenSyntax.whenParentTagged(j,le)},ve.prototype.whenAnyAncestorIs=function(j){return this._bindingWhenSyntax.whenAnyAncestorIs(j)},ve.prototype.whenNoAncestorIs=function(j){return this._bindingWhenSyntax.whenNoAncestorIs(j)},ve.prototype.whenAnyAncestorNamed=function(j){return this._bindingWhenSyntax.whenAnyAncestorNamed(j)},ve.prototype.whenAnyAncestorTagged=function(j,le){return this._bindingWhenSyntax.whenAnyAncestorTagged(j,le)},ve.prototype.whenNoAncestorNamed=function(j){return this._bindingWhenSyntax.whenNoAncestorNamed(j)},ve.prototype.whenNoAncestorTagged=function(j,le){return this._bindingWhenSyntax.whenNoAncestorTagged(j,le)},ve.prototype.whenAnyAncestorMatches=function(j){return this._bindingWhenSyntax.whenAnyAncestorMatches(j)},ve.prototype.whenNoAncestorMatches=function(j){return this._bindingWhenSyntax.whenNoAncestorMatches(j)},ve.prototype.onActivation=function(j){return this._bindingOnSyntax.onActivation(j)},ve}();J.BindingWhenOnSyntax=m},98370:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.BindingWhenSyntax=void 0;var ue=N(51811),ye=N(80758),m=function(){function ve(j){this._binding=j}return ve.prototype.when=function(j){return this._binding.constraint=j,new ue.BindingOnSyntax(this._binding)},ve.prototype.whenTargetNamed=function(j){return this._binding.constraint=ye.namedConstraint(j),new ue.BindingOnSyntax(this._binding)},ve.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(j){var le=j.target!==null&&!j.target.isNamed()&&!j.target.isTagged();return le},new ue.BindingOnSyntax(this._binding)},ve.prototype.whenTargetTagged=function(j,le){return this._binding.constraint=ye.taggedConstraint(j)(le),new ue.BindingOnSyntax(this._binding)},ve.prototype.whenInjectedInto=function(j){return this._binding.constraint=function(le){return ye.typeConstraint(j)(le.parentRequest)},new ue.BindingOnSyntax(this._binding)},ve.prototype.whenParentNamed=function(j){return this._binding.constraint=function(le){return ye.namedConstraint(j)(le.parentRequest)},new ue.BindingOnSyntax(this._binding)},ve.prototype.whenParentTagged=function(j,le){return this._binding.constraint=function(se){return ye.taggedConstraint(j)(le)(se.parentRequest)},new ue.BindingOnSyntax(this._binding)},ve.prototype.whenAnyAncestorIs=function(j){return this._binding.constraint=function(le){return ye.traverseAncerstors(le,ye.typeConstraint(j))},new ue.BindingOnSyntax(this._binding)},ve.prototype.whenNoAncestorIs=function(j){return this._binding.constraint=function(le){return!ye.traverseAncerstors(le,ye.typeConstraint(j))},new ue.BindingOnSyntax(this._binding)},ve.prototype.whenAnyAncestorNamed=function(j){return this._binding.constraint=function(le){return ye.traverseAncerstors(le,ye.namedConstraint(j))},new ue.BindingOnSyntax(this._binding)},ve.prototype.whenNoAncestorNamed=function(j){return this._binding.constraint=function(le){return!ye.traverseAncerstors(le,ye.namedConstraint(j))},new ue.BindingOnSyntax(this._binding)},ve.prototype.whenAnyAncestorTagged=function(j,le){return this._binding.constraint=function(se){return ye.traverseAncerstors(se,ye.taggedConstraint(j)(le))},new ue.BindingOnSyntax(this._binding)},ve.prototype.whenNoAncestorTagged=function(j,le){return this._binding.constraint=function(se){return!ye.traverseAncerstors(se,ye.taggedConstraint(j)(le))},new ue.BindingOnSyntax(this._binding)},ve.prototype.whenAnyAncestorMatches=function(j){return this._binding.constraint=function(le){return ye.traverseAncerstors(le,j)},new ue.BindingOnSyntax(this._binding)},ve.prototype.whenNoAncestorMatches=function(j){return this._binding.constraint=function(le){return!ye.traverseAncerstors(le,j)},new ue.BindingOnSyntax(this._binding)},ve}();J.BindingWhenSyntax=m},80758:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.typeConstraint=J.namedConstraint=J.taggedConstraint=J.traverseAncerstors=void 0;var ue=N(6867),ye=N(47738),m=function(se,Ne){var ae=se.parentRequest;return ae!==null?Ne(ae)?!0:m(ae,Ne):!1};J.traverseAncerstors=m;var ve=function(se){return function(Ne){var ae=function(tt){return tt!==null&&tt.target!==null&&tt.target.matchesTag(se)(Ne)};return ae.metaData=new ye.Metadata(se,Ne),ae}};J.taggedConstraint=ve;var j=ve(ue.NAMED_TAG);J.namedConstraint=j;var le=function(se){return function(Ne){var ae=null;if(Ne!==null)if(ae=Ne.bindings[0],typeof se=="string"){var tt=ae.serviceIdentifier;return tt===se}else{var Le=Ne.bindings[0].implementationType;return se===Le}return!1}};J.typeConstraint=le},70600:function(Mt,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.multiBindToService=void 0;var N=function(ue){return function(ye){return function(){for(var m=[],ve=0;ve<arguments.length;ve++)m[ve]=arguments[ve];return m.forEach(function(j){return ue.bind(j).toService(ye)})}}};J.multiBindToService=N},85265:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.isStackOverflowExeption=void 0;var ue=N(16674);function ye(m){return m instanceof RangeError||m.message===ue.STACK_OVERFLOW}J.isStackOverflowExeption=ye},37791:function(Mt,J){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.id=void 0;var N=0;function ue(){return N++}J.id=ue},55800:function(Mt,J,N){"use strict";Object.defineProperty(J,"__esModule",{value:!0}),J.circularDependencyToException=J.listMetadataForTarget=J.listRegisteredBindingsForServiceIdentifier=J.getServiceIdentifierAsString=J.getFunctionName=void 0;var ue=N(16674);function ye(ae){if(typeof ae=="function"){var tt=ae;return tt.name}else{if(typeof ae=="symbol")return ae.toString();var tt=ae;return tt}}J.getServiceIdentifierAsString=ye;function m(ae,tt,Le){var it="",Vt=Le(ae,tt);return Vt.length!==0&&(it=`
Registered bindings:`,Vt.forEach(function(sr){var At="Object";sr.implementationType!==null&&(At=Ne(sr.implementationType)),it=it+`
 `+At,sr.constraint.metaData&&(it=it+" - "+sr.constraint.metaData)})),it}J.listRegisteredBindingsForServiceIdentifier=m;function ve(ae,tt){return ae.parentRequest===null?!1:ae.parentRequest.serviceIdentifier===tt?!0:ve(ae.parentRequest,tt)}function j(ae){function tt(it,Vt){Vt===void 0&&(Vt=[]);var sr=ye(it.serviceIdentifier);return Vt.push(sr),it.parentRequest!==null?tt(it.parentRequest,Vt):Vt}var Le=tt(ae);return Le.reverse().join(" --> ")}function le(ae){ae.childRequests.forEach(function(tt){if(ve(tt,tt.serviceIdentifier)){var Le=j(tt);throw new Error(ue.CIRCULAR_DEPENDENCY+" "+Le)}else le(tt)})}J.circularDependencyToException=le;function se(ae,tt){if(tt.isTagged()||tt.isNamed()){var Le="",it=tt.getNamedTag(),Vt=tt.getCustomTags();return it!==null&&(Le+=it.toString()+`
`),Vt!==null&&Vt.forEach(function(sr){Le+=sr.toString()+`
`})," "+ae+`
 `+ae+" - "+Le}else return" "+ae}J.listMetadataForTarget=se;function Ne(ae){if(ae.name)return ae.name;var tt=ae.toString(),Le=tt.match(/^function\s*([^\s(]+)/);return Le?Le[1]:"Anonymous function: "+tt}J.getFunctionName=Ne},31745:function(Mt){"use strict";Mt.exports=N,Mt.exports.default=N;var J=1e20;function N(j,le,se,Ne,ae,tt){this.fontSize=j||24,this.buffer=le===void 0?3:le,this.cutoff=Ne||.25,this.fontFamily=ae||"sans-serif",this.fontWeight=tt||"normal",this.radius=se||8;var Le=this.size=this.fontSize+this.buffer*2,it=Le+this.buffer*2,Vt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;Vt?this.canvas=my.createOffscreenCanvas(Le,Le,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=Le),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(it*it),this.gridInner=new Float64Array(it*it),this.f=new Float64Array(it),this.z=new Float64Array(it+1),this.v=new Uint16Array(it),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,Vt?this.middle=Math.round(Le/2*1):this.middle=Math.round(Le/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ue(j,le,se,Ne,ae,tt,Le){tt.fill(J,0,le*se),Le.fill(0,0,le*se);for(var it=(le-Ne)/2,Vt=0;Vt<ae;Vt++)for(var sr=0;sr<Ne;sr++){var At=(Vt+it)*le+sr+it,er=j.data[4*(Vt*Ne+sr)+3]/255;if(er===1)tt[At]=0,Le[At]=J;else if(er===0)tt[At]=J,Le[At]=0;else{var It=Math.max(0,.5-er),lt=Math.max(0,er-.5);tt[At]=It*It,Le[At]=lt*lt}}}function ye(j,le,se,Ne,ae,tt,Le){for(var it=0;it<le*se;it++){var Vt=Math.sqrt(Ne[it])-Math.sqrt(ae[it]);j[it]=Math.round(255-255*(Vt/tt+Le))}}N.prototype._draw=function(j,le){var se=this.ctx.measureText(j),Ne=se.width,ae=2*this.buffer,tt,Le,it,Vt,sr,At,er,It;le&&this.useMetrics?(sr=Math.floor(se.actualBoundingBoxAscent),It=this.buffer+Math.ceil(se.actualBoundingBoxAscent),At=this.buffer,er=this.buffer,Le=Math.min(this.size,Math.ceil(se.actualBoundingBoxRight-se.actualBoundingBoxLeft)),Vt=Math.min(this.size-At,Math.ceil(se.actualBoundingBoxAscent+se.actualBoundingBoxDescent)),tt=Le+ae,it=Vt+ae,this.ctx.textBaseline="alphabetic"):(tt=Le=this.size,it=Vt=this.size,sr=19*this.fontSize/24,At=er=0,It=this.middle,this.ctx.textBaseline="middle");var lt;Le&&Vt&&(this.ctx.clearRect(er,At,Le,Vt),this.ctx.fillText(j,this.buffer,It),lt=this.ctx.getImageData(er,At,Le,Vt));var dt=new Uint8ClampedArray(tt*it);return ue(lt,tt,it,Le,Vt,this.gridOuter,this.gridInner),m(this.gridOuter,tt,it,this.f,this.v,this.z),m(this.gridInner,tt,it,this.f,this.v,this.z),ye(dt,tt,it,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:dt,metrics:{width:Le,height:Vt,sdfWidth:tt,sdfHeight:it,top:sr,left:0,advance:Ne}}},N.prototype.draw=function(j){return this._draw(j,!1).data},N.prototype.drawWithMetrics=function(j){return this._draw(j,!0)};function m(j,le,se,Ne,ae,tt){for(var Le=0;Le<le;Le++)ve(j,Le,le,se,Ne,ae,tt);for(var it=0;it<se;it++)ve(j,it*le,1,le,Ne,ae,tt)}function ve(j,le,se,Ne,ae,tt,Le){var it,Vt,sr,At;for(tt[0]=0,Le[0]=-J,Le[1]=J,it=0;it<Ne;it++)ae[it]=j[le+it*se];for(it=1,Vt=0,sr=0;it<Ne;it++){do At=tt[Vt],sr=(ae[it]-ae[At]+it*it-At*At)/(it-At)/2;while(sr<=Le[Vt]&&--Vt>-1);Vt++,tt[Vt]=it,Le[Vt]=sr,Le[Vt+1]=J}for(it=0,Vt=0;it<Ne;it++){for(;Le[Vt+1]<it;)Vt++;At=tt[Vt],j[le+it*se]=ae[At]+(it-At)*(it-At)}}},18857:function(Mt,J,N){"use strict";N.r(J),N.d(J,{Function:function(){return cu},Interpreter:function(){return bo},default:function(){return Qu},evaluate:function(){return $u},vm:function(){return ue}});var ue={};N.r(ue),N.d(ue,{Script:function(){return Ml},compileFunction:function(){return wc},createContext:function(){return Kl},runInContext:function(){return Ku},runInNewContext:function(){return Tc}});var ye={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},m="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",ve={5:m,"5module":m+" export import",6:m+" const class extends export import super"},j=/^in(stanceof)?$/,le="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",se="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",Ne=new RegExp("["+le+"]"),ae=new RegExp("["+le+se+"]");le=se=null;var tt=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],Le=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function it(_,T){for(var F=65536,R=0;R<T.length;R+=2){if(F+=T[R],F>_)return!1;if(F+=T[R+1],F>=_)return!0}}function Vt(_,T){return _<65?_===36:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&Ne.test(String.fromCharCode(_)):T===!1?!1:it(_,tt)}function sr(_,T){return _<48?_===36:_<58?!0:_<65?!1:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&ae.test(String.fromCharCode(_)):T===!1?!1:it(_,tt)||it(_,Le)}var At=function(T,F){F===void 0&&(F={}),this.label=T,this.keyword=F.keyword,this.beforeExpr=!!F.beforeExpr,this.startsExpr=!!F.startsExpr,this.isLoop=!!F.isLoop,this.isAssign=!!F.isAssign,this.prefix=!!F.prefix,this.postfix=!!F.postfix,this.binop=F.binop||null,this.updateContext=null};function er(_,T){return new At(_,{beforeExpr:!0,binop:T})}var It={beforeExpr:!0},lt={startsExpr:!0},dt={};function tr(_,T){return T===void 0&&(T={}),T.keyword=_,dt[_]=new At(_,T)}var Y={num:new At("num",lt),regexp:new At("regexp",lt),string:new At("string",lt),name:new At("name",lt),eof:new At("eof"),bracketL:new At("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new At("]"),braceL:new At("{",{beforeExpr:!0,startsExpr:!0}),braceR:new At("}"),parenL:new At("(",{beforeExpr:!0,startsExpr:!0}),parenR:new At(")"),comma:new At(",",It),semi:new At(";",It),colon:new At(":",It),dot:new At("."),question:new At("?",It),questionDot:new At("?."),arrow:new At("=>",It),template:new At("template"),invalidTemplate:new At("invalidTemplate"),ellipsis:new At("...",It),backQuote:new At("`",lt),dollarBraceL:new At("${",{beforeExpr:!0,startsExpr:!0}),eq:new At("=",{beforeExpr:!0,isAssign:!0}),assign:new At("_=",{beforeExpr:!0,isAssign:!0}),incDec:new At("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new At("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:er("||",1),logicalAND:er("&&",2),bitwiseOR:er("|",3),bitwiseXOR:er("^",4),bitwiseAND:er("&",5),equality:er("==/!=/===/!==",6),relational:er("</>/<=/>=",7),bitShift:er("<</>>/>>>",8),plusMin:new At("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:er("%",10),star:er("*",10),slash:er("/",10),starstar:new At("**",{beforeExpr:!0}),coalesce:er("??",1),_break:tr("break"),_case:tr("case",It),_catch:tr("catch"),_continue:tr("continue"),_debugger:tr("debugger"),_default:tr("default",It),_do:tr("do",{isLoop:!0,beforeExpr:!0}),_else:tr("else",It),_finally:tr("finally"),_for:tr("for",{isLoop:!0}),_function:tr("function",lt),_if:tr("if"),_return:tr("return",It),_switch:tr("switch"),_throw:tr("throw",It),_try:tr("try"),_var:tr("var"),_const:tr("const"),_while:tr("while",{isLoop:!0}),_with:tr("with"),_new:tr("new",{beforeExpr:!0,startsExpr:!0}),_this:tr("this",lt),_super:tr("super",lt),_class:tr("class",lt),_extends:tr("extends",It),_export:tr("export"),_import:tr("import",lt),_null:tr("null",lt),_true:tr("true",lt),_false:tr("false",lt),_in:tr("in",{beforeExpr:!0,binop:7}),_instanceof:tr("instanceof",{beforeExpr:!0,binop:7}),_typeof:tr("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:tr("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:tr("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},$t=/\r\n?|\n|\u2028|\u2029/,gt=new RegExp($t.source,"g");function Je(_,T){return _===10||_===13||!T&&(_===8232||_===8233)}var xt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Qe=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Kt=Object.prototype,Sr=Kt.hasOwnProperty,Br=Kt.toString;function Jr(_,T){return Sr.call(_,T)}var Te=Array.isArray||function(_){return Br.call(_)==="[object Array]"};function Xe(_){return new RegExp("^(?:"+_.replace(/ /g,"|")+")$")}var ke=function(T,F){this.line=T,this.column=F};ke.prototype.offset=function(T){return new ke(this.line,this.column+T)};var St=function(T,F,R){this.start=F,this.end=R,T.sourceFile!==null&&(this.source=T.sourceFile)};function vt(_,T){for(var F=1,R=0;;){gt.lastIndex=R;var K=gt.exec(_);if(K&&K.index<T)++F,R=K.index+K[0].length;else return new ke(F,T-R)}}var zt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Yt(_){var T={};for(var F in zt)T[F]=_&&Jr(_,F)?_[F]:zt[F];if(T.ecmaVersion>=2015&&(T.ecmaVersion-=2009),T.allowReserved==null&&(T.allowReserved=T.ecmaVersion<5),Te(T.onToken)){var R=T.onToken;T.onToken=function(K){return R.push(K)}}return Te(T.onComment)&&(T.onComment=Cr(T,T.onComment)),T}function Cr(_,T){return function(F,R,K,xe,We,ct){var ht={type:F?"Block":"Line",value:R,start:K,end:xe};_.locations&&(ht.loc=new St(this,We,ct)),_.ranges&&(ht.range=[K,xe]),T.push(ht)}}var Yn=1,hn=2,Ki=Yn|hn,Zn=4,Wn=8,mi=16,qn=32,ui=64,ia=128;function ki(_,T){return hn|(_?Zn:0)|(T?Wn:0)}var Ai=0,Vi=1,sa=2,wi=3,Ca=4,Mn=5,Ei=function(T,F,R){this.options=T=Yt(T),this.sourceFile=T.sourceFile,this.keywords=Xe(ve[T.ecmaVersion>=6?6:T.sourceType==="module"?"5module":5]);var K="";if(T.allowReserved!==!0){for(var xe=T.ecmaVersion;!(K=ye[xe]);xe--);T.sourceType==="module"&&(K+=" await")}this.reservedWords=Xe(K);var We=(K?K+" ":"")+ye.strict;this.reservedWordsStrict=Xe(We),this.reservedWordsStrictBind=Xe(We+" "+ye.strictBind),this.input=String(F),this.containsEsc=!1,R?(this.pos=R,this.lineStart=this.input.lastIndexOf(`
`,R-1)+1,this.curLine=this.input.slice(0,this.lineStart).split($t).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=Y.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=T.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&T.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Yn),this.regexpState=null},Zi={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Ei.prototype.parse=function(){var T=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(T)},Zi.inFunction.get=function(){return(this.currentVarScope().flags&hn)>0},Zi.inGenerator.get=function(){return(this.currentVarScope().flags&Wn)>0},Zi.inAsync.get=function(){return(this.currentVarScope().flags&Zn)>0},Zi.allowSuper.get=function(){return(this.currentThisScope().flags&ui)>0},Zi.allowDirectSuper.get=function(){return(this.currentThisScope().flags&ia)>0},Zi.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Ei.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&hn)>0},Ei.extend=function(){for(var T=[],F=arguments.length;F--;)T[F]=arguments[F];for(var R=this,K=0;K<T.length;K++)R=T[K](R);return R},Ei.parse=function(T,F){return new this(F,T).parse()},Ei.parseExpressionAt=function(T,F,R){var K=new this(R,T,F);return K.nextToken(),K.parseExpression()},Ei.tokenizer=function(T,F){return new this(F,T)},Object.defineProperties(Ei.prototype,Zi);var $i=Ei.prototype,Wa=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;$i.strictDirective=function(_){for(;;){Qe.lastIndex=_,_+=Qe.exec(this.input)[0].length;var T=Wa.exec(this.input.slice(_));if(!T)return!1;if((T[1]||T[2])==="use strict"){Qe.lastIndex=_+T[0].length;var F=Qe.exec(this.input),R=F.index+F[0].length,K=this.input.charAt(R);return K===";"||K==="}"||$t.test(F[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(K)||K==="!"&&this.input.charAt(R+1)==="=")}_+=T[0].length,Qe.lastIndex=_,_+=Qe.exec(this.input)[0].length,this.input[_]===";"&&_++}},$i.eat=function(_){return this.type===_?(this.next(),!0):!1},$i.isContextual=function(_){return this.type===Y.name&&this.value===_&&!this.containsEsc},$i.eatContextual=function(_){return this.isContextual(_)?(this.next(),!0):!1},$i.expectContextual=function(_){this.eatContextual(_)||this.unexpected()},$i.canInsertSemicolon=function(){return this.type===Y.eof||this.type===Y.braceR||$t.test(this.input.slice(this.lastTokEnd,this.start))},$i.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},$i.semicolon=function(){!this.eat(Y.semi)&&!this.insertSemicolon()&&this.unexpected()},$i.afterTrailingComma=function(_,T){if(this.type===_)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),T||this.next(),!0},$i.expect=function(_){this.eat(_)||this.unexpected()},$i.unexpected=function(_){this.raise(_!=null?_:this.start,"Unexpected token")};function de(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}$i.checkPatternErrors=function(_,T){if(!!_){_.trailingComma>-1&&this.raiseRecoverable(_.trailingComma,"Comma is not permitted after the rest element");var F=T?_.parenthesizedAssign:_.parenthesizedBind;F>-1&&this.raiseRecoverable(F,"Parenthesized pattern")}},$i.checkExpressionErrors=function(_,T){if(!_)return!1;var F=_.shorthandAssign,R=_.doubleProto;if(!T)return F>=0||R>=0;F>=0&&this.raise(F,"Shorthand property assignments are valid only in destructuring patterns"),R>=0&&this.raiseRecoverable(R,"Redefinition of __proto__ property")},$i.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},$i.isSimpleAssignTarget=function(_){return _.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(_.expression):_.type==="Identifier"||_.type==="MemberExpression"};var Fn=Ei.prototype;Fn.parseTopLevel=function(_){var T={};for(_.body||(_.body=[]);this.type!==Y.eof;){var F=this.parseStatement(null,!0,T);_.body.push(F)}if(this.inModule)for(var R=0,K=Object.keys(this.undefinedExports);R<K.length;R+=1){var xe=K[R];this.raiseRecoverable(this.undefinedExports[xe].start,"Export '"+xe+"' is not defined")}return this.adaptDirectivePrologue(_.body),this.next(),_.sourceType=this.options.sourceType,this.finishNode(_,"Program")};var Xa={kind:"loop"},vs={kind:"switch"};Fn.isLet=function(_){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Qe.lastIndex=this.pos;var T=Qe.exec(this.input),F=this.pos+T[0].length,R=this.input.charCodeAt(F);if(R===91)return!0;if(_)return!1;if(R===123)return!0;if(Vt(R,!0)){for(var K=F+1;sr(this.input.charCodeAt(K),!0);)++K;var xe=this.input.slice(F,K);if(!j.test(xe))return!0}return!1},Fn.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Qe.lastIndex=this.pos;var _=Qe.exec(this.input),T=this.pos+_[0].length;return!$t.test(this.input.slice(this.pos,T))&&this.input.slice(T,T+8)==="function"&&(T+8===this.input.length||!sr(this.input.charAt(T+8)))},Fn.parseStatement=function(_,T,F){var R=this.type,K=this.startNode(),xe;switch(this.isLet(_)&&(R=Y._var,xe="let"),R){case Y._break:case Y._continue:return this.parseBreakContinueStatement(K,R.keyword);case Y._debugger:return this.parseDebuggerStatement(K);case Y._do:return this.parseDoStatement(K);case Y._for:return this.parseForStatement(K);case Y._function:return _&&(this.strict||_!=="if"&&_!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(K,!1,!_);case Y._class:return _&&this.unexpected(),this.parseClass(K,!0);case Y._if:return this.parseIfStatement(K);case Y._return:return this.parseReturnStatement(K);case Y._switch:return this.parseSwitchStatement(K);case Y._throw:return this.parseThrowStatement(K);case Y._try:return this.parseTryStatement(K);case Y._const:case Y._var:return xe=xe||this.value,_&&xe!=="var"&&this.unexpected(),this.parseVarStatement(K,xe);case Y._while:return this.parseWhileStatement(K);case Y._with:return this.parseWithStatement(K);case Y.braceL:return this.parseBlock(!0,K);case Y.semi:return this.parseEmptyStatement(K);case Y._export:case Y._import:if(this.options.ecmaVersion>10&&R===Y._import){Qe.lastIndex=this.pos;var We=Qe.exec(this.input),ct=this.pos+We[0].length,ht=this.input.charCodeAt(ct);if(ht===40||ht===46)return this.parseExpressionStatement(K,this.parseExpression())}return this.options.allowImportExportEverywhere||(T||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),R===Y._import?this.parseImport(K):this.parseExport(K,F);default:if(this.isAsyncFunction())return _&&this.unexpected(),this.next(),this.parseFunctionStatement(K,!0,!_);var cr=this.value,xr=this.parseExpression();return R===Y.name&&xr.type==="Identifier"&&this.eat(Y.colon)?this.parseLabeledStatement(K,cr,xr,_):this.parseExpressionStatement(K,xr)}},Fn.parseBreakContinueStatement=function(_,T){var F=T==="break";this.next(),this.eat(Y.semi)||this.insertSemicolon()?_.label=null:this.type!==Y.name?this.unexpected():(_.label=this.parseIdent(),this.semicolon());for(var R=0;R<this.labels.length;++R){var K=this.labels[R];if((_.label==null||K.name===_.label.name)&&(K.kind!=null&&(F||K.kind==="loop")||_.label&&F))break}return R===this.labels.length&&this.raise(_.start,"Unsyntactic "+T),this.finishNode(_,F?"BreakStatement":"ContinueStatement")},Fn.parseDebuggerStatement=function(_){return this.next(),this.semicolon(),this.finishNode(_,"DebuggerStatement")},Fn.parseDoStatement=function(_){return this.next(),this.labels.push(Xa),_.body=this.parseStatement("do"),this.labels.pop(),this.expect(Y._while),_.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(Y.semi):this.semicolon(),this.finishNode(_,"DoWhileStatement")},Fn.parseForStatement=function(_){this.next();var T=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Xa),this.enterScope(0),this.expect(Y.parenL),this.type===Y.semi)return T>-1&&this.unexpected(T),this.parseFor(_,null);var F=this.isLet();if(this.type===Y._var||this.type===Y._const||F){var R=this.startNode(),K=F?"let":this.value;return this.next(),this.parseVar(R,!0,K),this.finishNode(R,"VariableDeclaration"),(this.type===Y._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&R.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===Y._in?T>-1&&this.unexpected(T):_.await=T>-1),this.parseForIn(_,R)):(T>-1&&this.unexpected(T),this.parseFor(_,R))}var xe=new de,We=this.parseExpression(!0,xe);return this.type===Y._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===Y._in?T>-1&&this.unexpected(T):_.await=T>-1),this.toAssignable(We,!1,xe),this.checkLVal(We),this.parseForIn(_,We)):(this.checkExpressionErrors(xe,!0),T>-1&&this.unexpected(T),this.parseFor(_,We))},Fn.parseFunctionStatement=function(_,T,F){return this.next(),this.parseFunction(_,or|(F?0:Mr),!1,T)},Fn.parseIfStatement=function(_){return this.next(),_.test=this.parseParenExpression(),_.consequent=this.parseStatement("if"),_.alternate=this.eat(Y._else)?this.parseStatement("if"):null,this.finishNode(_,"IfStatement")},Fn.parseReturnStatement=function(_){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(Y.semi)||this.insertSemicolon()?_.argument=null:(_.argument=this.parseExpression(),this.semicolon()),this.finishNode(_,"ReturnStatement")},Fn.parseSwitchStatement=function(_){this.next(),_.discriminant=this.parseParenExpression(),_.cases=[],this.expect(Y.braceL),this.labels.push(vs),this.enterScope(0);for(var T,F=!1;this.type!==Y.braceR;)if(this.type===Y._case||this.type===Y._default){var R=this.type===Y._case;T&&this.finishNode(T,"SwitchCase"),_.cases.push(T=this.startNode()),T.consequent=[],this.next(),R?T.test=this.parseExpression():(F&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),F=!0,T.test=null),this.expect(Y.colon)}else T||this.unexpected(),T.consequent.push(this.parseStatement(null));return this.exitScope(),T&&this.finishNode(T,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(_,"SwitchStatement")},Fn.parseThrowStatement=function(_){return this.next(),$t.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),_.argument=this.parseExpression(),this.semicolon(),this.finishNode(_,"ThrowStatement")};var jt=[];Fn.parseTryStatement=function(_){if(this.next(),_.block=this.parseBlock(),_.handler=null,this.type===Y._catch){var T=this.startNode();if(this.next(),this.eat(Y.parenL)){T.param=this.parseBindingAtom();var F=T.param.type==="Identifier";this.enterScope(F?qn:0),this.checkLVal(T.param,F?Ca:sa),this.expect(Y.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),T.param=null,this.enterScope(0);T.body=this.parseBlock(!1),this.exitScope(),_.handler=this.finishNode(T,"CatchClause")}return _.finalizer=this.eat(Y._finally)?this.parseBlock():null,!_.handler&&!_.finalizer&&this.raise(_.start,"Missing catch or finally clause"),this.finishNode(_,"TryStatement")},Fn.parseVarStatement=function(_,T){return this.next(),this.parseVar(_,!1,T),this.semicolon(),this.finishNode(_,"VariableDeclaration")},Fn.parseWhileStatement=function(_){return this.next(),_.test=this.parseParenExpression(),this.labels.push(Xa),_.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(_,"WhileStatement")},Fn.parseWithStatement=function(_){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),_.object=this.parseParenExpression(),_.body=this.parseStatement("with"),this.finishNode(_,"WithStatement")},Fn.parseEmptyStatement=function(_){return this.next(),this.finishNode(_,"EmptyStatement")},Fn.parseLabeledStatement=function(_,T,F,R){for(var K=0,xe=this.labels;K<xe.length;K+=1){var We=xe[K];We.name===T&&this.raise(F.start,"Label '"+T+"' is already declared")}for(var ct=this.type.isLoop?"loop":this.type===Y._switch?"switch":null,ht=this.labels.length-1;ht>=0;ht--){var cr=this.labels[ht];if(cr.statementStart===_.start)cr.statementStart=this.start,cr.kind=ct;else break}return this.labels.push({name:T,kind:ct,statementStart:this.start}),_.body=this.parseStatement(R?R.indexOf("label")===-1?R+"label":R:"label"),this.labels.pop(),_.label=F,this.finishNode(_,"LabeledStatement")},Fn.parseExpressionStatement=function(_,T){return _.expression=T,this.semicolon(),this.finishNode(_,"ExpressionStatement")},Fn.parseBlock=function(_,T,F){for(_===void 0&&(_=!0),T===void 0&&(T=this.startNode()),T.body=[],this.expect(Y.braceL),_&&this.enterScope(0);this.type!==Y.braceR;){var R=this.parseStatement(null);T.body.push(R)}return F&&(this.strict=!1),this.next(),_&&this.exitScope(),this.finishNode(T,"BlockStatement")},Fn.parseFor=function(_,T){return _.init=T,this.expect(Y.semi),_.test=this.type===Y.semi?null:this.parseExpression(),this.expect(Y.semi),_.update=this.type===Y.parenR?null:this.parseExpression(),this.expect(Y.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,"ForStatement")},Fn.parseForIn=function(_,T){var F=this.type===Y._in;return this.next(),T.type==="VariableDeclaration"&&T.declarations[0].init!=null&&(!F||this.options.ecmaVersion<8||this.strict||T.kind!=="var"||T.declarations[0].id.type!=="Identifier")?this.raise(T.start,(F?"for-in":"for-of")+" loop variable declaration may not have an initializer"):T.type==="AssignmentPattern"&&this.raise(T.start,"Invalid left-hand side in for-loop"),_.left=T,_.right=F?this.parseExpression():this.parseMaybeAssign(),this.expect(Y.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,F?"ForInStatement":"ForOfStatement")},Fn.parseVar=function(_,T,F){for(_.declarations=[],_.kind=F;;){var R=this.startNode();if(this.parseVarId(R,F),this.eat(Y.eq)?R.init=this.parseMaybeAssign(T):F==="const"&&!(this.type===Y._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():R.id.type!=="Identifier"&&!(T&&(this.type===Y._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):R.init=null,_.declarations.push(this.finishNode(R,"VariableDeclarator")),!this.eat(Y.comma))break}return _},Fn.parseVarId=function(_,T){_.id=this.parseBindingAtom(),this.checkLVal(_.id,T==="var"?Vi:sa,!1)};var or=1,Mr=2,I=4;Fn.parseFunction=function(_,T,F,R){this.initFunction(_),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!R)&&(this.type===Y.star&&T&Mr&&this.unexpected(),_.generator=this.eat(Y.star)),this.options.ecmaVersion>=8&&(_.async=!!R),T&or&&(_.id=T&I&&this.type!==Y.name?null:this.parseIdent(),_.id&&!(T&Mr)&&this.checkLVal(_.id,this.strict||_.generator||_.async?this.treatFunctionsAsVar?Vi:sa:wi));var K=this.yieldPos,xe=this.awaitPos,We=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(ki(_.async,_.generator)),T&or||(_.id=this.type===Y.name?this.parseIdent():null),this.parseFunctionParams(_),this.parseFunctionBody(_,F,!1),this.yieldPos=K,this.awaitPos=xe,this.awaitIdentPos=We,this.finishNode(_,T&or?"FunctionDeclaration":"FunctionExpression")},Fn.parseFunctionParams=function(_){this.expect(Y.parenL),_.params=this.parseBindingList(Y.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},Fn.parseClass=function(_,T){this.next();var F=this.strict;this.strict=!0,this.parseClassId(_,T),this.parseClassSuper(_);var R=this.startNode(),K=!1;for(R.body=[],this.expect(Y.braceL);this.type!==Y.braceR;){var xe=this.parseClassElement(_.superClass!==null);xe&&(R.body.push(xe),xe.type==="MethodDefinition"&&xe.kind==="constructor"&&(K&&this.raise(xe.start,"Duplicate constructor in the same class"),K=!0))}return this.strict=F,this.next(),_.body=this.finishNode(R,"ClassBody"),this.finishNode(_,T?"ClassDeclaration":"ClassExpression")},Fn.parseClassElement=function(_){var T=this;if(this.eat(Y.semi))return null;var F=this.startNode(),R=function(ht,cr){cr===void 0&&(cr=!1);var xr=T.start,Rn=T.startLoc;return T.eatContextual(ht)?T.type!==Y.parenL&&(!cr||!T.canInsertSemicolon())?!0:(F.key&&T.unexpected(),F.computed=!1,F.key=T.startNodeAt(xr,Rn),F.key.name=ht,T.finishNode(F.key,"Identifier"),!1):!1};F.kind="method",F.static=R("static");var K=this.eat(Y.star),xe=!1;K||(this.options.ecmaVersion>=8&&R("async",!0)?(xe=!0,K=this.options.ecmaVersion>=9&&this.eat(Y.star)):R("get")?F.kind="get":R("set")&&(F.kind="set")),F.key||this.parsePropertyName(F);var We=F.key,ct=!1;return!F.computed&&!F.static&&(We.type==="Identifier"&&We.name==="constructor"||We.type==="Literal"&&We.value==="constructor")?(F.kind!=="method"&&this.raise(We.start,"Constructor can't have get/set modifier"),K&&this.raise(We.start,"Constructor can't be a generator"),xe&&this.raise(We.start,"Constructor can't be an async method"),F.kind="constructor",ct=_):F.static&&We.type==="Identifier"&&We.name==="prototype"&&this.raise(We.start,"Classes may not have a static property named prototype"),this.parseClassMethod(F,K,xe,ct),F.kind==="get"&&F.value.params.length!==0&&this.raiseRecoverable(F.value.start,"getter should have no params"),F.kind==="set"&&F.value.params.length!==1&&this.raiseRecoverable(F.value.start,"setter should have exactly one param"),F.kind==="set"&&F.value.params[0].type==="RestElement"&&this.raiseRecoverable(F.value.params[0].start,"Setter cannot use rest params"),F},Fn.parseClassMethod=function(_,T,F,R){return _.value=this.parseMethod(T,F,R),this.finishNode(_,"MethodDefinition")},Fn.parseClassId=function(_,T){this.type===Y.name?(_.id=this.parseIdent(),T&&this.checkLVal(_.id,sa,!1)):(T===!0&&this.unexpected(),_.id=null)},Fn.parseClassSuper=function(_){_.superClass=this.eat(Y._extends)?this.parseExprSubscripts():null},Fn.parseExport=function(_,T){if(this.next(),this.eat(Y.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(_.exported=this.parseIdent(!0),this.checkExport(T,_.exported.name,this.lastTokStart)):_.exported=null),this.expectContextual("from"),this.type!==Y.string&&this.unexpected(),_.source=this.parseExprAtom(),this.semicolon(),this.finishNode(_,"ExportAllDeclaration");if(this.eat(Y._default)){this.checkExport(T,"default",this.lastTokStart);var F;if(this.type===Y._function||(F=this.isAsyncFunction())){var R=this.startNode();this.next(),F&&this.next(),_.declaration=this.parseFunction(R,or|I,!1,F)}else if(this.type===Y._class){var K=this.startNode();_.declaration=this.parseClass(K,"nullableID")}else _.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(_,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())_.declaration=this.parseStatement(null),_.declaration.type==="VariableDeclaration"?this.checkVariableExport(T,_.declaration.declarations):this.checkExport(T,_.declaration.id.name,_.declaration.id.start),_.specifiers=[],_.source=null;else{if(_.declaration=null,_.specifiers=this.parseExportSpecifiers(T),this.eatContextual("from"))this.type!==Y.string&&this.unexpected(),_.source=this.parseExprAtom();else{for(var xe=0,We=_.specifiers;xe<We.length;xe+=1){var ct=We[xe];this.checkUnreserved(ct.local),this.checkLocalExport(ct.local)}_.source=null}this.semicolon()}return this.finishNode(_,"ExportNamedDeclaration")},Fn.checkExport=function(_,T,F){!_||(Jr(_,T)&&this.raiseRecoverable(F,"Duplicate export '"+T+"'"),_[T]=!0)},Fn.checkPatternExport=function(_,T){var F=T.type;if(F==="Identifier")this.checkExport(_,T.name,T.start);else if(F==="ObjectPattern")for(var R=0,K=T.properties;R<K.length;R+=1){var xe=K[R];this.checkPatternExport(_,xe)}else if(F==="ArrayPattern")for(var We=0,ct=T.elements;We<ct.length;We+=1){var ht=ct[We];ht&&this.checkPatternExport(_,ht)}else F==="Property"?this.checkPatternExport(_,T.value):F==="AssignmentPattern"?this.checkPatternExport(_,T.left):F==="RestElement"?this.checkPatternExport(_,T.argument):F==="ParenthesizedExpression"&&this.checkPatternExport(_,T.expression)},Fn.checkVariableExport=function(_,T){if(!!_)for(var F=0,R=T;F<R.length;F+=1){var K=R[F];this.checkPatternExport(_,K.id)}},Fn.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},Fn.parseExportSpecifiers=function(_){var T=[],F=!0;for(this.expect(Y.braceL);!this.eat(Y.braceR);){if(F)F=!1;else if(this.expect(Y.comma),this.afterTrailingComma(Y.braceR))break;var R=this.startNode();R.local=this.parseIdent(!0),R.exported=this.eatContextual("as")?this.parseIdent(!0):R.local,this.checkExport(_,R.exported.name,R.exported.start),T.push(this.finishNode(R,"ExportSpecifier"))}return T},Fn.parseImport=function(_){return this.next(),this.type===Y.string?(_.specifiers=jt,_.source=this.parseExprAtom()):(_.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),_.source=this.type===Y.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(_,"ImportDeclaration")},Fn.parseImportSpecifiers=function(){var _=[],T=!0;if(this.type===Y.name){var F=this.startNode();if(F.local=this.parseIdent(),this.checkLVal(F.local,sa),_.push(this.finishNode(F,"ImportDefaultSpecifier")),!this.eat(Y.comma))return _}if(this.type===Y.star){var R=this.startNode();return this.next(),this.expectContextual("as"),R.local=this.parseIdent(),this.checkLVal(R.local,sa),_.push(this.finishNode(R,"ImportNamespaceSpecifier")),_}for(this.expect(Y.braceL);!this.eat(Y.braceR);){if(T)T=!1;else if(this.expect(Y.comma),this.afterTrailingComma(Y.braceR))break;var K=this.startNode();K.imported=this.parseIdent(!0),this.eatContextual("as")?K.local=this.parseIdent():(this.checkUnreserved(K.imported),K.local=K.imported),this.checkLVal(K.local,sa),_.push(this.finishNode(K,"ImportSpecifier"))}return _},Fn.adaptDirectivePrologue=function(_){for(var T=0;T<_.length&&this.isDirectiveCandidate(_[T]);++T)_[T].directive=_[T].expression.raw.slice(1,-1)},Fn.isDirectiveCandidate=function(_){return _.type==="ExpressionStatement"&&_.expression.type==="Literal"&&typeof _.expression.value=="string"&&(this.input[_.start]==='"'||this.input[_.start]==="'")};var ar=Ei.prototype;ar.toAssignable=function(_,T,F){if(this.options.ecmaVersion>=6&&_)switch(_.type){case"Identifier":this.inAsync&&_.name==="await"&&this.raise(_.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":_.type="ObjectPattern",F&&this.checkPatternErrors(F,!0);for(var R=0,K=_.properties;R<K.length;R+=1){var xe=K[R];this.toAssignable(xe,T),xe.type==="RestElement"&&(xe.argument.type==="ArrayPattern"||xe.argument.type==="ObjectPattern")&&this.raise(xe.argument.start,"Unexpected token")}break;case"Property":_.kind!=="init"&&this.raise(_.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(_.value,T);break;case"ArrayExpression":_.type="ArrayPattern",F&&this.checkPatternErrors(F,!0),this.toAssignableList(_.elements,T);break;case"SpreadElement":_.type="RestElement",this.toAssignable(_.argument,T),_.argument.type==="AssignmentPattern"&&this.raise(_.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":_.operator!=="="&&this.raise(_.left.end,"Only '=' operator can be used for specifying default value."),_.type="AssignmentPattern",delete _.operator,this.toAssignable(_.left,T);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(_.expression,T,F);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!T)break;default:this.raise(_.start,"Assigning to rvalue")}else F&&this.checkPatternErrors(F,!0);return _},ar.toAssignableList=function(_,T){for(var F=_.length,R=0;R<F;R++){var K=_[R];K&&this.toAssignable(K,T)}if(F){var xe=_[F-1];this.options.ecmaVersion===6&&T&&xe&&xe.type==="RestElement"&&xe.argument.type!=="Identifier"&&this.unexpected(xe.argument.start)}return _},ar.parseSpread=function(_){var T=this.startNode();return this.next(),T.argument=this.parseMaybeAssign(!1,_),this.finishNode(T,"SpreadElement")},ar.parseRestBinding=function(){var _=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==Y.name&&this.unexpected(),_.argument=this.parseBindingAtom(),this.finishNode(_,"RestElement")},ar.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case Y.bracketL:var _=this.startNode();return this.next(),_.elements=this.parseBindingList(Y.bracketR,!0,!0),this.finishNode(_,"ArrayPattern");case Y.braceL:return this.parseObj(!0)}return this.parseIdent()},ar.parseBindingList=function(_,T,F){for(var R=[],K=!0;!this.eat(_);)if(K?K=!1:this.expect(Y.comma),T&&this.type===Y.comma)R.push(null);else{if(F&&this.afterTrailingComma(_))break;if(this.type===Y.ellipsis){var xe=this.parseRestBinding();this.parseBindingListItem(xe),R.push(xe),this.type===Y.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(_);break}else{var We=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(We),R.push(We)}}return R},ar.parseBindingListItem=function(_){return _},ar.parseMaybeDefault=function(_,T,F){if(F=F||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(Y.eq))return F;var R=this.startNodeAt(_,T);return R.left=F,R.right=this.parseMaybeAssign(),this.finishNode(R,"AssignmentPattern")},ar.checkLVal=function(_,T,F){switch(T===void 0&&(T=Ai),_.type){case"Identifier":T===sa&&_.name==="let"&&this.raiseRecoverable(_.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(_.name)&&this.raiseRecoverable(_.start,(T?"Binding ":"Assigning to ")+_.name+" in strict mode"),F&&(Jr(F,_.name)&&this.raiseRecoverable(_.start,"Argument name clash"),F[_.name]=!0),T!==Ai&&T!==Mn&&this.declareName(_.name,T,_.start);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":T&&this.raiseRecoverable(_.start,"Binding member expression");break;case"ObjectPattern":for(var R=0,K=_.properties;R<K.length;R+=1){var xe=K[R];this.checkLVal(xe,T,F)}break;case"Property":this.checkLVal(_.value,T,F);break;case"ArrayPattern":for(var We=0,ct=_.elements;We<ct.length;We+=1){var ht=ct[We];ht&&this.checkLVal(ht,T,F)}break;case"AssignmentPattern":this.checkLVal(_.left,T,F);break;case"RestElement":this.checkLVal(_.argument,T,F);break;case"ParenthesizedExpression":this.checkLVal(_.expression,T,F);break;default:this.raise(_.start,(T?"Binding":"Assigning to")+" rvalue")}};var kn=Ei.prototype;kn.checkPropClash=function(_,T,F){if(!(this.options.ecmaVersion>=9&&_.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(_.computed||_.method||_.shorthand))){var R=_.key,K;switch(R.type){case"Identifier":K=R.name;break;case"Literal":K=String(R.value);break;default:return}var xe=_.kind;if(this.options.ecmaVersion>=6){K==="__proto__"&&xe==="init"&&(T.proto&&(F?F.doubleProto<0&&(F.doubleProto=R.start):this.raiseRecoverable(R.start,"Redefinition of __proto__ property")),T.proto=!0);return}K="$"+K;var We=T[K];if(We){var ct;xe==="init"?ct=this.strict&&We.init||We.get||We.set:ct=We.init||We[xe],ct&&this.raiseRecoverable(R.start,"Redefinition of property")}else We=T[K]={init:!1,get:!1,set:!1};We[xe]=!0}},kn.parseExpression=function(_,T){var F=this.start,R=this.startLoc,K=this.parseMaybeAssign(_,T);if(this.type===Y.comma){var xe=this.startNodeAt(F,R);for(xe.expressions=[K];this.eat(Y.comma);)xe.expressions.push(this.parseMaybeAssign(_,T));return this.finishNode(xe,"SequenceExpression")}return K},kn.parseMaybeAssign=function(_,T,F){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(_);this.exprAllowed=!1}var R=!1,K=-1,xe=-1;T?(K=T.parenthesizedAssign,xe=T.trailingComma,T.parenthesizedAssign=T.trailingComma=-1):(T=new de,R=!0);var We=this.start,ct=this.startLoc;(this.type===Y.parenL||this.type===Y.name)&&(this.potentialArrowAt=this.start);var ht=this.parseMaybeConditional(_,T);if(F&&(ht=F.call(this,ht,We,ct)),this.type.isAssign){var cr=this.startNodeAt(We,ct);return cr.operator=this.value,cr.left=this.type===Y.eq?this.toAssignable(ht,!1,T):ht,R||(T.parenthesizedAssign=T.trailingComma=T.doubleProto=-1),T.shorthandAssign>=cr.left.start&&(T.shorthandAssign=-1),this.checkLVal(ht),this.next(),cr.right=this.parseMaybeAssign(_),this.finishNode(cr,"AssignmentExpression")}else R&&this.checkExpressionErrors(T,!0);return K>-1&&(T.parenthesizedAssign=K),xe>-1&&(T.trailingComma=xe),ht},kn.parseMaybeConditional=function(_,T){var F=this.start,R=this.startLoc,K=this.parseExprOps(_,T);if(this.checkExpressionErrors(T))return K;if(this.eat(Y.question)){var xe=this.startNodeAt(F,R);return xe.test=K,xe.consequent=this.parseMaybeAssign(),this.expect(Y.colon),xe.alternate=this.parseMaybeAssign(_),this.finishNode(xe,"ConditionalExpression")}return K},kn.parseExprOps=function(_,T){var F=this.start,R=this.startLoc,K=this.parseMaybeUnary(T,!1);return this.checkExpressionErrors(T)||K.start===F&&K.type==="ArrowFunctionExpression"?K:this.parseExprOp(K,F,R,-1,_)},kn.parseExprOp=function(_,T,F,R,K){var xe=this.type.binop;if(xe!=null&&(!K||this.type!==Y._in)&&xe>R){var We=this.type===Y.logicalOR||this.type===Y.logicalAND,ct=this.type===Y.coalesce;ct&&(xe=Y.logicalAND.binop);var ht=this.value;this.next();var cr=this.start,xr=this.startLoc,Rn=this.parseExprOp(this.parseMaybeUnary(null,!1),cr,xr,xe,K),ci=this.buildBinary(T,F,_,Rn,ht,We||ct);return(We&&this.type===Y.coalesce||ct&&(this.type===Y.logicalOR||this.type===Y.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(ci,T,F,R,K)}return _},kn.buildBinary=function(_,T,F,R,K,xe){var We=this.startNodeAt(_,T);return We.left=F,We.operator=K,We.right=R,this.finishNode(We,xe?"LogicalExpression":"BinaryExpression")},kn.parseMaybeUnary=function(_,T){var F=this.start,R=this.startLoc,K;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))K=this.parseAwait(),T=!0;else if(this.type.prefix){var xe=this.startNode(),We=this.type===Y.incDec;xe.operator=this.value,xe.prefix=!0,this.next(),xe.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(_,!0),We?this.checkLVal(xe.argument):this.strict&&xe.operator==="delete"&&xe.argument.type==="Identifier"?this.raiseRecoverable(xe.start,"Deleting local variable in strict mode"):T=!0,K=this.finishNode(xe,We?"UpdateExpression":"UnaryExpression")}else{if(K=this.parseExprSubscripts(_),this.checkExpressionErrors(_))return K;for(;this.type.postfix&&!this.canInsertSemicolon();){var ct=this.startNodeAt(F,R);ct.operator=this.value,ct.prefix=!1,ct.argument=K,this.checkLVal(K),this.next(),K=this.finishNode(ct,"UpdateExpression")}}return!T&&this.eat(Y.starstar)?this.buildBinary(F,R,K,this.parseMaybeUnary(null,!1),"**",!1):K},kn.parseExprSubscripts=function(_){var T=this.start,F=this.startLoc,R=this.parseExprAtom(_);if(R.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return R;var K=this.parseSubscripts(R,T,F);return _&&K.type==="MemberExpression"&&(_.parenthesizedAssign>=K.start&&(_.parenthesizedAssign=-1),_.parenthesizedBind>=K.start&&(_.parenthesizedBind=-1)),K},kn.parseSubscripts=function(_,T,F,R){for(var K=this.options.ecmaVersion>=8&&_.type==="Identifier"&&_.name==="async"&&this.lastTokEnd===_.end&&!this.canInsertSemicolon()&&_.end-_.start==5&&this.potentialArrowAt===_.start,xe=!1;;){var We=this.parseSubscript(_,T,F,R,K,xe);if(We.optional&&(xe=!0),We===_||We.type==="ArrowFunctionExpression"){if(xe){var ct=this.startNodeAt(T,F);ct.expression=We,We=this.finishNode(ct,"ChainExpression")}return We}_=We}},kn.parseSubscript=function(_,T,F,R,K,xe){var We=this.options.ecmaVersion>=11,ct=We&&this.eat(Y.questionDot);R&&ct&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var ht=this.eat(Y.bracketL);if(ht||ct&&this.type!==Y.parenL&&this.type!==Y.backQuote||this.eat(Y.dot)){var cr=this.startNodeAt(T,F);cr.object=_,cr.property=ht?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),cr.computed=!!ht,ht&&this.expect(Y.bracketR),We&&(cr.optional=ct),_=this.finishNode(cr,"MemberExpression")}else if(!R&&this.eat(Y.parenL)){var xr=new de,Rn=this.yieldPos,ci=this.awaitPos,Jn=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Yi=this.parseExprList(Y.parenR,this.options.ecmaVersion>=8,!1,xr);if(K&&!ct&&!this.canInsertSemicolon()&&this.eat(Y.arrow))return this.checkPatternErrors(xr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Rn,this.awaitPos=ci,this.awaitIdentPos=Jn,this.parseArrowExpression(this.startNodeAt(T,F),Yi,!0);this.checkExpressionErrors(xr,!0),this.yieldPos=Rn||this.yieldPos,this.awaitPos=ci||this.awaitPos,this.awaitIdentPos=Jn||this.awaitIdentPos;var ha=this.startNodeAt(T,F);ha.callee=_,ha.arguments=Yi,We&&(ha.optional=ct),_=this.finishNode(ha,"CallExpression")}else if(this.type===Y.backQuote){(ct||xe)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var La=this.startNodeAt(T,F);La.tag=_,La.quasi=this.parseTemplate({isTagged:!0}),_=this.finishNode(La,"TaggedTemplateExpression")}return _},kn.parseExprAtom=function(_){this.type===Y.slash&&this.readRegexp();var T,F=this.potentialArrowAt===this.start;switch(this.type){case Y._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),T=this.startNode(),this.next(),this.type===Y.parenL&&!this.allowDirectSuper&&this.raise(T.start,"super() call outside constructor of a subclass"),this.type!==Y.dot&&this.type!==Y.bracketL&&this.type!==Y.parenL&&this.unexpected(),this.finishNode(T,"Super");case Y._this:return T=this.startNode(),this.next(),this.finishNode(T,"ThisExpression");case Y.name:var R=this.start,K=this.startLoc,xe=this.containsEsc,We=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!xe&&We.name==="async"&&!this.canInsertSemicolon()&&this.eat(Y._function))return this.parseFunction(this.startNodeAt(R,K),0,!1,!0);if(F&&!this.canInsertSemicolon()){if(this.eat(Y.arrow))return this.parseArrowExpression(this.startNodeAt(R,K),[We],!1);if(this.options.ecmaVersion>=8&&We.name==="async"&&this.type===Y.name&&!xe)return We=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(Y.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(R,K),[We],!0)}return We;case Y.regexp:var ct=this.value;return T=this.parseLiteral(ct.value),T.regex={pattern:ct.pattern,flags:ct.flags},T;case Y.num:case Y.string:return this.parseLiteral(this.value);case Y._null:case Y._true:case Y._false:return T=this.startNode(),T.value=this.type===Y._null?null:this.type===Y._true,T.raw=this.type.keyword,this.next(),this.finishNode(T,"Literal");case Y.parenL:var ht=this.start,cr=this.parseParenAndDistinguishExpression(F);return _&&(_.parenthesizedAssign<0&&!this.isSimpleAssignTarget(cr)&&(_.parenthesizedAssign=ht),_.parenthesizedBind<0&&(_.parenthesizedBind=ht)),cr;case Y.bracketL:return T=this.startNode(),this.next(),T.elements=this.parseExprList(Y.bracketR,!0,!0,_),this.finishNode(T,"ArrayExpression");case Y.braceL:return this.parseObj(!1,_);case Y._function:return T=this.startNode(),this.next(),this.parseFunction(T,0);case Y._class:return this.parseClass(this.startNode(),!1);case Y._new:return this.parseNew();case Y.backQuote:return this.parseTemplate();case Y._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},kn.parseExprImport=function(){var _=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var T=this.parseIdent(!0);switch(this.type){case Y.parenL:return this.parseDynamicImport(_);case Y.dot:return _.meta=T,this.parseImportMeta(_);default:this.unexpected()}},kn.parseDynamicImport=function(_){if(this.next(),_.source=this.parseMaybeAssign(),!this.eat(Y.parenR)){var T=this.start;this.eat(Y.comma)&&this.eat(Y.parenR)?this.raiseRecoverable(T,"Trailing comma is not allowed in import()"):this.unexpected(T)}return this.finishNode(_,"ImportExpression")},kn.parseImportMeta=function(_){this.next();var T=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="meta"&&this.raiseRecoverable(_.property.start,"The only valid meta property for import is 'import.meta'"),T&&this.raiseRecoverable(_.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(_.start,"Cannot use 'import.meta' outside a module"),this.finishNode(_,"MetaProperty")},kn.parseLiteral=function(_){var T=this.startNode();return T.value=_,T.raw=this.input.slice(this.start,this.end),T.raw.charCodeAt(T.raw.length-1)===110&&(T.bigint=T.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(T,"Literal")},kn.parseParenExpression=function(){this.expect(Y.parenL);var _=this.parseExpression();return this.expect(Y.parenR),_},kn.parseParenAndDistinguishExpression=function(_){var T=this.start,F=this.startLoc,R,K=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var xe=this.start,We=this.startLoc,ct=[],ht=!0,cr=!1,xr=new de,Rn=this.yieldPos,ci=this.awaitPos,Jn;for(this.yieldPos=0,this.awaitPos=0;this.type!==Y.parenR;)if(ht?ht=!1:this.expect(Y.comma),K&&this.afterTrailingComma(Y.parenR,!0)){cr=!0;break}else if(this.type===Y.ellipsis){Jn=this.start,ct.push(this.parseParenItem(this.parseRestBinding())),this.type===Y.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else ct.push(this.parseMaybeAssign(!1,xr,this.parseParenItem));var Yi=this.start,ha=this.startLoc;if(this.expect(Y.parenR),_&&!this.canInsertSemicolon()&&this.eat(Y.arrow))return this.checkPatternErrors(xr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Rn,this.awaitPos=ci,this.parseParenArrowList(T,F,ct);(!ct.length||cr)&&this.unexpected(this.lastTokStart),Jn&&this.unexpected(Jn),this.checkExpressionErrors(xr,!0),this.yieldPos=Rn||this.yieldPos,this.awaitPos=ci||this.awaitPos,ct.length>1?(R=this.startNodeAt(xe,We),R.expressions=ct,this.finishNodeAt(R,"SequenceExpression",Yi,ha)):R=ct[0]}else R=this.parseParenExpression();if(this.options.preserveParens){var La=this.startNodeAt(T,F);return La.expression=R,this.finishNode(La,"ParenthesizedExpression")}else return R},kn.parseParenItem=function(_){return _},kn.parseParenArrowList=function(_,T,F){return this.parseArrowExpression(this.startNodeAt(_,T),F)};var li=[];kn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var _=this.startNode(),T=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(Y.dot)){_.meta=T;var F=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="target"&&this.raiseRecoverable(_.property.start,"The only valid meta property for new is 'new.target'"),F&&this.raiseRecoverable(_.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(_.start,"'new.target' can only be used in functions"),this.finishNode(_,"MetaProperty")}var R=this.start,K=this.startLoc,xe=this.type===Y._import;return _.callee=this.parseSubscripts(this.parseExprAtom(),R,K,!0),xe&&_.callee.type==="ImportExpression"&&this.raise(R,"Cannot use new with import()"),this.eat(Y.parenL)?_.arguments=this.parseExprList(Y.parenR,this.options.ecmaVersion>=8,!1):_.arguments=li,this.finishNode(_,"NewExpression")},kn.parseTemplateElement=function(_){var T=_.isTagged,F=this.startNode();return this.type===Y.invalidTemplate?(T||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),F.value={raw:this.value,cooked:null}):F.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),F.tail=this.type===Y.backQuote,this.finishNode(F,"TemplateElement")},kn.parseTemplate=function(_){_===void 0&&(_={});var T=_.isTagged;T===void 0&&(T=!1);var F=this.startNode();this.next(),F.expressions=[];var R=this.parseTemplateElement({isTagged:T});for(F.quasis=[R];!R.tail;)this.type===Y.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(Y.dollarBraceL),F.expressions.push(this.parseExpression()),this.expect(Y.braceR),F.quasis.push(R=this.parseTemplateElement({isTagged:T}));return this.next(),this.finishNode(F,"TemplateLiteral")},kn.isAsyncProp=function(_){return!_.computed&&_.key.type==="Identifier"&&_.key.name==="async"&&(this.type===Y.name||this.type===Y.num||this.type===Y.string||this.type===Y.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===Y.star)&&!$t.test(this.input.slice(this.lastTokEnd,this.start))},kn.parseObj=function(_,T){var F=this.startNode(),R=!0,K={};for(F.properties=[],this.next();!this.eat(Y.braceR);){if(R)R=!1;else if(this.expect(Y.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(Y.braceR))break;var xe=this.parseProperty(_,T);_||this.checkPropClash(xe,K,T),F.properties.push(xe)}return this.finishNode(F,_?"ObjectPattern":"ObjectExpression")},kn.parseProperty=function(_,T){var F=this.startNode(),R,K,xe,We;if(this.options.ecmaVersion>=9&&this.eat(Y.ellipsis))return _?(F.argument=this.parseIdent(!1),this.type===Y.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(F,"RestElement")):(this.type===Y.parenL&&T&&(T.parenthesizedAssign<0&&(T.parenthesizedAssign=this.start),T.parenthesizedBind<0&&(T.parenthesizedBind=this.start)),F.argument=this.parseMaybeAssign(!1,T),this.type===Y.comma&&T&&T.trailingComma<0&&(T.trailingComma=this.start),this.finishNode(F,"SpreadElement"));this.options.ecmaVersion>=6&&(F.method=!1,F.shorthand=!1,(_||T)&&(xe=this.start,We=this.startLoc),_||(R=this.eat(Y.star)));var ct=this.containsEsc;return this.parsePropertyName(F),!_&&!ct&&this.options.ecmaVersion>=8&&!R&&this.isAsyncProp(F)?(K=!0,R=this.options.ecmaVersion>=9&&this.eat(Y.star),this.parsePropertyName(F,T)):K=!1,this.parsePropertyValue(F,_,R,K,xe,We,T,ct),this.finishNode(F,"Property")},kn.parsePropertyValue=function(_,T,F,R,K,xe,We,ct){if((F||R)&&this.type===Y.colon&&this.unexpected(),this.eat(Y.colon))_.value=T?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,We),_.kind="init";else if(this.options.ecmaVersion>=6&&this.type===Y.parenL)T&&this.unexpected(),_.kind="init",_.method=!0,_.value=this.parseMethod(F,R);else if(!T&&!ct&&this.options.ecmaVersion>=5&&!_.computed&&_.key.type==="Identifier"&&(_.key.name==="get"||_.key.name==="set")&&this.type!==Y.comma&&this.type!==Y.braceR&&this.type!==Y.eq){(F||R)&&this.unexpected(),_.kind=_.key.name,this.parsePropertyName(_),_.value=this.parseMethod(!1);var ht=_.kind==="get"?0:1;if(_.value.params.length!==ht){var cr=_.value.start;_.kind==="get"?this.raiseRecoverable(cr,"getter should have no params"):this.raiseRecoverable(cr,"setter should have exactly one param")}else _.kind==="set"&&_.value.params[0].type==="RestElement"&&this.raiseRecoverable(_.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!_.computed&&_.key.type==="Identifier"?((F||R)&&this.unexpected(),this.checkUnreserved(_.key),_.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=K),_.kind="init",T?_.value=this.parseMaybeDefault(K,xe,_.key):this.type===Y.eq&&We?(We.shorthandAssign<0&&(We.shorthandAssign=this.start),_.value=this.parseMaybeDefault(K,xe,_.key)):_.value=_.key,_.shorthand=!0):this.unexpected()},kn.parsePropertyName=function(_){if(this.options.ecmaVersion>=6){if(this.eat(Y.bracketL))return _.computed=!0,_.key=this.parseMaybeAssign(),this.expect(Y.bracketR),_.key;_.computed=!1}return _.key=this.type===Y.num||this.type===Y.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},kn.initFunction=function(_){_.id=null,this.options.ecmaVersion>=6&&(_.generator=_.expression=!1),this.options.ecmaVersion>=8&&(_.async=!1)},kn.parseMethod=function(_,T,F){var R=this.startNode(),K=this.yieldPos,xe=this.awaitPos,We=this.awaitIdentPos;return this.initFunction(R),this.options.ecmaVersion>=6&&(R.generator=_),this.options.ecmaVersion>=8&&(R.async=!!T),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(ki(T,R.generator)|ui|(F?ia:0)),this.expect(Y.parenL),R.params=this.parseBindingList(Y.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(R,!1,!0),this.yieldPos=K,this.awaitPos=xe,this.awaitIdentPos=We,this.finishNode(R,"FunctionExpression")},kn.parseArrowExpression=function(_,T,F){var R=this.yieldPos,K=this.awaitPos,xe=this.awaitIdentPos;return this.enterScope(ki(F,!1)|mi),this.initFunction(_),this.options.ecmaVersion>=8&&(_.async=!!F),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,_.params=this.toAssignableList(T,!0),this.parseFunctionBody(_,!0,!1),this.yieldPos=R,this.awaitPos=K,this.awaitIdentPos=xe,this.finishNode(_,"ArrowFunctionExpression")},kn.parseFunctionBody=function(_,T,F){var R=T&&this.type!==Y.braceL,K=this.strict,xe=!1;if(R)_.body=this.parseMaybeAssign(),_.expression=!0,this.checkParams(_,!1);else{var We=this.options.ecmaVersion>=7&&!this.isSimpleParamList(_.params);(!K||We)&&(xe=this.strictDirective(this.end),xe&&We&&this.raiseRecoverable(_.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var ct=this.labels;this.labels=[],xe&&(this.strict=!0),this.checkParams(_,!K&&!xe&&!T&&!F&&this.isSimpleParamList(_.params)),this.strict&&_.id&&this.checkLVal(_.id,Mn),_.body=this.parseBlock(!1,void 0,xe&&!K),_.expression=!1,this.adaptDirectivePrologue(_.body.body),this.labels=ct}this.exitScope()},kn.isSimpleParamList=function(_){for(var T=0,F=_;T<F.length;T+=1){var R=F[T];if(R.type!=="Identifier")return!1}return!0},kn.checkParams=function(_,T){for(var F={},R=0,K=_.params;R<K.length;R+=1){var xe=K[R];this.checkLVal(xe,Vi,T?null:F)}},kn.parseExprList=function(_,T,F,R){for(var K=[],xe=!0;!this.eat(_);){if(xe)xe=!1;else if(this.expect(Y.comma),T&&this.afterTrailingComma(_))break;var We=void 0;F&&this.type===Y.comma?We=null:this.type===Y.ellipsis?(We=this.parseSpread(R),R&&this.type===Y.comma&&R.trailingComma<0&&(R.trailingComma=this.start)):We=this.parseMaybeAssign(!1,R),K.push(We)}return K},kn.checkUnreserved=function(_){var T=_.start,F=_.end,R=_.name;if(this.inGenerator&&R==="yield"&&this.raiseRecoverable(T,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&R==="await"&&this.raiseRecoverable(T,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(R)&&this.raise(T,"Unexpected keyword '"+R+"'"),!(this.options.ecmaVersion<6&&this.input.slice(T,F).indexOf("\\")!==-1)){var K=this.strict?this.reservedWordsStrict:this.reservedWords;K.test(R)&&(!this.inAsync&&R==="await"&&this.raiseRecoverable(T,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(T,"The keyword '"+R+"' is reserved"))}},kn.parseIdent=function(_,T){var F=this.startNode();return this.type===Y.name?F.name=this.value:this.type.keyword?(F.name=this.type.keyword,(F.name==="class"||F.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!_),this.finishNode(F,"Identifier"),_||(this.checkUnreserved(F),F.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=F.start)),F},kn.parseYield=function(_){this.yieldPos||(this.yieldPos=this.start);var T=this.startNode();return this.next(),this.type===Y.semi||this.canInsertSemicolon()||this.type!==Y.star&&!this.type.startsExpr?(T.delegate=!1,T.argument=null):(T.delegate=this.eat(Y.star),T.argument=this.parseMaybeAssign(_)),this.finishNode(T,"YieldExpression")},kn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var _=this.startNode();return this.next(),_.argument=this.parseMaybeUnary(null,!1),this.finishNode(_,"AwaitExpression")};var jn=Ei.prototype;jn.raise=function(_,T){var F=vt(this.input,_);T+=" ("+F.line+":"+F.column+")";var R=new SyntaxError(T);throw R.pos=_,R.loc=F,R.raisedAt=this.pos,R},jn.raiseRecoverable=jn.raise,jn.curPosition=function(){if(this.options.locations)return new ke(this.curLine,this.pos-this.lineStart)};var an=Ei.prototype,Pi=function(T){this.flags=T,this.var=[],this.lexical=[],this.functions=[]};an.enterScope=function(_){this.scopeStack.push(new Pi(_))},an.exitScope=function(){this.scopeStack.pop()},an.treatFunctionsAsVarInScope=function(_){return _.flags&hn||!this.inModule&&_.flags&Yn},an.declareName=function(_,T,F){var R=!1;if(T===sa){var K=this.currentScope();R=K.lexical.indexOf(_)>-1||K.functions.indexOf(_)>-1||K.var.indexOf(_)>-1,K.lexical.push(_),this.inModule&&K.flags&Yn&&delete this.undefinedExports[_]}else if(T===Ca){var xe=this.currentScope();xe.lexical.push(_)}else if(T===wi){var We=this.currentScope();this.treatFunctionsAsVar?R=We.lexical.indexOf(_)>-1:R=We.lexical.indexOf(_)>-1||We.var.indexOf(_)>-1,We.functions.push(_)}else for(var ct=this.scopeStack.length-1;ct>=0;--ct){var ht=this.scopeStack[ct];if(ht.lexical.indexOf(_)>-1&&!(ht.flags&qn&&ht.lexical[0]===_)||!this.treatFunctionsAsVarInScope(ht)&&ht.functions.indexOf(_)>-1){R=!0;break}if(ht.var.push(_),this.inModule&&ht.flags&Yn&&delete this.undefinedExports[_],ht.flags&Ki)break}R&&this.raiseRecoverable(F,"Identifier '"+_+"' has already been declared")},an.checkLocalExport=function(_){this.scopeStack[0].lexical.indexOf(_.name)===-1&&this.scopeStack[0].var.indexOf(_.name)===-1&&(this.undefinedExports[_.name]=_)},an.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},an.currentVarScope=function(){for(var _=this.scopeStack.length-1;;_--){var T=this.scopeStack[_];if(T.flags&Ki)return T}},an.currentThisScope=function(){for(var _=this.scopeStack.length-1;;_--){var T=this.scopeStack[_];if(T.flags&Ki&&!(T.flags&mi))return T}};var Ii=function(T,F,R){this.type="",this.start=F,this.end=0,T.options.locations&&(this.loc=new St(T,R)),T.options.directSourceFile&&(this.sourceFile=T.options.directSourceFile),T.options.ranges&&(this.range=[F,0])},Ja=Ei.prototype;Ja.startNode=function(){return new Ii(this,this.start,this.startLoc)},Ja.startNodeAt=function(_,T){return new Ii(this,_,T)};function ms(_,T,F,R){return _.type=T,_.end=F,this.options.locations&&(_.loc.end=R),this.options.ranges&&(_.range[1]=F),_}Ja.finishNode=function(_,T){return ms.call(this,_,T,this.lastTokEnd,this.lastTokEndLoc)},Ja.finishNodeAt=function(_,T,F,R){return ms.call(this,_,T,F,R)};var xa=function(T,F,R,K,xe){this.token=T,this.isExpr=!!F,this.preserveSpace=!!R,this.override=K,this.generator=!!xe},ka={b_stat:new xa("{",!1),b_expr:new xa("{",!0),b_tmpl:new xa("${",!1),p_stat:new xa("(",!1),p_expr:new xa("(",!0),q_tmpl:new xa("`",!0,!0,function(_){return _.tryReadTemplateToken()}),f_stat:new xa("function",!1),f_expr:new xa("function",!0),f_expr_gen:new xa("function",!0,!1,null,!0),f_gen:new xa("function",!1,!1,null,!0)},Ma=Ei.prototype;Ma.initialContext=function(){return[ka.b_stat]},Ma.braceIsBlock=function(_){var T=this.curContext();return T===ka.f_expr||T===ka.f_stat?!0:_===Y.colon&&(T===ka.b_stat||T===ka.b_expr)?!T.isExpr:_===Y._return||_===Y.name&&this.exprAllowed?$t.test(this.input.slice(this.lastTokEnd,this.start)):_===Y._else||_===Y.semi||_===Y.eof||_===Y.parenR||_===Y.arrow?!0:_===Y.braceL?T===ka.b_stat:_===Y._var||_===Y._const||_===Y.name?!1:!this.exprAllowed},Ma.inGeneratorContext=function(){for(var _=this.context.length-1;_>=1;_--){var T=this.context[_];if(T.token==="function")return T.generator}return!1},Ma.updateContext=function(_){var T,F=this.type;F.keyword&&_===Y.dot?this.exprAllowed=!1:(T=F.updateContext)?T.call(this,_):this.exprAllowed=F.beforeExpr},Y.parenR.updateContext=Y.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var _=this.context.pop();_===ka.b_stat&&this.curContext().token==="function"&&(_=this.context.pop()),this.exprAllowed=!_.isExpr},Y.braceL.updateContext=function(_){this.context.push(this.braceIsBlock(_)?ka.b_stat:ka.b_expr),this.exprAllowed=!0},Y.dollarBraceL.updateContext=function(){this.context.push(ka.b_tmpl),this.exprAllowed=!0},Y.parenL.updateContext=function(_){var T=_===Y._if||_===Y._for||_===Y._with||_===Y._while;this.context.push(T?ka.p_stat:ka.p_expr),this.exprAllowed=!0},Y.incDec.updateContext=function(){},Y._function.updateContext=Y._class.updateContext=function(_){_.beforeExpr&&_!==Y.semi&&_!==Y._else&&!(_===Y._return&&$t.test(this.input.slice(this.lastTokEnd,this.start)))&&!((_===Y.colon||_===Y.braceL)&&this.curContext()===ka.b_stat)?this.context.push(ka.f_expr):this.context.push(ka.f_stat),this.exprAllowed=!1},Y.backQuote.updateContext=function(){this.curContext()===ka.q_tmpl?this.context.pop():this.context.push(ka.q_tmpl),this.exprAllowed=!1},Y.star.updateContext=function(_){if(_===Y._function){var T=this.context.length-1;this.context[T]===ka.f_expr?this.context[T]=ka.f_expr_gen:this.context[T]=ka.f_gen}this.exprAllowed=!0},Y.name.updateContext=function(_){var T=!1;this.options.ecmaVersion>=6&&_!==Y.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(T=!0),this.exprAllowed=T};var H="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",$=H+" Extended_Pictographic",re=$,ge={9:H,10:$,11:re},Ie="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Ge="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",rt=Ge+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",ce=rt+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",De={9:Ge,10:rt,11:ce},mt={};function mr(_){var T=mt[_]={binary:Xe(ge[_]+" "+Ie),nonBinary:{General_Category:Xe(Ie),Script:Xe(De[_])}};T.nonBinary.Script_Extensions=T.nonBinary.Script,T.nonBinary.gc=T.nonBinary.General_Category,T.nonBinary.sc=T.nonBinary.Script,T.nonBinary.scx=T.nonBinary.Script_Extensions}mr(9),mr(10),mr(11);var Dt=Ei.prototype,Bt=function(T){this.parser=T,this.validFlags="gim"+(T.options.ecmaVersion>=6?"uy":"")+(T.options.ecmaVersion>=9?"s":""),this.unicodeProperties=mt[T.options.ecmaVersion>=11?11:T.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Bt.prototype.reset=function(T,F,R){var K=R.indexOf("u")!==-1;this.start=T|0,this.source=F+"",this.flags=R,this.switchU=K&&this.parser.options.ecmaVersion>=6,this.switchN=K&&this.parser.options.ecmaVersion>=9},Bt.prototype.raise=function(T){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+T)},Bt.prototype.at=function(T,F){F===void 0&&(F=!1);var R=this.source,K=R.length;if(T>=K)return-1;var xe=R.charCodeAt(T);if(!(F||this.switchU)||xe<=55295||xe>=57344||T+1>=K)return xe;var We=R.charCodeAt(T+1);return We>=56320&&We<=57343?(xe<<10)+We-56613888:xe},Bt.prototype.nextIndex=function(T,F){F===void 0&&(F=!1);var R=this.source,K=R.length;if(T>=K)return K;var xe=R.charCodeAt(T),We;return!(F||this.switchU)||xe<=55295||xe>=57344||T+1>=K||(We=R.charCodeAt(T+1))<56320||We>57343?T+1:T+2},Bt.prototype.current=function(T){return T===void 0&&(T=!1),this.at(this.pos,T)},Bt.prototype.lookahead=function(T){return T===void 0&&(T=!1),this.at(this.nextIndex(this.pos,T),T)},Bt.prototype.advance=function(T){T===void 0&&(T=!1),this.pos=this.nextIndex(this.pos,T)},Bt.prototype.eat=function(T,F){return F===void 0&&(F=!1),this.current(F)===T?(this.advance(F),!0):!1};function yr(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}Dt.validateRegExpFlags=function(_){for(var T=_.validFlags,F=_.flags,R=0;R<F.length;R++){var K=F.charAt(R);T.indexOf(K)===-1&&this.raise(_.start,"Invalid regular expression flag"),F.indexOf(K,R+1)>-1&&this.raise(_.start,"Duplicate regular expression flag")}},Dt.validateRegExpPattern=function(_){this.regexp_pattern(_),!_.switchN&&this.options.ecmaVersion>=9&&_.groupNames.length>0&&(_.switchN=!0,this.regexp_pattern(_))},Dt.regexp_pattern=function(_){_.pos=0,_.lastIntValue=0,_.lastStringValue="",_.lastAssertionIsQuantifiable=!1,_.numCapturingParens=0,_.maxBackReference=0,_.groupNames.length=0,_.backReferenceNames.length=0,this.regexp_disjunction(_),_.pos!==_.source.length&&(_.eat(41)&&_.raise("Unmatched ')'"),(_.eat(93)||_.eat(125))&&_.raise("Lone quantifier brackets")),_.maxBackReference>_.numCapturingParens&&_.raise("Invalid escape");for(var T=0,F=_.backReferenceNames;T<F.length;T+=1){var R=F[T];_.groupNames.indexOf(R)===-1&&_.raise("Invalid named capture referenced")}},Dt.regexp_disjunction=function(_){for(this.regexp_alternative(_);_.eat(124);)this.regexp_alternative(_);this.regexp_eatQuantifier(_,!0)&&_.raise("Nothing to repeat"),_.eat(123)&&_.raise("Lone quantifier brackets")},Dt.regexp_alternative=function(_){for(;_.pos<_.source.length&&this.regexp_eatTerm(_););},Dt.regexp_eatTerm=function(_){return this.regexp_eatAssertion(_)?(_.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(_)&&_.switchU&&_.raise("Invalid quantifier"),!0):(_.switchU?this.regexp_eatAtom(_):this.regexp_eatExtendedAtom(_))?(this.regexp_eatQuantifier(_),!0):!1},Dt.regexp_eatAssertion=function(_){var T=_.pos;if(_.lastAssertionIsQuantifiable=!1,_.eat(94)||_.eat(36))return!0;if(_.eat(92)){if(_.eat(66)||_.eat(98))return!0;_.pos=T}if(_.eat(40)&&_.eat(63)){var F=!1;if(this.options.ecmaVersion>=9&&(F=_.eat(60)),_.eat(61)||_.eat(33))return this.regexp_disjunction(_),_.eat(41)||_.raise("Unterminated group"),_.lastAssertionIsQuantifiable=!F,!0}return _.pos=T,!1},Dt.regexp_eatQuantifier=function(_,T){return T===void 0&&(T=!1),this.regexp_eatQuantifierPrefix(_,T)?(_.eat(63),!0):!1},Dt.regexp_eatQuantifierPrefix=function(_,T){return _.eat(42)||_.eat(43)||_.eat(63)||this.regexp_eatBracedQuantifier(_,T)},Dt.regexp_eatBracedQuantifier=function(_,T){var F=_.pos;if(_.eat(123)){var R=0,K=-1;if(this.regexp_eatDecimalDigits(_)&&(R=_.lastIntValue,_.eat(44)&&this.regexp_eatDecimalDigits(_)&&(K=_.lastIntValue),_.eat(125)))return K!==-1&&K<R&&!T&&_.raise("numbers out of order in {} quantifier"),!0;_.switchU&&!T&&_.raise("Incomplete quantifier"),_.pos=F}return!1},Dt.regexp_eatAtom=function(_){return this.regexp_eatPatternCharacters(_)||_.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)},Dt.regexp_eatReverseSolidusAtomEscape=function(_){var T=_.pos;if(_.eat(92)){if(this.regexp_eatAtomEscape(_))return!0;_.pos=T}return!1},Dt.regexp_eatUncapturingGroup=function(_){var T=_.pos;if(_.eat(40)){if(_.eat(63)&&_.eat(58)){if(this.regexp_disjunction(_),_.eat(41))return!0;_.raise("Unterminated group")}_.pos=T}return!1},Dt.regexp_eatCapturingGroup=function(_){if(_.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(_):_.current()===63&&_.raise("Invalid group"),this.regexp_disjunction(_),_.eat(41))return _.numCapturingParens+=1,!0;_.raise("Unterminated group")}return!1},Dt.regexp_eatExtendedAtom=function(_){return _.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)||this.regexp_eatInvalidBracedQuantifier(_)||this.regexp_eatExtendedPatternCharacter(_)},Dt.regexp_eatInvalidBracedQuantifier=function(_){return this.regexp_eatBracedQuantifier(_,!0)&&_.raise("Nothing to repeat"),!1},Dt.regexp_eatSyntaxCharacter=function(_){var T=_.current();return En(T)?(_.lastIntValue=T,_.advance(),!0):!1};function En(_){return _===36||_>=40&&_<=43||_===46||_===63||_>=91&&_<=94||_>=123&&_<=125}Dt.regexp_eatPatternCharacters=function(_){for(var T=_.pos,F=0;(F=_.current())!==-1&&!En(F);)_.advance();return _.pos!==T},Dt.regexp_eatExtendedPatternCharacter=function(_){var T=_.current();return T!==-1&&T!==36&&!(T>=40&&T<=43)&&T!==46&&T!==63&&T!==91&&T!==94&&T!==124?(_.advance(),!0):!1},Dt.regexp_groupSpecifier=function(_){if(_.eat(63)){if(this.regexp_eatGroupName(_)){_.groupNames.indexOf(_.lastStringValue)!==-1&&_.raise("Duplicate capture group name"),_.groupNames.push(_.lastStringValue);return}_.raise("Invalid group")}},Dt.regexp_eatGroupName=function(_){if(_.lastStringValue="",_.eat(60)){if(this.regexp_eatRegExpIdentifierName(_)&&_.eat(62))return!0;_.raise("Invalid capture group name")}return!1},Dt.regexp_eatRegExpIdentifierName=function(_){if(_.lastStringValue="",this.regexp_eatRegExpIdentifierStart(_)){for(_.lastStringValue+=yr(_.lastIntValue);this.regexp_eatRegExpIdentifierPart(_);)_.lastStringValue+=yr(_.lastIntValue);return!0}return!1},Dt.regexp_eatRegExpIdentifierStart=function(_){var T=_.pos,F=this.options.ecmaVersion>=11,R=_.current(F);return _.advance(F),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,F)&&(R=_.lastIntValue),cn(R)?(_.lastIntValue=R,!0):(_.pos=T,!1)};function cn(_){return Vt(_,!0)||_===36||_===95}Dt.regexp_eatRegExpIdentifierPart=function(_){var T=_.pos,F=this.options.ecmaVersion>=11,R=_.current(F);return _.advance(F),R===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,F)&&(R=_.lastIntValue),Pt(R)?(_.lastIntValue=R,!0):(_.pos=T,!1)};function Pt(_){return sr(_,!0)||_===36||_===95||_===8204||_===8205}Dt.regexp_eatAtomEscape=function(_){return this.regexp_eatBackReference(_)||this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)||_.switchN&&this.regexp_eatKGroupName(_)?!0:(_.switchU&&(_.current()===99&&_.raise("Invalid unicode escape"),_.raise("Invalid escape")),!1)},Dt.regexp_eatBackReference=function(_){var T=_.pos;if(this.regexp_eatDecimalEscape(_)){var F=_.lastIntValue;if(_.switchU)return F>_.maxBackReference&&(_.maxBackReference=F),!0;if(F<=_.numCapturingParens)return!0;_.pos=T}return!1},Dt.regexp_eatKGroupName=function(_){if(_.eat(107)){if(this.regexp_eatGroupName(_))return _.backReferenceNames.push(_.lastStringValue),!0;_.raise("Invalid named reference")}return!1},Dt.regexp_eatCharacterEscape=function(_){return this.regexp_eatControlEscape(_)||this.regexp_eatCControlLetter(_)||this.regexp_eatZero(_)||this.regexp_eatHexEscapeSequence(_)||this.regexp_eatRegExpUnicodeEscapeSequence(_,!1)||!_.switchU&&this.regexp_eatLegacyOctalEscapeSequence(_)||this.regexp_eatIdentityEscape(_)},Dt.regexp_eatCControlLetter=function(_){var T=_.pos;if(_.eat(99)){if(this.regexp_eatControlLetter(_))return!0;_.pos=T}return!1},Dt.regexp_eatZero=function(_){return _.current()===48&&!Ti(_.lookahead())?(_.lastIntValue=0,_.advance(),!0):!1},Dt.regexp_eatControlEscape=function(_){var T=_.current();return T===116?(_.lastIntValue=9,_.advance(),!0):T===110?(_.lastIntValue=10,_.advance(),!0):T===118?(_.lastIntValue=11,_.advance(),!0):T===102?(_.lastIntValue=12,_.advance(),!0):T===114?(_.lastIntValue=13,_.advance(),!0):!1},Dt.regexp_eatControlLetter=function(_){var T=_.current();return un(T)?(_.lastIntValue=T%32,_.advance(),!0):!1};function un(_){return _>=65&&_<=90||_>=97&&_<=122}Dt.regexp_eatRegExpUnicodeEscapeSequence=function(_,T){T===void 0&&(T=!1);var F=_.pos,R=T||_.switchU;if(_.eat(117)){if(this.regexp_eatFixedHexDigits(_,4)){var K=_.lastIntValue;if(R&&K>=55296&&K<=56319){var xe=_.pos;if(_.eat(92)&&_.eat(117)&&this.regexp_eatFixedHexDigits(_,4)){var We=_.lastIntValue;if(We>=56320&&We<=57343)return _.lastIntValue=(K-55296)*1024+(We-56320)+65536,!0}_.pos=xe,_.lastIntValue=K}return!0}if(R&&_.eat(123)&&this.regexp_eatHexDigits(_)&&_.eat(125)&&Gr(_.lastIntValue))return!0;R&&_.raise("Invalid unicode escape"),_.pos=F}return!1};function Gr(_){return _>=0&&_<=1114111}Dt.regexp_eatIdentityEscape=function(_){if(_.switchU)return this.regexp_eatSyntaxCharacter(_)?!0:_.eat(47)?(_.lastIntValue=47,!0):!1;var T=_.current();return T!==99&&(!_.switchN||T!==107)?(_.lastIntValue=T,_.advance(),!0):!1},Dt.regexp_eatDecimalEscape=function(_){_.lastIntValue=0;var T=_.current();if(T>=49&&T<=57){do _.lastIntValue=10*_.lastIntValue+(T-48),_.advance();while((T=_.current())>=48&&T<=57);return!0}return!1},Dt.regexp_eatCharacterClassEscape=function(_){var T=_.current();if(Wr(T))return _.lastIntValue=-1,_.advance(),!0;if(_.switchU&&this.options.ecmaVersion>=9&&(T===80||T===112)){if(_.lastIntValue=-1,_.advance(),_.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(_)&&_.eat(125))return!0;_.raise("Invalid property name")}return!1};function Wr(_){return _===100||_===68||_===115||_===83||_===119||_===87}Dt.regexp_eatUnicodePropertyValueExpression=function(_){var T=_.pos;if(this.regexp_eatUnicodePropertyName(_)&&_.eat(61)){var F=_.lastStringValue;if(this.regexp_eatUnicodePropertyValue(_)){var R=_.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(_,F,R),!0}}if(_.pos=T,this.regexp_eatLoneUnicodePropertyNameOrValue(_)){var K=_.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(_,K),!0}return!1},Dt.regexp_validateUnicodePropertyNameAndValue=function(_,T,F){Jr(_.unicodeProperties.nonBinary,T)||_.raise("Invalid property name"),_.unicodeProperties.nonBinary[T].test(F)||_.raise("Invalid property value")},Dt.regexp_validateUnicodePropertyNameOrValue=function(_,T){_.unicodeProperties.binary.test(T)||_.raise("Invalid property name")},Dt.regexp_eatUnicodePropertyName=function(_){var T=0;for(_.lastStringValue="";oi(T=_.current());)_.lastStringValue+=yr(T),_.advance();return _.lastStringValue!==""};function oi(_){return un(_)||_===95}Dt.regexp_eatUnicodePropertyValue=function(_){var T=0;for(_.lastStringValue="";rn(T=_.current());)_.lastStringValue+=yr(T),_.advance();return _.lastStringValue!==""};function rn(_){return oi(_)||Ti(_)}Dt.regexp_eatLoneUnicodePropertyNameOrValue=function(_){return this.regexp_eatUnicodePropertyValue(_)},Dt.regexp_eatCharacterClass=function(_){if(_.eat(91)){if(_.eat(94),this.regexp_classRanges(_),_.eat(93))return!0;_.raise("Unterminated character class")}return!1},Dt.regexp_classRanges=function(_){for(;this.regexp_eatClassAtom(_);){var T=_.lastIntValue;if(_.eat(45)&&this.regexp_eatClassAtom(_)){var F=_.lastIntValue;_.switchU&&(T===-1||F===-1)&&_.raise("Invalid character class"),T!==-1&&F!==-1&&T>F&&_.raise("Range out of order in character class")}}},Dt.regexp_eatClassAtom=function(_){var T=_.pos;if(_.eat(92)){if(this.regexp_eatClassEscape(_))return!0;if(_.switchU){var F=_.current();(F===99||Oi(F))&&_.raise("Invalid class escape"),_.raise("Invalid escape")}_.pos=T}var R=_.current();return R!==93?(_.lastIntValue=R,_.advance(),!0):!1},Dt.regexp_eatClassEscape=function(_){var T=_.pos;if(_.eat(98))return _.lastIntValue=8,!0;if(_.switchU&&_.eat(45))return _.lastIntValue=45,!0;if(!_.switchU&&_.eat(99)){if(this.regexp_eatClassControlLetter(_))return!0;_.pos=T}return this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)},Dt.regexp_eatClassControlLetter=function(_){var T=_.current();return Ti(T)||T===95?(_.lastIntValue=T%32,_.advance(),!0):!1},Dt.regexp_eatHexEscapeSequence=function(_){var T=_.pos;if(_.eat(120)){if(this.regexp_eatFixedHexDigits(_,2))return!0;_.switchU&&_.raise("Invalid escape"),_.pos=T}return!1},Dt.regexp_eatDecimalDigits=function(_){var T=_.pos,F=0;for(_.lastIntValue=0;Ti(F=_.current());)_.lastIntValue=10*_.lastIntValue+(F-48),_.advance();return _.pos!==T};function Ti(_){return _>=48&&_<=57}Dt.regexp_eatHexDigits=function(_){var T=_.pos,F=0;for(_.lastIntValue=0;ea(F=_.current());)_.lastIntValue=16*_.lastIntValue+bi(F),_.advance();return _.pos!==T};function ea(_){return _>=48&&_<=57||_>=65&&_<=70||_>=97&&_<=102}function bi(_){return _>=65&&_<=70?10+(_-65):_>=97&&_<=102?10+(_-97):_-48}Dt.regexp_eatLegacyOctalEscapeSequence=function(_){if(this.regexp_eatOctalDigit(_)){var T=_.lastIntValue;if(this.regexp_eatOctalDigit(_)){var F=_.lastIntValue;T<=3&&this.regexp_eatOctalDigit(_)?_.lastIntValue=T*64+F*8+_.lastIntValue:_.lastIntValue=T*8+F}else _.lastIntValue=T;return!0}return!1},Dt.regexp_eatOctalDigit=function(_){var T=_.current();return Oi(T)?(_.lastIntValue=T-48,_.advance(),!0):(_.lastIntValue=0,!1)};function Oi(_){return _>=48&&_<=55}Dt.regexp_eatFixedHexDigits=function(_,T){var F=_.pos;_.lastIntValue=0;for(var R=0;R<T;++R){var K=_.current();if(!ea(K))return _.pos=F,!1;_.lastIntValue=16*_.lastIntValue+bi(K),_.advance()}return!0};var Si=function(T){this.type=T.type,this.value=T.value,this.start=T.start,this.end=T.end,T.options.locations&&(this.loc=new St(T,T.startLoc,T.endLoc)),T.options.ranges&&(this.range=[T.start,T.end])},ri=Ei.prototype;ri.next=function(_){!_&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Si(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},ri.getToken=function(){return this.next(),new Si(this)},typeof Symbol!="undefined"&&(ri[Symbol.iterator]=function(){var _=this;return{next:function(){var T=_.getToken();return{done:T.type===Y.eof,value:T}}}}),ri.curContext=function(){return this.context[this.context.length-1]},ri.nextToken=function(){var _=this.curContext();if((!_||!_.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(Y.eof);if(_.override)return _.override(this);this.readToken(this.fullCharCodeAtPos())},ri.readToken=function(_){return Vt(_,this.options.ecmaVersion>=6)||_===92?this.readWord():this.getTokenFromCode(_)},ri.fullCharCodeAtPos=function(){var _=this.input.charCodeAt(this.pos);if(_<=55295||_>=57344)return _;var T=this.input.charCodeAt(this.pos+1);return(_<<10)+T-56613888},ri.skipBlockComment=function(){var _=this.options.onComment&&this.curPosition(),T=this.pos,F=this.input.indexOf("*/",this.pos+=2);if(F===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=F+2,this.options.locations){gt.lastIndex=T;for(var R;(R=gt.exec(this.input))&&R.index<this.pos;)++this.curLine,this.lineStart=R.index+R[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(T+2,F),T,this.pos,_,this.curPosition())},ri.skipLineComment=function(_){for(var T=this.pos,F=this.options.onComment&&this.curPosition(),R=this.input.charCodeAt(this.pos+=_);this.pos<this.input.length&&!Je(R);)R=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(T+_,this.pos),T,this.pos,F,this.curPosition())},ri.skipSpace=function(){e:for(;this.pos<this.input.length;){var _=this.input.charCodeAt(this.pos);switch(_){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(_>8&&_<14||_>=5760&&xt.test(String.fromCharCode(_)))++this.pos;else break e}}},ri.finishToken=function(_,T){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var F=this.type;this.type=_,this.value=T,this.updateContext(F)},ri.readToken_dot=function(){var _=this.input.charCodeAt(this.pos+1);if(_>=48&&_<=57)return this.readNumber(!0);var T=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&_===46&&T===46?(this.pos+=3,this.finishToken(Y.ellipsis)):(++this.pos,this.finishToken(Y.dot))},ri.readToken_slash=function(){var _=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):_===61?this.finishOp(Y.assign,2):this.finishOp(Y.slash,1)},ri.readToken_mult_modulo_exp=function(_){var T=this.input.charCodeAt(this.pos+1),F=1,R=_===42?Y.star:Y.modulo;return this.options.ecmaVersion>=7&&_===42&&T===42&&(++F,R=Y.starstar,T=this.input.charCodeAt(this.pos+2)),T===61?this.finishOp(Y.assign,F+1):this.finishOp(R,F)},ri.readToken_pipe_amp=function(_){var T=this.input.charCodeAt(this.pos+1);if(T===_){if(this.options.ecmaVersion>=12){var F=this.input.charCodeAt(this.pos+2);if(F===61)return this.finishOp(Y.assign,3)}return this.finishOp(_===124?Y.logicalOR:Y.logicalAND,2)}return T===61?this.finishOp(Y.assign,2):this.finishOp(_===124?Y.bitwiseOR:Y.bitwiseAND,1)},ri.readToken_caret=function(){var _=this.input.charCodeAt(this.pos+1);return _===61?this.finishOp(Y.assign,2):this.finishOp(Y.bitwiseXOR,1)},ri.readToken_plus_min=function(_){var T=this.input.charCodeAt(this.pos+1);return T===_?T===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||$t.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(Y.incDec,2):T===61?this.finishOp(Y.assign,2):this.finishOp(Y.plusMin,1)},ri.readToken_lt_gt=function(_){var T=this.input.charCodeAt(this.pos+1),F=1;return T===_?(F=_===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+F)===61?this.finishOp(Y.assign,F+1):this.finishOp(Y.bitShift,F)):T===33&&_===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(T===61&&(F=2),this.finishOp(Y.relational,F))},ri.readToken_eq_excl=function(_){var T=this.input.charCodeAt(this.pos+1);return T===61?this.finishOp(Y.equality,this.input.charCodeAt(this.pos+2)===61?3:2):_===61&&T===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(Y.arrow)):this.finishOp(_===61?Y.eq:Y.prefix,1)},ri.readToken_question=function(){var _=this.options.ecmaVersion;if(_>=11){var T=this.input.charCodeAt(this.pos+1);if(T===46){var F=this.input.charCodeAt(this.pos+2);if(F<48||F>57)return this.finishOp(Y.questionDot,2)}if(T===63){if(_>=12){var R=this.input.charCodeAt(this.pos+2);if(R===61)return this.finishOp(Y.assign,3)}return this.finishOp(Y.coalesce,2)}}return this.finishOp(Y.question,1)},ri.getTokenFromCode=function(_){switch(_){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(Y.parenL);case 41:return++this.pos,this.finishToken(Y.parenR);case 59:return++this.pos,this.finishToken(Y.semi);case 44:return++this.pos,this.finishToken(Y.comma);case 91:return++this.pos,this.finishToken(Y.bracketL);case 93:return++this.pos,this.finishToken(Y.bracketR);case 123:return++this.pos,this.finishToken(Y.braceL);case 125:return++this.pos,this.finishToken(Y.braceR);case 58:return++this.pos,this.finishToken(Y.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(Y.backQuote);case 48:var T=this.input.charCodeAt(this.pos+1);if(T===120||T===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(T===111||T===79)return this.readRadixNumber(8);if(T===98||T===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(_);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(_);case 124:case 38:return this.readToken_pipe_amp(_);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(_);case 60:case 62:return this.readToken_lt_gt(_);case 61:case 33:return this.readToken_eq_excl(_);case 63:return this.readToken_question();case 126:return this.finishOp(Y.prefix,1)}this.raise(this.pos,"Unexpected character '"+aa(_)+"'")},ri.finishOp=function(_,T){var F=this.input.slice(this.pos,this.pos+T);return this.pos+=T,this.finishToken(_,F)},ri.readRegexp=function(){for(var _,T,F=this.pos;;){this.pos>=this.input.length&&this.raise(F,"Unterminated regular expression");var R=this.input.charAt(this.pos);if($t.test(R)&&this.raise(F,"Unterminated regular expression"),_)_=!1;else{if(R==="[")T=!0;else if(R==="]"&&T)T=!1;else if(R==="/"&&!T)break;_=R==="\\"}++this.pos}var K=this.input.slice(F,this.pos);++this.pos;var xe=this.pos,We=this.readWord1();this.containsEsc&&this.unexpected(xe);var ct=this.regexpState||(this.regexpState=new Bt(this));ct.reset(F,K,We),this.validateRegExpFlags(ct),this.validateRegExpPattern(ct);var ht=null;try{ht=new RegExp(K,We)}catch(cr){}return this.finishToken(Y.regexp,{pattern:K,flags:We,value:ht})},ri.readInt=function(_,T,F){for(var R=this.options.ecmaVersion>=12&&T===void 0,K=F&&this.input.charCodeAt(this.pos)===48,xe=this.pos,We=0,ct=0,ht=0,cr=T==null?Infinity:T;ht<cr;++ht,++this.pos){var xr=this.input.charCodeAt(this.pos),Rn=void 0;if(R&&xr===95){K&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),ct===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),ht===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),ct=xr;continue}if(xr>=97?Rn=xr-97+10:xr>=65?Rn=xr-65+10:xr>=48&&xr<=57?Rn=xr-48:Rn=Infinity,Rn>=_)break;ct=xr,We=We*_+Rn}return R&&ct===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===xe||T!=null&&this.pos-xe!==T?null:We};function Xi(_,T){return T?parseInt(_,8):parseFloat(_.replace(/_/g,""))}function Da(_){return typeof BigInt!="function"?null:BigInt(_.replace(/_/g,""))}ri.readRadixNumber=function(_){var T=this.pos;this.pos+=2;var F=this.readInt(_);return F==null&&this.raise(this.start+2,"Expected number in radix "+_),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(F=Da(this.input.slice(T,this.pos)),++this.pos):Vt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(Y.num,F)},ri.readNumber=function(_){var T=this.pos;!_&&this.readInt(10,void 0,!0)===null&&this.raise(T,"Invalid number");var F=this.pos-T>=2&&this.input.charCodeAt(T)===48;F&&this.strict&&this.raise(T,"Invalid number");var R=this.input.charCodeAt(this.pos);if(!F&&!_&&this.options.ecmaVersion>=11&&R===110){var K=Da(this.input.slice(T,this.pos));return++this.pos,Vt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(Y.num,K)}F&&/[89]/.test(this.input.slice(T,this.pos))&&(F=!1),R===46&&!F&&(++this.pos,this.readInt(10),R=this.input.charCodeAt(this.pos)),(R===69||R===101)&&!F&&(R=this.input.charCodeAt(++this.pos),(R===43||R===45)&&++this.pos,this.readInt(10)===null&&this.raise(T,"Invalid number")),Vt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var xe=Xi(this.input.slice(T,this.pos),F);return this.finishToken(Y.num,xe)},ri.readCodePoint=function(){var _=this.input.charCodeAt(this.pos),T;if(_===123){this.options.ecmaVersion<6&&this.unexpected();var F=++this.pos;T=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,T>1114111&&this.invalidStringToken(F,"Code point out of bounds")}else T=this.readHexChar(4);return T};function aa(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}ri.readString=function(_){for(var T="",F=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var R=this.input.charCodeAt(this.pos);if(R===_)break;R===92?(T+=this.input.slice(F,this.pos),T+=this.readEscapedChar(!1),F=this.pos):(Je(R,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return T+=this.input.slice(F,this.pos++),this.finishToken(Y.string,T)};var Ri={};ri.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(_){if(_===Ri)this.readInvalidTemplateToken();else throw _}this.inTemplateElement=!1},ri.invalidStringToken=function(_,T){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Ri;this.raise(_,T)},ri.readTmplToken=function(){for(var _="",T=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var F=this.input.charCodeAt(this.pos);if(F===96||F===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===Y.template||this.type===Y.invalidTemplate)?F===36?(this.pos+=2,this.finishToken(Y.dollarBraceL)):(++this.pos,this.finishToken(Y.backQuote)):(_+=this.input.slice(T,this.pos),this.finishToken(Y.template,_));if(F===92)_+=this.input.slice(T,this.pos),_+=this.readEscapedChar(!0),T=this.pos;else if(Je(F)){switch(_+=this.input.slice(T,this.pos),++this.pos,F){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:_+=`
`;break;default:_+=String.fromCharCode(F);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),T=this.pos}else++this.pos}},ri.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(Y.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},ri.readEscapedChar=function(_){var T=this.input.charCodeAt(++this.pos);switch(++this.pos,T){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return aa(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(_){var F=this.pos-1;return this.invalidStringToken(F,"Invalid escape sequence in template string"),null}default:if(T>=48&&T<=55){var R=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],K=parseInt(R,8);return K>255&&(R=R.slice(0,-1),K=parseInt(R,8)),this.pos+=R.length-1,T=this.input.charCodeAt(this.pos),(R!=="0"||T===56||T===57)&&(this.strict||_)&&this.invalidStringToken(this.pos-1-R.length,_?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(K)}return Je(T)?"":String.fromCharCode(T)}},ri.readHexChar=function(_){var T=this.pos,F=this.readInt(16,_);return F===null&&this.invalidStringToken(T,"Bad character escape sequence"),F},ri.readWord1=function(){this.containsEsc=!1;for(var _="",T=!0,F=this.pos,R=this.options.ecmaVersion>=6;this.pos<this.input.length;){var K=this.fullCharCodeAtPos();if(sr(K,R))this.pos+=K<=65535?1:2;else if(K===92){this.containsEsc=!0,_+=this.input.slice(F,this.pos);var xe=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var We=this.readCodePoint();(T?Vt:sr)(We,R)||this.invalidStringToken(xe,"Invalid Unicode escape"),_+=aa(We),F=this.pos}else break;T=!1}return _+this.input.slice(F,this.pos)},ri.readWord=function(){var _=this.readWord1(),T=Y.name;return this.keywords.test(_)&&(T=dt[_]),this.finishToken(T,_)};var Gi="7.4.1";Ei.acorn={Parser:Ei,version:Gi,defaultOptions:zt,Position:ke,SourceLocation:St,getLineInfo:vt,Node:Ii,TokenType:At,tokTypes:Y,keywordTypes:dt,TokContext:xa,tokContexts:ka,isIdentifierChar:sr,isIdentifierStart:Vt,Token:Si,isNewLine:Je,lineBreak:$t,lineBreakG:gt,nonASCIIwhitespace:xt};function za(_,T){return Ei.parse(_,T)}function su(_,T,F){return Ei.parseExpressionAt(_,T,F)}function Pa(_,T){return Ei.tokenizer(_,T)}function Ia(_,T){_.prototype=Object.create(T.prototype),_.prototype.constructor=_,_.__proto__=T}function As(_){var T=typeof Map=="function"?new Map:void 0;return As=function(R){if(R===null||!Yu(R))return R;if(typeof R!="function")throw new TypeError("Super expression must either be null or a function");if(typeof T!="undefined"){if(T.has(R))return T.get(R);T.set(R,K)}function K(){return ta(R,arguments,Ua(this).constructor)}return K.prototype=Object.create(R.prototype,{constructor:{value:K,enumerable:!1,writable:!0,configurable:!0}}),_o(K,R)},As(_)}function gs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function ta(_,T,F){return gs()?ta=Reflect.construct:ta=function(K,xe,We){var ct=[null];ct.push.apply(ct,xe);var ht=Function.bind.apply(K,ct),cr=new ht;return We&&_o(cr,We.prototype),cr},ta.apply(null,arguments)}function Yu(_){return Function.toString.call(_).indexOf("[native code]")!==-1}function _o(_,T){return _o=Object.setPrototypeOf||function(R,K){return R.__proto__=K,R},_o(_,T)}function Ua(_){return Ua=Object.setPrototypeOf?Object.getPrototypeOf:function(F){return F.__proto__||Object.getPrototypeOf(F)},Ua(_)}var so=function(_){Ia(T,_);function T(){return _.apply(this,arguments)||this}return T}(As(Error)),Qi=function(_){Ia(T,_);function T(){return _.apply(this,arguments)||this}return T}(As(SyntaxError)),qo=function(_){Ia(T,_);function T(){return _.apply(this,arguments)||this}return T}(As(ReferenceError)),Ko=function(_){Ia(T,_);function T(){return _.apply(this,arguments)||this}return T}(As(TypeError)),qu=function(_){Ia(T,_);function T(){return _.apply(this,arguments)||this}return T}(so),Ao=function(_){Ia(T,_);function T(){return _.apply(this,arguments)||this}return T}(Qi),$o=function(_){Ia(T,_);function T(){return _.apply(this,arguments)||this}return T}(qo),ba={UnknownError:[3001,"%0",qu],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",qu],NodeTypeSyntaxError:[1001,"Unknown node type: %0",$o],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",$o],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",$o],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",$o],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",$o],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",$o],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",$o],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",$o],ParamTypeSyntaxError:[1009,"Unknown param type: %0",$o],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",$o],FunctionUndefinedReferenceError:[2001,"%0 is not a function",qo],VariableUndefinedReferenceError:[2002,"%0 is not defined",qo],IsNotConstructor:[2003,"%0 is not a constructor",Ko]};function xo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function Qo(_,T,F){return xo()?Qo=Reflect.construct:Qo=function(K,xe,We){var ct=[null];ct.push.apply(ct,xe);var ht=Function.bind.apply(K,ct),cr=new ht;return We&&uo(cr,We.prototype),cr},Qo.apply(null,arguments)}function uo(_,T){return uo=Object.setPrototypeOf||function(R,K){return R.__proto__=K,R},uo(_,T)}var uu="0.0.3";function Ac(_,T){Object.defineProperty(_,"name",{value:T,writable:!1,enumerable:!1,configurable:!0})}var Fs=Object.prototype.hasOwnProperty,Q=Symbol("Break"),Ee=Symbol("Continue"),Ke=Symbol("DefaultCase"),kt=Symbol("EmptyStatementReturn"),Fr=Symbol("WithScopeName"),ot=Symbol("SuperScopeName"),wt=Symbol("RootScopeName"),lo=Symbol("GlobalScopeName");function Ji(_){return typeof _=="function"}var Ya=function(){function _(F){this.interpreter=F}var T=_.prototype;return T.generator=function(){var R=this.interpreter;function K(){return this.getCurrentScope()}function xe(){return this.getGlobalScope()}function We(){return this.getCurrentContext()}return{getOptions:R.getOptions.bind(R),getCurrentScope:K.bind(R),getGlobalScope:xe.bind(R),getCurrentContext:We.bind(R),getExecStartTime:R.getExecStartTime.bind(R)}},_}();function Jo(_,T,F){if(F===void 0&&(F=!0),!(_ instanceof Ya))throw new Error("Illegal call");if(typeof T!="string")return T;if(!!T){var R=_.generator(),K=R.getOptions(),xe={timeout:K.timeout,_initEnv:function(){F||this.setCurrentContext(R.getCurrentContext()),this.execStartTime=R.getExecStartTime(),this.execEndTime=this.execStartTime}},We=F?R.getGlobalScope():R.getCurrentScope(),ct=new bo(We,xe);return ct.evaluate(T)}}Object.defineProperty(Jo,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function en(_){if(!(_ instanceof Ya))throw new Error("Illegal call");for(var T=_.generator(),F=arguments.length,R=new Array(F>1?F-1:0),K=1;K<F;K++)R[K-1]=arguments[K];var xe=R.pop(),We=new bo(T.getGlobalScope(),T.getOptions()),ct=`
		    (function anonymous(`+R.join(",")+`){
		        `+xe+`
		    });
		    `;return We.evaluate(ct)}Object.defineProperty(en,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var $r=function(T){this.value=T},Rt=function(T){this.value=T},Vo=function(T){this.value=T},he=function(T,F,R){F===void 0&&(F=null),this.name=R,this.parent=F,this.data=T,this.labelStack=[]};function Js(){}function lu(_,T){return _===void 0&&(_=null),new he(Object.create(null),_,T)}function ys(_){return Object.create(_)}var oa={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Jo,Function:en};typeof JSON!="undefined"&&(oa.JSON=JSON),typeof Promise!="undefined"&&(oa.Promise=Promise),typeof Set!="undefined"&&(oa.Set=Set),typeof Map!="undefined"&&(oa.Map=Map),typeof Symbol!="undefined"&&(oa.Symbol=Symbol),typeof Proxy!="undefined"&&(oa.Proxy=Proxy),typeof WeakMap!="undefined"&&(oa.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(oa.WeakSet=WeakSet),typeof Reflect!="undefined"&&(oa.Reflect=Reflect);var bo=function(){function _(F,R){F===void 0&&(F=_.global),R===void 0&&(R={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:R.ecmaVersion||_.ecmaVersion,timeout:R.timeout||0,rootContext:R.rootContext,globalContextInFunction:R.globalContextInFunction===void 0?_.globalContextInFunction:R.globalContextInFunction,_initEnv:R._initEnv},this.context=F||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var T=_.prototype;return T.initEnvironment=function(R){var K;if(R instanceof he)K=R;else{var xe=null,We=this.createSuperScope(R);this.options.rootContext&&(xe=new he(ys(this.options.rootContext),We,wt)),K=new he(R,xe||We,lo)}this.globalScope=K,this.currentScope=this.globalScope,this.globalContext=K.data,this.currentContext=K.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var ct=this.options._initEnv;ct&&ct.call(this)},T.getExecStartTime=function(){return this.execStartTime},T.getExecutionTime=function(){return this.execEndTime-this.execStartTime},T.setExecTimeout=function(R){R===void 0&&(R=0),this.options.timeout=R},T.getOptions=function(){return this.options},T.getGlobalScope=function(){return this.globalScope},T.getCurrentScope=function(){return this.currentScope},T.getCurrentContext=function(){return this.currentContext},T.isInterruptThrow=function(R){return R instanceof qu||R instanceof $o||R instanceof Ao},T.createSuperScope=function(R){var K=Object.assign({},oa),xe=Object.keys(K);return xe.forEach(function(We){We in R&&delete K[We]}),new he(K,null,ot)},T.setCurrentContext=function(R){this.currentContext=R},T.setCurrentScope=function(R){this.currentScope=R},T.evaluate=function(R){R===void 0&&(R="");var K;if(!!R)return K=za(R,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||_.ecmaVersion}),this.evaluateNode(K,R)},T.appendCode=function(R){return this.evaluate(R)},T.evaluateNode=function(R,K){var xe=this;K===void 0&&(K=""),this.value=void 0,this.source=K,this.sourceList.push(K),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var We=this.getCurrentScope(),ct=this.getCurrentContext(),ht=We.labelStack.concat([]),cr=this.callStack.concat([]),xr=function(){xe.setCurrentScope(We),xe.setCurrentContext(ct),We.labelStack=ht,xe.callStack=cr};try{var Rn=this.createClosure(R);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Rn()}catch(ci){throw ci}finally{xr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},T.createErrorMessage=function(R,K,xe){var We=R[1].replace("%0",String(K));return xe!==null&&(We+=this.getNodePosition(xe||this.lastExecNode)),We},T.createError=function(R,K){return new K(R)},T.createThrowError=function(R,K){return this.createError(R,K)},T.createInternalThrowError=function(R,K,xe){return this.createError(this.createErrorMessage(R,K,xe),R[2])},T.checkTimeout=function(){if(!this.isRunning)return!1;var R=this.options.timeout||0,K=Date.now();return K-this.execStartTime>R},T.getNodePosition=function(R){if(R){var K="";return R.loc?" ["+R.loc.start.line+":"+R.loc.start.column+"]"+K:""}return""},T.createClosure=function(R){var K=this,xe;switch(R.type){case"BinaryExpression":xe=this.binaryExpressionHandler(R);break;case"LogicalExpression":xe=this.logicalExpressionHandler(R);break;case"UnaryExpression":xe=this.unaryExpressionHandler(R);break;case"UpdateExpression":xe=this.updateExpressionHandler(R);break;case"ObjectExpression":xe=this.objectExpressionHandler(R);break;case"ArrayExpression":xe=this.arrayExpressionHandler(R);break;case"CallExpression":xe=this.callExpressionHandler(R);break;case"NewExpression":xe=this.newExpressionHandler(R);break;case"MemberExpression":xe=this.memberExpressionHandler(R);break;case"ThisExpression":xe=this.thisExpressionHandler(R);break;case"SequenceExpression":xe=this.sequenceExpressionHandler(R);break;case"Literal":xe=this.literalHandler(R);break;case"Identifier":xe=this.identifierHandler(R);break;case"AssignmentExpression":xe=this.assignmentExpressionHandler(R);break;case"FunctionDeclaration":xe=this.functionDeclarationHandler(R);break;case"VariableDeclaration":xe=this.variableDeclarationHandler(R);break;case"BlockStatement":case"Program":xe=this.programHandler(R);break;case"ExpressionStatement":xe=this.expressionStatementHandler(R);break;case"EmptyStatement":xe=this.emptyStatementHandler(R);break;case"ReturnStatement":xe=this.returnStatementHandler(R);break;case"FunctionExpression":xe=this.functionExpressionHandler(R);break;case"IfStatement":xe=this.ifStatementHandler(R);break;case"ConditionalExpression":xe=this.conditionalExpressionHandler(R);break;case"ForStatement":xe=this.forStatementHandler(R);break;case"WhileStatement":xe=this.whileStatementHandler(R);break;case"DoWhileStatement":xe=this.doWhileStatementHandler(R);break;case"ForInStatement":xe=this.forInStatementHandler(R);break;case"WithStatement":xe=this.withStatementHandler(R);break;case"ThrowStatement":xe=this.throwStatementHandler(R);break;case"TryStatement":xe=this.tryStatementHandler(R);break;case"ContinueStatement":xe=this.continueStatementHandler(R);break;case"BreakStatement":xe=this.breakStatementHandler(R);break;case"SwitchStatement":xe=this.switchStatementHandler(R);break;case"LabeledStatement":xe=this.labeledStatementHandler(R);break;case"DebuggerStatement":xe=this.debuggerStatementHandler(R);break;default:throw this.createInternalThrowError(ba.NodeTypeSyntaxError,R.type,R)}return function(){var We=K.options.timeout;if(We&&We>0&&K.checkTimeout())throw K.createInternalThrowError(ba.ExecutionTimeOutError,We,null);return K.lastExecNode=R,xe.apply(void 0,arguments)}},T.binaryExpressionHandler=function(R){var K=this,xe=this.createClosure(R.left),We=this.createClosure(R.right);return function(){var ct=xe(),ht=We();switch(R.operator){case"==":return ct==ht;case"!=":return ct!=ht;case"===":return ct===ht;case"!==":return ct!==ht;case"<":return ct<ht;case"<=":return ct<=ht;case">":return ct>ht;case">=":return ct>=ht;case"<<":return ct<<ht;case">>":return ct>>ht;case">>>":return ct>>>ht;case"+":return ct+ht;case"-":return ct-ht;case"*":return ct*ht;case"**":return Math.pow(ct,ht);case"/":return ct/ht;case"%":return ct%ht;case"|":return ct|ht;case"^":return ct^ht;case"&":return ct&ht;case"in":return ct in ht;case"instanceof":return ct instanceof ht;default:throw K.createInternalThrowError(ba.BinaryOperatorSyntaxError,R.operator,R)}}},T.logicalExpressionHandler=function(R){var K=this,xe=this.createClosure(R.left),We=this.createClosure(R.right);return function(){switch(R.operator){case"||":return xe()||We();case"&&":return xe()&&We();default:throw K.createInternalThrowError(ba.LogicalOperatorSyntaxError,R.operator,R)}}},T.unaryExpressionHandler=function(R){var K=this;switch(R.operator){case"delete":var xe=this.createObjectGetter(R.argument),We=this.createNameGetter(R.argument);return function(){var xr=xe(),Rn=We();return delete xr[Rn]};default:var ct;if(R.operator==="typeof"&&R.argument.type==="Identifier"){var ht=this.createObjectGetter(R.argument),cr=this.createNameGetter(R.argument);ct=function(){return ht()[cr()]}}else ct=this.createClosure(R.argument);return function(){var xr=ct();switch(R.operator){case"-":return-xr;case"+":return+xr;case"!":return!xr;case"~":return~xr;case"void":return;case"typeof":return typeof xr;default:throw K.createInternalThrowError(ba.UnaryOperatorSyntaxError,R.operator,R)}}}},T.updateExpressionHandler=function(R){var K=this,xe=this.createObjectGetter(R.argument),We=this.createNameGetter(R.argument);return function(){var ct=xe(),ht=We();switch(K.assertVariable(ct,ht,R),R.operator){case"++":return R.prefix?++ct[ht]:ct[ht]++;case"--":return R.prefix?--ct[ht]:ct[ht]--;default:throw K.createInternalThrowError(ba.UpdateOperatorSyntaxError,R.operator,R)}}},T.objectExpressionHandler=function(R){var K=this,xe=[];function We(ht){return ht.type==="Identifier"?ht.name:ht.type==="Literal"?ht.value:this.throwError(ba.ObjectStructureSyntaxError,ht.type,ht)}var ct=Object.create(null);return R.properties.forEach(function(ht){var cr=ht.kind,xr=We(ht.key);(!ct[xr]||cr==="init")&&(ct[xr]={}),ct[xr][cr]=K.createClosure(ht.value),xe.push({key:xr,property:ht})}),function(){for(var ht={},cr=xe.length,xr=0;xr<cr;xr++){var Rn=xe[xr],ci=Rn.key,Jn=ct[ci],Yi=Jn.init?Jn.init():void 0,ha=Jn.get?Jn.get():function(){},La=Jn.set?Jn.set():function(pl){};if("set"in Jn||"get"in Jn){var Hi={configurable:!0,enumerable:!0,get:ha,set:La};Object.defineProperty(ht,ci,Hi)}else{var Fo=Rn.property,ws=Fo.kind;Fo.key.type==="Identifier"&&Fo.value.type==="FunctionExpression"&&ws==="init"&&!Fo.value.id&&Ac(Yi,Fo.key.name),ht[ci]=Yi}}return ht}},T.arrayExpressionHandler=function(R){var K=this,xe=R.elements.map(function(We){return We&&K.createClosure(We)});return function(){for(var We=xe.length,ct=Array(We),ht=0;ht<We;ht++){var cr=xe[ht];cr&&(ct[ht]=cr())}return ct}},T.safeObjectGet=function(R,K,xe){return R[K]},T.createCallFunctionGetter=function(R){var K=this;switch(R.type){case"MemberExpression":var xe=this.createClosure(R.object),We=this.createMemberKeyGetter(R),ct=this.source;return function(){var cr=xe(),xr=We(),Rn=K.safeObjectGet(cr,xr,R);if(!Rn||!Ji(Rn)){var ci=ct.slice(R.start,R.end);throw K.createInternalThrowError(ba.FunctionUndefinedReferenceError,ci,R)}return Rn.__IS_EVAL_FUNC?function(Jn){return Rn(new Ya(K),Jn,!0)}:Rn.__IS_FUNCTION_FUNC?function(){for(var Jn=arguments.length,Yi=new Array(Jn),ha=0;ha<Jn;ha++)Yi[ha]=arguments[ha];return Rn.apply(void 0,[new Ya(K)].concat(Yi))}:Rn.bind(cr)};default:var ht=this.createClosure(R);return function(){var cr="";R.type==="Identifier"&&(cr=R.name);var xr=ht();if(!xr||!Ji(xr))throw K.createInternalThrowError(ba.FunctionUndefinedReferenceError,cr,R);if(R.type==="Identifier"&&xr.__IS_EVAL_FUNC&&cr==="eval")return function(Jn){var Yi=K.getScopeFromName(cr,K.getCurrentScope()),ha=Yi.name===ot||Yi.name===lo||Yi.name===wt;return xr(new Ya(K),Jn,!ha)};if(xr.__IS_EVAL_FUNC)return function(Jn){return xr(new Ya(K),Jn,!0)};if(xr.__IS_FUNCTION_FUNC)return function(){for(var Jn=arguments.length,Yi=new Array(Jn),ha=0;ha<Jn;ha++)Yi[ha]=arguments[ha];return xr.apply(void 0,[new Ya(K)].concat(Yi))};var Rn=K.options.globalContextInFunction;if(R.type==="Identifier"){var ci=K.getIdentifierScope(R);ci.name===Fr&&(Rn=ci.data)}return xr.bind(Rn)}}},T.callExpressionHandler=function(R){var K=this,xe=this.createCallFunctionGetter(R.callee),We=R.arguments.map(function(ct){return K.createClosure(ct)});return function(){return xe().apply(void 0,We.map(function(ct){return ct()}))}},T.functionExpressionHandler=function(R){var K=this,xe=this,We=this.source,ct=this.collectDeclVars,ht=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var cr=R.id?R.id.name:"",xr=R.params.length,Rn=R.params.map(function(ha){return K.createParamNameGetter(ha)}),ci=this.createClosure(R.body),Jn=this.collectDeclVars,Yi=this.collectDeclFuncs;return this.collectDeclVars=ct,this.collectDeclFuncs=ht,function(){var ha=xe.getCurrentScope(),La=function Hi(){for(var Fo=arguments.length,ws=new Array(Fo),pl=0;pl<Fo;pl++)ws[pl]=arguments[pl];xe.callStack.push(""+cr);var tf=xe.getCurrentScope(),Ju=lu(ha,"FunctionScope("+cr+")");xe.setCurrentScope(Ju),xe.addDeclarationsToScope(Jn,Yi,Ju),cr&&(Ju.data[cr]=Hi),Ju.data.arguments=arguments,Rn.forEach(function(yu,wo){Ju.data[yu()]=ws[wo]});var Mc=xe.getCurrentContext();xe.setCurrentContext(this);var Ru=ci();if(xe.setCurrentContext(Mc),xe.setCurrentScope(tf),xe.callStack.pop(),Ru instanceof $r)return Ru.value};return Ac(La,cr),Object.defineProperty(La,"length",{value:xr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(La,"toString",{value:function(){return We.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(La,"valueOf",{value:function(){return We.slice(R.start,R.end)},writable:!0,configurable:!0,enumerable:!1}),La}},T.newExpressionHandler=function(R){var K=this,xe=this.source,We=this.createClosure(R.callee),ct=R.arguments.map(function(ht){return K.createClosure(ht)});return function(){var ht=We();if(!Ji(ht)||ht.__IS_EVAL_FUNC){var cr=R.callee,xr=xe.slice(cr.start,cr.end);throw K.createInternalThrowError(ba.IsNotConstructor,xr,R)}return ht.__IS_FUNCTION_FUNC?ht.apply(void 0,[new Ya(K)].concat(ct.map(function(Rn){return Rn()}))):Qo(ht,ct.map(function(Rn){return Rn()}))}},T.memberExpressionHandler=function(R){var K=this.createClosure(R.object),xe=this.createMemberKeyGetter(R);return function(){var We=K(),ct=xe();return We[ct]}},T.thisExpressionHandler=function(R){var K=this;return function(){return K.getCurrentContext()}},T.sequenceExpressionHandler=function(R){var K=this,xe=R.expressions.map(function(We){return K.createClosure(We)});return function(){for(var We,ct=xe.length,ht=0;ht<ct;ht++){var cr=xe[ht];We=cr()}return We}},T.literalHandler=function(R){return function(){return R.regex?new RegExp(R.regex.pattern,R.regex.flags):R.value}},T.identifierHandler=function(R){var K=this;return function(){var xe=K.getCurrentScope(),We=K.getScopeDataFromName(R.name,xe);return K.assertVariable(We,R.name,R),We[R.name]}},T.getIdentifierScope=function(R){var K=this.getCurrentScope(),xe=this.getScopeFromName(R.name,K);return xe},T.assignmentExpressionHandler=function(R){var K=this;R.left.type==="Identifier"&&R.right.type==="FunctionExpression"&&!R.right.id&&(R.right.id={type:"Identifier",name:R.left.name});var xe=this.createObjectGetter(R.left),We=this.createNameGetter(R.left),ct=this.createClosure(R.right);return function(){var ht=xe(),cr=We(),xr=ct();switch(R.operator!=="="&&K.assertVariable(ht,cr,R),R.operator){case"=":return ht[cr]=xr;case"+=":return ht[cr]+=xr;case"-=":return ht[cr]-=xr;case"*=":return ht[cr]*=xr;case"**=":return ht[cr]=Math.pow(ht[cr],xr);case"/=":return ht[cr]/=xr;case"%=":return ht[cr]%=xr;case"<<=":return ht[cr]<<=xr;case">>=":return ht[cr]>>=xr;case">>>=":return ht[cr]>>>=xr;case"&=":return ht[cr]&=xr;case"^=":return ht[cr]^=xr;case"|=":return ht[cr]|=xr;default:throw K.createInternalThrowError(ba.AssignmentExpressionSyntaxError,R.type,R)}}},T.functionDeclarationHandler=function(R){if(R.id){var K=this.functionExpressionHandler(R);Object.defineProperty(K,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(R.id.name,K)}return function(){return kt}},T.getVariableName=function(R){if(R.type==="Identifier")return R.name;throw this.createInternalThrowError(ba.VariableTypeSyntaxError,R.type,R)},T.variableDeclarationHandler=function(R){for(var K=this,xe,We=[],ct=0;ct<R.declarations.length;ct++){var ht=R.declarations[ct];this.varDeclaration(this.getVariableName(ht.id)),ht.init&&We.push({type:"AssignmentExpression",operator:"=",left:ht.id,right:ht.init})}return We.length&&(xe=this.createClosure({type:"BlockStatement",body:We})),function(){if(xe){var cr=K.isVarDeclMode;K.isVarDeclMode=!0,xe(),K.isVarDeclMode=cr}return kt}},T.assertVariable=function(R,K,xe){if(R===this.globalScope.data&&!(K in R))throw this.createInternalThrowError(ba.VariableUndefinedReferenceError,K,xe)},T.programHandler=function(R){var K=this,xe=R.body.map(function(We){return K.createClosure(We)});return function(){for(var We=kt,ct=0;ct<xe.length;ct++){var ht=xe[ct],cr=K.setValue(ht());if(cr!==kt&&(We=cr,We instanceof $r||We instanceof Rt||We instanceof Vo||We===Q||We===Ee))break}return We}},T.expressionStatementHandler=function(R){return this.createClosure(R.expression)},T.emptyStatementHandler=function(R){return function(){return kt}},T.returnStatementHandler=function(R){var K=R.argument?this.createClosure(R.argument):Js;return function(){return new $r(K())}},T.ifStatementHandler=function(R){var K=this.createClosure(R.test),xe=this.createClosure(R.consequent),We=R.alternate?this.createClosure(R.alternate):function(){return kt};return function(){return K()?xe():We()}},T.conditionalExpressionHandler=function(R){return this.ifStatementHandler(R)},T.forStatementHandler=function(R){var K=this,xe=Js,We=R.test?this.createClosure(R.test):function(){return!0},ct=Js,ht=this.createClosure(R.body);return R.type==="ForStatement"&&(xe=R.init?this.createClosure(R.init):xe,ct=R.update?this.createClosure(R.update):Js),function(cr){var xr,Rn=kt,ci=R.type==="DoWhileStatement";for(cr&&cr.type==="LabeledStatement"&&(xr=cr.label.name),xe();ci||We();ct()){ci=!1;var Jn=K.setValue(ht());if(!(Jn===kt||Jn===Ee)){if(Jn===Q)break;if(Rn=Jn,Rn instanceof Vo&&Rn.value===xr){Rn=kt;continue}if(Rn instanceof $r||Rn instanceof Rt||Rn instanceof Vo)break}}return Rn}},T.whileStatementHandler=function(R){return this.forStatementHandler(R)},T.doWhileStatementHandler=function(R){return this.forStatementHandler(R)},T.forInStatementHandler=function(R){var K=this,xe=R.left,We=this.createClosure(R.right),ct=this.createClosure(R.body);return R.left.type==="VariableDeclaration"&&(this.createClosure(R.left)(),xe=R.left.declarations[0].id),function(ht){var cr,xr=kt,Rn;ht&&ht.type==="LabeledStatement"&&(cr=ht.label.name);var ci=We();for(Rn in ci){K.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:xe,right:{type:"Literal",value:Rn}})();var Jn=K.setValue(ct());if(!(Jn===kt||Jn===Ee)){if(Jn===Q)break;if(xr=Jn,xr instanceof Vo&&xr.value===cr){xr=kt;continue}if(xr instanceof $r||xr instanceof Rt||xr instanceof Vo)break}}return xr}},T.withStatementHandler=function(R){var K=this,xe=this.createClosure(R.object),We=this.createClosure(R.body);return function(){var ct=xe(),ht=K.getCurrentScope(),cr=new he(ct,ht,Fr);K.setCurrentScope(cr);var xr=K.setValue(We());return K.setCurrentScope(ht),xr}},T.throwStatementHandler=function(R){var K=this,xe=this.createClosure(R.argument);return function(){throw K.setValue(void 0),xe()}},T.tryStatementHandler=function(R){var K=this,xe=this.createClosure(R.block),We=R.handler?this.catchClauseHandler(R.handler):null,ct=R.finalizer?this.createClosure(R.finalizer):null;return function(){var ht=K.getCurrentScope(),cr=K.getCurrentContext(),xr=ht.labelStack.concat([]),Rn=K.callStack.concat([]),ci=kt,Jn,Yi,ha=function(){K.setCurrentScope(ht),K.setCurrentContext(cr),ht.labelStack=xr,K.callStack=Rn};try{ci=K.setValue(xe()),ci instanceof $r&&(Jn=ci)}catch(La){if(ha(),K.isInterruptThrow(La))throw La;if(We)try{ci=K.setValue(We(La)),ci instanceof $r&&(Jn=ci)}catch(Hi){if(ha(),K.isInterruptThrow(Hi))throw Hi;Yi=Hi}}if(ct)try{ci=ct(),ci instanceof $r&&(Jn=ci)}catch(La){if(ha(),K.isInterruptThrow(La))throw La;Yi=La}if(Yi)throw Yi;return Jn||ci}},T.catchClauseHandler=function(R){var K=this,xe=this.createParamNameGetter(R.param),We=this.createClosure(R.body);return function(ct){var ht,cr=K.getCurrentScope(),xr=cr.data,Rn=xe(),ci=Fs.call(xr,Rn),Jn=xr[Rn];return xr[Rn]=ct,ht=We(),ci?xr[Rn]=Jn:delete xr[Rn],ht}},T.continueStatementHandler=function(R){return function(){return R.label?new Vo(R.label.name):Ee}},T.breakStatementHandler=function(R){return function(){return R.label?new Rt(R.label.name):Q}},T.switchStatementHandler=function(R){var K=this,xe=this.createClosure(R.discriminant),We=R.cases.map(function(ct){return K.switchCaseHandler(ct)});return function(){for(var ct=xe(),ht=!1,cr,xr,Rn,ci=0;ci<We.length;ci++){var Jn=We[ci](),Yi=Jn.testClosure();if(Yi===Ke){Rn=Jn;continue}if(ht||Yi===ct){if(ht=!0,xr=K.setValue(Jn.bodyClosure()),xr===kt)continue;if(xr===Q||(cr=xr,cr instanceof $r||cr instanceof Rt||cr instanceof Vo||cr===Ee))break}}if(!ht&&Rn){xr=K.setValue(Rn.bodyClosure());var ha=xr===kt||xr===Q||xr===Ee;ha||(cr=xr)}return cr}},T.switchCaseHandler=function(R){var K=R.test?this.createClosure(R.test):function(){return Ke},xe=this.createClosure({type:"BlockStatement",body:R.consequent});return function(){return{testClosure:K,bodyClosure:xe}}},T.labeledStatementHandler=function(R){var K=this,xe=R.label.name,We=this.createClosure(R.body);return function(){var ct,ht=K.getCurrentScope();return ht.labelStack.push(xe),ct=We(R),ct instanceof Rt&&ct.value===xe&&(ct=kt),ht.labelStack.pop(),ct}},T.debuggerStatementHandler=function(R){return function(){debugger;return kt}},T.createParamNameGetter=function(R){if(R.type==="Identifier")return function(){return R.name};throw this.createInternalThrowError(ba.ParamTypeSyntaxError,R.type,R)},T.createObjectKeyGetter=function(R){var K;return R.type==="Identifier"?K=function(){return R.name}:K=this.createClosure(R),function(){return K()}},T.createMemberKeyGetter=function(R){return R.computed?this.createClosure(R.property):this.createObjectKeyGetter(R.property)},T.createObjectGetter=function(R){var K=this;switch(R.type){case"Identifier":return function(){return K.getScopeDataFromName(R.name,K.getCurrentScope())};case"MemberExpression":return this.createClosure(R.object);default:throw this.createInternalThrowError(ba.AssignmentTypeSyntaxError,R.type,R)}},T.createNameGetter=function(R){switch(R.type){case"Identifier":return function(){return R.name};case"MemberExpression":return this.createMemberKeyGetter(R);default:throw this.createInternalThrowError(ba.AssignmentTypeSyntaxError,R.type,R)}},T.varDeclaration=function(R){var K=this.collectDeclVars;K[R]=void 0},T.funcDeclaration=function(R,K){var xe=this.collectDeclFuncs;xe[R]=K},T.addDeclarationsToScope=function(R,K,xe){var We=xe.data;for(var ct in K){var ht=K[ct];We[ct]=ht&&ht()}for(var cr in R)cr in We||(We[cr]=void 0)},T.getScopeValue=function(R,K){var xe=this.getScopeFromName(R,K);return xe.data[R]},T.getScopeDataFromName=function(R,K){return this.getScopeFromName(R,K).data},T.getScopeFromName=function(R,K){var xe=K;do if(R in xe.data)return xe;while(xe=xe.parent);return this.globalScope},T.setValue=function(R){var K=this.callStack.length;return this.isVarDeclMode||K||R===kt||R===Q||R===Ee||R instanceof Rt||R instanceof Vo||(this.value=R instanceof $r?R.value:R),R},T.getValue=function(){return this.value},_}();bo.version=uu,bo.eval=Jo,bo.Function=en,bo.ecmaVersion=5,bo.globalContextInFunction=void 0,bo.global=Object.create(null);function Kl(_){return _===void 0&&(_=Object.create(null)),_}function wc(_,T,F){T===void 0&&(T=[]),F===void 0&&(F={});var R=F.parsingContext,K=F.timeout===void 0?0:F.timeout,xe=`
    (function anonymous(`+T.join(",")+`){
         `+_+`
    });
    `,We=new bo(R,{ecmaVersion:F.ecmaVersion,timeout:K,rootContext:F.rootContext,globalContextInFunction:F.globalContextInFunction});return We.evaluate(xe)}function Ku(_,T,F){var R=new bo(T,F);return R.evaluate(_)}var Tc=Ku,Ml=function(){function _(F){this._code=F}var T=_.prototype;return T.runInContext=function(R){return Ku(this._code,R)},T.runInNewContext=function(R){return Ku(this._code,R)},_}(),$u=function(_,T,F){return Ku(_,T,F)};function cu(){for(var _=arguments.length,T=new Array(_),F=0;F<_;F++)T[F]=arguments[F];var R=T.pop();return wc(R||"",T)}var Qu=$u},20396:function(Mt,J,N){var ue;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(ye,m,ve,j){"use strict";var le=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,se=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Ne=le||se,ae=["","webkit","Moz","MS","ms","o"],tt=Ne?"":m.createElement("div"),Le="function",it=Math.round,Vt=Math.abs,sr=Date.now;function At(Q,Ee,Ke){return setTimeout(gt(Q,Ke),Ee)}function er(Q,Ee,Ke){return Array.isArray(Q)?(It(Q,Ke[Ee],Ke),!0):!1}function It(Q,Ee,Ke){var kt;if(!!Q)if(Q.forEach)Q.forEach(Ee,Ke);else if(Q.length!==j)for(kt=0;kt<Q.length;)Ee.call(Ke,Q[kt],kt,Q),kt++;else for(kt in Q)Q.hasOwnProperty(kt)&&Ee.call(Ke,Q[kt],kt,Q)}function lt(Q,Ee,Ke){var kt="DEPRECATED METHOD: "+Ee+`
`+Ke+` AT 
`;return function(){var Fr=new Error("get-stack-trace"),ot=Fr&&Fr.stack?Fr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",wt=ye.console&&(ye.console.warn||ye.console.log);return wt&&wt.call(ye.console,kt,ot),Q.apply(this,arguments)}}var dt;typeof Object.assign!="function"?dt=function(Ee){if(Ee===j||Ee===null)throw new TypeError("Cannot convert undefined or null to object");for(var Ke=Object(Ee),kt=1;kt<arguments.length;kt++){var Fr=arguments[kt];if(Fr!==j&&Fr!==null)for(var ot in Fr)Fr.hasOwnProperty(ot)&&(Ke[ot]=Fr[ot])}return Ke}:dt=Object.assign;var tr=lt(function(Ee,Ke,kt){for(var Fr=Object.keys(Ke),ot=0;ot<Fr.length;)(!kt||kt&&Ee[Fr[ot]]===j)&&(Ee[Fr[ot]]=Ke[Fr[ot]]),ot++;return Ee},"extend","Use `assign`."),Y=lt(function(Ee,Ke){return tr(Ee,Ke,!0)},"merge","Use `assign`.");function $t(Q,Ee,Ke){var kt=Ee.prototype,Fr;Fr=Q.prototype=Object.create(kt),Fr.constructor=Q,Fr._super=kt,Ke&&dt(Fr,Ke)}function gt(Q,Ee){return function(){return Q.apply(Ee,arguments)}}function Je(Q,Ee){return typeof Q==Le?Q.apply(Ee&&Ee[0]||j,Ee):Q}function xt(Q,Ee){return Q===j?Ee:Q}function Qe(Q,Ee,Ke){It(Jr(Ee),function(kt){Q.addEventListener(kt,Ke,!1)})}function Kt(Q,Ee,Ke){It(Jr(Ee),function(kt){Q.removeEventListener(kt,Ke,!1)})}function Sr(Q,Ee){for(;Q;){if(Q==Ee)return!0;Q=Q.parentNode}return!1}function Br(Q,Ee){return Q.indexOf(Ee)>-1}function Jr(Q){return Q.trim().split(/\s+/g)}function Te(Q,Ee,Ke){if(Q.indexOf&&!Ke)return Q.indexOf(Ee);for(var kt=0;kt<Q.length;){if(Ke&&Q[kt][Ke]==Ee||!Ke&&Q[kt]===Ee)return kt;kt++}return-1}function Xe(Q){return Array.prototype.slice.call(Q,0)}function ke(Q,Ee,Ke){for(var kt=[],Fr=[],ot=0;ot<Q.length;){var wt=Ee?Q[ot][Ee]:Q[ot];Te(Fr,wt)<0&&kt.push(Q[ot]),Fr[ot]=wt,ot++}return Ke&&(Ee?kt=kt.sort(function(Ji,Ya){return Ji[Ee]>Ya[Ee]}):kt=kt.sort()),kt}function St(Q,Ee){for(var Ke,kt,Fr=Ee[0].toUpperCase()+Ee.slice(1),ot=0;ot<ae.length;){if(Ke=ae[ot],kt=Ke?Ke+Fr:Ee,kt in Q)return kt;ot++}return j}var vt=1;function zt(){return vt++}function Yt(Q){var Ee=Q.ownerDocument||Q;return Ee.defaultView||Ee.parentWindow||ye}var Cr=/mobile|tablet|ip(ad|hone|od)|android/i,Yn="ontouchstart"in ye,hn=St(ye,"PointerEvent")!==j,Ki=Yn&&Cr.test(navigator.userAgent),Zn="touch",Wn="pen",mi="mouse",qn="kinect",ui=25,ia=1,ki=2,Ai=4,Vi=8,sa=1,wi=2,Ca=4,Mn=8,Ei=16,Zi=wi|Ca,$i=Mn|Ei,Wa=Zi|$i,de=["x","y"],Fn=["clientX","clientY"];function Xa(Q,Ee){var Ke=this;this.manager=Q,this.callback=Ee,this.element=Q.element,this.target=Q.options.inputTarget,this.domHandler=function(kt){Je(Q.options.enable,[Q])&&Ke.handler(kt)},this.init()}Xa.prototype={handler:function(){},init:function(){this.evEl&&Qe(this.element,this.evEl,this.domHandler),this.evTarget&&Qe(this.target,this.evTarget,this.domHandler),this.evWin&&Qe(Yt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Kt(this.element,this.evEl,this.domHandler),this.evTarget&&Kt(this.target,this.evTarget,this.domHandler),this.evWin&&Kt(Yt(this.element),this.evWin,this.domHandler)}};function vs(Q){var Ee,Ke=Q.options.inputClass;return Ke?Ee=Ke:hn?Ee=Ie:Ki?Ee=Bt:Yn?Ee=Pt:Ee=Ma,new Ee(Q,jt)}function jt(Q,Ee,Ke){var kt=Ke.pointers.length,Fr=Ke.changedPointers.length,ot=Ee&ia&&kt-Fr==0,wt=Ee&(Ai|Vi)&&kt-Fr==0;Ke.isFirst=!!ot,Ke.isFinal=!!wt,ot&&(Q.session={}),Ke.eventType=Ee,or(Q,Ke),Q.emit("hammer.input",Ke),Q.recognize(Ke),Q.session.prevInput=Ke}function or(Q,Ee){var Ke=Q.session,kt=Ee.pointers,Fr=kt.length;Ke.firstInput||(Ke.firstInput=ar(Ee)),Fr>1&&!Ke.firstMultiple?Ke.firstMultiple=ar(Ee):Fr===1&&(Ke.firstMultiple=!1);var ot=Ke.firstInput,wt=Ke.firstMultiple,lo=wt?wt.center:ot.center,Ji=Ee.center=kn(kt);Ee.timeStamp=sr(),Ee.deltaTime=Ee.timeStamp-ot.timeStamp,Ee.angle=Pi(lo,Ji),Ee.distance=an(lo,Ji),Mr(Ke,Ee),Ee.offsetDirection=jn(Ee.deltaX,Ee.deltaY);var Ya=li(Ee.deltaTime,Ee.deltaX,Ee.deltaY);Ee.overallVelocityX=Ya.x,Ee.overallVelocityY=Ya.y,Ee.overallVelocity=Vt(Ya.x)>Vt(Ya.y)?Ya.x:Ya.y,Ee.scale=wt?Ja(wt.pointers,kt):1,Ee.rotation=wt?Ii(wt.pointers,kt):0,Ee.maxPointers=Ke.prevInput?Ee.pointers.length>Ke.prevInput.maxPointers?Ee.pointers.length:Ke.prevInput.maxPointers:Ee.pointers.length,I(Ke,Ee);var Jo=Q.element;Sr(Ee.srcEvent.target,Jo)&&(Jo=Ee.srcEvent.target),Ee.target=Jo}function Mr(Q,Ee){var Ke=Ee.center,kt=Q.offsetDelta||{},Fr=Q.prevDelta||{},ot=Q.prevInput||{};(Ee.eventType===ia||ot.eventType===Ai)&&(Fr=Q.prevDelta={x:ot.deltaX||0,y:ot.deltaY||0},kt=Q.offsetDelta={x:Ke.x,y:Ke.y}),Ee.deltaX=Fr.x+(Ke.x-kt.x),Ee.deltaY=Fr.y+(Ke.y-kt.y)}function I(Q,Ee){var Ke=Q.lastInterval||Ee,kt=Ee.timeStamp-Ke.timeStamp,Fr,ot,wt,lo;if(Ee.eventType!=Vi&&(kt>ui||Ke.velocity===j)){var Ji=Ee.deltaX-Ke.deltaX,Ya=Ee.deltaY-Ke.deltaY,Jo=li(kt,Ji,Ya);ot=Jo.x,wt=Jo.y,Fr=Vt(Jo.x)>Vt(Jo.y)?Jo.x:Jo.y,lo=jn(Ji,Ya),Q.lastInterval=Ee}else Fr=Ke.velocity,ot=Ke.velocityX,wt=Ke.velocityY,lo=Ke.direction;Ee.velocity=Fr,Ee.velocityX=ot,Ee.velocityY=wt,Ee.direction=lo}function ar(Q){for(var Ee=[],Ke=0;Ke<Q.pointers.length;)Ee[Ke]={clientX:it(Q.pointers[Ke].clientX),clientY:it(Q.pointers[Ke].clientY)},Ke++;return{timeStamp:sr(),pointers:Ee,center:kn(Ee),deltaX:Q.deltaX,deltaY:Q.deltaY}}function kn(Q){var Ee=Q.length;if(Ee===1)return{x:it(Q[0].clientX),y:it(Q[0].clientY)};for(var Ke=0,kt=0,Fr=0;Fr<Ee;)Ke+=Q[Fr].clientX,kt+=Q[Fr].clientY,Fr++;return{x:it(Ke/Ee),y:it(kt/Ee)}}function li(Q,Ee,Ke){return{x:Ee/Q||0,y:Ke/Q||0}}function jn(Q,Ee){return Q===Ee?sa:Vt(Q)>=Vt(Ee)?Q<0?wi:Ca:Ee<0?Mn:Ei}function an(Q,Ee,Ke){Ke||(Ke=de);var kt=Ee[Ke[0]]-Q[Ke[0]],Fr=Ee[Ke[1]]-Q[Ke[1]];return Math.sqrt(kt*kt+Fr*Fr)}function Pi(Q,Ee,Ke){Ke||(Ke=de);var kt=Ee[Ke[0]]-Q[Ke[0]],Fr=Ee[Ke[1]]-Q[Ke[1]];return Math.atan2(Fr,kt)*180/Math.PI}function Ii(Q,Ee){return Pi(Ee[1],Ee[0],Fn)+Pi(Q[1],Q[0],Fn)}function Ja(Q,Ee){return an(Ee[0],Ee[1],Fn)/an(Q[0],Q[1],Fn)}var ms={mousedown:ia,mousemove:ki,mouseup:Ai},xa="mousedown",ka="mousemove mouseup";function Ma(){this.evEl=xa,this.evWin=ka,this.pressed=!1,Xa.apply(this,arguments)}$t(Ma,Xa,{handler:function(Ee){var Ke=ms[Ee.type];Ke&ia&&Ee.button===0&&(this.pressed=!0),Ke&ki&&Ee.which!==1&&(Ke=Ai),!!this.pressed&&(Ke&Ai&&(this.pressed=!1),this.callback(this.manager,Ke,{pointers:[Ee],changedPointers:[Ee],pointerType:mi,srcEvent:Ee}))}});var H={pointerdown:ia,pointermove:ki,pointerup:Ai,pointercancel:Vi,pointerout:Vi},$={2:Zn,3:Wn,4:mi,5:qn},re="pointerdown",ge="pointermove pointerup pointercancel";!Ne&&ye.MSPointerEvent&&!ye.PointerEvent&&(re="MSPointerDown",ge="MSPointerMove MSPointerUp MSPointerCancel");function Ie(){this.evEl=re,this.evWin=ge,Xa.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}$t(Ie,Xa,{handler:function(Ee){var Ke=this.store,kt=!1,Fr=Ee.type.toLowerCase().replace("ms",""),ot=H[Fr],wt=$[Ee.pointerType]||Ee.pointerType,lo=wt==Zn,Ji=Te(Ke,Ee.pointerId,"pointerId");ot&ia&&(Ee.button===0||lo)?Ji<0&&(Ke.push(Ee),Ji=Ke.length-1):ot&(Ai|Vi)&&(kt=!0),!(Ji<0)&&(Ke[Ji]=Ee,this.callback(this.manager,ot,{pointers:Ke,changedPointers:[Ee],pointerType:wt,srcEvent:Ee}),kt&&Ke.splice(Ji,1))}});var Ge={touchstart:ia,touchmove:ki,touchend:Ai,touchcancel:Vi},rt="touchstart",ce="touchstart touchmove touchend touchcancel";function De(){this.evTarget=rt,this.evWin=ce,this.started=!1,Xa.apply(this,arguments)}$t(De,Xa,{handler:function(Ee){var Ke=Ge[Ee.type];if(Ke===ia&&(this.started=!0),!!this.started){var kt=mt.call(this,Ee,Ke);Ke&(Ai|Vi)&&kt[0].length-kt[1].length==0&&(this.started=!1),this.callback(this.manager,Ke,{pointers:kt[0],changedPointers:kt[1],pointerType:Zn,srcEvent:Ee})}}});function mt(Q,Ee){var Ke=Xe(Q.touches),kt=Xe(Q.changedTouches);return Ee&(Ai|Vi)&&(Ke=ke(Ke.concat(kt),"identifier",!0)),[Ke,kt]}var mr={touchstart:ia,touchmove:ki,touchend:Ai,touchcancel:Vi},Dt="touchstart touchmove touchend touchcancel";function Bt(){this.evTarget=Dt,this.targetIds={},Xa.apply(this,arguments)}$t(Bt,Xa,{handler:function(Ee){var Ke=mr[Ee.type],kt=yr.call(this,Ee,Ke);!kt||this.callback(this.manager,Ke,{pointers:kt[0],changedPointers:kt[1],pointerType:Zn,srcEvent:Ee})}});function yr(Q,Ee){var Ke=Xe(Q.touches),kt=this.targetIds;if(Ee&(ia|ki)&&Ke.length===1)return kt[Ke[0].identifier]=!0,[Ke,Ke];var Fr,ot,wt=Xe(Q.changedTouches),lo=[],Ji=this.target;if(ot=Ke.filter(function(Ya){return Sr(Ya.target,Ji)}),Ee===ia)for(Fr=0;Fr<ot.length;)kt[ot[Fr].identifier]=!0,Fr++;for(Fr=0;Fr<wt.length;)kt[wt[Fr].identifier]&&lo.push(wt[Fr]),Ee&(Ai|Vi)&&delete kt[wt[Fr].identifier],Fr++;if(!!lo.length)return[ke(ot.concat(lo),"identifier",!0),lo]}var En=2500,cn=25;function Pt(){Xa.apply(this,arguments);var Q=gt(this.handler,this);this.touch=new Bt(this.manager,Q),this.mouse=new Ma(this.manager,Q),this.primaryTouch=null,this.lastTouches=[]}$t(Pt,Xa,{handler:function(Ee,Ke,kt){var Fr=kt.pointerType==Zn,ot=kt.pointerType==mi;if(!(ot&&kt.sourceCapabilities&&kt.sourceCapabilities.firesTouchEvents)){if(Fr)un.call(this,Ke,kt);else if(ot&&Wr.call(this,kt))return;this.callback(Ee,Ke,kt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function un(Q,Ee){Q&ia?(this.primaryTouch=Ee.changedPointers[0].identifier,Gr.call(this,Ee)):Q&(Ai|Vi)&&Gr.call(this,Ee)}function Gr(Q){var Ee=Q.changedPointers[0];if(Ee.identifier===this.primaryTouch){var Ke={x:Ee.clientX,y:Ee.clientY};this.lastTouches.push(Ke);var kt=this.lastTouches,Fr=function(){var ot=kt.indexOf(Ke);ot>-1&&kt.splice(ot,1)};setTimeout(Fr,En)}}function Wr(Q){for(var Ee=Q.srcEvent.clientX,Ke=Q.srcEvent.clientY,kt=0;kt<this.lastTouches.length;kt++){var Fr=this.lastTouches[kt],ot=Math.abs(Ee-Fr.x),wt=Math.abs(Ke-Fr.y);if(ot<=cn&&wt<=cn)return!0}return!1}var oi=Ne?j:St(tt.style,"touchAction"),rn=oi!==j,Ti="compute",ea="auto",bi="manipulation",Oi="none",Si="pan-x",ri="pan-y",Xi=Ri();function Da(Q,Ee){this.manager=Q,this.set(Ee)}Da.prototype={set:function(Q){Q==Ti&&(Q=this.compute()),rn&&this.manager.element.style&&Xi[Q]&&(this.manager.element.style[oi]=Q),this.actions=Q.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var Q=[];return It(this.manager.recognizers,function(Ee){Je(Ee.options.enable,[Ee])&&(Q=Q.concat(Ee.getTouchAction()))}),aa(Q.join(" "))},preventDefaults:function(Q){var Ee=Q.srcEvent,Ke=Q.offsetDirection;if(this.manager.session.prevented){Ee.preventDefault();return}var kt=this.actions,Fr=Br(kt,Oi)&&!Xi[Oi],ot=Br(kt,ri)&&!Xi[ri],wt=Br(kt,Si)&&!Xi[Si];if(Fr){var lo=Q.pointers.length===1,Ji=Q.distance<2,Ya=Q.deltaTime<250;if(lo&&Ji&&Ya)return}if(!(wt&&ot)&&(Fr||ot&&Ke&Zi||wt&&Ke&$i))return this.preventSrc(Ee)},preventSrc:function(Q){this.manager.session.prevented=!0,Q.preventDefault()}};function aa(Q){if(Br(Q,Oi))return Oi;var Ee=Br(Q,Si),Ke=Br(Q,ri);return Ee&&Ke?Oi:Ee||Ke?Ee?Si:ri:Br(Q,bi)?bi:ea}function Ri(){if(!rn)return!1;var Q={};if(Ne)return Q;var Ee=ye.CSS&&ye.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Ke){Q[Ke]=Ee?ye.CSS.supports("touch-action",Ke):!0}),Q}var Gi=1,za=2,su=4,Pa=8,Ia=Pa,As=16,gs=32;function ta(Q){this.options=dt({},this.defaults,Q||{}),this.id=zt(),this.manager=null,this.options.enable=xt(this.options.enable,!0),this.state=Gi,this.simultaneous={},this.requireFail=[]}ta.prototype={defaults:{},set:function(Q){return dt(this.options,Q),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(Q){if(er(Q,"recognizeWith",this))return this;var Ee=this.simultaneous;return Q=Ua(Q,this),Ee[Q.id]||(Ee[Q.id]=Q,Q.recognizeWith(this)),this},dropRecognizeWith:function(Q){return er(Q,"dropRecognizeWith",this)?this:(Q=Ua(Q,this),delete this.simultaneous[Q.id],this)},requireFailure:function(Q){if(er(Q,"requireFailure",this))return this;var Ee=this.requireFail;return Q=Ua(Q,this),Te(Ee,Q)===-1&&(Ee.push(Q),Q.requireFailure(this)),this},dropRequireFailure:function(Q){if(er(Q,"dropRequireFailure",this))return this;Q=Ua(Q,this);var Ee=Te(this.requireFail,Q);return Ee>-1&&this.requireFail.splice(Ee,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(Q){return!!this.simultaneous[Q.id]},emit:function(Q){var Ee=this,Ke=this.state;function kt(Fr){Ee.manager.emit(Fr,Q)}Ke<Pa&&kt(Ee.options.event+Yu(Ke)),kt(Ee.options.event),Q.additionalEvent&&kt(Q.additionalEvent),Ke>=Pa&&kt(Ee.options.event+Yu(Ke))},tryEmit:function(Q){if(this.canEmit())return this.emit(Q);this.state=gs},canEmit:function(){for(var Q=0;Q<this.requireFail.length;){if(!(this.requireFail[Q].state&(gs|Gi)))return!1;Q++}return!0},recognize:function(Q){var Ee=dt({},Q);if(!Je(this.options.enable,[this,Ee])){this.reset(),this.state=gs;return}this.state&(Ia|As|gs)&&(this.state=Gi),this.state=this.process(Ee),this.state&(za|su|Pa|As)&&this.tryEmit(Ee)},process:function(Q){},getTouchAction:function(){},reset:function(){}};function Yu(Q){return Q&As?"cancel":Q&Pa?"end":Q&su?"move":Q&za?"start":""}function _o(Q){return Q==Ei?"down":Q==Mn?"up":Q==wi?"left":Q==Ca?"right":""}function Ua(Q,Ee){var Ke=Ee.manager;return Ke?Ke.get(Q):Q}function so(){ta.apply(this,arguments)}$t(so,ta,{defaults:{pointers:1},attrTest:function(Q){var Ee=this.options.pointers;return Ee===0||Q.pointers.length===Ee},process:function(Q){var Ee=this.state,Ke=Q.eventType,kt=Ee&(za|su),Fr=this.attrTest(Q);return kt&&(Ke&Vi||!Fr)?Ee|As:kt||Fr?Ke&Ai?Ee|Pa:Ee&za?Ee|su:za:gs}});function Qi(){so.apply(this,arguments),this.pX=null,this.pY=null}$t(Qi,so,{defaults:{event:"pan",threshold:10,pointers:1,direction:Wa},getTouchAction:function(){var Q=this.options.direction,Ee=[];return Q&Zi&&Ee.push(ri),Q&$i&&Ee.push(Si),Ee},directionTest:function(Q){var Ee=this.options,Ke=!0,kt=Q.distance,Fr=Q.direction,ot=Q.deltaX,wt=Q.deltaY;return Fr&Ee.direction||(Ee.direction&Zi?(Fr=ot===0?sa:ot<0?wi:Ca,Ke=ot!=this.pX,kt=Math.abs(Q.deltaX)):(Fr=wt===0?sa:wt<0?Mn:Ei,Ke=wt!=this.pY,kt=Math.abs(Q.deltaY))),Q.direction=Fr,Ke&&kt>Ee.threshold&&Fr&Ee.direction},attrTest:function(Q){return so.prototype.attrTest.call(this,Q)&&(this.state&za||!(this.state&za)&&this.directionTest(Q))},emit:function(Q){this.pX=Q.deltaX,this.pY=Q.deltaY;var Ee=_o(Q.direction);Ee&&(Q.additionalEvent=this.options.event+Ee),this._super.emit.call(this,Q)}});function qo(){so.apply(this,arguments)}$t(qo,so,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Oi]},attrTest:function(Q){return this._super.attrTest.call(this,Q)&&(Math.abs(Q.scale-1)>this.options.threshold||this.state&za)},emit:function(Q){if(Q.scale!==1){var Ee=Q.scale<1?"in":"out";Q.additionalEvent=this.options.event+Ee}this._super.emit.call(this,Q)}});function Ko(){ta.apply(this,arguments),this._timer=null,this._input=null}$t(Ko,ta,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ea]},process:function(Q){var Ee=this.options,Ke=Q.pointers.length===Ee.pointers,kt=Q.distance<Ee.threshold,Fr=Q.deltaTime>Ee.time;if(this._input=Q,!kt||!Ke||Q.eventType&(Ai|Vi)&&!Fr)this.reset();else if(Q.eventType&ia)this.reset(),this._timer=At(function(){this.state=Ia,this.tryEmit()},Ee.time,this);else if(Q.eventType&Ai)return Ia;return gs},reset:function(){clearTimeout(this._timer)},emit:function(Q){this.state===Ia&&(Q&&Q.eventType&Ai?this.manager.emit(this.options.event+"up",Q):(this._input.timeStamp=sr(),this.manager.emit(this.options.event,this._input)))}});function qu(){so.apply(this,arguments)}$t(qu,so,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Oi]},attrTest:function(Q){return this._super.attrTest.call(this,Q)&&(Math.abs(Q.rotation)>this.options.threshold||this.state&za)}});function Ao(){so.apply(this,arguments)}$t(Ao,so,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Zi|$i,pointers:1},getTouchAction:function(){return Qi.prototype.getTouchAction.call(this)},attrTest:function(Q){var Ee=this.options.direction,Ke;return Ee&(Zi|$i)?Ke=Q.overallVelocity:Ee&Zi?Ke=Q.overallVelocityX:Ee&$i&&(Ke=Q.overallVelocityY),this._super.attrTest.call(this,Q)&&Ee&Q.offsetDirection&&Q.distance>this.options.threshold&&Q.maxPointers==this.options.pointers&&Vt(Ke)>this.options.velocity&&Q.eventType&Ai},emit:function(Q){var Ee=_o(Q.offsetDirection);Ee&&this.manager.emit(this.options.event+Ee,Q),this.manager.emit(this.options.event,Q)}});function $o(){ta.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}$t($o,ta,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[bi]},process:function(Q){var Ee=this.options,Ke=Q.pointers.length===Ee.pointers,kt=Q.distance<Ee.threshold,Fr=Q.deltaTime<Ee.time;if(this.reset(),Q.eventType&ia&&this.count===0)return this.failTimeout();if(kt&&Fr&&Ke){if(Q.eventType!=Ai)return this.failTimeout();var ot=this.pTime?Q.timeStamp-this.pTime<Ee.interval:!0,wt=!this.pCenter||an(this.pCenter,Q.center)<Ee.posThreshold;this.pTime=Q.timeStamp,this.pCenter=Q.center,!wt||!ot?this.count=1:this.count+=1,this._input=Q;var lo=this.count%Ee.taps;if(lo===0)return this.hasRequireFailures()?(this._timer=At(function(){this.state=Ia,this.tryEmit()},Ee.interval,this),za):Ia}return gs},failTimeout:function(){return this._timer=At(function(){this.state=gs},this.options.interval,this),gs},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ia&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function ba(Q,Ee){return Ee=Ee||{},Ee.recognizers=xt(Ee.recognizers,ba.defaults.preset),new uo(Q,Ee)}ba.VERSION="2.0.7",ba.defaults={domEvents:!1,touchAction:Ti,enable:!0,inputTarget:null,inputClass:null,preset:[[qu,{enable:!1}],[qo,{enable:!1},["rotate"]],[Ao,{direction:Zi}],[Qi,{direction:Zi},["swipe"]],[$o],[$o,{event:"doubletap",taps:2},["tap"]],[Ko]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var xo=1,Qo=2;function uo(Q,Ee){this.options=dt({},ba.defaults,Ee||{}),this.options.inputTarget=this.options.inputTarget||Q,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=Q,this.input=vs(this),this.touchAction=new Da(this,this.options.touchAction),uu(this,!0),It(this.options.recognizers,function(Ke){var kt=this.add(new Ke[0](Ke[1]));Ke[2]&&kt.recognizeWith(Ke[2]),Ke[3]&&kt.requireFailure(Ke[3])},this)}uo.prototype={set:function(Q){return dt(this.options,Q),Q.touchAction&&this.touchAction.update(),Q.inputTarget&&(this.input.destroy(),this.input.target=Q.inputTarget,this.input.init()),this},stop:function(Q){this.session.stopped=Q?Qo:xo},recognize:function(Q){var Ee=this.session;if(!Ee.stopped){this.touchAction.preventDefaults(Q);var Ke,kt=this.recognizers,Fr=Ee.curRecognizer;(!Fr||Fr&&Fr.state&Ia)&&(Fr=Ee.curRecognizer=null);for(var ot=0;ot<kt.length;)Ke=kt[ot],Ee.stopped!==Qo&&(!Fr||Ke==Fr||Ke.canRecognizeWith(Fr))?Ke.recognize(Q):Ke.reset(),!Fr&&Ke.state&(za|su|Pa)&&(Fr=Ee.curRecognizer=Ke),ot++}},get:function(Q){if(Q instanceof ta)return Q;for(var Ee=this.recognizers,Ke=0;Ke<Ee.length;Ke++)if(Ee[Ke].options.event==Q)return Ee[Ke];return null},add:function(Q){if(er(Q,"add",this))return this;var Ee=this.get(Q.options.event);return Ee&&this.remove(Ee),this.recognizers.push(Q),Q.manager=this,this.touchAction.update(),Q},remove:function(Q){if(er(Q,"remove",this))return this;if(Q=this.get(Q),Q){var Ee=this.recognizers,Ke=Te(Ee,Q);Ke!==-1&&(Ee.splice(Ke,1),this.touchAction.update())}return this},on:function(Q,Ee){if(Q!==j&&Ee!==j){var Ke=this.handlers;return It(Jr(Q),function(kt){Ke[kt]=Ke[kt]||[],Ke[kt].push(Ee)}),this}},off:function(Q,Ee){if(Q!==j){var Ke=this.handlers;return It(Jr(Q),function(kt){Ee?Ke[kt]&&Ke[kt].splice(Te(Ke[kt],Ee),1):delete Ke[kt]}),this}},emit:function(Q,Ee){this.options.domEvents&&Ac(Q,Ee);var Ke=this.handlers[Q]&&this.handlers[Q].slice();if(!(!Ke||!Ke.length)){Ee.type=Q,Ee.preventDefault=function(){Ee.srcEvent.preventDefault()};for(var kt=0;kt<Ke.length;)Ke[kt](Ee),kt++}},destroy:function(){this.element&&uu(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function uu(Q,Ee){var Ke=Q.element;if(!!Ke.style){var kt;It(Q.options.cssProps,function(Fr,ot){kt=St(Ke.style,ot),Ee?(Q.oldCssProps[kt]=Ke.style[kt],Ke.style[kt]=Fr):Ke.style[kt]=Q.oldCssProps[kt]||""}),Ee||(Q.oldCssProps={})}}function Ac(Q,Ee){if(!Ne){var Ke=m.createEvent("Event");Ke.initEvent(Q,!0,!0),Ke.gesture=Ee,Ee.target.dispatchEvent(Ke)}}if(!Ne){dt(ba,{INPUT_START:ia,INPUT_MOVE:ki,INPUT_END:Ai,INPUT_CANCEL:Vi,STATE_POSSIBLE:Gi,STATE_BEGAN:za,STATE_CHANGED:su,STATE_ENDED:Pa,STATE_RECOGNIZED:Ia,STATE_CANCELLED:As,STATE_FAILED:gs,DIRECTION_NONE:sa,DIRECTION_LEFT:wi,DIRECTION_RIGHT:Ca,DIRECTION_UP:Mn,DIRECTION_DOWN:Ei,DIRECTION_HORIZONTAL:Zi,DIRECTION_VERTICAL:$i,DIRECTION_ALL:Wa,Manager:uo,Input:Xa,TouchAction:Da,TouchInput:Bt,MouseInput:Ma,PointerEventInput:Ie,TouchMouseInput:Pt,SingleTouchInput:De,Recognizer:ta,AttrRecognizer:so,Tap:$o,Pan:Qi,Swipe:Ao,Pinch:qo,Rotate:qu,Press:Ko,on:Qe,off:Kt,each:It,merge:Y,extend:tr,assign:dt,inherit:$t,bindFn:gt,prefixed:St});var Fs=typeof window!="undefined"?window:typeof self!="undefined"?self:{};Fs.Hammer=ba,ue=function(){return ba}.call(J,N,J,Mt),ue!==j&&(Mt.exports=ue)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(Mt,J,N){(function(ue,ye){Mt.exports=ye(N(18857))})(this,function(ue){"use strict";var ye=function(B){return B instanceof Uint8Array||B instanceof Uint16Array||B instanceof Uint32Array||B instanceof Int8Array||B instanceof Int16Array||B instanceof Int32Array||B instanceof Float32Array||B instanceof Float64Array||B instanceof Uint8ClampedArray},m=function(B,me){for(var Be=Object.keys(me),Ft=0;Ft<Be.length;++Ft)B[Be[Ft]]=me[Be[Ft]];return B},ve=`
`;function j(B){return typeof atob!="undefined"?atob(B):"base64:"+B}function le(B){var me=new Error("(regl) "+B);throw console.error(me),me}function se(B,me){B||le(me)}function Ne(B){return B?": "+B:""}function ae(B,me,Be){B in me||le("unknown parameter ("+B+")"+Ne(Be)+". possible values: "+Object.keys(me).join())}function tt(B,me){ye(B)||le("invalid parameter type"+Ne(me)+". must be a typed array")}function Le(B,me){switch(me){case"number":return typeof B=="number";case"object":return typeof B=="object";case"string":return typeof B=="string";case"boolean":return typeof B=="boolean";case"function":return typeof B=="function";case"undefined":return typeof B=="undefined";case"symbol":return typeof B=="symbol"}}function it(B,me,Be){Le(B,me)||le("invalid parameter type"+Ne(Be)+". expected "+me+", got "+typeof B)}function Vt(B,me){B>=0&&(B|0)===B||le("invalid parameter type, ("+B+")"+Ne(me)+". must be a nonnegative integer")}function sr(B,me,Be){me.indexOf(B)<0&&le("invalid value"+Ne(Be)+". must be one of: "+me)}var At=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function er(B){Object.keys(B).forEach(function(me){At.indexOf(me)<0&&le('invalid regl constructor argument "'+me+'". must be one of '+At)})}function It(B,me){for(B=B+"";B.length<me;)B=" "+B;return B}function lt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function dt(B,me){this.number=B,this.line=me,this.errors=[]}function tr(B,me,Be){this.file=B,this.line=me,this.message=Be}function Y(){var B=new Error,me=(B.stack||B).toString(),Be=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(me);if(Be)return Be[1];var Ft=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(me);return Ft?Ft[1]:"unknown"}function $t(){var B=new Error,me=(B.stack||B).toString(),Be=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(me);if(Be)return Be[1];var Ft=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(me);return Ft?Ft[1]:"unknown"}function gt(B,me){var Be=B.split(`
`),Ft=1,ur=0,Lt={unknown:new lt,0:new lt};Lt.unknown.name=Lt[0].name=me||Y(),Lt.unknown.lines.push(new dt(0,""));for(var nr=0;nr<Be.length;++nr){var hr=Be[nr],_r=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(hr);if(_r)switch(_r[1]){case"line":var br=/(\d+)(\s+\d+)?/.exec(_r[2]);br&&(Ft=br[1]|0,br[2]&&(ur=br[2]|0,ur in Lt||(Lt[ur]=new lt)));break;case"define":var Tr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(_r[2]);Tr&&(Lt[ur].name=Tr[1]?j(Tr[2]):Tr[2]);break}Lt[ur].lines.push(new dt(Ft++,hr))}return Object.keys(Lt).forEach(function(kr){var dr=Lt[kr];dr.lines.forEach(function(gr){dr.index[gr.number]=gr})}),Lt}function Je(B){var me=[];return B.split(`
`).forEach(function(Be){if(!(Be.length<5)){var Ft=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Be);Ft?me.push(new tr(Ft[1]|0,Ft[2]|0,Ft[3].trim())):Be.length>0&&me.push(new tr("unknown",0,Be))}}),me}function xt(B,me){me.forEach(function(Be){var Ft=B[Be.file];if(Ft){var ur=Ft.index[Be.line];if(ur){ur.errors.push(Be),Ft.hasErrors=!0;return}}B.unknown.hasErrors=!0,B.unknown.lines[0].errors.push(Be)})}function Qe(B,me,Be,Ft,ur){if(!B.getShaderParameter(me,B.COMPILE_STATUS)){var Lt=B.getShaderInfoLog(me),nr=Ft===B.FRAGMENT_SHADER?"fragment":"vertex";ke(Be,"string",nr+" shader source must be a string",ur);var hr=gt(Be,ur),_r=Je(Lt);xt(hr,_r),Object.keys(hr).forEach(function(br){var Tr=hr[br];if(!Tr.hasErrors)return;var kr=[""],dr=[""];function gr(Pr,ut){kr.push(Pr),dr.push(ut||"")}gr("file number "+br+": "+Tr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Tr.lines.forEach(function(Pr){if(Pr.errors.length>0){gr(It(Pr.number,4)+"|  ","background-color:yellow; font-weight:bold"),gr(Pr.line+ve,"color:red; background-color:yellow; font-weight:bold");var ut=0;Pr.errors.forEach(function(Gt){var Ar=Gt.message,Zr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Ar);if(Zr){var pr=Zr[1];switch(Ar=Zr[2],pr){case"assign":pr="=";break}ut=Math.max(Pr.line.indexOf(pr,ut),0)}else ut=0;gr(It("| ",6)),gr(It("^^^",ut+3)+ve,"font-weight:bold"),gr(It("| ",6)),gr(Ar+ve,"font-weight:bold")}),gr(It("| ",6)+ve)}else gr(It(Pr.number,4)+"|  "),gr(Pr.line+ve,"color:red")}),typeof document!="undefined"&&!window.chrome?(dr[0]=kr.join("%c"),console.log.apply(console,dr)):console.log(kr.join(""))}),se.raise("Error compiling "+nr+" shader, "+hr[0].name)}}function Kt(B,me,Be,Ft,ur){if(!B.getProgramParameter(me,B.LINK_STATUS)){var Lt=B.getProgramInfoLog(me),nr=gt(Be,ur),hr=gt(Ft,ur),_r='Error linking program with vertex shader, "'+hr[0].name+'", and fragment shader "'+nr[0].name+'"';typeof document!="undefined"?console.log("%c"+_r+ve+"%c"+Lt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(_r+ve+Lt),se.raise(_r)}}function Sr(B){B._commandRef=Y()}function Br(B,me,Be,Ft){Sr(B);function ur(_r){return _r?Ft.id(_r):0}B._fragId=ur(B.static.frag),B._vertId=ur(B.static.vert);function Lt(_r,br){Object.keys(br).forEach(function(Tr){_r[Ft.id(Tr)]=!0})}var nr=B._uniformSet={};Lt(nr,me.static),Lt(nr,me.dynamic);var hr=B._attributeSet={};Lt(hr,Be.static),Lt(hr,Be.dynamic),B._hasCount="count"in B.static||"count"in B.dynamic||"elements"in B.static||"elements"in B.dynamic}function Jr(B,me){var Be=$t();le(B+" in command "+(me||Y())+(Be==="unknown"?"":" called from "+Be))}function Te(B,me,Be){B||Jr(me,Be||Y())}function Xe(B,me,Be,Ft){B in me||Jr("unknown parameter ("+B+")"+Ne(Be)+". possible values: "+Object.keys(me).join(),Ft||Y())}function ke(B,me,Be,Ft){Le(B,me)||Jr("invalid parameter type"+Ne(Be)+". expected "+me+", got "+typeof B,Ft||Y())}function St(B){B()}function vt(B,me,Be){B.texture?sr(B.texture._texture.internalformat,me,"unsupported texture format for attachment"):sr(B.renderbuffer._renderbuffer.format,Be,"unsupported renderbuffer format for attachment")}var zt=33071,Yt=9728,Cr=9984,Yn=9985,hn=9986,Ki=9987,Zn=5120,Wn=5121,mi=5122,qn=5123,ui=5124,ia=5125,ki=5126,Ai=32819,Vi=32820,sa=33635,wi=34042,Ca=36193,Mn={};Mn[Zn]=Mn[Wn]=1,Mn[mi]=Mn[qn]=Mn[Ca]=Mn[sa]=Mn[Ai]=Mn[Vi]=2,Mn[ui]=Mn[ia]=Mn[ki]=Mn[wi]=4;function Ei(B,me){return B===Vi||B===Ai||B===sa?2:B===wi?4:Mn[B]*me}function Zi(B){return!(B&B-1)&&!!B}function $i(B,me,Be){var Ft,ur=me.width,Lt=me.height,nr=me.channels;se(ur>0&&ur<=Be.maxTextureSize&&Lt>0&&Lt<=Be.maxTextureSize,"invalid texture shape"),(B.wrapS!==zt||B.wrapT!==zt)&&se(Zi(ur)&&Zi(Lt),"incompatible wrap mode for texture, both width and height must be power of 2"),me.mipmask===1?ur!==1&&Lt!==1&&se(B.minFilter!==Cr&&B.minFilter!==hn&&B.minFilter!==Yn&&B.minFilter!==Ki,"min filter requires mipmap"):(se(Zi(ur)&&Zi(Lt),"texture must be a square power of 2 to support mipmapping"),se(me.mipmask===(ur<<1)-1,"missing or incomplete mipmap data")),me.type===ki&&(Be.extensions.indexOf("oes_texture_float_linear")<0&&se(B.minFilter===Yt&&B.magFilter===Yt,"filter not supported, must enable oes_texture_float_linear"),se(!B.genMipmaps,"mipmap generation not supported with float textures"));var hr=me.images;for(Ft=0;Ft<16;++Ft)if(hr[Ft]){var _r=ur>>Ft,br=Lt>>Ft;se(me.mipmask&1<<Ft,"missing mipmap data");var Tr=hr[Ft];if(se(Tr.width===_r&&Tr.height===br,"invalid shape for mip images"),se(Tr.format===me.format&&Tr.internalformat===me.internalformat&&Tr.type===me.type,"incompatible type for mip image"),!Tr.compressed)if(Tr.data){var kr=Math.ceil(Ei(Tr.type,nr)*_r/Tr.unpackAlignment)*Tr.unpackAlignment;se(Tr.data.byteLength===kr*br,"invalid data for image, buffer size is inconsistent with image format")}else Tr.element||Tr.copy}else B.genMipmaps||se((me.mipmask&1<<Ft)==0,"extra mipmap data");me.compressed&&se(!B.genMipmaps,"mipmap generation for compressed images not supported")}function Wa(B,me,Be,Ft){var ur=B.width,Lt=B.height,nr=B.channels;se(ur>0&&ur<=Ft.maxTextureSize&&Lt>0&&Lt<=Ft.maxTextureSize,"invalid texture shape"),se(ur===Lt,"cube map must be square"),se(me.wrapS===zt&&me.wrapT===zt,"wrap mode not supported by cube map");for(var hr=0;hr<Be.length;++hr){var _r=Be[hr];se(_r.width===ur&&_r.height===Lt,"inconsistent cube map face shape"),me.genMipmaps&&(se(!_r.compressed,"can not generate mipmap for compressed textures"),se(_r.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var br=_r.images,Tr=0;Tr<16;++Tr){var kr=br[Tr];if(kr){var dr=ur>>Tr,gr=Lt>>Tr;se(_r.mipmask&1<<Tr,"missing mipmap data"),se(kr.width===dr&&kr.height===gr,"invalid shape for mip images"),se(kr.format===B.format&&kr.internalformat===B.internalformat&&kr.type===B.type,"incompatible type for mip image"),kr.compressed||(kr.data?se(kr.data.byteLength===dr*gr*Math.max(Ei(kr.type,nr),kr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):kr.element||kr.copy)}}}}var de=m(se,{optional:St,raise:le,commandRaise:Jr,command:Te,parameter:ae,commandParameter:Xe,constructor:er,type:it,commandType:ke,isTypedArray:tt,nni:Vt,oneOf:sr,shaderError:Qe,linkError:Kt,callSite:$t,saveCommandRef:Sr,saveDrawInfo:Br,framebufferFormat:vt,guessCommand:Y,texture2D:$i,textureCube:Wa}),Fn=0,Xa=0,vs=5,jt=6;function or(B,me){this.id=Fn++,this.type=B,this.data=me}function Mr(B){return B.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function I(B){if(B.length===0)return[];var me=B.charAt(0),Be=B.charAt(B.length-1);if(B.length>1&&me===Be&&(me==='"'||me==="'"))return['"'+Mr(B.substr(1,B.length-2))+'"'];var Ft=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(B);if(Ft)return I(B.substr(0,Ft.index)).concat(I(Ft[1])).concat(I(B.substr(Ft.index+Ft[0].length)));var ur=B.split(".");if(ur.length===1)return['"'+Mr(B)+'"'];for(var Lt=[],nr=0;nr<ur.length;++nr)Lt=Lt.concat(I(ur[nr]));return Lt}function ar(B){return"["+I(B).join("][")+"]"}function kn(B,me){return new or(B,ar(me+""))}function li(B){return typeof B=="function"&&!B._reglType||B instanceof or}function jn(B,me){if(typeof B=="function")return new or(Xa,B);if(typeof B=="number"||typeof B=="boolean")return new or(vs,B);if(Array.isArray(B))return new or(jt,B.map(function(Be,Ft){return jn(Be,me+"["+Ft+"]")}));if(B instanceof or)return B;de(!1,"invalid option type in uniform "+me)}var an={DynamicVariable:or,define:kn,isDynamic:li,unbox:jn,accessor:ar},Pi={next:typeof requestAnimationFrame=="function"?function(B){return requestAnimationFrame(B)}:function(B){return setTimeout(B,16)},cancel:typeof cancelAnimationFrame=="function"?function(B){return cancelAnimationFrame(B)}:clearTimeout},Ii=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Ja=Ii?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function ms(){var B={"":0},me=[""];return{id:function(Be){var Ft=B[Be];return Ft||(Ft=B[Be]=me.length,me.push(Be),Ft)},str:function(Be){return me[Be]}}}function xa(B,me,Be){var Ft=document.createElement("canvas");m(Ft.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),B.appendChild(Ft),B===document.body&&(Ft.style.position="absolute",m(B.style,{margin:0,padding:0}));function ur(){var hr=window.innerWidth,_r=window.innerHeight;if(B!==document.body){var br=Ft.getBoundingClientRect();hr=br.right-br.left,_r=br.bottom-br.top}Ft.width=Be*hr,Ft.height=Be*_r}var Lt;B!==document.body&&typeof ResizeObserver=="function"?(Lt=new ResizeObserver(function(){setTimeout(ur)}),Lt.observe(B)):window.addEventListener("resize",ur,!1);function nr(){Lt?Lt.disconnect():window.removeEventListener("resize",ur),B.removeChild(Ft)}return ur(),{canvas:Ft,onDestroy:nr}}function ka(B,me){function Be(Ft){try{return B.getContext(Ft,me)}catch(ur){return null}}return Be("webgl")||Be("experimental-webgl")||Be("webgl-experimental")}function Ma(B){return typeof B.nodeName=="string"&&typeof B.appendChild=="function"&&typeof B.getBoundingClientRect=="function"}function H(B){return typeof B.drawArrays=="function"||typeof B.drawElements=="function"}function $(B){return typeof B=="string"?B.split():(de(Array.isArray(B),"invalid extension array"),B)}function re(B){return typeof B=="string"?(de(typeof document!="undefined","not supported outside of DOM"),document.querySelector(B)):B}function ge(B){var me=B||{},Be,Ft,ur,Lt,nr={},hr=[],_r=[],br=typeof window=="undefined"?1:window.devicePixelRatio,Tr=!1,kr=function(Pr){Pr&&de.raise(Pr)},dr=function(){};if(typeof me=="string"?(de(typeof document!="undefined","selector queries only supported in DOM environments"),Be=document.querySelector(me),de(Be,"invalid query string for element")):typeof me=="object"?Ma(me)?Be=me:H(me)?(Lt=me,ur=Lt.canvas):(de.constructor(me),"gl"in me?Lt=me.gl:"canvas"in me?ur=re(me.canvas):"container"in me&&(Ft=re(me.container)),"attributes"in me&&(nr=me.attributes,de.type(nr,"object","invalid context attributes")),"extensions"in me&&(hr=$(me.extensions)),"optionalExtensions"in me&&(_r=$(me.optionalExtensions)),"onDone"in me&&(de.type(me.onDone,"function","invalid or missing onDone callback"),kr=me.onDone),"profile"in me&&(Tr=!!me.profile),"pixelRatio"in me&&(br=+me.pixelRatio,de(br>0,"invalid pixel ratio"))):de.raise("invalid arguments to regl"),Be&&(Be.nodeName.toLowerCase()==="canvas"?ur=Be:Ft=Be),!Lt){if(!ur){de(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var gr=xa(Ft||document.body,kr,br);if(!gr)return null;ur=gr.canvas,dr=gr.onDestroy}nr.premultipliedAlpha===void 0&&(nr.premultipliedAlpha=!0),Lt=ka(ur,nr)}return Lt?{gl:Lt,canvas:ur,container:Ft,extensions:hr,optionalExtensions:_r,pixelRatio:br,profile:Tr,onDone:kr,onDestroy:dr}:(dr(),kr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ie(B,me){var Be={};function Ft(hr){de.type(hr,"string","extension name must be string");var _r=hr.toLowerCase(),br;try{br=Be[_r]=ur(hr)}catch(Tr){}return!!br}function ur(hr){return B.getExtension(hr)?B.getExtension(hr):B.getExtension(hr.toLowerCase())?B.getExtension(hr.toLowerCase()):null}for(var Lt=0;Lt<me.extensions.length;++Lt){var nr=me.extensions[Lt];if(!Ft(nr))return me.onDestroy(),me.onDone('"'+nr+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return me.optionalExtensions.forEach(Ft),{extensions:Be,restore:function(){Object.keys(Be).forEach(function(hr){if(Be[hr]&&!Ft(hr))throw new Error("(regl): error restoring extension "+hr)})}}}function Ge(B,me){for(var Be=Array(B),Ft=0;Ft<B;++Ft)Be[Ft]=me(Ft);return Be}var rt=5120,ce=5121,De=5122,mt=5123,mr=5124,Dt=5125,Bt=5126;function yr(B){for(var me=16;me<=1<<28;me*=16)if(B<=me)return me;return 0}function En(B){var me,Be;return me=(B>65535)<<4,B>>>=me,Be=(B>255)<<3,B>>>=Be,me|=Be,Be=(B>15)<<2,B>>>=Be,me|=Be,Be=(B>3)<<1,B>>>=Be,me|=Be,me|B>>1}function cn(){var B=Ge(8,function(){return[]});function me(Lt){var nr=yr(Lt),hr=B[En(nr)>>2];return hr.length>0?hr.pop():new ArrayBuffer(nr)}function Be(Lt){B[En(Lt.byteLength)>>2].push(Lt)}function Ft(Lt,nr){var hr=null;switch(Lt){case rt:hr=new Int8Array(me(nr),0,nr);break;case ce:hr=new Uint8Array(me(nr),0,nr);break;case De:hr=new Int16Array(me(2*nr),0,nr);break;case mt:hr=new Uint16Array(me(2*nr),0,nr);break;case mr:hr=new Int32Array(me(4*nr),0,nr);break;case Dt:hr=new Uint32Array(me(4*nr),0,nr);break;case Bt:hr=new Float32Array(me(4*nr),0,nr);break;default:return null}return hr.length!==nr?hr.subarray(0,nr):hr}function ur(Lt){Be(Lt.buffer)}return{alloc:me,free:Be,allocType:Ft,freeType:ur}}var Pt=cn();Pt.zero=cn();var un=3408,Gr=3410,Wr=3411,oi=3412,rn=3413,Ti=3414,ea=3415,bi=33901,Oi=33902,Si=3379,ri=3386,Xi=34921,Da=36347,aa=36348,Ri=35661,Gi=35660,za=34930,su=36349,Pa=34076,Ia=34024,As=7936,gs=7937,ta=7938,Yu=35724,_o=34047,Ua=36063,so=34852,Qi=3553,qo=34067,Ko=34069,qu=33984,Ao=6408,$o=5126,ba=5121,xo=36160,Qo=36053,uo=36064,uu=16384,Ac=function(B,me){var Be=1;me.ext_texture_filter_anisotropic&&(Be=B.getParameter(_o));var Ft=1,ur=1;me.webgl_draw_buffers&&(Ft=B.getParameter(so),ur=B.getParameter(Ua));var Lt=!!me.oes_texture_float;if(Lt){var nr=B.createTexture();B.bindTexture(Qi,nr),B.texImage2D(Qi,0,Ao,1,1,0,Ao,$o,null);var hr=B.createFramebuffer();if(B.bindFramebuffer(xo,hr),B.framebufferTexture2D(xo,uo,Qi,nr,0),B.bindTexture(Qi,null),B.checkFramebufferStatus(xo)!==Qo)Lt=!1;else{B.viewport(0,0,1,1),B.clearColor(1,0,0,1),B.clear(uu);var _r=Pt.allocType($o,4);B.readPixels(0,0,1,1,Ao,$o,_r),B.getError()?Lt=!1:(B.deleteFramebuffer(hr),B.deleteTexture(nr),Lt=_r[0]===1),Pt.freeType(_r)}}var br=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Tr=!0;if(!br){var kr=B.createTexture(),dr=Pt.allocType(ba,36);B.activeTexture(qu),B.bindTexture(qo,kr),B.texImage2D(Ko,0,Ao,3,3,0,Ao,ba,dr),Pt.freeType(dr),B.bindTexture(qo,null),B.deleteTexture(kr),Tr=!B.getError()}return{colorBits:[B.getParameter(Gr),B.getParameter(Wr),B.getParameter(oi),B.getParameter(rn)],depthBits:B.getParameter(Ti),stencilBits:B.getParameter(ea),subpixelBits:B.getParameter(un),extensions:Object.keys(me).filter(function(gr){return!!me[gr]}),maxAnisotropic:Be,maxDrawbuffers:Ft,maxColorAttachments:ur,pointSizeDims:B.getParameter(bi),lineWidthDims:B.getParameter(Oi),maxViewportDims:B.getParameter(ri),maxCombinedTextureUnits:B.getParameter(Ri),maxCubeMapSize:B.getParameter(Pa),maxRenderbufferSize:B.getParameter(Ia),maxTextureUnits:B.getParameter(za),maxTextureSize:B.getParameter(Si),maxAttributes:B.getParameter(Xi),maxVertexUniforms:B.getParameter(Da),maxVertexTextureUnits:B.getParameter(Gi),maxVaryingVectors:B.getParameter(aa),maxFragmentUniforms:B.getParameter(su),glsl:B.getParameter(Yu),renderer:B.getParameter(gs),vendor:B.getParameter(As),version:B.getParameter(ta),readFloat:Lt,npotTextureCube:Tr}};function Fs(B){return!!B&&typeof B=="object"&&Array.isArray(B.shape)&&Array.isArray(B.stride)&&typeof B.offset=="number"&&B.shape.length===B.stride.length&&(Array.isArray(B.data)||ye(B.data))}var Q=function(B){return Object.keys(B).map(function(me){return B[me]})},Ee={shape:lo,flatten:wt};function Ke(B,me,Be){for(var Ft=0;Ft<me;++Ft)Be[Ft]=B[Ft]}function kt(B,me,Be,Ft){for(var ur=0,Lt=0;Lt<me;++Lt)for(var nr=B[Lt],hr=0;hr<Be;++hr)Ft[ur++]=nr[hr]}function Fr(B,me,Be,Ft,ur,Lt){for(var nr=Lt,hr=0;hr<me;++hr)for(var _r=B[hr],br=0;br<Be;++br)for(var Tr=_r[br],kr=0;kr<Ft;++kr)ur[nr++]=Tr[kr]}function ot(B,me,Be,Ft,ur){for(var Lt=1,nr=Be+1;nr<me.length;++nr)Lt*=me[nr];var hr=me[Be];if(me.length-Be==4){var _r=me[Be+1],br=me[Be+2],Tr=me[Be+3];for(nr=0;nr<hr;++nr)Fr(B[nr],_r,br,Tr,Ft,ur),ur+=Lt}else for(nr=0;nr<hr;++nr)ot(B[nr],me,Be+1,Ft,ur),ur+=Lt}function wt(B,me,Be,Ft){var ur=1;if(me.length)for(var Lt=0;Lt<me.length;++Lt)ur*=me[Lt];else ur=0;var nr=Ft||Pt.allocType(Be,ur);switch(me.length){case 0:break;case 1:Ke(B,me[0],nr);break;case 2:kt(B,me[0],me[1],nr);break;case 3:Fr(B,me[0],me[1],me[2],nr,0);break;default:ot(B,me,0,nr,0)}return nr}function lo(B){for(var me=[],Be=B;Be.length;Be=Be[0])me.push(Be.length);return me}var Ji={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ya=5120,Jo=5122,en=5124,$r=5121,Rt=5123,Vo=5125,he=5126,Js=5126,lu={int8:Ya,int16:Jo,int32:en,uint8:$r,uint16:Rt,uint32:Vo,float:he,float32:Js},ys=35048,oa=35040,bo={dynamic:ys,stream:oa,static:35044},Kl=Ee.flatten,wc=Ee.shape,Ku=35044,Tc=35040,Ml=5121,$u=5126,cu=[];cu[5120]=1,cu[5122]=2,cu[5124]=4,cu[5121]=1,cu[5123]=2,cu[5125]=4,cu[5126]=4;function Qu(B){return Ji[Object.prototype.toString.call(B)]|0}function _(B,me){for(var Be=0;Be<me.length;++Be)B[Be]=me[Be]}function T(B,me,Be,Ft,ur,Lt,nr){for(var hr=0,_r=0;_r<Be;++_r)for(var br=0;br<Ft;++br)B[hr++]=me[ur*_r+Lt*br+nr]}function F(B,me,Be,Ft){var ur=0,Lt={};function nr(ut){this.id=ur++,this.buffer=B.createBuffer(),this.type=ut,this.usage=Ku,this.byteLength=0,this.dimension=1,this.dtype=Ml,this.persistentData=null,Be.profile&&(this.stats={size:0})}nr.prototype.bind=function(){B.bindBuffer(this.type,this.buffer)},nr.prototype.destroy=function(){dr(this)};var hr=[];function _r(ut,Gt){var Ar=hr.pop();return Ar||(Ar=new nr(ut)),Ar.bind(),kr(Ar,Gt,Tc,0,1,!1),Ar}function br(ut){hr.push(ut)}function Tr(ut,Gt,Ar){ut.byteLength=Gt.byteLength,B.bufferData(ut.type,Gt,Ar)}function kr(ut,Gt,Ar,Zr,pr,Rr){var Qr;if(ut.usage=Ar,Array.isArray(Gt)){if(ut.dtype=Zr||$u,Gt.length>0){var Nn;if(Array.isArray(Gt[0])){Qr=wc(Gt);for(var Xt=1,ir=1;ir<Qr.length;++ir)Xt*=Qr[ir];ut.dimension=Xt,Nn=Kl(Gt,Qr,ut.dtype),Tr(ut,Nn,Ar),Rr?ut.persistentData=Nn:Pt.freeType(Nn)}else if(typeof Gt[0]=="number"){ut.dimension=pr;var dn=Pt.allocType(ut.dtype,Gt.length);_(dn,Gt),Tr(ut,dn,Ar),Rr?ut.persistentData=dn:Pt.freeType(dn)}else ye(Gt[0])?(ut.dimension=Gt[0].length,ut.dtype=Zr||Qu(Gt[0])||$u,Nn=Kl(Gt,[Gt.length,Gt[0].length],ut.dtype),Tr(ut,Nn,Ar),Rr?ut.persistentData=Nn:Pt.freeType(Nn)):de.raise("invalid buffer data")}}else if(ye(Gt))ut.dtype=Zr||Qu(Gt),ut.dimension=pr,Tr(ut,Gt,Ar),Rr&&(ut.persistentData=new Uint8Array(new Uint8Array(Gt.buffer)));else if(Fs(Gt)){Qr=Gt.shape;var Xr=Gt.stride,Er=Gt.offset,Hr=0,Yr=0,yi=0,ai=0;Qr.length===1?(Hr=Qr[0],Yr=1,yi=Xr[0],ai=0):Qr.length===2?(Hr=Qr[0],Yr=Qr[1],yi=Xr[0],ai=Xr[1]):de.raise("invalid shape"),ut.dtype=Zr||Qu(Gt.data)||$u,ut.dimension=Yr;var qr=Pt.allocType(ut.dtype,Hr*Yr);T(qr,Gt.data,Hr,Yr,yi,ai,Er),Tr(ut,qr,Ar),Rr?ut.persistentData=qr:Pt.freeType(qr)}else Gt instanceof ArrayBuffer?(ut.dtype=Ml,ut.dimension=pr,Tr(ut,Gt,Ar),Rr&&(ut.persistentData=new Uint8Array(new Uint8Array(Gt)))):de.raise("invalid buffer data")}function dr(ut){me.bufferCount--,Ft(ut);var Gt=ut.buffer;de(Gt,"buffer must not be deleted already"),B.deleteBuffer(Gt),ut.buffer=null,delete Lt[ut.id]}function gr(ut,Gt,Ar,Zr){me.bufferCount++;var pr=new nr(Gt);Lt[pr.id]=pr;function Rr(Xt){var ir=Ku,dn=null,Xr=0,Er=0,Hr=1;return Array.isArray(Xt)||ye(Xt)||Fs(Xt)||Xt instanceof ArrayBuffer?dn=Xt:typeof Xt=="number"?Xr=Xt|0:Xt&&(de.type(Xt,"object","buffer arguments must be an object, a number or an array"),"data"in Xt&&(de(dn===null||Array.isArray(dn)||ye(dn)||Fs(dn),"invalid data for buffer"),dn=Xt.data),"usage"in Xt&&(de.parameter(Xt.usage,bo,"invalid buffer usage"),ir=bo[Xt.usage]),"type"in Xt&&(de.parameter(Xt.type,lu,"invalid buffer type"),Er=lu[Xt.type]),"dimension"in Xt&&(de.type(Xt.dimension,"number","invalid dimension"),Hr=Xt.dimension|0),"length"in Xt&&(de.nni(Xr,"buffer length must be a nonnegative integer"),Xr=Xt.length|0)),pr.bind(),dn?kr(pr,dn,ir,Er,Hr,Zr):(Xr&&B.bufferData(pr.type,Xr,ir),pr.dtype=Er||Ml,pr.usage=ir,pr.dimension=Hr,pr.byteLength=Xr),Be.profile&&(pr.stats.size=pr.byteLength*cu[pr.dtype]),Rr}function Qr(Xt,ir){de(ir+Xt.byteLength<=pr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Xt.byteLength+" starting from offset "+ir+" to a buffer of size "+pr.byteLength),B.bufferSubData(pr.type,ir,Xt)}function Nn(Xt,ir){var dn=(ir||0)|0,Xr;if(pr.bind(),ye(Xt)||Xt instanceof ArrayBuffer)Qr(Xt,dn);else if(Array.isArray(Xt)){if(Xt.length>0)if(typeof Xt[0]=="number"){var Er=Pt.allocType(pr.dtype,Xt.length);_(Er,Xt),Qr(Er,dn),Pt.freeType(Er)}else if(Array.isArray(Xt[0])||ye(Xt[0])){Xr=wc(Xt);var Hr=Kl(Xt,Xr,pr.dtype);Qr(Hr,dn),Pt.freeType(Hr)}else de.raise("invalid buffer data")}else if(Fs(Xt)){Xr=Xt.shape;var Yr=Xt.stride,yi=0,ai=0,qr=0,sn=0;Xr.length===1?(yi=Xr[0],ai=1,qr=Yr[0],sn=0):Xr.length===2?(yi=Xr[0],ai=Xr[1],qr=Yr[0],sn=Yr[1]):de.raise("invalid shape");var Qn=Array.isArray(Xt.data)?pr.dtype:Qu(Xt.data),hi=Pt.allocType(Qn,yi*ai);T(hi,Xt.data,yi,ai,qr,sn,Xt.offset),Qr(hi,dn),Pt.freeType(hi)}else de.raise("invalid data for buffer subdata");return Rr}return Ar||Rr(ut),Rr._reglType="buffer",Rr._buffer=pr,Rr.subdata=Nn,Be.profile&&(Rr.stats=pr.stats),Rr.destroy=function(){dr(pr)},Rr}function Pr(){Q(Lt).forEach(function(ut){ut.buffer=B.createBuffer(),B.bindBuffer(ut.type,ut.buffer),B.bufferData(ut.type,ut.persistentData||ut.byteLength,ut.usage)})}return Be.profile&&(me.getTotalBufferSize=function(){var ut=0;return Object.keys(Lt).forEach(function(Gt){ut+=Lt[Gt].stats.size}),ut}),{create:gr,createStream:_r,destroyStream:br,clear:function(){Q(Lt).forEach(dr),hr.forEach(dr)},getBuffer:function(ut){return ut&&ut._buffer instanceof nr?ut._buffer:null},restore:Pr,_initBuffer:kr}}var R=0,K=0,xe=1,We=1,ct=4,ht=4,cr={points:R,point:K,lines:xe,line:We,triangles:ct,triangle:ht,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},xr=0,Rn=1,ci=4,Jn=5120,Yi=5121,ha=5122,La=5123,Hi=5124,Fo=5125,ws=34963,pl=35040,tf=35044;function Ju(B,me,Be,Ft){var ur={},Lt=0,nr={uint8:Yi,uint16:La};me.oes_element_index_uint&&(nr.uint32=Fo);function hr(Pr){this.id=Lt++,ur[this.id]=this,this.buffer=Pr,this.primType=ci,this.vertCount=0,this.type=0}hr.prototype.bind=function(){this.buffer.bind()};var _r=[];function br(Pr){var ut=_r.pop();return ut||(ut=new hr(Be.create(null,ws,!0,!1)._buffer)),kr(ut,Pr,pl,-1,-1,0,0),ut}function Tr(Pr){_r.push(Pr)}function kr(Pr,ut,Gt,Ar,Zr,pr,Rr){Pr.buffer.bind();var Qr;if(ut){var Nn=Rr;!Rr&&(!ye(ut)||Fs(ut)&&!ye(ut.data))&&(Nn=me.oes_element_index_uint?Fo:La),Be._initBuffer(Pr.buffer,ut,Gt,Nn,3)}else B.bufferData(ws,pr,Gt),Pr.buffer.dtype=Qr||Yi,Pr.buffer.usage=Gt,Pr.buffer.dimension=3,Pr.buffer.byteLength=pr;if(Qr=Rr,!Rr){switch(Pr.buffer.dtype){case Yi:case Jn:Qr=Yi;break;case La:case ha:Qr=La;break;case Fo:case Hi:Qr=Fo;break;default:de.raise("unsupported type for element array")}Pr.buffer.dtype=Qr}Pr.type=Qr,de(Qr!==Fo||!!me.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Xt=Zr;Xt<0&&(Xt=Pr.buffer.byteLength,Qr===La?Xt>>=1:Qr===Fo&&(Xt>>=2)),Pr.vertCount=Xt;var ir=Ar;if(Ar<0){ir=ci;var dn=Pr.buffer.dimension;dn===1&&(ir=xr),dn===2&&(ir=Rn),dn===3&&(ir=ci)}Pr.primType=ir}function dr(Pr){Ft.elementsCount--,de(Pr.buffer!==null,"must not double destroy elements"),delete ur[Pr.id],Pr.buffer.destroy(),Pr.buffer=null}function gr(Pr,ut){var Gt=Be.create(null,ws,!0),Ar=new hr(Gt._buffer);Ft.elementsCount++;function Zr(pr){if(!pr)Gt(),Ar.primType=ci,Ar.vertCount=0,Ar.type=Yi;else if(typeof pr=="number")Gt(pr),Ar.primType=ci,Ar.vertCount=pr|0,Ar.type=Yi;else{var Rr=null,Qr=tf,Nn=-1,Xt=-1,ir=0,dn=0;Array.isArray(pr)||ye(pr)||Fs(pr)?Rr=pr:(de.type(pr,"object","invalid arguments for elements"),"data"in pr&&(Rr=pr.data,de(Array.isArray(Rr)||ye(Rr)||Fs(Rr),"invalid data for element buffer")),"usage"in pr&&(de.parameter(pr.usage,bo,"invalid element buffer usage"),Qr=bo[pr.usage]),"primitive"in pr&&(de.parameter(pr.primitive,cr,"invalid element buffer primitive"),Nn=cr[pr.primitive]),"count"in pr&&(de(typeof pr.count=="number"&&pr.count>=0,"invalid vertex count for elements"),Xt=pr.count|0),"type"in pr&&(de.parameter(pr.type,nr,"invalid buffer type"),dn=nr[pr.type]),"length"in pr?ir=pr.length|0:(ir=Xt,dn===La||dn===ha?ir*=2:(dn===Fo||dn===Hi)&&(ir*=4))),kr(Ar,Rr,Qr,Nn,Xt,ir,dn)}return Zr}return Zr(Pr),Zr._reglType="elements",Zr._elements=Ar,Zr.subdata=function(pr,Rr){return Gt.subdata(pr,Rr),Zr},Zr.destroy=function(){dr(Ar)},Zr}return{create:gr,createStream:br,destroyStream:Tr,getElements:function(Pr){return typeof Pr=="function"&&Pr._elements instanceof hr?Pr._elements:null},clear:function(){Q(ur).forEach(dr)}}}var Mc=new Float32Array(1),Ru=new Uint32Array(Mc.buffer),yu=5123;function wo(B){for(var me=Pt.allocType(yu,B.length),Be=0;Be<B.length;++Be)if(isNaN(B[Be]))me[Be]=65535;else if(B[Be]===Infinity)me[Be]=31744;else if(B[Be]===-Infinity)me[Be]=64512;else{Mc[0]=B[Be];var Ft=Ru[0],ur=Ft>>>31<<15,Lt=(Ft<<1>>>24)-127,nr=Ft>>13&(1<<10)-1;if(Lt<-24)me[Be]=ur;else if(Lt<-14){var hr=-14-Lt;me[Be]=ur+(nr+(1<<10)>>hr)}else Lt>15?me[Be]=ur+31744:me[Be]=ur+(Lt+15<<10)+nr}return me}function da(B){return Array.isArray(B)||ye(B)}var yp=function(B){return!(B&B-1)&&!!B},_p=34467,vo=3553,Ff=34067,_u=34069,Bs=6408,Pc=6406,hl=6407,Aa=6409,Pl=6410,$l=32854,os=32855,Bf=36194,xp=32819,bp=32820,rf=33635,dl=34042,Go=6402,Lu=34041,el=35904,Ho=35906,Il=36193,tl=33776,eu=33777,nf=33778,af=33779,of=35986,rl=35987,Ql=34798,Ic=35840,sf=35841,Oc=35842,Ep=35843,Rc=36196,vl=5121,uf=5123,lf=5125,ku=5126,cf=10242,Nf=10243,Sp=10497,Ol=33071,ih=33648,ss=10240,qa=10241,Jl=9728,Rl=9729,fu=9984,Bi=9985,Fa=9986,Ns=9987,ff=33170,ml=4352,pf=4353,ah=4354,oh=34046,Lc=3317,ec=37440,nl=37441,Bo=37443,tc=37444,rc=33984,eo=[fu,Fa,Bi,Ns],yn=[0,Aa,Pl,hl,Bs],co={};co[Aa]=co[Pc]=co[Go]=1,co[Lu]=co[Pl]=2,co[hl]=co[el]=3,co[Bs]=co[Ho]=4;function il(B){return"[object "+B+"]"}var al=il("HTMLCanvasElement"),xu=il("OffscreenCanvas"),zs=il("CanvasRenderingContext2D"),zf=il("ImageBitmap"),Kr=il("HTMLImageElement"),hf=il("HTMLVideoElement"),Uf=Object.keys(Ji).concat([al,xu,zs,zf,Kr,hf]),Du=[];Du[vl]=1,Du[ku]=4,Du[Il]=2,Du[uf]=2,Du[lf]=4;var Ha=[];Ha[$l]=2,Ha[os]=2,Ha[Bf]=2,Ha[Lu]=4,Ha[tl]=.5,Ha[eu]=.5,Ha[nf]=1,Ha[af]=1,Ha[of]=.5,Ha[rl]=1,Ha[Ql]=1,Ha[Ic]=.5,Ha[sf]=.25,Ha[Oc]=.5,Ha[Ep]=.25,Ha[Rc]=.5;function Us(B){return Array.isArray(B)&&(B.length===0||typeof B[0]=="number")}function df(B){if(!Array.isArray(B))return!1;var me=B.length;return!(me===0||!da(B[0]))}function Fu(B){return Object.prototype.toString.call(B)}function Os(B){return Fu(B)===al}function To(B){return Fu(B)===xu}function Cp(B){return Fu(B)===zs}function Ea(B){return Fu(B)===zf}function Zf(B){return Fu(B)===Kr}function Ap(B){return Fu(B)===hf}function tu(B){var me=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(me&&B&&B.getContext)}function Rs(B){var me=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(me&&B&&"src"in B&&"crossOrigin"in B)}function Li(B){if(!B)return!1;if(tu(B)||Rs(B))return!0;var me=Fu(B);return Uf.indexOf(me)>=0?!0:Us(B)||df(B)||Fs(B)}function bu(B){return Ji[Object.prototype.toString.call(B)]|0}function va(B,me){var Be=me.length;switch(B.type){case vl:case uf:case lf:case ku:var Ft=Pt.allocType(B.type,Be);Ft.set(me),B.data=Ft;break;case Il:B.data=wo(me);break;default:de.raise("unsupported texture type, must specify a typed array")}}function mo(B,me){return Pt.allocType(B.type===Il?ku:B.type,me)}function Zs(B,me){B.type===Il?(B.data=wo(me),Pt.freeType(me)):B.data=me}function pu(B,me,Be,Ft,ur,Lt){for(var nr=B.width,hr=B.height,_r=B.channels,br=nr*hr*_r,Tr=mo(B,br),kr=0,dr=0;dr<hr;++dr)for(var gr=0;gr<nr;++gr)for(var Pr=0;Pr<_r;++Pr)Tr[kr++]=me[Be*gr+Ft*dr+ur*Pr+Lt];Zs(B,Tr)}function js(B,me,Be,Ft,ur,Lt){var nr;if(typeof Ha[B]!="undefined"?nr=Ha[B]:nr=co[B]*Du[me],Lt&&(nr*=6),ur){for(var hr=0,_r=Be;_r>=1;)hr+=nr*_r*_r,_r/=2;return hr}else return nr*Be*Ft}function _s(B,me,Be,Ft,ur,Lt,nr){var hr={"don't care":ml,"dont care":ml,nice:ah,fast:pf},_r={repeat:Sp,clamp:Ol,mirror:ih},br={nearest:Jl,linear:Rl},Tr=m({mipmap:Ns,"nearest mipmap nearest":fu,"linear mipmap nearest":Bi,"nearest mipmap linear":Fa,"linear mipmap linear":Ns},br),kr={none:0,browser:tc},dr={uint8:vl,rgba4:xp,rgb565:rf,"rgb5 a1":bp},gr={alpha:Pc,luminance:Aa,"luminance alpha":Pl,rgb:hl,rgba:Bs,rgba4:$l,"rgb5 a1":os,rgb565:Bf},Pr={};me.ext_srgb&&(gr.srgb=el,gr.srgba=Ho),me.oes_texture_float&&(dr.float32=dr.float=ku),me.oes_texture_half_float&&(dr.float16=dr["half float"]=Il),me.webgl_depth_texture&&(m(gr,{depth:Go,"depth stencil":Lu}),m(dr,{uint16:uf,uint32:lf,"depth stencil":dl})),me.webgl_compressed_texture_s3tc&&m(Pr,{"rgb s3tc dxt1":tl,"rgba s3tc dxt1":eu,"rgba s3tc dxt3":nf,"rgba s3tc dxt5":af}),me.webgl_compressed_texture_atc&&m(Pr,{"rgb atc":of,"rgba atc explicit alpha":rl,"rgba atc interpolated alpha":Ql}),me.webgl_compressed_texture_pvrtc&&m(Pr,{"rgb pvrtc 4bppv1":Ic,"rgb pvrtc 2bppv1":sf,"rgba pvrtc 4bppv1":Oc,"rgba pvrtc 2bppv1":Ep}),me.webgl_compressed_texture_etc1&&(Pr["rgb etc1"]=Rc);var ut=Array.prototype.slice.call(B.getParameter(_p)||new Uint32Array(0));Object.keys(Pr).forEach(function(we){var Ut=Pr[we];ut.indexOf(Ut)>=0&&(gr[we]=Ut)});var Gt=Object.keys(gr);Be.textureFormats=Gt;var Ar=[];Object.keys(gr).forEach(function(we){var Ut=gr[we];Ar[Ut]=we});var Zr=[];Object.keys(dr).forEach(function(we){var Ut=dr[we];Zr[Ut]=we});var pr=[];Object.keys(br).forEach(function(we){var Ut=br[we];pr[Ut]=we});var Rr=[];Object.keys(Tr).forEach(function(we){var Ut=Tr[we];Rr[Ut]=we});var Qr=[];Object.keys(_r).forEach(function(we){var Ut=_r[we];Qr[Ut]=we});var Nn=Gt.reduce(function(we,Ut){var bt=gr[Ut];return bt===Aa||bt===Pc||bt===Aa||bt===Pl||bt===Go||bt===Lu||me.ext_srgb&&(bt===el||bt===Ho)?we[bt]=bt:bt===os||Ut.indexOf("rgba")>=0?we[bt]=Bs:we[bt]=hl,we},{});function Xt(){this.internalformat=Bs,this.format=Bs,this.type=vl,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=tc,this.width=0,this.height=0,this.channels=0}function ir(we,Ut){we.internalformat=Ut.internalformat,we.format=Ut.format,we.type=Ut.type,we.compressed=Ut.compressed,we.premultiplyAlpha=Ut.premultiplyAlpha,we.flipY=Ut.flipY,we.unpackAlignment=Ut.unpackAlignment,we.colorSpace=Ut.colorSpace,we.width=Ut.width,we.height=Ut.height,we.channels=Ut.channels}function dn(we,Ut){if(!(typeof Ut!="object"||!Ut)){if("premultiplyAlpha"in Ut&&(de.type(Ut.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),we.premultiplyAlpha=Ut.premultiplyAlpha),"flipY"in Ut&&(de.type(Ut.flipY,"boolean","invalid texture flip"),we.flipY=Ut.flipY),"alignment"in Ut&&(de.oneOf(Ut.alignment,[1,2,4,8],"invalid texture unpack alignment"),we.unpackAlignment=Ut.alignment),"colorSpace"in Ut&&(de.parameter(Ut.colorSpace,kr,"invalid colorSpace"),we.colorSpace=kr[Ut.colorSpace]),"type"in Ut){var bt=Ut.type;de(me.oes_texture_float||!(bt==="float"||bt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),de(me.oes_texture_half_float||!(bt==="half float"||bt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),de(me.webgl_depth_texture||!(bt==="uint16"||bt==="uint32"||bt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),de.parameter(bt,dr,"invalid texture type"),we.type=dr[bt]}var gn=we.width,Fi=we.height,Ce=we.channels,ie=!1;"shape"in Ut?(de(Array.isArray(Ut.shape)&&Ut.shape.length>=2,"shape must be an array"),gn=Ut.shape[0],Fi=Ut.shape[1],Ut.shape.length===3&&(Ce=Ut.shape[2],de(Ce>0&&Ce<=4,"invalid number of channels"),ie=!0),de(gn>=0&&gn<=Be.maxTextureSize,"invalid width"),de(Fi>=0&&Fi<=Be.maxTextureSize,"invalid height")):("radius"in Ut&&(gn=Fi=Ut.radius,de(gn>=0&&gn<=Be.maxTextureSize,"invalid radius")),"width"in Ut&&(gn=Ut.width,de(gn>=0&&gn<=Be.maxTextureSize,"invalid width")),"height"in Ut&&(Fi=Ut.height,de(Fi>=0&&Fi<=Be.maxTextureSize,"invalid height")),"channels"in Ut&&(Ce=Ut.channels,de(Ce>0&&Ce<=4,"invalid number of channels"),ie=!0)),we.width=gn|0,we.height=Fi|0,we.channels=Ce|0;var Ve=!1;if("format"in Ut){var ft=Ut.format;de(me.webgl_depth_texture||!(ft==="depth"||ft==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),de.parameter(ft,gr,"invalid texture format");var Ot=we.internalformat=gr[ft];we.format=Nn[Ot],ft in dr&&("type"in Ut||(we.type=dr[ft])),ft in Pr&&(we.compressed=!0),Ve=!0}!ie&&Ve?we.channels=co[we.format]:ie&&!Ve?we.channels!==yn[we.format]&&(we.format=we.internalformat=yn[we.channels]):Ve&&ie&&de(we.channels===co[we.format],"number of channels inconsistent with specified format")}}function Xr(we){B.pixelStorei(ec,we.flipY),B.pixelStorei(nl,we.premultiplyAlpha),B.pixelStorei(Bo,we.colorSpace),B.pixelStorei(Lc,we.unpackAlignment)}function Er(){Xt.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Hr(we,Ut){var bt=null;if(Li(Ut)?bt=Ut:Ut&&(de.type(Ut,"object","invalid pixel data type"),dn(we,Ut),"x"in Ut&&(we.xOffset=Ut.x|0),"y"in Ut&&(we.yOffset=Ut.y|0),Li(Ut.data)&&(bt=Ut.data)),de(!we.compressed||bt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Ut.copy){de(!bt,"can not specify copy and data field for the same texture");var gn=ur.viewportWidth,Fi=ur.viewportHeight;we.width=we.width||gn-we.xOffset,we.height=we.height||Fi-we.yOffset,we.needsCopy=!0,de(we.xOffset>=0&&we.xOffset<gn&&we.yOffset>=0&&we.yOffset<Fi&&we.width>0&&we.width<=gn&&we.height>0&&we.height<=Fi,"copy texture read out of bounds")}else if(!bt)we.width=we.width||1,we.height=we.height||1,we.channels=we.channels||4;else if(ye(bt))we.channels=we.channels||4,we.data=bt,!("type"in Ut)&&we.type===vl&&(we.type=bu(bt));else if(Us(bt))we.channels=we.channels||4,va(we,bt),we.alignment=1,we.needsFree=!0;else if(Fs(bt)){var Ce=bt.data;!Array.isArray(Ce)&&we.type===vl&&(we.type=bu(Ce));var ie=bt.shape,Ve=bt.stride,ft,Ot,qe,Fe,nt,_e;ie.length===3?(qe=ie[2],_e=Ve[2]):(de(ie.length===2,"invalid ndarray pixel data, must be 2 or 3D"),qe=1,_e=1),ft=ie[0],Ot=ie[1],Fe=Ve[0],nt=Ve[1],we.alignment=1,we.width=ft,we.height=Ot,we.channels=qe,we.format=we.internalformat=yn[qe],we.needsFree=!0,pu(we,Ce,Fe,nt,_e,bt.offset)}else if(tu(bt)||Os(bt)||To(bt)||Cp(bt))tu(bt)||Os(bt)||To(bt)?we.element=bt:we.element=bt.canvas,we.width=we.element.width,we.height=we.element.height,we.channels=4;else if(Ea(bt))we.element=bt,we.width=bt.width,we.height=bt.height,we.channels=4;else if(Zf(bt))we.element=bt,we.width=bt.naturalWidth,we.height=bt.naturalHeight,we.channels=4;else if(Rs(bt))we.element=bt,we.width=bt.width,we.height=bt.height,we.channels=4;else if(Ap(bt))we.element=bt,we.width=bt.videoWidth,we.height=bt.videoHeight,we.channels=4;else if(df(bt)){var Ue=we.width||bt[0].length,Ae=we.height||bt.length,pt=we.channels;da(bt[0][0])?pt=pt||bt[0][0].length:pt=pt||1;for(var _t=Ee.shape(bt),vr=1,jr=0;jr<_t.length;++jr)vr*=_t[jr];var Vr=mo(we,vr);Ee.flatten(bt,_t,"",Vr),Zs(we,Vr),we.alignment=1,we.width=Ue,we.height=Ae,we.channels=pt,we.format=we.internalformat=yn[pt],we.needsFree=!0}we.type===ku?de(Be.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):we.type===Il&&de(Be.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Yr(we,Ut,bt){var gn=we.element,Fi=we.data,Ce=we.internalformat,ie=we.format,Ve=we.type,ft=we.width,Ot=we.height;Xr(we),gn?B.texImage2D(Ut,bt,ie,ie,Ve,gn):we.compressed?B.compressedTexImage2D(Ut,bt,Ce,ft,Ot,0,Fi):we.needsCopy?(Ft(),B.copyTexImage2D(Ut,bt,ie,we.xOffset,we.yOffset,ft,Ot,0)):B.texImage2D(Ut,bt,ie,ft,Ot,0,ie,Ve,Fi||null)}function yi(we,Ut,bt,gn,Fi){var Ce=we.element,ie=we.data,Ve=we.internalformat,ft=we.format,Ot=we.type,qe=we.width,Fe=we.height;Xr(we),Ce?B.texSubImage2D(Ut,Fi,bt,gn,ft,Ot,Ce):we.compressed?B.compressedTexSubImage2D(Ut,Fi,bt,gn,Ve,qe,Fe,ie):we.needsCopy?(Ft(),B.copyTexSubImage2D(Ut,Fi,bt,gn,we.xOffset,we.yOffset,qe,Fe)):B.texSubImage2D(Ut,Fi,bt,gn,qe,Fe,ft,Ot,ie)}var ai=[];function qr(){return ai.pop()||new Er}function sn(we){we.needsFree&&Pt.freeType(we.data),Er.call(we),ai.push(we)}function Qn(){Xt.call(this),this.genMipmaps=!1,this.mipmapHint=ml,this.mipmask=0,this.images=Array(16)}function hi(we,Ut,bt){var gn=we.images[0]=qr();we.mipmask=1,gn.width=we.width=Ut,gn.height=we.height=bt,gn.channels=we.channels=4}function zi(we,Ut){var bt=null;if(Li(Ut))bt=we.images[0]=qr(),ir(bt,we),Hr(bt,Ut),we.mipmask=1;else if(dn(we,Ut),Array.isArray(Ut.mipmap))for(var gn=Ut.mipmap,Fi=0;Fi<gn.length;++Fi)bt=we.images[Fi]=qr(),ir(bt,we),bt.width>>=Fi,bt.height>>=Fi,Hr(bt,gn[Fi]),we.mipmask|=1<<Fi;else bt=we.images[0]=qr(),ir(bt,we),Hr(bt,Ut),we.mipmask=1;ir(we,we.images[0]),we.compressed&&(we.internalformat===tl||we.internalformat===eu||we.internalformat===nf||we.internalformat===af)&&de(we.width%4==0&&we.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function po(we,Ut){for(var bt=we.images,gn=0;gn<bt.length;++gn){if(!bt[gn])return;Yr(bt[gn],Ut,gn)}}var go=[];function Di(){var we=go.pop()||new Qn;Xt.call(we),we.mipmask=0;for(var Ut=0;Ut<16;++Ut)we.images[Ut]=null;return we}function us(we){for(var Ut=we.images,bt=0;bt<Ut.length;++bt)Ut[bt]&&sn(Ut[bt]),Ut[bt]=null;go.push(we)}function Ka(){this.minFilter=Jl,this.magFilter=Jl,this.wrapS=Ol,this.wrapT=Ol,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=ml}function ns(we,Ut){if("min"in Ut){var bt=Ut.min;de.parameter(bt,Tr),we.minFilter=Tr[bt],eo.indexOf(we.minFilter)>=0&&!("faces"in Ut)&&(we.genMipmaps=!0)}if("mag"in Ut){var gn=Ut.mag;de.parameter(gn,br),we.magFilter=br[gn]}var Fi=we.wrapS,Ce=we.wrapT;if("wrap"in Ut){var ie=Ut.wrap;typeof ie=="string"?(de.parameter(ie,_r),Fi=Ce=_r[ie]):Array.isArray(ie)&&(de.parameter(ie[0],_r),de.parameter(ie[1],_r),Fi=_r[ie[0]],Ce=_r[ie[1]])}else{if("wrapS"in Ut){var Ve=Ut.wrapS;de.parameter(Ve,_r),Fi=_r[Ve]}if("wrapT"in Ut){var ft=Ut.wrapT;de.parameter(ft,_r),Ce=_r[ft]}}if(we.wrapS=Fi,we.wrapT=Ce,"anisotropic"in Ut){var Ot=Ut.anisotropic;de(typeof Ot=="number"&&Ot>=1&&Ot<=Be.maxAnisotropic,"aniso samples must be between 1 and "),we.anisotropic=Ut.anisotropic}if("mipmap"in Ut){var qe=!1;switch(typeof Ut.mipmap){case"string":de.parameter(Ut.mipmap,hr,"invalid mipmap hint"),we.mipmapHint=hr[Ut.mipmap],we.genMipmaps=!0,qe=!0;break;case"boolean":qe=we.genMipmaps=Ut.mipmap;break;case"object":de(Array.isArray(Ut.mipmap),"invalid mipmap type"),we.genMipmaps=!1,qe=!0;break;default:de.raise("invalid mipmap type")}qe&&!("min"in Ut)&&(we.minFilter=fu)}}function Oo(we,Ut){B.texParameteri(Ut,qa,we.minFilter),B.texParameteri(Ut,ss,we.magFilter),B.texParameteri(Ut,cf,we.wrapS),B.texParameteri(Ut,Nf,we.wrapT),me.ext_texture_filter_anisotropic&&B.texParameteri(Ut,oh,we.anisotropic),we.genMipmaps&&(B.hint(ff,we.mipmapHint),B.generateMipmap(Ut))}var is=0,Uo={},ls=Be.maxTextureUnits,yo=Array(ls).map(function(){return null});function _i(we){Xt.call(this),this.mipmask=0,this.internalformat=Bs,this.id=is++,this.refCount=1,this.target=we,this.texture=B.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Ka,nr.profile&&(this.stats={size:0})}function Zo(we){B.activeTexture(rc),B.bindTexture(we.target,we.texture)}function ra(){var we=yo[0];we?B.bindTexture(we.target,we.texture):B.bindTexture(vo,null)}function cs(we){var Ut=we.texture;de(Ut,"must not double destroy texture");var bt=we.unit,gn=we.target;bt>=0&&(B.activeTexture(rc+bt),B.bindTexture(gn,null),yo[bt]=null),B.deleteTexture(Ut),we.texture=null,we.params=null,we.pixels=null,we.refCount=0,delete Uo[we.id],Lt.textureCount--}m(_i.prototype,{bind:function(){var we=this;we.bindCount+=1;var Ut=we.unit;if(Ut<0){for(var bt=0;bt<ls;++bt){var gn=yo[bt];if(gn){if(gn.bindCount>0)continue;gn.unit=-1}yo[bt]=we,Ut=bt;break}Ut>=ls&&de.raise("insufficient number of texture units"),nr.profile&&Lt.maxTextureUnits<Ut+1&&(Lt.maxTextureUnits=Ut+1),we.unit=Ut,B.activeTexture(rc+Ut),B.bindTexture(we.target,we.texture)}return Ut},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&cs(this)}});function ii(we,Ut){var bt=new _i(vo);Uo[bt.id]=bt,Lt.textureCount++;function gn(ie,Ve){var ft=bt.texInfo;Ka.call(ft);var Ot=Di();return typeof ie=="number"?typeof Ve=="number"?hi(Ot,ie|0,Ve|0):hi(Ot,ie|0,ie|0):ie?(de.type(ie,"object","invalid arguments to regl.texture"),ns(ft,ie),zi(Ot,ie)):hi(Ot,1,1),ft.genMipmaps&&(Ot.mipmask=(Ot.width<<1)-1),bt.mipmask=Ot.mipmask,ir(bt,Ot),de.texture2D(ft,Ot,Be),bt.internalformat=Ot.internalformat,gn.width=Ot.width,gn.height=Ot.height,Zo(bt),po(Ot,vo),Oo(ft,vo),ra(),us(Ot),nr.profile&&(bt.stats.size=js(bt.internalformat,bt.type,Ot.width,Ot.height,ft.genMipmaps,!1)),gn.format=Ar[bt.internalformat],gn.type=Zr[bt.type],gn.mag=pr[ft.magFilter],gn.min=Rr[ft.minFilter],gn.wrapS=Qr[ft.wrapS],gn.wrapT=Qr[ft.wrapT],gn}function Fi(ie,Ve,ft,Ot){de(!!ie,"must specify image data");var qe=Ve|0,Fe=ft|0,nt=Ot|0,_e=qr();return ir(_e,bt),_e.width=0,_e.height=0,Hr(_e,ie),_e.width=_e.width||(bt.width>>nt)-qe,_e.height=_e.height||(bt.height>>nt)-Fe,de(bt.type===_e.type&&bt.format===_e.format&&bt.internalformat===_e.internalformat,"incompatible format for texture.subimage"),de(qe>=0&&Fe>=0&&qe+_e.width<=bt.width&&Fe+_e.height<=bt.height,"texture.subimage write out of bounds"),de(bt.mipmask&1<<nt,"missing mipmap data"),de(_e.data||_e.element||_e.needsCopy,"missing image data"),Zo(bt),yi(_e,vo,qe,Fe,nt),ra(),sn(_e),gn}function Ce(ie,Ve){var ft=ie|0,Ot=Ve|0||ft;if(ft===bt.width&&Ot===bt.height)return gn;gn.width=bt.width=ft,gn.height=bt.height=Ot,Zo(bt);for(var qe=0;bt.mipmask>>qe;++qe){var Fe=ft>>qe,nt=Ot>>qe;if(!Fe||!nt)break;B.texImage2D(vo,qe,bt.format,Fe,nt,0,bt.format,bt.type,null)}return ra(),nr.profile&&(bt.stats.size=js(bt.internalformat,bt.type,ft,Ot,!1,!1)),gn}return gn(we,Ut),gn.subimage=Fi,gn.resize=Ce,gn._reglType="texture2d",gn._texture=bt,nr.profile&&(gn.stats=bt.stats),gn.destroy=function(){bt.decRef()},gn}function Ui(we,Ut,bt,gn,Fi,Ce){var ie=new _i(Ff);Uo[ie.id]=ie,Lt.cubeCount++;var Ve=new Array(6);function ft(Fe,nt,_e,Ue,Ae,pt){var _t,vr=ie.texInfo;for(Ka.call(vr),_t=0;_t<6;++_t)Ve[_t]=Di();if(typeof Fe=="number"||!Fe){var jr=Fe|0||1;for(_t=0;_t<6;++_t)hi(Ve[_t],jr,jr)}else if(typeof Fe=="object")if(nt)zi(Ve[0],Fe),zi(Ve[1],nt),zi(Ve[2],_e),zi(Ve[3],Ue),zi(Ve[4],Ae),zi(Ve[5],pt);else if(ns(vr,Fe),dn(ie,Fe),"faces"in Fe){var Vr=Fe.faces;for(de(Array.isArray(Vr)&&Vr.length===6,"cube faces must be a length 6 array"),_t=0;_t<6;++_t)de(typeof Vr[_t]=="object"&&!!Vr[_t],"invalid input for cube map face"),ir(Ve[_t],ie),zi(Ve[_t],Vr[_t])}else for(_t=0;_t<6;++_t)zi(Ve[_t],Fe);else de.raise("invalid arguments to cube map");for(ir(ie,Ve[0]),de.optional(function(){Be.npotTextureCube||de(yp(ie.width)&&yp(ie.height),"your browser does not support non power or two texture dimensions")}),vr.genMipmaps?ie.mipmask=(Ve[0].width<<1)-1:ie.mipmask=Ve[0].mipmask,de.textureCube(ie,vr,Ve,Be),ie.internalformat=Ve[0].internalformat,ft.width=Ve[0].width,ft.height=Ve[0].height,Zo(ie),_t=0;_t<6;++_t)po(Ve[_t],_u+_t);for(Oo(vr,Ff),ra(),nr.profile&&(ie.stats.size=js(ie.internalformat,ie.type,ft.width,ft.height,vr.genMipmaps,!0)),ft.format=Ar[ie.internalformat],ft.type=Zr[ie.type],ft.mag=pr[vr.magFilter],ft.min=Rr[vr.minFilter],ft.wrapS=Qr[vr.wrapS],ft.wrapT=Qr[vr.wrapT],_t=0;_t<6;++_t)us(Ve[_t]);return ft}function Ot(Fe,nt,_e,Ue,Ae){de(!!nt,"must specify image data"),de(typeof Fe=="number"&&Fe===(Fe|0)&&Fe>=0&&Fe<6,"invalid face");var pt=_e|0,_t=Ue|0,vr=Ae|0,jr=qr();return ir(jr,ie),jr.width=0,jr.height=0,Hr(jr,nt),jr.width=jr.width||(ie.width>>vr)-pt,jr.height=jr.height||(ie.height>>vr)-_t,de(ie.type===jr.type&&ie.format===jr.format&&ie.internalformat===jr.internalformat,"incompatible format for texture.subimage"),de(pt>=0&&_t>=0&&pt+jr.width<=ie.width&&_t+jr.height<=ie.height,"texture.subimage write out of bounds"),de(ie.mipmask&1<<vr,"missing mipmap data"),de(jr.data||jr.element||jr.needsCopy,"missing image data"),Zo(ie),yi(jr,_u+Fe,pt,_t,vr),ra(),sn(jr),ft}function qe(Fe){var nt=Fe|0;if(nt!==ie.width){ft.width=ie.width=nt,ft.height=ie.height=nt,Zo(ie);for(var _e=0;_e<6;++_e)for(var Ue=0;ie.mipmask>>Ue;++Ue)B.texImage2D(_u+_e,Ue,ie.format,nt>>Ue,nt>>Ue,0,ie.format,ie.type,null);return ra(),nr.profile&&(ie.stats.size=js(ie.internalformat,ie.type,ft.width,ft.height,!1,!0)),ft}}return ft(we,Ut,bt,gn,Fi,Ce),ft.subimage=Ot,ft.resize=qe,ft._reglType="textureCube",ft._texture=ie,nr.profile&&(ft.stats=ie.stats),ft.destroy=function(){ie.decRef()},ft}function ga(){for(var we=0;we<ls;++we)B.activeTexture(rc+we),B.bindTexture(vo,null),yo[we]=null;Q(Uo).forEach(cs),Lt.cubeCount=0,Lt.textureCount=0}nr.profile&&(Lt.getTotalTextureSize=function(){var we=0;return Object.keys(Uo).forEach(function(Ut){we+=Uo[Ut].stats.size}),we});function Ro(){for(var we=0;we<ls;++we){var Ut=yo[we];Ut&&(Ut.bindCount=0,Ut.unit=-1,yo[we]=null)}Q(Uo).forEach(function(bt){bt.texture=B.createTexture(),B.bindTexture(bt.target,bt.texture);for(var gn=0;gn<32;++gn)if((bt.mipmask&1<<gn)!=0)if(bt.target===vo)B.texImage2D(vo,gn,bt.internalformat,bt.width>>gn,bt.height>>gn,0,bt.internalformat,bt.type,null);else for(var Fi=0;Fi<6;++Fi)B.texImage2D(_u+Fi,gn,bt.internalformat,bt.width>>gn,bt.height>>gn,0,bt.internalformat,bt.type,null);Oo(bt.texInfo,bt.target)})}function Cl(){for(var we=0;we<ls;++we){var Ut=yo[we];Ut&&(Ut.bindCount=0,Ut.unit=-1,yo[we]=null),B.activeTexture(rc+we),B.bindTexture(vo,null),B.bindTexture(Ff,null)}}return{create2D:ii,createCube:Ui,clear:ga,getTexture:function(we){return null},restore:Ro,refresh:Cl}}var Vs=36161,Ln=32854,wn=32855,nc=36194,xs=33189,Eu=36168,es=34041,wa=35907,kc=34836,Dc=34842,ma=34843,Oa=[];Oa[Ln]=2,Oa[wn]=2,Oa[nc]=2,Oa[xs]=2,Oa[Eu]=1,Oa[es]=4,Oa[wa]=4,Oa[kc]=16,Oa[Dc]=8,Oa[ma]=6;function Fc(B,me,Be){return Oa[B]*me*Be}var Ll=function(B,me,Be,Ft,ur){var Lt={rgba4:Ln,rgb565:nc,"rgb5 a1":wn,depth:xs,stencil:Eu,"depth stencil":es};me.ext_srgb&&(Lt.srgba=wa),me.ext_color_buffer_half_float&&(Lt.rgba16f=Dc,Lt.rgb16f=ma),me.webgl_color_buffer_float&&(Lt.rgba32f=kc);var nr=[];Object.keys(Lt).forEach(function(gr){var Pr=Lt[gr];nr[Pr]=gr});var hr=0,_r={};function br(gr){this.id=hr++,this.refCount=1,this.renderbuffer=gr,this.format=Ln,this.width=0,this.height=0,ur.profile&&(this.stats={size:0})}br.prototype.decRef=function(){--this.refCount<=0&&Tr(this)};function Tr(gr){var Pr=gr.renderbuffer;de(Pr,"must not double destroy renderbuffer"),B.bindRenderbuffer(Vs,null),B.deleteRenderbuffer(Pr),gr.renderbuffer=null,gr.refCount=0,delete _r[gr.id],Ft.renderbufferCount--}function kr(gr,Pr){var ut=new br(B.createRenderbuffer());_r[ut.id]=ut,Ft.renderbufferCount++;function Gt(Zr,pr){var Rr=0,Qr=0,Nn=Ln;if(typeof Zr=="object"&&Zr){var Xt=Zr;if("shape"in Xt){var ir=Xt.shape;de(Array.isArray(ir)&&ir.length>=2,"invalid renderbuffer shape"),Rr=ir[0]|0,Qr=ir[1]|0}else"radius"in Xt&&(Rr=Qr=Xt.radius|0),"width"in Xt&&(Rr=Xt.width|0),"height"in Xt&&(Qr=Xt.height|0);"format"in Xt&&(de.parameter(Xt.format,Lt,"invalid renderbuffer format"),Nn=Lt[Xt.format])}else typeof Zr=="number"?(Rr=Zr|0,typeof pr=="number"?Qr=pr|0:Qr=Rr):Zr?de.raise("invalid arguments to renderbuffer constructor"):Rr=Qr=1;if(de(Rr>0&&Qr>0&&Rr<=Be.maxRenderbufferSize&&Qr<=Be.maxRenderbufferSize,"invalid renderbuffer size"),!(Rr===ut.width&&Qr===ut.height&&Nn===ut.format))return Gt.width=ut.width=Rr,Gt.height=ut.height=Qr,ut.format=Nn,B.bindRenderbuffer(Vs,ut.renderbuffer),B.renderbufferStorage(Vs,Nn,Rr,Qr),de(B.getError()===0,"invalid render buffer format"),ur.profile&&(ut.stats.size=Fc(ut.format,ut.width,ut.height)),Gt.format=nr[ut.format],Gt}function Ar(Zr,pr){var Rr=Zr|0,Qr=pr|0||Rr;return Rr===ut.width&&Qr===ut.height||(de(Rr>0&&Qr>0&&Rr<=Be.maxRenderbufferSize&&Qr<=Be.maxRenderbufferSize,"invalid renderbuffer size"),Gt.width=ut.width=Rr,Gt.height=ut.height=Qr,B.bindRenderbuffer(Vs,ut.renderbuffer),B.renderbufferStorage(Vs,ut.format,Rr,Qr),de(B.getError()===0,"invalid render buffer format"),ur.profile&&(ut.stats.size=Fc(ut.format,ut.width,ut.height))),Gt}return Gt(gr,Pr),Gt.resize=Ar,Gt._reglType="renderbuffer",Gt._renderbuffer=ut,ur.profile&&(Gt.stats=ut.stats),Gt.destroy=function(){ut.decRef()},Gt}ur.profile&&(Ft.getTotalRenderbufferSize=function(){var gr=0;return Object.keys(_r).forEach(function(Pr){gr+=_r[Pr].stats.size}),gr});function dr(){Q(_r).forEach(function(gr){gr.renderbuffer=B.createRenderbuffer(),B.bindRenderbuffer(Vs,gr.renderbuffer),B.renderbufferStorage(Vs,gr.format,gr.width,gr.height)}),B.bindRenderbuffer(Vs,null)}return{create:kr,clear:function(){Q(_r).forEach(Tr)},restore:dr}},Su=36160,ru=36161,No=3553,gl=34069,Cu=36064,vf=36096,kl=36128,Dl=33306,Fl=36053,ic=36054,yl=36055,wp=36057,ol=36061,Bu=36193,jf=5121,_l=5126,nu=6407,mf=6408,Gs=6402,Tp=[nu,mf],ac=[];ac[mf]=4,ac[nu]=3;var l=[];l[jf]=1,l[_l]=4,l[Bu]=2;var f=32854,c=32855,d=36194,E=33189,A=36168,M=34041,L=35907,U=34836,X=34842,oe=34843,fe=[f,c,d,L,X,oe,U],pe={};pe[Fl]="complete",pe[ic]="incomplete attachment",pe[wp]="incomplete dimensions",pe[yl]="incomplete, missing attachment",pe[ol]="unsupported";function Re(B,me,Be,Ft,ur,Lt){var nr={cur:null,next:null,dirty:!1,setFBO:null},hr=["rgba"],_r=["rgba4","rgb565","rgb5 a1"];me.ext_srgb&&_r.push("srgba"),me.ext_color_buffer_half_float&&_r.push("rgba16f","rgb16f"),me.webgl_color_buffer_float&&_r.push("rgba32f");var br=["uint8"];me.oes_texture_half_float&&br.push("half float","float16"),me.oes_texture_float&&br.push("float","float32");function Tr(Er,Hr,Yr){this.target=Er,this.texture=Hr,this.renderbuffer=Yr;var yi=0,ai=0;Hr?(yi=Hr.width,ai=Hr.height):Yr&&(yi=Yr.width,ai=Yr.height),this.width=yi,this.height=ai}function kr(Er){Er&&(Er.texture&&Er.texture._texture.decRef(),Er.renderbuffer&&Er.renderbuffer._renderbuffer.decRef())}function dr(Er,Hr,Yr){if(!!Er)if(Er.texture){var yi=Er.texture._texture,ai=Math.max(1,yi.width),qr=Math.max(1,yi.height);de(ai===Hr&&qr===Yr,"inconsistent width/height for supplied texture"),yi.refCount+=1}else{var sn=Er.renderbuffer._renderbuffer;de(sn.width===Hr&&sn.height===Yr,"inconsistent width/height for renderbuffer"),sn.refCount+=1}}function gr(Er,Hr){Hr&&(Hr.texture?B.framebufferTexture2D(Su,Er,Hr.target,Hr.texture._texture.texture,0):B.framebufferRenderbuffer(Su,Er,ru,Hr.renderbuffer._renderbuffer.renderbuffer))}function Pr(Er){var Hr=No,Yr=null,yi=null,ai=Er;typeof Er=="object"&&(ai=Er.data,"target"in Er&&(Hr=Er.target|0)),de.type(ai,"function","invalid attachment data");var qr=ai._reglType;return qr==="texture2d"?(Yr=ai,de(Hr===No)):qr==="textureCube"?(Yr=ai,de(Hr>=gl&&Hr<gl+6,"invalid cube map target")):qr==="renderbuffer"?(yi=ai,Hr=ru):de.raise("invalid regl object for attachment"),new Tr(Hr,Yr,yi)}function ut(Er,Hr,Yr,yi,ai){if(Yr){var qr=Ft.create2D({width:Er,height:Hr,format:yi,type:ai});return qr._texture.refCount=0,new Tr(No,qr,null)}else{var sn=ur.create({width:Er,height:Hr,format:yi});return sn._renderbuffer.refCount=0,new Tr(ru,null,sn)}}function Gt(Er){return Er&&(Er.texture||Er.renderbuffer)}function Ar(Er,Hr,Yr){Er&&(Er.texture?Er.texture.resize(Hr,Yr):Er.renderbuffer&&Er.renderbuffer.resize(Hr,Yr),Er.width=Hr,Er.height=Yr)}var Zr=0,pr={};function Rr(){this.id=Zr++,pr[this.id]=this,this.framebuffer=B.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Qr(Er){Er.colorAttachments.forEach(kr),kr(Er.depthAttachment),kr(Er.stencilAttachment),kr(Er.depthStencilAttachment)}function Nn(Er){var Hr=Er.framebuffer;de(Hr,"must not double destroy framebuffer"),B.deleteFramebuffer(Hr),Er.framebuffer=null,Lt.framebufferCount--,delete pr[Er.id]}function Xt(Er){var Hr;B.bindFramebuffer(Su,Er.framebuffer);var Yr=Er.colorAttachments;for(Hr=0;Hr<Yr.length;++Hr)gr(Cu+Hr,Yr[Hr]);for(Hr=Yr.length;Hr<Be.maxColorAttachments;++Hr)B.framebufferTexture2D(Su,Cu+Hr,No,null,0);B.framebufferTexture2D(Su,Dl,No,null,0),B.framebufferTexture2D(Su,vf,No,null,0),B.framebufferTexture2D(Su,kl,No,null,0),gr(vf,Er.depthAttachment),gr(kl,Er.stencilAttachment),gr(Dl,Er.depthStencilAttachment);var yi=B.checkFramebufferStatus(Su);!B.isContextLost()&&yi!==Fl&&de.raise("framebuffer configuration not supported, status = "+pe[yi]),B.bindFramebuffer(Su,nr.next?nr.next.framebuffer:null),nr.cur=nr.next,B.getError()}function ir(Er,Hr){var Yr=new Rr;Lt.framebufferCount++;function yi(qr,sn){var Qn;de(nr.next!==Yr,"can not update framebuffer which is currently in use");var hi=0,zi=0,po=!0,go=!0,Di=null,us=!0,Ka="rgba",ns="uint8",Oo=1,is=null,Uo=null,ls=null,yo=!1;if(typeof qr=="number")hi=qr|0,zi=sn|0||hi;else if(!qr)hi=zi=1;else{de.type(qr,"object","invalid arguments for framebuffer");var _i=qr;if("shape"in _i){var Zo=_i.shape;de(Array.isArray(Zo)&&Zo.length>=2,"invalid shape for framebuffer"),hi=Zo[0],zi=Zo[1]}else"radius"in _i&&(hi=zi=_i.radius),"width"in _i&&(hi=_i.width),"height"in _i&&(zi=_i.height);("color"in _i||"colors"in _i)&&(Di=_i.color||_i.colors,Array.isArray(Di)&&de(Di.length===1||me.webgl_draw_buffers,"multiple render targets not supported")),Di||("colorCount"in _i&&(Oo=_i.colorCount|0,de(Oo>0,"invalid color buffer count")),"colorTexture"in _i&&(us=!!_i.colorTexture,Ka="rgba4"),"colorType"in _i&&(ns=_i.colorType,us?(de(me.oes_texture_float||!(ns==="float"||ns==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),de(me.oes_texture_half_float||!(ns==="half float"||ns==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):ns==="half float"||ns==="float16"?(de(me.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Ka="rgba16f"):(ns==="float"||ns==="float32")&&(de(me.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Ka="rgba32f"),de.oneOf(ns,br,"invalid color type")),"colorFormat"in _i&&(Ka=_i.colorFormat,hr.indexOf(Ka)>=0?us=!0:_r.indexOf(Ka)>=0?us=!1:de.optional(function(){us?de.oneOf(_i.colorFormat,hr,"invalid color format for texture"):de.oneOf(_i.colorFormat,_r,"invalid color format for renderbuffer")}))),("depthTexture"in _i||"depthStencilTexture"in _i)&&(yo=!!(_i.depthTexture||_i.depthStencilTexture),de(!yo||me.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in _i&&(typeof _i.depth=="boolean"?po=_i.depth:(is=_i.depth,go=!1)),"stencil"in _i&&(typeof _i.stencil=="boolean"?go=_i.stencil:(Uo=_i.stencil,po=!1)),"depthStencil"in _i&&(typeof _i.depthStencil=="boolean"?po=go=_i.depthStencil:(ls=_i.depthStencil,po=!1,go=!1))}var ra=null,cs=null,ii=null,Ui=null;if(Array.isArray(Di))ra=Di.map(Pr);else if(Di)ra=[Pr(Di)];else for(ra=new Array(Oo),Qn=0;Qn<Oo;++Qn)ra[Qn]=ut(hi,zi,us,Ka,ns);de(me.webgl_draw_buffers||ra.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),de(ra.length<=Be.maxColorAttachments,"too many color attachments, not supported"),hi=hi||ra[0].width,zi=zi||ra[0].height,is?cs=Pr(is):po&&!go&&(cs=ut(hi,zi,yo,"depth","uint32")),Uo?ii=Pr(Uo):go&&!po&&(ii=ut(hi,zi,!1,"stencil","uint8")),ls?Ui=Pr(ls):!is&&!Uo&&go&&po&&(Ui=ut(hi,zi,yo,"depth stencil","depth stencil")),de(!!is+!!Uo+!!ls<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var ga=null;for(Qn=0;Qn<ra.length;++Qn)if(dr(ra[Qn],hi,zi),de(!ra[Qn]||ra[Qn].texture&&Tp.indexOf(ra[Qn].texture._texture.format)>=0||ra[Qn].renderbuffer&&fe.indexOf(ra[Qn].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Qn+" is invalid"),ra[Qn]&&ra[Qn].texture){var Ro=ac[ra[Qn].texture._texture.format]*l[ra[Qn].texture._texture.type];ga===null?ga=Ro:de(ga===Ro,"all color attachments much have the same number of bits per pixel.")}return dr(cs,hi,zi),de(!cs||cs.texture&&cs.texture._texture.format===Gs||cs.renderbuffer&&cs.renderbuffer._renderbuffer.format===E,"invalid depth attachment for framebuffer object"),dr(ii,hi,zi),de(!ii||ii.renderbuffer&&ii.renderbuffer._renderbuffer.format===A,"invalid stencil attachment for framebuffer object"),dr(Ui,hi,zi),de(!Ui||Ui.texture&&Ui.texture._texture.format===M||Ui.renderbuffer&&Ui.renderbuffer._renderbuffer.format===M,"invalid depth-stencil attachment for framebuffer object"),Qr(Yr),Yr.width=hi,Yr.height=zi,Yr.colorAttachments=ra,Yr.depthAttachment=cs,Yr.stencilAttachment=ii,Yr.depthStencilAttachment=Ui,yi.color=ra.map(Gt),yi.depth=Gt(cs),yi.stencil=Gt(ii),yi.depthStencil=Gt(Ui),yi.width=Yr.width,yi.height=Yr.height,Xt(Yr),yi}function ai(qr,sn){de(nr.next!==Yr,"can not resize a framebuffer which is currently in use");var Qn=Math.max(qr|0,1),hi=Math.max(sn|0||Qn,1);if(Qn===Yr.width&&hi===Yr.height)return yi;for(var zi=Yr.colorAttachments,po=0;po<zi.length;++po)Ar(zi[po],Qn,hi);return Ar(Yr.depthAttachment,Qn,hi),Ar(Yr.stencilAttachment,Qn,hi),Ar(Yr.depthStencilAttachment,Qn,hi),Yr.width=yi.width=Qn,Yr.height=yi.height=hi,Xt(Yr),yi}return yi(Er,Hr),m(yi,{resize:ai,_reglType:"framebuffer",_framebuffer:Yr,destroy:function(){Nn(Yr),Qr(Yr)},use:function(qr){nr.setFBO({framebuffer:yi},qr)}})}function dn(Er){var Hr=Array(6);function Yr(ai){var qr;de(Hr.indexOf(nr.next)<0,"can not update framebuffer which is currently in use");var sn={color:null},Qn=0,hi=null,zi="rgba",po="uint8",go=1;if(typeof ai=="number")Qn=ai|0;else if(!ai)Qn=1;else{de.type(ai,"object","invalid arguments for framebuffer");var Di=ai;if("shape"in Di){var us=Di.shape;de(Array.isArray(us)&&us.length>=2,"invalid shape for framebuffer"),de(us[0]===us[1],"cube framebuffer must be square"),Qn=us[0]}else"radius"in Di&&(Qn=Di.radius|0),"width"in Di?(Qn=Di.width|0,"height"in Di&&de(Di.height===Qn,"must be square")):"height"in Di&&(Qn=Di.height|0);("color"in Di||"colors"in Di)&&(hi=Di.color||Di.colors,Array.isArray(hi)&&de(hi.length===1||me.webgl_draw_buffers,"multiple render targets not supported")),hi||("colorCount"in Di&&(go=Di.colorCount|0,de(go>0,"invalid color buffer count")),"colorType"in Di&&(de.oneOf(Di.colorType,br,"invalid color type"),po=Di.colorType),"colorFormat"in Di&&(zi=Di.colorFormat,de.oneOf(Di.colorFormat,hr,"invalid color format for texture"))),"depth"in Di&&(sn.depth=Di.depth),"stencil"in Di&&(sn.stencil=Di.stencil),"depthStencil"in Di&&(sn.depthStencil=Di.depthStencil)}var Ka;if(hi)if(Array.isArray(hi))for(Ka=[],qr=0;qr<hi.length;++qr)Ka[qr]=hi[qr];else Ka=[hi];else{Ka=Array(go);var ns={radius:Qn,format:zi,type:po};for(qr=0;qr<go;++qr)Ka[qr]=Ft.createCube(ns)}for(sn.color=Array(Ka.length),qr=0;qr<Ka.length;++qr){var Oo=Ka[qr];de(typeof Oo=="function"&&Oo._reglType==="textureCube","invalid cube map"),Qn=Qn||Oo.width,de(Oo.width===Qn&&Oo.height===Qn,"invalid cube map shape"),sn.color[qr]={target:gl,data:Ka[qr]}}for(qr=0;qr<6;++qr){for(var is=0;is<Ka.length;++is)sn.color[is].target=gl+qr;qr>0&&(sn.depth=Hr[0].depth,sn.stencil=Hr[0].stencil,sn.depthStencil=Hr[0].depthStencil),Hr[qr]?Hr[qr](sn):Hr[qr]=ir(sn)}return m(Yr,{width:Qn,height:Qn,color:Ka})}function yi(ai){var qr,sn=ai|0;if(de(sn>0&&sn<=Be.maxCubeMapSize,"invalid radius for cube fbo"),sn===Yr.width)return Yr;var Qn=Yr.color;for(qr=0;qr<Qn.length;++qr)Qn[qr].resize(sn);for(qr=0;qr<6;++qr)Hr[qr].resize(sn);return Yr.width=Yr.height=sn,Yr}return Yr(Er),m(Yr,{faces:Hr,resize:yi,_reglType:"framebufferCube",destroy:function(){Hr.forEach(function(ai){ai.destroy()})}})}function Xr(){nr.cur=null,nr.next=null,nr.dirty=!0,Q(pr).forEach(function(Er){Er.framebuffer=B.createFramebuffer(),Xt(Er)})}return m(nr,{getFramebuffer:function(Er){if(typeof Er=="function"&&Er._reglType==="framebuffer"){var Hr=Er._framebuffer;if(Hr instanceof Rr)return Hr}return null},create:ir,createCube:dn,clear:function(){Q(pr).forEach(Nn)},restore:Xr})}var Pe=5126,He=34962,be=34963,je=["attributes","elements","offset","count","primitive","instances"];function et(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Pe,this.offset=0,this.stride=0,this.divisor=0}function yt(B,me,Be,Ft,ur,Lt,nr){for(var hr=Be.maxAttributes,_r=new Array(hr),br=0;br<hr;++br)_r[br]=new et;var Tr=0,kr={},dr={Record:et,scope:{},state:_r,currentVAO:null,targetVAO:null,restore:Pr()?Qr:function(){},createVAO:Nn,getVAO:Gt,destroyBuffer:gr,setVAO:Pr()?Ar:Zr,clear:Pr()?pr:function(){}};function gr(Xt){for(var ir=0;ir<_r.length;++ir){var dn=_r[ir];dn.buffer===Xt&&(B.disableVertexAttribArray(ir),dn.buffer=null)}}function Pr(){return me.oes_vertex_array_object}function ut(){return me.angle_instanced_arrays}function Gt(Xt){return typeof Xt=="function"&&Xt._vao?Xt._vao:null}function Ar(Xt){if(Xt!==dr.currentVAO){var ir=Pr();Xt?ir.bindVertexArrayOES(Xt.vao):ir.bindVertexArrayOES(null),dr.currentVAO=Xt}}function Zr(Xt){if(Xt!==dr.currentVAO){if(Xt)Xt.bindAttrs();else{for(var ir=ut(),dn=0;dn<_r.length;++dn){var Xr=_r[dn];Xr.buffer?(B.enableVertexAttribArray(dn),Xr.buffer.bind(),B.vertexAttribPointer(dn,Xr.size,Xr.type,Xr.normalized,Xr.stride,Xr.offfset),ir&&Xr.divisor&&ir.vertexAttribDivisorANGLE(dn,Xr.divisor)):(B.disableVertexAttribArray(dn),B.vertexAttrib4f(dn,Xr.x,Xr.y,Xr.z,Xr.w))}nr.elements?B.bindBuffer(be,nr.elements.buffer.buffer):B.bindBuffer(be,null)}dr.currentVAO=Xt}}function pr(){Q(kr).forEach(function(Xt){Xt.destroy()})}function Rr(){this.id=++Tr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var Xt=Pr();Xt?this.vao=Xt.createVertexArrayOES():this.vao=null,kr[this.id]=this,this.buffers=[]}Rr.prototype.bindAttrs=function(){for(var Xt=ut(),ir=this.attributes,dn=0;dn<ir.length;++dn){var Xr=ir[dn];Xr.buffer?(B.enableVertexAttribArray(dn),B.bindBuffer(He,Xr.buffer.buffer),B.vertexAttribPointer(dn,Xr.size,Xr.type,Xr.normalized,Xr.stride,Xr.offset),Xt&&Xr.divisor&&Xt.vertexAttribDivisorANGLE(dn,Xr.divisor)):(B.disableVertexAttribArray(dn),B.vertexAttrib4f(dn,Xr.x,Xr.y,Xr.z,Xr.w))}for(var Er=ir.length;Er<hr;++Er)B.disableVertexAttribArray(Er);var Hr=Lt.getElements(this.elements);Hr?B.bindBuffer(be,Hr.buffer.buffer):B.bindBuffer(be,null)},Rr.prototype.refresh=function(){var Xt=Pr();Xt&&(Xt.bindVertexArrayOES(this.vao),this.bindAttrs(),dr.currentVAO=null,Xt.bindVertexArrayOES(null))},Rr.prototype.destroy=function(){if(this.vao){var Xt=Pr();this===dr.currentVAO&&(dr.currentVAO=null,Xt.bindVertexArrayOES(null)),Xt.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),kr[this.id]&&(delete kr[this.id],Ft.vaoCount-=1)};function Qr(){var Xt=Pr();Xt&&Q(kr).forEach(function(ir){ir.refresh()})}function Nn(Xt){var ir=new Rr;Ft.vaoCount+=1;function dn(Xr){var Er;if(Array.isArray(Xr))Er=Xr,ir.elements&&ir.ownsElements&&ir.elements.destroy(),ir.elements=null,ir.ownsElements=!1,ir.offset=0,ir.count=0,ir.instances=-1,ir.primitive=4;else{if(de(typeof Xr=="object","invalid arguments for create vao"),de("attributes"in Xr,"must specify attributes for vao"),Xr.elements){var Hr=Xr.elements;ir.ownsElements?typeof Hr=="function"&&Hr._reglType==="elements"?(ir.elements.destroy(),ir.ownsElements=!1):(ir.elements(Hr),ir.ownsElements=!1):Lt.getElements(Xr.elements)?(ir.elements=Xr.elements,ir.ownsElements=!1):(ir.elements=Lt.create(Xr.elements),ir.ownsElements=!0)}else ir.elements=null,ir.ownsElements=!1;Er=Xr.attributes,ir.offset=0,ir.count=-1,ir.instances=-1,ir.primitive=4,ir.elements&&(ir.count=ir.elements._elements.vertCount,ir.primitive=ir.elements._elements.primType),"offset"in Xr&&(ir.offset=Xr.offset|0),"count"in Xr&&(ir.count=Xr.count|0),"instances"in Xr&&(ir.instances=Xr.instances|0),"primitive"in Xr&&(de(Xr.primitive in cr,"bad primitive type: "+Xr.primitive),ir.primitive=cr[Xr.primitive]),de.optional(function(){for(var po=Object.keys(Xr),go=0;go<po.length;++go)de(je.indexOf(po[go])>=0,'invalid option for vao: "'+po[go]+'" valid options are '+je)}),de(Array.isArray(Er),"attributes must be an array")}de(Er.length<hr,"too many attributes"),de(Er.length>0,"must specify at least one attribute");var Yr={},yi=ir.attributes;yi.length=Er.length;for(var ai=0;ai<Er.length;++ai){var qr=Er[ai],sn=yi[ai]=new et,Qn=qr.data||qr;if(Array.isArray(Qn)||ye(Qn)||Fs(Qn)){var hi;ir.buffers[ai]&&(hi=ir.buffers[ai],ye(Qn)&&hi._buffer.byteLength>=Qn.byteLength?hi.subdata(Qn):(hi.destroy(),ir.buffers[ai]=null)),ir.buffers[ai]||(hi=ir.buffers[ai]=ur.create(qr,He,!1,!0)),sn.buffer=ur.getBuffer(hi),sn.size=sn.buffer.dimension|0,sn.normalized=!1,sn.type=sn.buffer.dtype,sn.offset=0,sn.stride=0,sn.divisor=0,sn.state=1,Yr[ai]=1}else ur.getBuffer(qr)?(sn.buffer=ur.getBuffer(qr),sn.size=sn.buffer.dimension|0,sn.normalized=!1,sn.type=sn.buffer.dtype,sn.offset=0,sn.stride=0,sn.divisor=0,sn.state=1):ur.getBuffer(qr.buffer)?(sn.buffer=ur.getBuffer(qr.buffer),sn.size=(+qr.size||sn.buffer.dimension)|0,sn.normalized=!!qr.normalized||!1,"type"in qr?(de.parameter(qr.type,lu,"invalid buffer type"),sn.type=lu[qr.type]):sn.type=sn.buffer.dtype,sn.offset=(qr.offset||0)|0,sn.stride=(qr.stride||0)|0,sn.divisor=(qr.divisor||0)|0,sn.state=1,de(sn.size>=1&&sn.size<=4,"size must be between 1 and 4"),de(sn.offset>=0,"invalid offset"),de(sn.stride>=0&&sn.stride<=255,"stride must be between 0 and 255"),de(sn.divisor>=0,"divisor must be positive"),de(!sn.divisor||!!me.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in qr?(de(ai>0,"first attribute must not be a constant"),sn.x=+qr.x||0,sn.y=+qr.y||0,sn.z=+qr.z||0,sn.w=+qr.w||0,sn.state=2):de(!1,"invalid attribute spec for location "+ai)}for(var zi=0;zi<ir.buffers.length;++zi)!Yr[zi]&&ir.buffers[zi]&&(ir.buffers[zi].destroy(),ir.buffers[zi]=null);return ir.refresh(),dn}return dn.destroy=function(){for(var Xr=0;Xr<ir.buffers.length;++Xr)ir.buffers[Xr]&&ir.buffers[Xr].destroy();ir.buffers.length=0,ir.ownsElements&&(ir.elements.destroy(),ir.elements=null,ir.ownsElements=!1),ir.destroy()},dn._vao=ir,dn._reglType="vao",dn(Xt)}return dr}var Ht=35632,Nt=35633,Qt=35718,rr=35721;function Ir(B,me,Be,Ft){var ur={},Lt={};function nr(ut,Gt,Ar,Zr){this.name=ut,this.id=Gt,this.location=Ar,this.info=Zr}function hr(ut,Gt){for(var Ar=0;Ar<ut.length;++Ar)if(ut[Ar].id===Gt.id){ut[Ar].location=Gt.location;return}ut.push(Gt)}function _r(ut,Gt,Ar){var Zr=ut===Ht?ur:Lt,pr=Zr[Gt];if(!pr){var Rr=me.str(Gt);pr=B.createShader(ut),B.shaderSource(pr,Rr),B.compileShader(pr),de.shaderError(B,pr,Rr,ut,Ar),Zr[Gt]=pr}return pr}var br={},Tr=[],kr=0;function dr(ut,Gt){this.id=kr++,this.fragId=ut,this.vertId=Gt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Ft.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function gr(ut,Gt,Ar){var Zr,pr,Rr=_r(Ht,ut.fragId),Qr=_r(Nt,ut.vertId),Nn=ut.program=B.createProgram();if(B.attachShader(Nn,Rr),B.attachShader(Nn,Qr),Ar)for(Zr=0;Zr<Ar.length;++Zr){var Xt=Ar[Zr];B.bindAttribLocation(Nn,Xt[0],Xt[1])}B.linkProgram(Nn),de.linkError(B,Nn,me.str(ut.fragId),me.str(ut.vertId),Gt);var ir=B.getProgramParameter(Nn,Qt);Ft.profile&&(ut.stats.uniformsCount=ir);var dn=ut.uniforms;for(Zr=0;Zr<ir;++Zr)if(pr=B.getActiveUniform(Nn,Zr),pr)if(pr.size>1)for(var Xr=0;Xr<pr.size;++Xr){var Er=pr.name.replace("[0]","["+Xr+"]");hr(dn,new nr(Er,me.id(Er),B.getUniformLocation(Nn,Er),pr))}else hr(dn,new nr(pr.name,me.id(pr.name),B.getUniformLocation(Nn,pr.name),pr));var Hr=B.getProgramParameter(Nn,rr);Ft.profile&&(ut.stats.attributesCount=Hr);var Yr=ut.attributes;for(Zr=0;Zr<Hr;++Zr)pr=B.getActiveAttrib(Nn,Zr),pr&&hr(Yr,new nr(pr.name,me.id(pr.name),B.getAttribLocation(Nn,pr.name),pr))}Ft.profile&&(Be.getMaxUniformsCount=function(){var ut=0;return Tr.forEach(function(Gt){Gt.stats.uniformsCount>ut&&(ut=Gt.stats.uniformsCount)}),ut},Be.getMaxAttributesCount=function(){var ut=0;return Tr.forEach(function(Gt){Gt.stats.attributesCount>ut&&(ut=Gt.stats.attributesCount)}),ut});function Pr(){ur={},Lt={};for(var ut=0;ut<Tr.length;++ut)gr(Tr[ut],null,Tr[ut].attributes.map(function(Gt){return[Gt.location,Gt.name]}))}return{clear:function(){var ut=B.deleteShader.bind(B);Q(ur).forEach(ut),ur={},Q(Lt).forEach(ut),Lt={},Tr.forEach(function(Gt){B.deleteProgram(Gt.program)}),Tr.length=0,br={},Be.shaderCount=0},program:function(ut,Gt,Ar,Zr){de.command(ut>=0,"missing vertex shader",Ar),de.command(Gt>=0,"missing fragment shader",Ar);var pr=br[Gt];pr||(pr=br[Gt]={});var Rr=pr[ut];if(Rr&&(Rr.refCount++,!Zr))return Rr;var Qr=new dr(Gt,ut);return Be.shaderCount++,gr(Qr,Ar,Zr),Rr||(pr[ut]=Qr),Tr.push(Qr),m(Qr,{destroy:function(){if(Qr.refCount--,Qr.refCount<=0){B.deleteProgram(Qr.program);var Nn=Tr.indexOf(Qr);Tr.splice(Nn,1),Be.shaderCount--}pr[Qr.vertId].refCount<=0&&(B.deleteShader(Lt[Qr.vertId]),delete Lt[Qr.vertId],delete br[Qr.fragId][Qr.vertId]),Object.keys(br[Qr.fragId]).length||(B.deleteShader(ur[Qr.fragId]),delete ur[Qr.fragId],delete br[Qr.fragId])}})},restore:Pr,shader:_r,frag:-1,vert:-1}}var Or=6408,ln=5121,Bn=3333,Dn=5126;function Un(B,me,Be,Ft,ur,Lt,nr){function hr(Tr){var kr;me.next===null?(de(ur.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),kr=ln):(de(me.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),kr=me.next.colorAttachments[0].texture._texture.type,de.optional(function(){Lt.oes_texture_float?(de(kr===ln||kr===Dn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),kr===Dn&&de(nr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):de(kr===ln,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var dr=0,gr=0,Pr=Ft.framebufferWidth,ut=Ft.framebufferHeight,Gt=null;ye(Tr)?Gt=Tr:Tr&&(de.type(Tr,"object","invalid arguments to regl.read()"),dr=Tr.x|0,gr=Tr.y|0,de(dr>=0&&dr<Ft.framebufferWidth,"invalid x offset for regl.read"),de(gr>=0&&gr<Ft.framebufferHeight,"invalid y offset for regl.read"),Pr=(Tr.width||Ft.framebufferWidth-dr)|0,ut=(Tr.height||Ft.framebufferHeight-gr)|0,Gt=Tr.data||null),Gt&&(kr===ln?de(Gt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):kr===Dn&&de(Gt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),de(Pr>0&&Pr+dr<=Ft.framebufferWidth,"invalid width for read pixels"),de(ut>0&&ut+gr<=Ft.framebufferHeight,"invalid height for read pixels"),Be();var Ar=Pr*ut*4;return Gt||(kr===ln?Gt=new Uint8Array(Ar):kr===Dn&&(Gt=Gt||new Float32Array(Ar))),de.isTypedArray(Gt,"data buffer for regl.read() must be a typedarray"),de(Gt.byteLength>=Ar,"data buffer for regl.read() too small"),B.pixelStorei(Bn,4),B.readPixels(dr,gr,Pr,ut,Or,kr,Gt),Gt}function _r(Tr){var kr;return me.setFBO({framebuffer:Tr.framebuffer},function(){kr=hr(Tr)}),kr}function br(Tr){return!Tr||!("framebuffer"in Tr)?hr(Tr):_r(Tr)}return br}function Ni(B){return Array.prototype.slice.call(B)}function on(B){return Ni(B).join("")}function ni(){var B=0,me=[],Be=[];function Ft(kr){for(var dr=0;dr<Be.length;++dr)if(Be[dr]===kr)return me[dr];var gr="g"+B++;return me.push(gr),Be.push(kr),gr}function ur(){var kr=[];function dr(){kr.push.apply(kr,Ni(arguments))}var gr=[];function Pr(){var ut="v"+B++;return gr.push(ut),arguments.length>0&&(kr.push(ut,"="),kr.push.apply(kr,Ni(arguments)),kr.push(";")),ut}return m(dr,{def:Pr,toString:function(){return on([gr.length>0?"var "+gr.join(",")+";":"",on(kr)])}})}function Lt(){var kr=ur(),dr=ur(),gr=kr.toString,Pr=dr.toString;function ut(Gt,Ar){dr(Gt,Ar,"=",kr.def(Gt,Ar),";")}return m(function(){kr.apply(kr,Ni(arguments))},{def:kr.def,entry:kr,exit:dr,save:ut,set:function(Gt,Ar,Zr){ut(Gt,Ar),kr(Gt,Ar,"=",Zr,";")},toString:function(){return gr()+Pr()}})}function nr(){var kr=on(arguments),dr=Lt(),gr=Lt(),Pr=dr.toString,ut=gr.toString;return m(dr,{then:function(){return dr.apply(dr,Ni(arguments)),this},else:function(){return gr.apply(gr,Ni(arguments)),this},toString:function(){var Gt=ut();return Gt&&(Gt="else{"+Gt+"}"),on(["if(",kr,"){",Pr(),"}",Gt])}})}var hr=ur(),_r={};function br(kr,dr){var gr=[];function Pr(){var pr="a"+gr.length;return gr.push(pr),pr}dr=dr||0;for(var ut=0;ut<dr;++ut)Pr();var Gt=Lt(),Ar=Gt.toString,Zr=_r[kr]=m(Gt,{arg:Pr,toString:function(){return on(["function(",gr.join(),"){",Ar(),"}"])}});return Zr}function Tr(){var kr=['"use strict";',hr,"return {"];Object.keys(_r).forEach(function(ut){kr.push('"',ut,'":',_r[ut].toString(),",")}),kr.push("}");var dr=on(kr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),gr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Pr=gr?ue.Function.apply(null,me.concat(dr)):Function.apply(null,me.concat(dr));return Pr.apply(null,Be)}return{global:hr,link:Ft,block:ur,proc:br,scope:Lt,cond:nr,compile:Tr}}var pi="xyzw".split(""),ei=5121,Vn=1,gi=2,Kn=0,Gn=1,Mo=2,ua=3,Wo=4,to=5,ro=6,Za="dither",bs="blend.enable",Es="blend.color",Nu="blend.equation",Ss="blend.func",hu="depth.enable",Ra="depth.func",fo="depth.range",zu="depth.mask",Au="colorMask",du="cull.enable",Bc="cull.face",wu="frontFace",oc="lineWidth",Uu="polygonOffset.enable",Eo="polygonOffset.offset",Xo="sample.alpha",xl="sample.enable",bl="sample.coverage",la="stencil.enable",ts="stencil.mask",rs="stencil.func",vu="stencil.opFront",sc="stencil.opBack",uc="scissor.enable",Bl="scissor.box",Ts="viewport",Nl="profile",iu="framebuffer",Zu="vert",lc="frag",Tu="elements",zo="primitive",Hs="count",gf="offset",Mp="instances",Vf="vao",sh="Width",uh="Height",cc=iu+sh,yf=iu+uh,_f=Ts+sh,ju=Ts+uh,zl="drawingBuffer",xf=zl+sh,lh=zl+uh,Hh=[Ss,Nu,rs,vu,sc,bl,Ts,Bl,Eo],Nc=34962,Pp=34963,bd=35632,Ed=35633,Wh=3553,Ip=34067,Sd=2884,bf=3042,Cd=3024,Po=2960,zc=2929,Xh=3089,Op=32823,Rp=32926,Gf=32928,Lp=5126,Ef=35664,fc=35665,Uc=35666,Zc=5124,kp=35667,pc=35668,Dp=35669,Hf=35670,Fp=35671,Sf=35672,sl=35673,au=35674,Wf=35675,Xf=35676,Yf=35678,Cf=35680,qf=4,El=1028,jc=1029,ch=2304,Kf=2305,Yh=32775,Ad=32776,wd=519,Mu=7680,Bp=0,fh=1,Ur=32774,ul=513,qt=36160,Td=36064,Sl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Vc=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],hc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ul={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},qh={frag:bd,vert:Ed},Np={cw:ch,ccw:Kf};function dc(B){return Array.isArray(B)||ye(B)||Fs(B)}function ph(B){return B.sort(function(me,Be){return me===Ts?-1:Be===Ts?1:me<Be?-1:1})}function Sa(B,me,Be,Ft){this.thisDep=B,this.contextDep=me,this.propDep=Be,this.append=Ft}function Zl(B){return B&&!(B.thisDep||B.contextDep||B.propDep)}function Io(B){return new Sa(!1,!1,!1,B)}function Ws(B,me){var Be=B.type;if(Be===Kn){var Ft=B.data.length;return new Sa(!0,Ft>=1,Ft>=2,me)}else if(Be===Wo){var ur=B.data;return new Sa(ur.thisDep,ur.contextDep,ur.propDep,me)}else{if(Be===to)return new Sa(!1,!1,!1,me);if(Be===ro){for(var Lt=!1,nr=!1,hr=!1,_r=0;_r<B.data.length;++_r){var br=B.data[_r];if(br.type===Gn)hr=!0;else if(br.type===Mo)nr=!0;else if(br.type===ua)Lt=!0;else if(br.type===Kn){Lt=!0;var Tr=br.data;Tr>=1&&(nr=!0),Tr>=2&&(hr=!0)}else br.type===Wo&&(Lt=Lt||br.data.thisDep,nr=nr||br.data.contextDep,hr=hr||br.data.propDep)}return new Sa(Lt,nr,hr,me)}else return new Sa(Be===ua,Be===Mo,Be===Gn,me)}}var hh=new Sa(!1,!1,!1,function(){});function dh(B,me,Be,Ft,ur,Lt,nr,hr,_r,br,Tr,kr,dr,gr,Pr){var ut=br.Record,Gt={add:32774,subtract:32778,"reverse subtract":32779};Be.ext_blend_minmax&&(Gt.min=Yh,Gt.max=Ad);var Ar=Be.angle_instanced_arrays,Zr=Be.webgl_draw_buffers,pr=Be.oes_vertex_array_object,Rr={dirty:!0,profile:Pr.profile},Qr={},Nn=[],Xt={},ir={};function dn(Ce){return Ce.replace(".","_")}function Xr(Ce,ie,Ve){var ft=dn(Ce);Nn.push(Ce),Qr[ft]=Rr[ft]=!!Ve,Xt[ft]=ie}function Er(Ce,ie,Ve){var ft=dn(Ce);Nn.push(Ce),Array.isArray(Ve)?(Rr[ft]=Ve.slice(),Qr[ft]=Ve.slice()):Rr[ft]=Qr[ft]=Ve,ir[ft]=ie}Xr(Za,Cd),Xr(bs,bf),Er(Es,"blendColor",[0,0,0,0]),Er(Nu,"blendEquationSeparate",[Ur,Ur]),Er(Ss,"blendFuncSeparate",[fh,Bp,fh,Bp]),Xr(hu,zc,!0),Er(Ra,"depthFunc",ul),Er(fo,"depthRange",[0,1]),Er(zu,"depthMask",!0),Er(Au,Au,[!0,!0,!0,!0]),Xr(du,Sd),Er(Bc,"cullFace",jc),Er(wu,wu,Kf),Er(oc,oc,1),Xr(Uu,Op),Er(Eo,"polygonOffset",[0,0]),Xr(Xo,Rp),Xr(xl,Gf),Er(bl,"sampleCoverage",[1,!1]),Xr(la,Po),Er(ts,"stencilMask",-1),Er(rs,"stencilFunc",[wd,0,-1]),Er(vu,"stencilOpSeparate",[El,Mu,Mu,Mu]),Er(sc,"stencilOpSeparate",[jc,Mu,Mu,Mu]),Xr(uc,Xh),Er(Bl,"scissor",[0,0,B.drawingBufferWidth,B.drawingBufferHeight]),Er(Ts,Ts,[0,0,B.drawingBufferWidth,B.drawingBufferHeight]);var Hr={gl:B,context:dr,strings:me,next:Qr,current:Rr,draw:kr,elements:Lt,buffer:ur,shader:Tr,attributes:br.state,vao:br,uniforms:_r,framebuffer:hr,extensions:Be,timer:gr,isBufferArgs:dc},Yr={primTypes:cr,compareFuncs:hc,blendFuncs:Sl,blendEquations:Gt,stencilOps:Ul,glTypes:lu,orientationType:Np};de.optional(function(){Hr.isArrayLike=da}),Zr&&(Yr.backBuffer=[jc],Yr.drawBuffer=Ge(Ft.maxDrawbuffers,function(Ce){return Ce===0?[0]:Ge(Ce,function(ie){return Td+ie})}));var yi=0;function ai(){var Ce=ni(),ie=Ce.link,Ve=Ce.global;Ce.id=yi++,Ce.batchId="0";var ft=ie(Hr),Ot=Ce.shared={props:"a0"};Object.keys(Hr).forEach(function(Ue){Ot[Ue]=Ve.def(ft,".",Ue)}),de.optional(function(){Ce.CHECK=ie(de),Ce.commandStr=de.guessCommand(),Ce.command=ie(Ce.commandStr),Ce.assert=function(Ue,Ae,pt){Ue("if(!(",Ae,"))",this.CHECK,".commandRaise(",ie(pt),",",this.command,");")},Yr.invalidBlendCombinations=Vc});var qe=Ce.next={},Fe=Ce.current={};Object.keys(ir).forEach(function(Ue){Array.isArray(Rr[Ue])&&(qe[Ue]=Ve.def(Ot.next,".",Ue),Fe[Ue]=Ve.def(Ot.current,".",Ue))});var nt=Ce.constants={};Object.keys(Yr).forEach(function(Ue){nt[Ue]=Ve.def(JSON.stringify(Yr[Ue]))}),Ce.invoke=function(Ue,Ae){switch(Ae.type){case Kn:var pt=["this",Ot.context,Ot.props,Ce.batchId];return Ue.def(ie(Ae.data),".call(",pt.slice(0,Math.max(Ae.data.length+1,4)),")");case Gn:return Ue.def(Ot.props,Ae.data);case Mo:return Ue.def(Ot.context,Ae.data);case ua:return Ue.def("this",Ae.data);case Wo:return Ae.data.append(Ce,Ue),Ae.data.ref;case to:return Ae.data.toString();case ro:return Ae.data.map(function(_t){return Ce.invoke(Ue,_t)})}},Ce.attribCache={};var _e={};return Ce.scopeAttrib=function(Ue){var Ae=me.id(Ue);if(Ae in _e)return _e[Ae];var pt=br.scope[Ae];pt||(pt=br.scope[Ae]=new ut);var _t=_e[Ae]=ie(pt);return _t},Ce}function qr(Ce){var ie=Ce.static,Ve=Ce.dynamic,ft;if(Nl in ie){var Ot=!!ie[Nl];ft=Io(function(Fe,nt){return Ot}),ft.enable=Ot}else if(Nl in Ve){var qe=Ve[Nl];ft=Ws(qe,function(Fe,nt){return Fe.invoke(nt,qe)})}return ft}function sn(Ce,ie){var Ve=Ce.static,ft=Ce.dynamic;if(iu in Ve){var Ot=Ve[iu];return Ot?(Ot=hr.getFramebuffer(Ot),de.command(Ot,"invalid framebuffer object"),Io(function(Fe,nt){var _e=Fe.link(Ot),Ue=Fe.shared;nt.set(Ue.framebuffer,".next",_e);var Ae=Ue.context;return nt.set(Ae,"."+cc,_e+".width"),nt.set(Ae,"."+yf,_e+".height"),_e})):Io(function(Fe,nt){var _e=Fe.shared;nt.set(_e.framebuffer,".next","null");var Ue=_e.context;return nt.set(Ue,"."+cc,Ue+"."+xf),nt.set(Ue,"."+yf,Ue+"."+lh),"null"})}else if(iu in ft){var qe=ft[iu];return Ws(qe,function(Fe,nt){var _e=Fe.invoke(nt,qe),Ue=Fe.shared,Ae=Ue.framebuffer,pt=nt.def(Ae,".getFramebuffer(",_e,")");de.optional(function(){Fe.assert(nt,"!"+_e+"||"+pt,"invalid framebuffer object")}),nt.set(Ae,".next",pt);var _t=Ue.context;return nt.set(_t,"."+cc,pt+"?"+pt+".width:"+_t+"."+xf),nt.set(_t,"."+yf,pt+"?"+pt+".height:"+_t+"."+lh),pt})}else return null}function Qn(Ce,ie,Ve){var ft=Ce.static,Ot=Ce.dynamic;function qe(_e){if(_e in ft){var Ue=ft[_e];de.commandType(Ue,"object","invalid "+_e,Ve.commandStr);var Ae=!0,pt=Ue.x|0,_t=Ue.y|0,vr,jr;return"width"in Ue?(vr=Ue.width|0,de.command(vr>=0,"invalid "+_e,Ve.commandStr)):Ae=!1,"height"in Ue?(jr=Ue.height|0,de.command(jr>=0,"invalid "+_e,Ve.commandStr)):Ae=!1,new Sa(!Ae&&ie&&ie.thisDep,!Ae&&ie&&ie.contextDep,!Ae&&ie&&ie.propDep,function(Nr,Cn){var fn=Nr.shared.context,Sn=vr;"width"in Ue||(Sn=Cn.def(fn,".",cc,"-",pt));var _n=jr;return"height"in Ue||(_n=Cn.def(fn,".",yf,"-",_t)),[pt,_t,Sn,_n]})}else if(_e in Ot){var Vr=Ot[_e],nn=Ws(Vr,function(Nr,Cn){var fn=Nr.invoke(Cn,Vr);de.optional(function(){Nr.assert(Cn,fn+"&&typeof "+fn+'==="object"',"invalid "+_e)});var Sn=Nr.shared.context,_n=Cn.def(fn,".x|0"),vn=Cn.def(fn,".y|0"),Xn=Cn.def('"width" in ',fn,"?",fn,".width|0:","(",Sn,".",cc,"-",_n,")"),ya=Cn.def('"height" in ',fn,"?",fn,".height|0:","(",Sn,".",yf,"-",vn,")");return de.optional(function(){Nr.assert(Cn,Xn+">=0&&"+ya+">=0","invalid "+_e)}),[_n,vn,Xn,ya]});return ie&&(nn.thisDep=nn.thisDep||ie.thisDep,nn.contextDep=nn.contextDep||ie.contextDep,nn.propDep=nn.propDep||ie.propDep),nn}else return ie?new Sa(ie.thisDep,ie.contextDep,ie.propDep,function(Nr,Cn){var fn=Nr.shared.context;return[0,0,Cn.def(fn,".",cc),Cn.def(fn,".",yf)]}):null}var Fe=qe(Ts);if(Fe){var nt=Fe;Fe=new Sa(Fe.thisDep,Fe.contextDep,Fe.propDep,function(_e,Ue){var Ae=nt.append(_e,Ue),pt=_e.shared.context;return Ue.set(pt,"."+_f,Ae[2]),Ue.set(pt,"."+ju,Ae[3]),Ae})}return{viewport:Fe,scissor_box:qe(Bl)}}function hi(Ce,ie){var Ve=Ce.static,ft=typeof Ve[lc]=="string"&&typeof Ve[Zu]=="string";if(ft){if(Object.keys(ie.dynamic).length>0)return null;var Ot=ie.static,qe=Object.keys(Ot);if(qe.length>0&&typeof Ot[qe[0]]=="number"){for(var Fe=[],nt=0;nt<qe.length;++nt)de(typeof Ot[qe[nt]]=="number","must specify all vertex attribute locations when using vaos"),Fe.push([Ot[qe[nt]]|0,qe[nt]]);return Fe}}return null}function zi(Ce,ie,Ve){var ft=Ce.static,Ot=Ce.dynamic;function qe(Ae){if(Ae in ft){var pt=me.id(ft[Ae]);de.optional(function(){Tr.shader(qh[Ae],pt,de.guessCommand())});var _t=Io(function(){return pt});return _t.id=pt,_t}else if(Ae in Ot){var vr=Ot[Ae];return Ws(vr,function(jr,Vr){var nn=jr.invoke(Vr,vr),Nr=Vr.def(jr.shared.strings,".id(",nn,")");return de.optional(function(){Vr(jr.shared.shader,".shader(",qh[Ae],",",Nr,",",jr.command,");")}),Nr})}return null}var Fe=qe(lc),nt=qe(Zu),_e=null,Ue;return Zl(Fe)&&Zl(nt)?(_e=Tr.program(nt.id,Fe.id,null,Ve),Ue=Io(function(Ae,pt){return Ae.link(_e)})):Ue=new Sa(Fe&&Fe.thisDep||nt&&nt.thisDep,Fe&&Fe.contextDep||nt&&nt.contextDep,Fe&&Fe.propDep||nt&&nt.propDep,function(Ae,pt){var _t=Ae.shared.shader,vr;Fe?vr=Fe.append(Ae,pt):vr=pt.def(_t,".",lc);var jr;nt?jr=nt.append(Ae,pt):jr=pt.def(_t,".",Zu);var Vr=_t+".program("+jr+","+vr;return de.optional(function(){Vr+=","+Ae.command}),pt.def(Vr+")")}),{frag:Fe,vert:nt,progVar:Ue,program:_e}}function po(Ce,ie){var Ve=Ce.static,ft=Ce.dynamic,Ot={},qe=!1;function Fe(){if(Vf in Ve){var Cn=Ve[Vf];return Cn!==null&&br.getVAO(Cn)===null&&(Cn=br.createVAO(Cn)),qe=!0,Ot.vao=Cn,Io(function(Sn){var _n=br.getVAO(Cn);return _n?Sn.link(_n):"null"})}else if(Vf in ft){qe=!0;var fn=ft[Vf];return Ws(fn,function(Sn,_n){var vn=Sn.invoke(_n,fn);return _n.def(Sn.shared.vao+".getVAO("+vn+")")})}return null}var nt=Fe(),_e=!1;function Ue(){if(Tu in Ve){var Cn=Ve[Tu];if(Ot.elements=Cn,dc(Cn)){var fn=Ot.elements=Lt.create(Cn,!0);Cn=Lt.getElements(fn),_e=!0}else Cn&&(Cn=Lt.getElements(Cn),_e=!0,de.command(Cn,"invalid elements",ie.commandStr));var Sn=Io(function(vn,Xn){if(Cn){var ya=vn.link(Cn);return vn.ELEMENTS=ya,ya}return vn.ELEMENTS=null,null});return Sn.value=Cn,Sn}else if(Tu in ft){_e=!0;var _n=ft[Tu];return Ws(_n,function(vn,Xn){var ya=vn.shared,fs=ya.isBufferArgs,ja=ya.elements,_a=vn.invoke(Xn,_n),fi=Xn.def("null"),Hn=Xn.def(fs,"(",_a,")"),Vu=vn.cond(Hn).then(fi,"=",ja,".createStream(",_a,");").else(fi,"=",ja,".getElements(",_a,");");return de.optional(function(){vn.assert(Vu.else,"!"+_a+"||"+fi,"invalid elements")}),Xn.entry(Vu),Xn.exit(vn.cond(Hn).then(ja,".destroyStream(",fi,");")),vn.ELEMENTS=fi,fi})}else if(qe)return new Sa(nt.thisDep,nt.contextDep,nt.propDep,function(vn,Xn){return Xn.def(vn.shared.vao+".currentVAO?"+vn.shared.elements+".getElements("+vn.shared.vao+".currentVAO.elements):null")});return null}var Ae=Ue();function pt(){if(zo in Ve){var Cn=Ve[zo];return Ot.primitive=Cn,de.commandParameter(Cn,cr,"invalid primitve",ie.commandStr),Io(function(Sn,_n){return cr[Cn]})}else if(zo in ft){var fn=ft[zo];return Ws(fn,function(Sn,_n){var vn=Sn.constants.primTypes,Xn=Sn.invoke(_n,fn);return de.optional(function(){Sn.assert(_n,Xn+" in "+vn,"invalid primitive, must be one of "+Object.keys(cr))}),_n.def(vn,"[",Xn,"]")})}else{if(_e)return Zl(Ae)?Ae.value?Io(function(Sn,_n){return _n.def(Sn.ELEMENTS,".primType")}):Io(function(){return qf}):new Sa(Ae.thisDep,Ae.contextDep,Ae.propDep,function(Sn,_n){var vn=Sn.ELEMENTS;return _n.def(vn,"?",vn,".primType:",qf)});if(qe)return new Sa(nt.thisDep,nt.contextDep,nt.propDep,function(Sn,_n){return _n.def(Sn.shared.vao+".currentVAO?"+Sn.shared.vao+".currentVAO.primitive:"+qf)})}return null}function _t(Cn,fn){if(Cn in Ve){var Sn=Ve[Cn]|0;return fn?Ot.offset=Sn:Ot.instances=Sn,de.command(!fn||Sn>=0,"invalid "+Cn,ie.commandStr),Io(function(vn,Xn){return fn&&(vn.OFFSET=Sn),Sn})}else if(Cn in ft){var _n=ft[Cn];return Ws(_n,function(vn,Xn){var ya=vn.invoke(Xn,_n);return fn&&(vn.OFFSET=ya,de.optional(function(){vn.assert(Xn,ya+">=0","invalid "+Cn)})),ya})}else if(fn){if(_e)return Io(function(vn,Xn){return vn.OFFSET=0,0});if(qe)return new Sa(nt.thisDep,nt.contextDep,nt.propDep,function(vn,Xn){return Xn.def(vn.shared.vao+".currentVAO?"+vn.shared.vao+".currentVAO.offset:0")})}else if(qe)return new Sa(nt.thisDep,nt.contextDep,nt.propDep,function(vn,Xn){return Xn.def(vn.shared.vao+".currentVAO?"+vn.shared.vao+".currentVAO.instances:-1")});return null}var vr=_t(gf,!0);function jr(){if(Hs in Ve){var Cn=Ve[Hs]|0;return Ot.count=Cn,de.command(typeof Cn=="number"&&Cn>=0,"invalid vertex count",ie.commandStr),Io(function(){return Cn})}else if(Hs in ft){var fn=ft[Hs];return Ws(fn,function(Xn,ya){var fs=Xn.invoke(ya,fn);return de.optional(function(){Xn.assert(ya,"typeof "+fs+'==="number"&&'+fs+">=0&&"+fs+"===("+fs+"|0)","invalid vertex count")}),fs})}else if(_e)if(Zl(Ae)){if(Ae)return vr?new Sa(vr.thisDep,vr.contextDep,vr.propDep,function(Xn,ya){var fs=ya.def(Xn.ELEMENTS,".vertCount-",Xn.OFFSET);return de.optional(function(){Xn.assert(ya,fs+">=0","invalid vertex offset/element buffer too small")}),fs}):Io(function(Xn,ya){return ya.def(Xn.ELEMENTS,".vertCount")});var Sn=Io(function(){return-1});return de.optional(function(){Sn.MISSING=!0}),Sn}else{var _n=new Sa(Ae.thisDep||vr.thisDep,Ae.contextDep||vr.contextDep,Ae.propDep||vr.propDep,function(Xn,ya){var fs=Xn.ELEMENTS;return Xn.OFFSET?ya.def(fs,"?",fs,".vertCount-",Xn.OFFSET,":-1"):ya.def(fs,"?",fs,".vertCount:-1")});return de.optional(function(){_n.DYNAMIC=!0}),_n}else if(qe){var vn=new Sa(nt.thisDep,nt.contextDep,nt.propDep,function(Xn,ya){return ya.def(Xn.shared.vao,".currentVAO?",Xn.shared.vao,".currentVAO.count:-1")});return vn}return null}var Vr=pt(),nn=jr(),Nr=_t(Mp,!1);return{elements:Ae,primitive:Vr,count:nn,instances:Nr,offset:vr,vao:nt,vaoActive:qe,elementsActive:_e,static:Ot}}function go(Ce,ie){var Ve=Ce.static,ft=Ce.dynamic,Ot={};return Nn.forEach(function(qe){var Fe=dn(qe);function nt(_e,Ue){if(qe in Ve){var Ae=_e(Ve[qe]);Ot[Fe]=Io(function(){return Ae})}else if(qe in ft){var pt=ft[qe];Ot[Fe]=Ws(pt,function(_t,vr){return Ue(_t,vr,_t.invoke(vr,pt))})}}switch(qe){case du:case bs:case Za:case la:case hu:case uc:case Uu:case Xo:case xl:case zu:return nt(function(_e){return de.commandType(_e,"boolean",qe,ie.commandStr),_e},function(_e,Ue,Ae){return de.optional(function(){_e.assert(Ue,"typeof "+Ae+'==="boolean"',"invalid flag "+qe,_e.commandStr)}),Ae});case Ra:return nt(function(_e){return de.commandParameter(_e,hc,"invalid "+qe,ie.commandStr),hc[_e]},function(_e,Ue,Ae){var pt=_e.constants.compareFuncs;return de.optional(function(){_e.assert(Ue,Ae+" in "+pt,"invalid "+qe+", must be one of "+Object.keys(hc))}),Ue.def(pt,"[",Ae,"]")});case fo:return nt(function(_e){return de.command(da(_e)&&_e.length===2&&typeof _e[0]=="number"&&typeof _e[1]=="number"&&_e[0]<=_e[1],"depth range is 2d array",ie.commandStr),_e},function(_e,Ue,Ae){de.optional(function(){_e.assert(Ue,_e.shared.isArrayLike+"("+Ae+")&&"+Ae+".length===2&&typeof "+Ae+'[0]==="number"&&typeof '+Ae+'[1]==="number"&&'+Ae+"[0]<="+Ae+"[1]","depth range must be a 2d array")});var pt=Ue.def("+",Ae,"[0]"),_t=Ue.def("+",Ae,"[1]");return[pt,_t]});case Ss:return nt(function(_e){de.commandType(_e,"object","blend.func",ie.commandStr);var Ue="srcRGB"in _e?_e.srcRGB:_e.src,Ae="srcAlpha"in _e?_e.srcAlpha:_e.src,pt="dstRGB"in _e?_e.dstRGB:_e.dst,_t="dstAlpha"in _e?_e.dstAlpha:_e.dst;return de.commandParameter(Ue,Sl,Fe+".srcRGB",ie.commandStr),de.commandParameter(Ae,Sl,Fe+".srcAlpha",ie.commandStr),de.commandParameter(pt,Sl,Fe+".dstRGB",ie.commandStr),de.commandParameter(_t,Sl,Fe+".dstAlpha",ie.commandStr),de.command(Vc.indexOf(Ue+", "+pt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Ue+", "+pt+")",ie.commandStr),[Sl[Ue],Sl[pt],Sl[Ae],Sl[_t]]},function(_e,Ue,Ae){var pt=_e.constants.blendFuncs;de.optional(function(){_e.assert(Ue,Ae+"&&typeof "+Ae+'==="object"',"invalid blend func, must be an object")});function _t(fn,Sn){var _n=Ue.def('"',fn,Sn,'" in ',Ae,"?",Ae,".",fn,Sn,":",Ae,".",fn);return de.optional(function(){_e.assert(Ue,_n+" in "+pt,"invalid "+qe+"."+fn+Sn+", must be one of "+Object.keys(Sl))}),_n}var vr=_t("src","RGB"),jr=_t("dst","RGB");de.optional(function(){var fn=_e.constants.invalidBlendCombinations;_e.assert(Ue,fn+".indexOf("+vr+'+", "+'+jr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Vr=Ue.def(pt,"[",vr,"]"),nn=Ue.def(pt,"[",_t("src","Alpha"),"]"),Nr=Ue.def(pt,"[",jr,"]"),Cn=Ue.def(pt,"[",_t("dst","Alpha"),"]");return[Vr,Nr,nn,Cn]});case Nu:return nt(function(_e){if(typeof _e=="string")return de.commandParameter(_e,Gt,"invalid "+qe,ie.commandStr),[Gt[_e],Gt[_e]];if(typeof _e=="object")return de.commandParameter(_e.rgb,Gt,qe+".rgb",ie.commandStr),de.commandParameter(_e.alpha,Gt,qe+".alpha",ie.commandStr),[Gt[_e.rgb],Gt[_e.alpha]];de.commandRaise("invalid blend.equation",ie.commandStr)},function(_e,Ue,Ae){var pt=_e.constants.blendEquations,_t=Ue.def(),vr=Ue.def(),jr=_e.cond("typeof ",Ae,'==="string"');return de.optional(function(){function Vr(nn,Nr,Cn){_e.assert(nn,Cn+" in "+pt,"invalid "+Nr+", must be one of "+Object.keys(Gt))}Vr(jr.then,qe,Ae),_e.assert(jr.else,Ae+"&&typeof "+Ae+'==="object"',"invalid "+qe),Vr(jr.else,qe+".rgb",Ae+".rgb"),Vr(jr.else,qe+".alpha",Ae+".alpha")}),jr.then(_t,"=",vr,"=",pt,"[",Ae,"];"),jr.else(_t,"=",pt,"[",Ae,".rgb];",vr,"=",pt,"[",Ae,".alpha];"),Ue(jr),[_t,vr]});case Es:return nt(function(_e){return de.command(da(_e)&&_e.length===4,"blend.color must be a 4d array",ie.commandStr),Ge(4,function(Ue){return+_e[Ue]})},function(_e,Ue,Ae){return de.optional(function(){_e.assert(Ue,_e.shared.isArrayLike+"("+Ae+")&&"+Ae+".length===4","blend.color must be a 4d array")}),Ge(4,function(pt){return Ue.def("+",Ae,"[",pt,"]")})});case ts:return nt(function(_e){return de.commandType(_e,"number",Fe,ie.commandStr),_e|0},function(_e,Ue,Ae){return de.optional(function(){_e.assert(Ue,"typeof "+Ae+'==="number"',"invalid stencil.mask")}),Ue.def(Ae,"|0")});case rs:return nt(function(_e){de.commandType(_e,"object",Fe,ie.commandStr);var Ue=_e.cmp||"keep",Ae=_e.ref||0,pt="mask"in _e?_e.mask:-1;return de.commandParameter(Ue,hc,qe+".cmp",ie.commandStr),de.commandType(Ae,"number",qe+".ref",ie.commandStr),de.commandType(pt,"number",qe+".mask",ie.commandStr),[hc[Ue],Ae,pt]},function(_e,Ue,Ae){var pt=_e.constants.compareFuncs;de.optional(function(){function Vr(){_e.assert(Ue,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Vr(Ae+"&&typeof ",Ae,'==="object"'),Vr('!("cmp" in ',Ae,")||(",Ae,".cmp in ",pt,")")});var _t=Ue.def('"cmp" in ',Ae,"?",pt,"[",Ae,".cmp]",":",Mu),vr=Ue.def(Ae,".ref|0"),jr=Ue.def('"mask" in ',Ae,"?",Ae,".mask|0:-1");return[_t,vr,jr]});case vu:case sc:return nt(function(_e){de.commandType(_e,"object",Fe,ie.commandStr);var Ue=_e.fail||"keep",Ae=_e.zfail||"keep",pt=_e.zpass||"keep";return de.commandParameter(Ue,Ul,qe+".fail",ie.commandStr),de.commandParameter(Ae,Ul,qe+".zfail",ie.commandStr),de.commandParameter(pt,Ul,qe+".zpass",ie.commandStr),[qe===sc?jc:El,Ul[Ue],Ul[Ae],Ul[pt]]},function(_e,Ue,Ae){var pt=_e.constants.stencilOps;de.optional(function(){_e.assert(Ue,Ae+"&&typeof "+Ae+'==="object"',"invalid "+qe)});function _t(vr){return de.optional(function(){_e.assert(Ue,'!("'+vr+'" in '+Ae+")||("+Ae+"."+vr+" in "+pt+")","invalid "+qe+"."+vr+", must be one of "+Object.keys(Ul))}),Ue.def('"',vr,'" in ',Ae,"?",pt,"[",Ae,".",vr,"]:",Mu)}return[qe===sc?jc:El,_t("fail"),_t("zfail"),_t("zpass")]});case Eo:return nt(function(_e){de.commandType(_e,"object",Fe,ie.commandStr);var Ue=_e.factor|0,Ae=_e.units|0;return de.commandType(Ue,"number",Fe+".factor",ie.commandStr),de.commandType(Ae,"number",Fe+".units",ie.commandStr),[Ue,Ae]},function(_e,Ue,Ae){de.optional(function(){_e.assert(Ue,Ae+"&&typeof "+Ae+'==="object"',"invalid "+qe)});var pt=Ue.def(Ae,".factor|0"),_t=Ue.def(Ae,".units|0");return[pt,_t]});case Bc:return nt(function(_e){var Ue=0;return _e==="front"?Ue=El:_e==="back"&&(Ue=jc),de.command(!!Ue,Fe,ie.commandStr),Ue},function(_e,Ue,Ae){return de.optional(function(){_e.assert(Ue,Ae+'==="front"||'+Ae+'==="back"',"invalid cull.face")}),Ue.def(Ae,'==="front"?',El,":",jc)});case oc:return nt(function(_e){return de.command(typeof _e=="number"&&_e>=Ft.lineWidthDims[0]&&_e<=Ft.lineWidthDims[1],"invalid line width, must be a positive number between "+Ft.lineWidthDims[0]+" and "+Ft.lineWidthDims[1],ie.commandStr),_e},function(_e,Ue,Ae){return de.optional(function(){_e.assert(Ue,"typeof "+Ae+'==="number"&&'+Ae+">="+Ft.lineWidthDims[0]+"&&"+Ae+"<="+Ft.lineWidthDims[1],"invalid line width")}),Ae});case wu:return nt(function(_e){return de.commandParameter(_e,Np,Fe,ie.commandStr),Np[_e]},function(_e,Ue,Ae){return de.optional(function(){_e.assert(Ue,Ae+'==="cw"||'+Ae+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Ue.def(Ae+'==="cw"?'+ch+":"+Kf)});case Au:return nt(function(_e){return de.command(da(_e)&&_e.length===4,"color.mask must be length 4 array",ie.commandStr),_e.map(function(Ue){return!!Ue})},function(_e,Ue,Ae){return de.optional(function(){_e.assert(Ue,_e.shared.isArrayLike+"("+Ae+")&&"+Ae+".length===4","invalid color.mask")}),Ge(4,function(pt){return"!!"+Ae+"["+pt+"]"})});case bl:return nt(function(_e){de.command(typeof _e=="object"&&_e,Fe,ie.commandStr);var Ue="value"in _e?_e.value:1,Ae=!!_e.invert;return de.command(typeof Ue=="number"&&Ue>=0&&Ue<=1,"sample.coverage.value must be a number between 0 and 1",ie.commandStr),[Ue,Ae]},function(_e,Ue,Ae){de.optional(function(){_e.assert(Ue,Ae+"&&typeof "+Ae+'==="object"',"invalid sample.coverage")});var pt=Ue.def('"value" in ',Ae,"?+",Ae,".value:1"),_t=Ue.def("!!",Ae,".invert");return[pt,_t]})}}),Ot}function Di(Ce,ie){var Ve=Ce.static,ft=Ce.dynamic,Ot={};return Object.keys(Ve).forEach(function(qe){var Fe=Ve[qe],nt;if(typeof Fe=="number"||typeof Fe=="boolean")nt=Io(function(){return Fe});else if(typeof Fe=="function"){var _e=Fe._reglType;_e==="texture2d"||_e==="textureCube"?nt=Io(function(Ue){return Ue.link(Fe)}):_e==="framebuffer"||_e==="framebufferCube"?(de.command(Fe.color.length>0,'missing color attachment for framebuffer sent to uniform "'+qe+'"',ie.commandStr),nt=Io(function(Ue){return Ue.link(Fe.color[0])})):de.commandRaise('invalid data for uniform "'+qe+'"',ie.commandStr)}else da(Fe)?nt=Io(function(Ue){var Ae=Ue.global.def("[",Ge(Fe.length,function(pt){return de.command(typeof Fe[pt]=="number"||typeof Fe[pt]=="boolean","invalid uniform "+qe,Ue.commandStr),Fe[pt]}),"]");return Ae}):de.commandRaise('invalid or missing data for uniform "'+qe+'"',ie.commandStr);nt.value=Fe,Ot[qe]=nt}),Object.keys(ft).forEach(function(qe){var Fe=ft[qe];Ot[qe]=Ws(Fe,function(nt,_e){return nt.invoke(_e,Fe)})}),Ot}function us(Ce,ie){var Ve=Ce.static,ft=Ce.dynamic,Ot={};return Object.keys(Ve).forEach(function(qe){var Fe=Ve[qe],nt=me.id(qe),_e=new ut;if(dc(Fe))_e.state=Vn,_e.buffer=ur.getBuffer(ur.create(Fe,Nc,!1,!0)),_e.type=0;else{var Ue=ur.getBuffer(Fe);if(Ue)_e.state=Vn,_e.buffer=Ue,_e.type=0;else if(de.command(typeof Fe=="object"&&Fe,"invalid data for attribute "+qe,ie.commandStr),"constant"in Fe){var Ae=Fe.constant;_e.buffer="null",_e.state=gi,typeof Ae=="number"?_e.x=Ae:(de.command(da(Ae)&&Ae.length>0&&Ae.length<=4,"invalid constant for attribute "+qe,ie.commandStr),pi.forEach(function(Nr,Cn){Cn<Ae.length&&(_e[Nr]=Ae[Cn])}))}else{dc(Fe.buffer)?Ue=ur.getBuffer(ur.create(Fe.buffer,Nc,!1,!0)):Ue=ur.getBuffer(Fe.buffer),de.command(!!Ue,'missing buffer for attribute "'+qe+'"',ie.commandStr);var pt=Fe.offset|0;de.command(pt>=0,'invalid offset for attribute "'+qe+'"',ie.commandStr);var _t=Fe.stride|0;de.command(_t>=0&&_t<256,'invalid stride for attribute "'+qe+'", must be integer betweeen [0, 255]',ie.commandStr);var vr=Fe.size|0;de.command(!("size"in Fe)||vr>0&&vr<=4,'invalid size for attribute "'+qe+'", must be 1,2,3,4',ie.commandStr);var jr=!!Fe.normalized,Vr=0;"type"in Fe&&(de.commandParameter(Fe.type,lu,"invalid type for attribute "+qe,ie.commandStr),Vr=lu[Fe.type]);var nn=Fe.divisor|0;de.optional(function(){"divisor"in Fe&&(de.command(nn===0||Ar,'cannot specify divisor for attribute "'+qe+'", instancing not supported',ie.commandStr),de.command(nn>=0,'invalid divisor for attribute "'+qe+'"',ie.commandStr));var Nr=ie.commandStr,Cn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Fe).forEach(function(fn){de.command(Cn.indexOf(fn)>=0,'unknown parameter "'+fn+'" for attribute pointer "'+qe+'" (valid parameters are '+Cn+")",Nr)})}),_e.buffer=Ue,_e.state=Vn,_e.size=vr,_e.normalized=jr,_e.type=Vr||Ue.dtype,_e.offset=pt,_e.stride=_t,_e.divisor=nn}}Ot[qe]=Io(function(Nr,Cn){var fn=Nr.attribCache;if(nt in fn)return fn[nt];var Sn={isStream:!1};return Object.keys(_e).forEach(function(_n){Sn[_n]=_e[_n]}),_e.buffer&&(Sn.buffer=Nr.link(_e.buffer),Sn.type=Sn.type||Sn.buffer+".dtype"),fn[nt]=Sn,Sn})}),Object.keys(ft).forEach(function(qe){var Fe=ft[qe];function nt(_e,Ue){var Ae=_e.invoke(Ue,Fe),pt=_e.shared,_t=_e.constants,vr=pt.isBufferArgs,jr=pt.buffer;de.optional(function(){_e.assert(Ue,Ae+"&&(typeof "+Ae+'==="object"||typeof '+Ae+'==="function")&&('+vr+"("+Ae+")||"+jr+".getBuffer("+Ae+")||"+jr+".getBuffer("+Ae+".buffer)||"+vr+"("+Ae+'.buffer)||("constant" in '+Ae+"&&(typeof "+Ae+'.constant==="number"||'+pt.isArrayLike+"("+Ae+".constant))))",'invalid dynamic attribute "'+qe+'"')});var Vr={isStream:Ue.def(!1)},nn=new ut;nn.state=Vn,Object.keys(nn).forEach(function(Sn){Vr[Sn]=Ue.def(""+nn[Sn])});var Nr=Vr.buffer,Cn=Vr.type;Ue("if(",vr,"(",Ae,")){",Vr.isStream,"=true;",Nr,"=",jr,".createStream(",Nc,",",Ae,");",Cn,"=",Nr,".dtype;","}else{",Nr,"=",jr,".getBuffer(",Ae,");","if(",Nr,"){",Cn,"=",Nr,".dtype;",'}else if("constant" in ',Ae,"){",Vr.state,"=",gi,";","if(typeof "+Ae+'.constant === "number"){',Vr[pi[0]],"=",Ae,".constant;",pi.slice(1).map(function(Sn){return Vr[Sn]}).join("="),"=0;","}else{",pi.map(function(Sn,_n){return Vr[Sn]+"="+Ae+".constant.length>"+_n+"?"+Ae+".constant["+_n+"]:0;"}).join(""),"}}else{","if(",vr,"(",Ae,".buffer)){",Nr,"=",jr,".createStream(",Nc,",",Ae,".buffer);","}else{",Nr,"=",jr,".getBuffer(",Ae,".buffer);","}",Cn,'="type" in ',Ae,"?",_t.glTypes,"[",Ae,".type]:",Nr,".dtype;",Vr.normalized,"=!!",Ae,".normalized;");function fn(Sn){Ue(Vr[Sn],"=",Ae,".",Sn,"|0;")}return fn("size"),fn("offset"),fn("stride"),fn("divisor"),Ue("}}"),Ue.exit("if(",Vr.isStream,"){",jr,".destroyStream(",Nr,");","}"),Vr}Ot[qe]=Ws(Fe,nt)}),Ot}function Ka(Ce){var ie=Ce.static,Ve=Ce.dynamic,ft={};return Object.keys(ie).forEach(function(Ot){var qe=ie[Ot];ft[Ot]=Io(function(Fe,nt){return typeof qe=="number"||typeof qe=="boolean"?""+qe:Fe.link(qe)})}),Object.keys(Ve).forEach(function(Ot){var qe=Ve[Ot];ft[Ot]=Ws(qe,function(Fe,nt){return Fe.invoke(nt,qe)})}),ft}function ns(Ce,ie,Ve,ft,Ot){var qe=Ce.static,Fe=Ce.dynamic;de.optional(function(){var fn=[iu,Zu,lc,Tu,zo,gf,Hs,Mp,Nl,Vf].concat(Nn);function Sn(_n){Object.keys(_n).forEach(function(vn){de.command(fn.indexOf(vn)>=0,'unknown parameter "'+vn+'"',Ot.commandStr)})}Sn(qe),Sn(Fe)});var nt=hi(Ce,ie),_e=sn(Ce,Ot),Ue=Qn(Ce,_e,Ot),Ae=po(Ce,Ot),pt=go(Ce,Ot),_t=zi(Ce,Ot,nt);function vr(fn){var Sn=Ue[fn];Sn&&(pt[fn]=Sn)}vr(Ts),vr(dn(Bl));var jr=Object.keys(pt).length>0,Vr={framebuffer:_e,draw:Ae,shader:_t,state:pt,dirty:jr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Vr.profile=qr(Ce,Ot),Vr.uniforms=Di(Ve,Ot),Vr.drawVAO=Vr.scopeVAO=Ae.vao,!Vr.drawVAO&&_t.program&&!nt&&Be.angle_instanced_arrays&&Ae.static.elements){var nn=!0,Nr=_t.program.attributes.map(function(fn){var Sn=ie.static[fn];return nn=nn&&!!Sn,Sn});if(nn&&Nr.length>0){var Cn=br.getVAO(br.createVAO({attributes:Nr,elements:Ae.static.elements}));Vr.drawVAO=new Sa(null,null,null,function(fn,Sn){return fn.link(Cn)}),Vr.useVAO=!0}}return nt?Vr.useVAO=!0:Vr.attributes=us(ie,Ot),Vr.context=Ka(ft,Ot),Vr}function Oo(Ce,ie,Ve){var ft=Ce.shared,Ot=ft.context,qe=Ce.scope();Object.keys(Ve).forEach(function(Fe){ie.save(Ot,"."+Fe);var nt=Ve[Fe],_e=nt.append(Ce,ie);Array.isArray(_e)?qe(Ot,".",Fe,"=[",_e.join(),"];"):qe(Ot,".",Fe,"=",_e,";")}),ie(qe)}function is(Ce,ie,Ve,ft){var Ot=Ce.shared,qe=Ot.gl,Fe=Ot.framebuffer,nt;Zr&&(nt=ie.def(Ot.extensions,".webgl_draw_buffers"));var _e=Ce.constants,Ue=_e.drawBuffer,Ae=_e.backBuffer,pt;Ve?pt=Ve.append(Ce,ie):pt=ie.def(Fe,".next"),ft||ie("if(",pt,"!==",Fe,".cur){"),ie("if(",pt,"){",qe,".bindFramebuffer(",qt,",",pt,".framebuffer);"),Zr&&ie(nt,".drawBuffersWEBGL(",Ue,"[",pt,".colorAttachments.length]);"),ie("}else{",qe,".bindFramebuffer(",qt,",null);"),Zr&&ie(nt,".drawBuffersWEBGL(",Ae,");"),ie("}",Fe,".cur=",pt,";"),ft||ie("}")}function Uo(Ce,ie,Ve){var ft=Ce.shared,Ot=ft.gl,qe=Ce.current,Fe=Ce.next,nt=ft.current,_e=ft.next,Ue=Ce.cond(nt,".dirty");Nn.forEach(function(Ae){var pt=dn(Ae);if(!(pt in Ve.state)){var _t,vr;if(pt in Fe){_t=Fe[pt],vr=qe[pt];var jr=Ge(Rr[pt].length,function(nn){return Ue.def(_t,"[",nn,"]")});Ue(Ce.cond(jr.map(function(nn,Nr){return nn+"!=="+vr+"["+Nr+"]"}).join("||")).then(Ot,".",ir[pt],"(",jr,");",jr.map(function(nn,Nr){return vr+"["+Nr+"]="+nn}).join(";"),";"))}else{_t=Ue.def(_e,".",pt);var Vr=Ce.cond(_t,"!==",nt,".",pt);Ue(Vr),pt in Xt?Vr(Ce.cond(_t).then(Ot,".enable(",Xt[pt],");").else(Ot,".disable(",Xt[pt],");"),nt,".",pt,"=",_t,";"):Vr(Ot,".",ir[pt],"(",_t,");",nt,".",pt,"=",_t,";")}}}),Object.keys(Ve.state).length===0&&Ue(nt,".dirty=false;"),ie(Ue)}function ls(Ce,ie,Ve,ft){var Ot=Ce.shared,qe=Ce.current,Fe=Ot.current,nt=Ot.gl;ph(Object.keys(Ve)).forEach(function(_e){var Ue=Ve[_e];if(!(ft&&!ft(Ue))){var Ae=Ue.append(Ce,ie);if(Xt[_e]){var pt=Xt[_e];Zl(Ue)?Ae?ie(nt,".enable(",pt,");"):ie(nt,".disable(",pt,");"):ie(Ce.cond(Ae).then(nt,".enable(",pt,");").else(nt,".disable(",pt,");")),ie(Fe,".",_e,"=",Ae,";")}else if(da(Ae)){var _t=qe[_e];ie(nt,".",ir[_e],"(",Ae,");",Ae.map(function(vr,jr){return _t+"["+jr+"]="+vr}).join(";"),";")}else ie(nt,".",ir[_e],"(",Ae,");",Fe,".",_e,"=",Ae,";")}})}function yo(Ce,ie){Ar&&(Ce.instancing=ie.def(Ce.shared.extensions,".angle_instanced_arrays"))}function _i(Ce,ie,Ve,ft,Ot){var qe=Ce.shared,Fe=Ce.stats,nt=qe.current,_e=qe.timer,Ue=Ve.profile;function Ae(){var fn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return fn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var pt,_t;function vr(fn){pt=ie.def(),fn(pt,"=",Ae(),";"),typeof Ot=="string"?fn(Fe,".count+=",Ot,";"):fn(Fe,".count++;"),gr&&(ft?(_t=ie.def(),fn(_t,"=",_e,".getNumPendingQueries();")):fn(_e,".beginQuery(",Fe,");"))}function jr(fn){fn(Fe,".cpuTime+=",Ae(),"-",pt,";"),gr&&(ft?fn(_e,".pushScopeStats(",_t,",",_e,".getNumPendingQueries(),",Fe,");"):fn(_e,".endQuery();"))}function Vr(fn){var Sn=ie.def(nt,".profile");ie(nt,".profile=",fn,";"),ie.exit(nt,".profile=",Sn,";")}var nn;if(Ue){if(Zl(Ue)){Ue.enable?(vr(ie),jr(ie.exit),Vr("true")):Vr("false");return}nn=Ue.append(Ce,ie),Vr(nn)}else nn=ie.def(nt,".profile");var Nr=Ce.block();vr(Nr),ie("if(",nn,"){",Nr,"}");var Cn=Ce.block();jr(Cn),ie.exit("if(",nn,"){",Cn,"}")}function Zo(Ce,ie,Ve,ft,Ot){var qe=Ce.shared;function Fe(_e){switch(_e){case Ef:case kp:case Fp:return 2;case fc:case pc:case Sf:return 3;case Uc:case Dp:case sl:return 4;default:return 1}}function nt(_e,Ue,Ae){var pt=qe.gl,_t=ie.def(_e,".location"),vr=ie.def(qe.attributes,"[",_t,"]"),jr=Ae.state,Vr=Ae.buffer,nn=[Ae.x,Ae.y,Ae.z,Ae.w],Nr=["buffer","normalized","offset","stride"];function Cn(){ie("if(!",vr,".buffer){",pt,".enableVertexAttribArray(",_t,");}");var Sn=Ae.type,_n;if(Ae.size?_n=ie.def(Ae.size,"||",Ue):_n=Ue,ie("if(",vr,".type!==",Sn,"||",vr,".size!==",_n,"||",Nr.map(function(Xn){return vr+"."+Xn+"!=="+Ae[Xn]}).join("||"),"){",pt,".bindBuffer(",Nc,",",Vr,".buffer);",pt,".vertexAttribPointer(",[_t,_n,Sn,Ae.normalized,Ae.stride,Ae.offset],");",vr,".type=",Sn,";",vr,".size=",_n,";",Nr.map(function(Xn){return vr+"."+Xn+"="+Ae[Xn]+";"}).join(""),"}"),Ar){var vn=Ae.divisor;ie("if(",vr,".divisor!==",vn,"){",Ce.instancing,".vertexAttribDivisorANGLE(",[_t,vn],");",vr,".divisor=",vn,";}")}}function fn(){ie("if(",vr,".buffer){",pt,".disableVertexAttribArray(",_t,");",vr,".buffer=null;","}if(",pi.map(function(Sn,_n){return vr+"."+Sn+"!=="+nn[_n]}).join("||"),"){",pt,".vertexAttrib4f(",_t,",",nn,");",pi.map(function(Sn,_n){return vr+"."+Sn+"="+nn[_n]+";"}).join(""),"}")}jr===Vn?Cn():jr===gi?fn():(ie("if(",jr,"===",Vn,"){"),Cn(),ie("}else{"),fn(),ie("}"))}ft.forEach(function(_e){var Ue=_e.name,Ae=Ve.attributes[Ue],pt;if(Ae){if(!Ot(Ae))return;pt=Ae.append(Ce,ie)}else{if(!Ot(hh))return;var _t=Ce.scopeAttrib(Ue);de.optional(function(){Ce.assert(ie,_t+".state","missing attribute "+Ue)}),pt={},Object.keys(new ut).forEach(function(vr){pt[vr]=ie.def(_t,".",vr)})}nt(Ce.link(_e),Fe(_e.info.type),pt)})}function ra(Ce,ie,Ve,ft,Ot,qe){for(var Fe=Ce.shared,nt=Fe.gl,_e,Ue=0;Ue<ft.length;++Ue){var Ae=ft[Ue],pt=Ae.name,_t=Ae.info.type,vr=Ve.uniforms[pt],jr=Ce.link(Ae),Vr=jr+".location",nn;if(vr){if(!Ot(vr))continue;if(Zl(vr)){var Nr=vr.value;if(de.command(Nr!==null&&typeof Nr!="undefined",'missing uniform "'+pt+'"',Ce.commandStr),_t===Yf||_t===Cf){de.command(typeof Nr=="function"&&(_t===Yf&&(Nr._reglType==="texture2d"||Nr._reglType==="framebuffer")||_t===Cf&&(Nr._reglType==="textureCube"||Nr._reglType==="framebufferCube")),"invalid texture for uniform "+pt,Ce.commandStr);var Cn=Ce.link(Nr._texture||Nr.color[0]._texture);ie(nt,".uniform1i(",Vr,",",Cn+".bind());"),ie.exit(Cn,".unbind();")}else if(_t===au||_t===Wf||_t===Xf){de.optional(function(){de.command(da(Nr),"invalid matrix for uniform "+pt,Ce.commandStr),de.command(_t===au&&Nr.length===4||_t===Wf&&Nr.length===9||_t===Xf&&Nr.length===16,"invalid length for matrix uniform "+pt,Ce.commandStr)});var fn=Ce.global.def("new Float32Array(["+Array.prototype.slice.call(Nr)+"])"),Sn=2;_t===Wf?Sn=3:_t===Xf&&(Sn=4),ie(nt,".uniformMatrix",Sn,"fv(",Vr,",false,",fn,");")}else{switch(_t){case Lp:de.commandType(Nr,"number","uniform "+pt,Ce.commandStr),_e="1f";break;case Ef:de.command(da(Nr)&&Nr.length===2,"uniform "+pt,Ce.commandStr),_e="2f";break;case fc:de.command(da(Nr)&&Nr.length===3,"uniform "+pt,Ce.commandStr),_e="3f";break;case Uc:de.command(da(Nr)&&Nr.length===4,"uniform "+pt,Ce.commandStr),_e="4f";break;case Hf:de.commandType(Nr,"boolean","uniform "+pt,Ce.commandStr),_e="1i";break;case Zc:de.commandType(Nr,"number","uniform "+pt,Ce.commandStr),_e="1i";break;case Fp:de.command(da(Nr)&&Nr.length===2,"uniform "+pt,Ce.commandStr),_e="2i";break;case kp:de.command(da(Nr)&&Nr.length===2,"uniform "+pt,Ce.commandStr),_e="2i";break;case Sf:de.command(da(Nr)&&Nr.length===3,"uniform "+pt,Ce.commandStr),_e="3i";break;case pc:de.command(da(Nr)&&Nr.length===3,"uniform "+pt,Ce.commandStr),_e="3i";break;case sl:de.command(da(Nr)&&Nr.length===4,"uniform "+pt,Ce.commandStr),_e="4i";break;case Dp:de.command(da(Nr)&&Nr.length===4,"uniform "+pt,Ce.commandStr),_e="4i";break}ie(nt,".uniform",_e,"(",Vr,",",da(Nr)?Array.prototype.slice.call(Nr):Nr,");")}continue}else nn=vr.append(Ce,ie)}else{if(!Ot(hh))continue;nn=ie.def(Fe.uniforms,"[",me.id(pt),"]")}_t===Yf?(de(!Array.isArray(nn),"must specify a scalar prop for textures"),ie("if(",nn,"&&",nn,'._reglType==="framebuffer"){',nn,"=",nn,".color[0];","}")):_t===Cf&&(de(!Array.isArray(nn),"must specify a scalar prop for cube maps"),ie("if(",nn,"&&",nn,'._reglType==="framebufferCube"){',nn,"=",nn,".color[0];","}")),de.optional(function(){function Hn(Hu,Hc){Ce.assert(ie,Hu,'bad data or missing for uniform "'+pt+'".  '+Hc)}function Vu(Hu){de(!Array.isArray(nn),"must not specify an array type for uniform"),Hn("typeof "+nn+'==="'+Hu+'"',"invalid type, expected "+Hu)}function Gu(Hu,Hc){Array.isArray(nn)?de(nn.length===Hu,"must have length "+Hu):Hn(Fe.isArrayLike+"("+nn+")&&"+nn+".length==="+Hu,"invalid vector, should have length "+Hu,Ce.commandStr)}function mh(Hu){de(!Array.isArray(nn),"must not specify a value type"),Hn("typeof "+nn+'==="function"&&'+nn+'._reglType==="texture'+(Hu===Wh?"2d":"Cube")+'"',"invalid texture type",Ce.commandStr)}switch(_t){case Zc:Vu("number");break;case kp:Gu(2,"number");break;case pc:Gu(3,"number");break;case Dp:Gu(4,"number");break;case Lp:Vu("number");break;case Ef:Gu(2,"number");break;case fc:Gu(3,"number");break;case Uc:Gu(4,"number");break;case Hf:Vu("boolean");break;case Fp:Gu(2,"boolean");break;case Sf:Gu(3,"boolean");break;case sl:Gu(4,"boolean");break;case au:Gu(4,"number");break;case Wf:Gu(9,"number");break;case Xf:Gu(16,"number");break;case Yf:mh(Wh);break;case Cf:mh(Ip);break}});var _n=1;switch(_t){case Yf:case Cf:var vn=ie.def(nn,"._texture");ie(nt,".uniform1i(",Vr,",",vn,".bind());"),ie.exit(vn,".unbind();");continue;case Zc:case Hf:_e="1i";break;case kp:case Fp:_e="2i",_n=2;break;case pc:case Sf:_e="3i",_n=3;break;case Dp:case sl:_e="4i",_n=4;break;case Lp:_e="1f";break;case Ef:_e="2f",_n=2;break;case fc:_e="3f",_n=3;break;case Uc:_e="4f",_n=4;break;case au:_e="Matrix2fv";break;case Wf:_e="Matrix3fv";break;case Xf:_e="Matrix4fv";break}if(_e.charAt(0)==="M"){ie(nt,".uniform",_e,"(",Vr,",");var Xn=Math.pow(_t-au+2,2),ya=Ce.global.def("new Float32Array(",Xn,")");Array.isArray(nn)?ie("false,(",Ge(Xn,function(Hn){return ya+"["+Hn+"]="+nn[Hn]}),",",ya,")"):ie("false,(Array.isArray(",nn,")||",nn," instanceof Float32Array)?",nn,":(",Ge(Xn,function(Hn){return ya+"["+Hn+"]="+nn+"["+Hn+"]"}),",",ya,")"),ie(");")}else if(_n>1){for(var fs=[],ja=[],_a=0;_a<_n;++_a)Array.isArray(nn)?ja.push(nn[_a]):ja.push(ie.def(nn+"["+_a+"]")),qe&&fs.push(ie.def());qe&&ie("if(!",Ce.batchId,"||",fs.map(function(Hn,Vu){return Hn+"!=="+ja[Vu]}).join("||"),"){",fs.map(function(Hn,Vu){return Hn+"="+ja[Vu]+";"}).join("")),ie(nt,".uniform",_e,"(",Vr,",",ja.join(","),");"),qe&&ie("}")}else{if(de(!Array.isArray(nn),"uniform value must not be an array"),qe){var fi=ie.def();ie("if(!",Ce.batchId,"||",fi,"!==",nn,"){",fi,"=",nn,";")}ie(nt,".uniform",_e,"(",Vr,",",nn,");"),qe&&ie("}")}}}function cs(Ce,ie,Ve,ft){var Ot=Ce.shared,qe=Ot.gl,Fe=Ot.draw,nt=ft.draw;function _e(){var _n=nt.elements,vn,Xn=ie;return _n?((_n.contextDep&&ft.contextDynamic||_n.propDep)&&(Xn=Ve),vn=_n.append(Ce,Xn),nt.elementsActive&&Xn("if("+vn+")"+qe+".bindBuffer("+Pp+","+vn+".buffer.buffer);")):(vn=Xn.def(),Xn(vn,"=",Fe,".",Tu,";","if(",vn,"){",qe,".bindBuffer(",Pp,",",vn,".buffer.buffer);}","else if(",Ot.vao,".currentVAO){",vn,"=",Ce.shared.elements+".getElements("+Ot.vao,".currentVAO.elements);",pr?"":"if("+vn+")"+qe+".bindBuffer("+Pp+","+vn+".buffer.buffer);","}")),vn}function Ue(){var _n=nt.count,vn,Xn=ie;return _n?((_n.contextDep&&ft.contextDynamic||_n.propDep)&&(Xn=Ve),vn=_n.append(Ce,Xn),de.optional(function(){_n.MISSING&&Ce.assert(ie,"false","missing vertex count"),_n.DYNAMIC&&Ce.assert(Xn,vn+">=0","missing vertex count")})):(vn=Xn.def(Fe,".",Hs),de.optional(function(){Ce.assert(Xn,vn+">=0","missing vertex count")})),vn}var Ae=_e();function pt(_n){var vn=nt[_n];return vn?vn.contextDep&&ft.contextDynamic||vn.propDep?vn.append(Ce,Ve):vn.append(Ce,ie):ie.def(Fe,".",_n)}var _t=pt(zo),vr=pt(gf),jr=Ue();if(typeof jr=="number"){if(jr===0)return}else Ve("if(",jr,"){"),Ve.exit("}");var Vr,nn;Ar&&(Vr=pt(Mp),nn=Ce.instancing);var Nr=Ae+".type",Cn=nt.elements&&Zl(nt.elements)&&!nt.vaoActive;function fn(){function _n(){Ve(nn,".drawElementsInstancedANGLE(",[_t,jr,Nr,vr+"<<(("+Nr+"-"+ei+")>>1)",Vr],");")}function vn(){Ve(nn,".drawArraysInstancedANGLE(",[_t,vr,jr,Vr],");")}Ae&&Ae!=="null"?Cn?_n():(Ve("if(",Ae,"){"),_n(),Ve("}else{"),vn(),Ve("}")):vn()}function Sn(){function _n(){Ve(qe+".drawElements("+[_t,jr,Nr,vr+"<<(("+Nr+"-"+ei+")>>1)"]+");")}function vn(){Ve(qe+".drawArrays("+[_t,vr,jr]+");")}Ae&&Ae!=="null"?Cn?_n():(Ve("if(",Ae,"){"),_n(),Ve("}else{"),vn(),Ve("}")):vn()}Ar&&(typeof Vr!="number"||Vr>=0)?typeof Vr=="string"?(Ve("if(",Vr,">0){"),fn(),Ve("}else if(",Vr,"<0){"),Sn(),Ve("}")):fn():Sn()}function ii(Ce,ie,Ve,ft,Ot){var qe=ai(),Fe=qe.proc("body",Ot);return de.optional(function(){qe.commandStr=ie.commandStr,qe.command=qe.link(ie.commandStr)}),Ar&&(qe.instancing=Fe.def(qe.shared.extensions,".angle_instanced_arrays")),Ce(qe,Fe,Ve,ft),qe.compile().body}function Ui(Ce,ie,Ve,ft){yo(Ce,ie),Ve.useVAO?Ve.drawVAO?ie(Ce.shared.vao,".setVAO(",Ve.drawVAO.append(Ce,ie),");"):ie(Ce.shared.vao,".setVAO(",Ce.shared.vao,".targetVAO);"):(ie(Ce.shared.vao,".setVAO(null);"),Zo(Ce,ie,Ve,ft.attributes,function(){return!0})),ra(Ce,ie,Ve,ft.uniforms,function(){return!0},!1),cs(Ce,ie,ie,Ve)}function ga(Ce,ie){var Ve=Ce.proc("draw",1);yo(Ce,Ve),Oo(Ce,Ve,ie.context),is(Ce,Ve,ie.framebuffer),Uo(Ce,Ve,ie),ls(Ce,Ve,ie.state),_i(Ce,Ve,ie,!1,!0);var ft=ie.shader.progVar.append(Ce,Ve);if(Ve(Ce.shared.gl,".useProgram(",ft,".program);"),ie.shader.program)Ui(Ce,Ve,ie,ie.shader.program);else{Ve(Ce.shared.vao,".setVAO(null);");var Ot=Ce.global.def("{}"),qe=Ve.def(ft,".id"),Fe=Ve.def(Ot,"[",qe,"]");Ve(Ce.cond(Fe).then(Fe,".call(this,a0);").else(Fe,"=",Ot,"[",qe,"]=",Ce.link(function(nt){return ii(Ui,Ce,ie,nt,1)}),"(",ft,");",Fe,".call(this,a0);"))}Object.keys(ie.state).length>0&&Ve(Ce.shared.current,".dirty=true;"),Ce.shared.vao&&Ve(Ce.shared.vao,".setVAO(null);")}function Ro(Ce,ie,Ve,ft){Ce.batchId="a1",yo(Ce,ie);function Ot(){return!0}Zo(Ce,ie,Ve,ft.attributes,Ot),ra(Ce,ie,Ve,ft.uniforms,Ot,!1),cs(Ce,ie,ie,Ve)}function Cl(Ce,ie,Ve,ft){yo(Ce,ie);var Ot=Ve.contextDep,qe=ie.def(),Fe="a0",nt="a1",_e=ie.def();Ce.shared.props=_e,Ce.batchId=qe;var Ue=Ce.scope(),Ae=Ce.scope();ie(Ue.entry,"for(",qe,"=0;",qe,"<",nt,";++",qe,"){",_e,"=",Fe,"[",qe,"];",Ae,"}",Ue.exit);function pt(Nr){return Nr.contextDep&&Ot||Nr.propDep}function _t(Nr){return!pt(Nr)}if(Ve.needsContext&&Oo(Ce,Ae,Ve.context),Ve.needsFramebuffer&&is(Ce,Ae,Ve.framebuffer),ls(Ce,Ae,Ve.state,pt),Ve.profile&&pt(Ve.profile)&&_i(Ce,Ae,Ve,!1,!0),ft)Ve.useVAO?Ve.drawVAO?pt(Ve.drawVAO)?Ae(Ce.shared.vao,".setVAO(",Ve.drawVAO.append(Ce,Ae),");"):Ue(Ce.shared.vao,".setVAO(",Ve.drawVAO.append(Ce,Ue),");"):Ue(Ce.shared.vao,".setVAO(",Ce.shared.vao,".targetVAO);"):(Ue(Ce.shared.vao,".setVAO(null);"),Zo(Ce,Ue,Ve,ft.attributes,_t),Zo(Ce,Ae,Ve,ft.attributes,pt)),ra(Ce,Ue,Ve,ft.uniforms,_t,!1),ra(Ce,Ae,Ve,ft.uniforms,pt,!0),cs(Ce,Ue,Ae,Ve);else{var vr=Ce.global.def("{}"),jr=Ve.shader.progVar.append(Ce,Ae),Vr=Ae.def(jr,".id"),nn=Ae.def(vr,"[",Vr,"]");Ae(Ce.shared.gl,".useProgram(",jr,".program);","if(!",nn,"){",nn,"=",vr,"[",Vr,"]=",Ce.link(function(Nr){return ii(Ro,Ce,Ve,Nr,2)}),"(",jr,");}",nn,".call(this,a0[",qe,"],",qe,");")}}function we(Ce,ie){var Ve=Ce.proc("batch",2);Ce.batchId="0",yo(Ce,Ve);var ft=!1,Ot=!0;Object.keys(ie.context).forEach(function(vr){ft=ft||ie.context[vr].propDep}),ft||(Oo(Ce,Ve,ie.context),Ot=!1);var qe=ie.framebuffer,Fe=!1;qe?(qe.propDep?ft=Fe=!0:qe.contextDep&&ft&&(Fe=!0),Fe||is(Ce,Ve,qe)):is(Ce,Ve,null),ie.state.viewport&&ie.state.viewport.propDep&&(ft=!0);function nt(vr){return vr.contextDep&&ft||vr.propDep}Uo(Ce,Ve,ie),ls(Ce,Ve,ie.state,function(vr){return!nt(vr)}),(!ie.profile||!nt(ie.profile))&&_i(Ce,Ve,ie,!1,"a1"),ie.contextDep=ft,ie.needsContext=Ot,ie.needsFramebuffer=Fe;var _e=ie.shader.progVar;if(_e.contextDep&&ft||_e.propDep)Cl(Ce,Ve,ie,null);else{var Ue=_e.append(Ce,Ve);if(Ve(Ce.shared.gl,".useProgram(",Ue,".program);"),ie.shader.program)Cl(Ce,Ve,ie,ie.shader.program);else{Ve(Ce.shared.vao,".setVAO(null);");var Ae=Ce.global.def("{}"),pt=Ve.def(Ue,".id"),_t=Ve.def(Ae,"[",pt,"]");Ve(Ce.cond(_t).then(_t,".call(this,a0,a1);").else(_t,"=",Ae,"[",pt,"]=",Ce.link(function(vr){return ii(Cl,Ce,ie,vr,2)}),"(",Ue,");",_t,".call(this,a0,a1);"))}}Object.keys(ie.state).length>0&&Ve(Ce.shared.current,".dirty=true;"),Ce.shared.vao&&Ve(Ce.shared.vao,".setVAO(null);")}function Ut(Ce,ie){var Ve=Ce.proc("scope",3);Ce.batchId="a2";var ft=Ce.shared,Ot=ft.current;Oo(Ce,Ve,ie.context),ie.framebuffer&&ie.framebuffer.append(Ce,Ve),ph(Object.keys(ie.state)).forEach(function(Fe){var nt=ie.state[Fe],_e=nt.append(Ce,Ve);da(_e)?_e.forEach(function(Ue,Ae){Ve.set(Ce.next[Fe],"["+Ae+"]",Ue)}):Ve.set(ft.next,"."+Fe,_e)}),_i(Ce,Ve,ie,!0,!0),[Tu,gf,Hs,Mp,zo].forEach(function(Fe){var nt=ie.draw[Fe];!nt||Ve.set(ft.draw,"."+Fe,""+nt.append(Ce,Ve))}),Object.keys(ie.uniforms).forEach(function(Fe){var nt=ie.uniforms[Fe].append(Ce,Ve);Array.isArray(nt)&&(nt="["+nt.join()+"]"),Ve.set(ft.uniforms,"["+me.id(Fe)+"]",nt)}),Object.keys(ie.attributes).forEach(function(Fe){var nt=ie.attributes[Fe].append(Ce,Ve),_e=Ce.scopeAttrib(Fe);Object.keys(new ut).forEach(function(Ue){Ve.set(_e,"."+Ue,nt[Ue])})}),ie.scopeVAO&&Ve.set(ft.vao,".targetVAO",ie.scopeVAO.append(Ce,Ve));function qe(Fe){var nt=ie.shader[Fe];nt&&Ve.set(ft.shader,"."+Fe,nt.append(Ce,Ve))}qe(Zu),qe(lc),Object.keys(ie.state).length>0&&(Ve(Ot,".dirty=true;"),Ve.exit(Ot,".dirty=true;")),Ve("a1(",Ce.shared.context,",a0,",Ce.batchId,");")}function bt(Ce){if(!(typeof Ce!="object"||da(Ce))){for(var ie=Object.keys(Ce),Ve=0;Ve<ie.length;++Ve)if(an.isDynamic(Ce[ie[Ve]]))return!0;return!1}}function gn(Ce,ie,Ve){var ft=ie.static[Ve];if(!ft||!bt(ft))return;var Ot=Ce.global,qe=Object.keys(ft),Fe=!1,nt=!1,_e=!1,Ue=Ce.global.def("{}");qe.forEach(function(pt){var _t=ft[pt];if(an.isDynamic(_t)){typeof _t=="function"&&(_t=ft[pt]=an.unbox(_t));var vr=Ws(_t,null);Fe=Fe||vr.thisDep,_e=_e||vr.propDep,nt=nt||vr.contextDep}else{switch(Ot(Ue,".",pt,"="),typeof _t){case"number":Ot(_t);break;case"string":Ot('"',_t,'"');break;case"object":Array.isArray(_t)&&Ot("[",_t.join(),"]");break;default:Ot(Ce.link(_t));break}Ot(";")}});function Ae(pt,_t){qe.forEach(function(vr){var jr=ft[vr];if(!!an.isDynamic(jr)){var Vr=pt.invoke(_t,jr);_t(Ue,".",vr,"=",Vr,";")}})}ie.dynamic[Ve]=new an.DynamicVariable(Wo,{thisDep:Fe,contextDep:nt,propDep:_e,ref:Ue,append:Ae}),delete ie.static[Ve]}function Fi(Ce,ie,Ve,ft,Ot){var qe=ai();qe.stats=qe.link(Ot),Object.keys(ie.static).forEach(function(nt){gn(qe,ie,nt)}),Hh.forEach(function(nt){gn(qe,Ce,nt)});var Fe=ns(Ce,ie,Ve,ft,qe);return ga(qe,Fe),Ut(qe,Fe),we(qe,Fe),m(qe.compile(),{destroy:function(){Fe.shader.program.destroy()}})}return{next:Qr,current:Rr,procs:function(){var Ce=ai(),ie=Ce.proc("poll"),Ve=Ce.proc("refresh"),ft=Ce.block();ie(ft),Ve(ft);var Ot=Ce.shared,qe=Ot.gl,Fe=Ot.next,nt=Ot.current;ft(nt,".dirty=false;"),is(Ce,ie),is(Ce,Ve,null,!0);var _e;Ar&&(_e=Ce.link(Ar)),Be.oes_vertex_array_object&&Ve(Ce.link(Be.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Ue=0;Ue<Ft.maxAttributes;++Ue){var Ae=Ve.def(Ot.attributes,"[",Ue,"]"),pt=Ce.cond(Ae,".buffer");pt.then(qe,".enableVertexAttribArray(",Ue,");",qe,".bindBuffer(",Nc,",",Ae,".buffer.buffer);",qe,".vertexAttribPointer(",Ue,",",Ae,".size,",Ae,".type,",Ae,".normalized,",Ae,".stride,",Ae,".offset);").else(qe,".disableVertexAttribArray(",Ue,");",qe,".vertexAttrib4f(",Ue,",",Ae,".x,",Ae,".y,",Ae,".z,",Ae,".w);",Ae,".buffer=null;"),Ve(pt),Ar&&Ve(_e,".vertexAttribDivisorANGLE(",Ue,",",Ae,".divisor);")}return Ve(Ce.shared.vao,".currentVAO=null;",Ce.shared.vao,".setVAO(",Ce.shared.vao,".targetVAO);"),Object.keys(Xt).forEach(function(_t){var vr=Xt[_t],jr=ft.def(Fe,".",_t),Vr=Ce.block();Vr("if(",jr,"){",qe,".enable(",vr,")}else{",qe,".disable(",vr,")}",nt,".",_t,"=",jr,";"),Ve(Vr),ie("if(",jr,"!==",nt,".",_t,"){",Vr,"}")}),Object.keys(ir).forEach(function(_t){var vr=ir[_t],jr=Rr[_t],Vr,nn,Nr=Ce.block();if(Nr(qe,".",vr,"("),da(jr)){var Cn=jr.length;Vr=Ce.global.def(Fe,".",_t),nn=Ce.global.def(nt,".",_t),Nr(Ge(Cn,function(fn){return Vr+"["+fn+"]"}),");",Ge(Cn,function(fn){return nn+"["+fn+"]="+Vr+"["+fn+"];"}).join("")),ie("if(",Ge(Cn,function(fn){return Vr+"["+fn+"]!=="+nn+"["+fn+"]"}).join("||"),"){",Nr,"}")}else Vr=ft.def(Fe,".",_t),nn=ft.def(nt,".",_t),Nr(Vr,");",nt,".",_t,"=",Vr,";"),ie("if(",Vr,"!==",nn,"){",Nr,"}");Ve(Nr)}),Ce.compile()}(),compile:Fi}}function Md(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Kh=34918,$h=34919,$f=35007,Pd=function(B,me){if(!me.ext_disjoint_timer_query)return null;var Be=[];function Ft(){return Be.pop()||me.ext_disjoint_timer_query.createQueryEXT()}function ur(Ar){Be.push(Ar)}var Lt=[];function nr(Ar){var Zr=Ft();me.ext_disjoint_timer_query.beginQueryEXT($f,Zr),Lt.push(Zr),gr(Lt.length-1,Lt.length,Ar)}function hr(){me.ext_disjoint_timer_query.endQueryEXT($f)}function _r(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var br=[];function Tr(){return br.pop()||new _r}function kr(Ar){br.push(Ar)}var dr=[];function gr(Ar,Zr,pr){var Rr=Tr();Rr.startQueryIndex=Ar,Rr.endQueryIndex=Zr,Rr.sum=0,Rr.stats=pr,dr.push(Rr)}var Pr=[],ut=[];function Gt(){var Ar,Zr,pr=Lt.length;if(pr!==0){ut.length=Math.max(ut.length,pr+1),Pr.length=Math.max(Pr.length,pr+1),Pr[0]=0,ut[0]=0;var Rr=0;for(Ar=0,Zr=0;Zr<Lt.length;++Zr){var Qr=Lt[Zr];me.ext_disjoint_timer_query.getQueryObjectEXT(Qr,$h)?(Rr+=me.ext_disjoint_timer_query.getQueryObjectEXT(Qr,Kh),ur(Qr)):Lt[Ar++]=Qr,Pr[Zr+1]=Rr,ut[Zr+1]=Ar}for(Lt.length=Ar,Ar=0,Zr=0;Zr<dr.length;++Zr){var Nn=dr[Zr],Xt=Nn.startQueryIndex,ir=Nn.endQueryIndex;Nn.sum+=Pr[ir]-Pr[Xt];var dn=ut[Xt],Xr=ut[ir];Xr===dn?(Nn.stats.gpuTime+=Nn.sum/1e6,kr(Nn)):(Nn.startQueryIndex=dn,Nn.endQueryIndex=Xr,dr[Ar++]=Nn)}dr.length=Ar}}return{beginQuery:nr,endQuery:hr,pushScopeStats:gr,update:Gt,getNumPendingQueries:function(){return Lt.length},clear:function(){Be.push.apply(Be,Lt);for(var Ar=0;Ar<Be.length;Ar++)me.ext_disjoint_timer_query.deleteQueryEXT(Be[Ar]);Lt.length=0,Be.length=0},restore:function(){Lt.length=0,Be.length=0}}},Id=16384,Qf=256,Qh=1024,Jh=34962,Jf="webglcontextlost",Ba="webglcontextrestored",zp=1,jl=2,Gc=3;function vh(B,me){for(var Be=0;Be<B.length;++Be)if(B[Be]===me)return Be;return-1}function y0(B){var me=ge(B);if(!me)return null;var Be=me.gl,Ft=Be.getContextAttributes(),ur=Be.isContextLost(),Lt=Ie(Be,me);if(!Lt)return null;var nr=ms(),hr=Md(),_r=Lt.extensions,br=Pd(Be,_r),Tr=Ja(),kr=Be.drawingBufferWidth,dr=Be.drawingBufferHeight,gr={tick:0,time:0,viewportWidth:kr,viewportHeight:dr,framebufferWidth:kr,framebufferHeight:dr,drawingBufferWidth:kr,drawingBufferHeight:dr,pixelRatio:me.pixelRatio},Pr={},ut={elements:null,primitive:4,count:-1,offset:0,instances:-1},Gt=Ac(Be,_r),Ar=F(Be,hr,me,Rr),Zr=Ju(Be,_r,Ar,hr),pr=yt(Be,_r,Gt,hr,Ar,Zr,ut);function Rr(ii){return pr.destroyBuffer(ii)}var Qr=Ir(Be,nr,hr,me),Nn=_s(Be,_r,Gt,function(){dn.procs.poll()},gr,hr,me),Xt=Ll(Be,_r,Gt,hr,me),ir=Re(Be,_r,Gt,Nn,Xt,hr),dn=dh(Be,nr,_r,Gt,Ar,Zr,Nn,ir,Pr,pr,Qr,ut,gr,br,me),Xr=Un(Be,ir,dn.procs.poll,gr,Ft,_r,Gt),Er=dn.next,Hr=Be.canvas,Yr=[],yi=[],ai=[],qr=[me.onDestroy],sn=null;function Qn(){if(Yr.length===0){br&&br.update(),sn=null;return}sn=Pi.next(Qn),yo();for(var ii=Yr.length-1;ii>=0;--ii){var Ui=Yr[ii];Ui&&Ui(gr,null,0)}Be.flush(),br&&br.update()}function hi(){!sn&&Yr.length>0&&(sn=Pi.next(Qn))}function zi(){sn&&(Pi.cancel(Qn),sn=null)}function po(ii){ii.preventDefault(),ur=!0,zi(),yi.forEach(function(Ui){Ui()})}function go(ii){Be.getError(),ur=!1,Lt.restore(),Qr.restore(),Ar.restore(),Nn.restore(),Xt.restore(),ir.restore(),pr.restore(),br&&br.restore(),dn.procs.refresh(),hi(),ai.forEach(function(Ui){Ui()})}var Di=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!Di&&Hr&&(Hr.addEventListener(Jf,po,!1),Hr.addEventListener(Ba,go,!1));function us(){Yr.length=0,zi(),!Di&&Hr&&(Hr.removeEventListener(Jf,po),Hr.removeEventListener(Ba,go)),Qr.clear(),ir.clear(),Xt.clear(),pr.clear(),Nn.clear(),Zr.clear(),Ar.clear(),br&&br.clear(),qr.forEach(function(ii){ii()})}function Ka(ii){de(!!ii,"invalid args to regl({...})"),de.type(ii,"object","invalid args to regl({...})");function Ui(qe){var Fe=m({},qe);delete Fe.uniforms,delete Fe.attributes,delete Fe.context,delete Fe.vao,"stencil"in Fe&&Fe.stencil.op&&(Fe.stencil.opBack=Fe.stencil.opFront=Fe.stencil.op,delete Fe.stencil.op);function nt(_e){if(_e in Fe){var Ue=Fe[_e];delete Fe[_e],Object.keys(Ue).forEach(function(Ae){Fe[_e+"."+Ae]=Ue[Ae]})}}return nt("blend"),nt("depth"),nt("cull"),nt("stencil"),nt("polygonOffset"),nt("scissor"),nt("sample"),"vao"in qe&&(Fe.vao=qe.vao),Fe}function ga(qe,Fe){var nt={},_e={};return Object.keys(qe).forEach(function(Ue){var Ae=qe[Ue];if(an.isDynamic(Ae)){_e[Ue]=an.unbox(Ae,Ue);return}else if(Fe&&Array.isArray(Ae)){for(var pt=0;pt<Ae.length;++pt)if(an.isDynamic(Ae[pt])){_e[Ue]=an.unbox(Ae,Ue);return}}nt[Ue]=Ae}),{dynamic:_e,static:nt}}var Ro=ga(ii.context||{},!0),Cl=ga(ii.uniforms||{},!0),we=ga(ii.attributes||{},!1),Ut=ga(Ui(ii),!1),bt={gpuTime:0,cpuTime:0,count:0},gn=dn.compile(Ut,we,Cl,Ro,bt),Fi=gn.draw,Ce=gn.batch,ie=gn.scope,Ve=[];function ft(qe){for(;Ve.length<qe;)Ve.push(null);return Ve}function Ot(qe,Fe){var nt;if(ur&&de.raise("context lost"),typeof qe=="function")return ie.call(this,null,qe,0);if(typeof Fe=="function")if(typeof qe=="number")for(nt=0;nt<qe;++nt)ie.call(this,null,Fe,nt);else if(Array.isArray(qe))for(nt=0;nt<qe.length;++nt)ie.call(this,qe[nt],Fe,nt);else return ie.call(this,qe,Fe,0);else if(typeof qe=="number"){if(qe>0)return Ce.call(this,ft(qe|0),qe|0)}else if(Array.isArray(qe)){if(qe.length)return Ce.call(this,qe,qe.length)}else return Fi.call(this,qe)}return m(Ot,{stats:bt,destroy:function(){gn.destroy()}})}var ns=ir.setFBO=Ka({framebuffer:an.define.call(null,zp,"framebuffer")});function Oo(ii,Ui){var ga=0;dn.procs.poll();var Ro=Ui.color;Ro&&(Be.clearColor(+Ro[0]||0,+Ro[1]||0,+Ro[2]||0,+Ro[3]||0),ga|=Id),"depth"in Ui&&(Be.clearDepth(+Ui.depth),ga|=Qf),"stencil"in Ui&&(Be.clearStencil(Ui.stencil|0),ga|=Qh),de(!!ga,"called regl.clear with no buffer specified"),Be.clear(ga)}function is(ii){if(de(typeof ii=="object"&&ii,"regl.clear() takes an object as input"),"framebuffer"in ii)if(ii.framebuffer&&ii.framebuffer_reglType==="framebufferCube")for(var Ui=0;Ui<6;++Ui)ns(m({framebuffer:ii.framebuffer.faces[Ui]},ii),Oo);else ns(ii,Oo);else Oo(null,ii)}function Uo(ii){de.type(ii,"function","regl.frame() callback must be a function"),Yr.push(ii);function Ui(){var ga=vh(Yr,ii);de(ga>=0,"cannot cancel a frame twice");function Ro(){var Cl=vh(Yr,Ro);Yr[Cl]=Yr[Yr.length-1],Yr.length-=1,Yr.length<=0&&zi()}Yr[ga]=Ro}return hi(),{cancel:Ui}}function ls(){var ii=Er.viewport,Ui=Er.scissor_box;ii[0]=ii[1]=Ui[0]=Ui[1]=0,gr.viewportWidth=gr.framebufferWidth=gr.drawingBufferWidth=ii[2]=Ui[2]=Be.drawingBufferWidth,gr.viewportHeight=gr.framebufferHeight=gr.drawingBufferHeight=ii[3]=Ui[3]=Be.drawingBufferHeight}function yo(){gr.tick+=1,gr.time=Zo(),ls(),dn.procs.poll()}function _i(){Nn.refresh(),ls(),dn.procs.refresh(),br&&br.update()}function Zo(){return(Ja()-Tr)/1e3}_i();function ra(ii,Ui){de.type(Ui,"function","listener callback must be a function");var ga;switch(ii){case"frame":return Uo(Ui);case"lost":ga=yi;break;case"restore":ga=ai;break;case"destroy":ga=qr;break;default:de.raise("invalid event, must be one of frame,lost,restore,destroy")}return ga.push(Ui),{cancel:function(){for(var Ro=0;Ro<ga.length;++Ro)if(ga[Ro]===Ui){ga[Ro]=ga[ga.length-1],ga.pop();return}}}}var cs=m(Ka,{clear:is,prop:an.define.bind(null,zp),context:an.define.bind(null,jl),this:an.define.bind(null,Gc),draw:Ka({}),buffer:function(ii){return Ar.create(ii,Jh,!1,!1)},elements:function(ii){return Zr.create(ii,!1)},texture:Nn.create2D,cube:Nn.createCube,renderbuffer:Xt.create,framebuffer:ir.create,framebufferCube:ir.createCube,vao:pr.createVAO,attributes:Ft,frame:Uo,on:ra,limits:Gt,hasExtension:function(ii){return Gt.extensions.indexOf(ii.toLowerCase())>=0},read:Xr,destroy:us,_gl:Be,_refresh:_i,poll:function(){yo(),br&&br.update()},now:Zo,stats:hr});return me.onDone(null,cs),cs}return y0})},77412:function(Mt){function J(N,ue){for(var ye=-1,m=N==null?0:N.length;++ye<m&&ue(N[ye],ye,N)!==!1;);return N}Mt.exports=J},47443:function(Mt,J,N){var ue=N(42118);function ye(m,ve){var j=m==null?0:m.length;return!!j&&ue(m,ve,0)>-1}Mt.exports=ye},1196:function(Mt){function J(N,ue,ye){for(var m=-1,ve=N==null?0:N.length;++m<ve;)if(ye(ue,N[m]))return!0;return!1}Mt.exports=J},62663:function(Mt){function J(N,ue,ye,m){var ve=-1,j=N==null?0:N.length;for(m&&j&&(ye=N[++ve]);++ve<j;)ye=ue(ye,N[ve],ve,N);return ye}Mt.exports=J},49029:function(Mt){var J=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function N(ue){return ue.match(J)||[]}Mt.exports=N},44037:function(Mt,J,N){var ue=N(98363),ye=N(3674);function m(ve,j){return ve&&ue(j,ye(j),ve)}Mt.exports=m},63886:function(Mt,J,N){var ue=N(98363),ye=N(81704);function m(ve,j){return ve&&ue(j,ye(j),ve)}Mt.exports=m},29750:function(Mt){function J(N,ue,ye){return N===N&&(ye!==void 0&&(N=N<=ye?N:ye),ue!==void 0&&(N=N>=ue?N:ue)),N}Mt.exports=J},85990:function(Mt,J,N){var ue=N(46384),ye=N(77412),m=N(34865),ve=N(44037),j=N(63886),le=N(64626),se=N(278),Ne=N(18805),ae=N(1911),tt=N(58234),Le=N(46904),it=N(64160),Vt=N(43824),sr=N(29148),At=N(38517),er=N(1469),It=N(44144),lt=N(56688),dt=N(13218),tr=N(72928),Y=N(3674),$t=N(81704),gt=1,Je=2,xt=4,Qe="[object Arguments]",Kt="[object Array]",Sr="[object Boolean]",Br="[object Date]",Jr="[object Error]",Te="[object Function]",Xe="[object GeneratorFunction]",ke="[object Map]",St="[object Number]",vt="[object Object]",zt="[object RegExp]",Yt="[object Set]",Cr="[object String]",Yn="[object Symbol]",hn="[object WeakMap]",Ki="[object ArrayBuffer]",Zn="[object DataView]",Wn="[object Float32Array]",mi="[object Float64Array]",qn="[object Int8Array]",ui="[object Int16Array]",ia="[object Int32Array]",ki="[object Uint8Array]",Ai="[object Uint8ClampedArray]",Vi="[object Uint16Array]",sa="[object Uint32Array]",wi={};wi[Qe]=wi[Kt]=wi[Ki]=wi[Zn]=wi[Sr]=wi[Br]=wi[Wn]=wi[mi]=wi[qn]=wi[ui]=wi[ia]=wi[ke]=wi[St]=wi[vt]=wi[zt]=wi[Yt]=wi[Cr]=wi[Yn]=wi[ki]=wi[Ai]=wi[Vi]=wi[sa]=!0,wi[Jr]=wi[Te]=wi[hn]=!1;function Ca(Mn,Ei,Zi,$i,Wa,de){var Fn,Xa=Ei&gt,vs=Ei&Je,jt=Ei&xt;if(Zi&&(Fn=Wa?Zi(Mn,$i,Wa,de):Zi(Mn)),Fn!==void 0)return Fn;if(!dt(Mn))return Mn;var or=er(Mn);if(or){if(Fn=Vt(Mn),!Xa)return se(Mn,Fn)}else{var Mr=it(Mn),I=Mr==Te||Mr==Xe;if(It(Mn))return le(Mn,Xa);if(Mr==vt||Mr==Qe||I&&!Wa){if(Fn=vs||I?{}:At(Mn),!Xa)return vs?ae(Mn,j(Fn,Mn)):Ne(Mn,ve(Fn,Mn))}else{if(!wi[Mr])return Wa?Mn:{};Fn=sr(Mn,Mr,Xa)}}de||(de=new ue);var ar=de.get(Mn);if(ar)return ar;de.set(Mn,Fn),tr(Mn)?Mn.forEach(function(jn){Fn.add(Ca(jn,Ei,Zi,jn,Mn,de))}):lt(Mn)&&Mn.forEach(function(jn,an){Fn.set(an,Ca(jn,Ei,Zi,an,Mn,de))});var kn=jt?vs?Le:tt:vs?$t:Y,li=or?void 0:kn(Mn);return ye(li||Mn,function(jn,an){li&&(an=jn,jn=Mn[an]),m(Fn,an,Ca(jn,Ei,Zi,an,Mn,de))}),Fn}Mt.exports=Ca},41848:function(Mt){function J(N,ue,ye,m){for(var ve=N.length,j=ye+(m?1:-1);m?j--:++j<ve;)if(ue(N[j],j,N))return j;return-1}Mt.exports=J},42118:function(Mt,J,N){var ue=N(41848),ye=N(62722),m=N(42351);function ve(j,le,se){return le===le?m(j,le,se):ue(j,ye,se)}Mt.exports=ve},25588:function(Mt,J,N){var ue=N(64160),ye=N(37005),m="[object Map]";function ve(j){return ye(j)&&ue(j)==m}Mt.exports=ve},62722:function(Mt){function J(N){return N!==N}Mt.exports=J},29221:function(Mt,J,N){var ue=N(64160),ye=N(37005),m="[object Set]";function ve(j){return ye(j)&&ue(j)==m}Mt.exports=ve},40371:function(Mt){function J(N){return function(ue){return ue==null?void 0:ue[N]}}Mt.exports=J},18674:function(Mt){function J(N){return function(ue){return N==null?void 0:N[ue]}}Mt.exports=J},45652:function(Mt,J,N){var ue=N(88668),ye=N(47443),m=N(1196),ve=N(74757),j=N(23593),le=N(21814),se=200;function Ne(ae,tt,Le){var it=-1,Vt=ye,sr=ae.length,At=!0,er=[],It=er;if(Le)At=!1,Vt=m;else if(sr>=se){var lt=tt?null:j(ae);if(lt)return le(lt);At=!1,Vt=ve,It=new ue}else It=tt?[]:er;e:for(;++it<sr;){var dt=ae[it],tr=tt?tt(dt):dt;if(dt=Le||dt!==0?dt:0,At&&tr===tr){for(var Y=It.length;Y--;)if(It[Y]===tr)continue e;tt&&It.push(tr),er.push(dt)}else Vt(It,tr,Le)||(It!==er&&It.push(tr),er.push(dt))}return er}Mt.exports=Ne},57157:function(Mt,J,N){var ue=N(74318);function ye(m,ve){var j=ve?ue(m.buffer):m.buffer;return new m.constructor(j,m.byteOffset,m.byteLength)}Mt.exports=ye},93147:function(Mt){var J=/\w*$/;function N(ue){var ye=new ue.constructor(ue.source,J.exec(ue));return ye.lastIndex=ue.lastIndex,ye}Mt.exports=N},40419:function(Mt,J,N){var ue=N(62705),ye=ue?ue.prototype:void 0,m=ye?ye.valueOf:void 0;function ve(j){return m?Object(m.call(j)):{}}Mt.exports=ve},18805:function(Mt,J,N){var ue=N(98363),ye=N(99551);function m(ve,j){return ue(ve,ye(ve),j)}Mt.exports=m},1911:function(Mt,J,N){var ue=N(98363),ye=N(51442);function m(ve,j){return ue(ve,ye(ve),j)}Mt.exports=m},98805:function(Mt,J,N){var ue=N(40180),ye=N(62689),m=N(83140),ve=N(79833);function j(le){return function(se){se=ve(se);var Ne=ye(se)?m(se):void 0,ae=Ne?Ne[0]:se.charAt(0),tt=Ne?ue(Ne,1).join(""):se.slice(1);return ae[le]()+tt}}Mt.exports=j},35393:function(Mt,J,N){var ue=N(62663),ye=N(53816),m=N(58748),ve="['\u2019]",j=RegExp(ve,"g");function le(se){return function(Ne){return ue(m(ye(Ne).replace(j,"")),se,"")}}Mt.exports=le},23593:function(Mt,J,N){var ue=N(58525),ye=N(50308),m=N(21814),ve=1/0,j=ue&&1/m(new ue([,-0]))[1]==ve?function(le){return new ue(le)}:ye;Mt.exports=j},69389:function(Mt,J,N){var ue=N(18674),ye={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},m=ue(ye);Mt.exports=m},46904:function(Mt,J,N){var ue=N(68866),ye=N(51442),m=N(81704);function ve(j){return ue(j,m,ye)}Mt.exports=ve},51442:function(Mt,J,N){var ue=N(62488),ye=N(85924),m=N(99551),ve=N(70479),j=Object.getOwnPropertySymbols,le=j?function(se){for(var Ne=[];se;)ue(Ne,m(se)),se=ye(se);return Ne}:ve;Mt.exports=le},93157:function(Mt){var J=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function N(ue){return J.test(ue)}Mt.exports=N},43824:function(Mt){var J=Object.prototype,N=J.hasOwnProperty;function ue(ye){var m=ye.length,ve=new ye.constructor(m);return m&&typeof ye[0]=="string"&&N.call(ye,"index")&&(ve.index=ye.index,ve.input=ye.input),ve}Mt.exports=ue},29148:function(Mt,J,N){var ue=N(74318),ye=N(57157),m=N(93147),ve=N(40419),j=N(77133),le="[object Boolean]",se="[object Date]",Ne="[object Map]",ae="[object Number]",tt="[object RegExp]",Le="[object Set]",it="[object String]",Vt="[object Symbol]",sr="[object ArrayBuffer]",At="[object DataView]",er="[object Float32Array]",It="[object Float64Array]",lt="[object Int8Array]",dt="[object Int16Array]",tr="[object Int32Array]",Y="[object Uint8Array]",$t="[object Uint8ClampedArray]",gt="[object Uint16Array]",Je="[object Uint32Array]";function xt(Qe,Kt,Sr){var Br=Qe.constructor;switch(Kt){case sr:return ue(Qe);case le:case se:return new Br(+Qe);case At:return ye(Qe,Sr);case er:case It:case lt:case dt:case tr:case Y:case $t:case gt:case Je:return j(Qe,Sr);case Ne:return new Br;case ae:case it:return new Br(Qe);case tt:return m(Qe);case Le:return new Br;case Vt:return ve(Qe)}}Mt.exports=xt},42351:function(Mt){function J(N,ue,ye){for(var m=ye-1,ve=N.length;++m<ve;)if(N[m]===ue)return m;return-1}Mt.exports=J},2757:function(Mt){var J="\\ud800-\\udfff",N="\\u0300-\\u036f",ue="\\ufe20-\\ufe2f",ye="\\u20d0-\\u20ff",m=N+ue+ye,ve="\\u2700-\\u27bf",j="a-z\\xdf-\\xf6\\xf8-\\xff",le="\\xac\\xb1\\xd7\\xf7",se="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Ne="\\u2000-\\u206f",ae=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",tt="A-Z\\xc0-\\xd6\\xd8-\\xde",Le="\\ufe0e\\ufe0f",it=le+se+Ne+ae,Vt="['\u2019]",sr="["+it+"]",At="["+m+"]",er="\\d+",It="["+ve+"]",lt="["+j+"]",dt="[^"+J+it+er+ve+j+tt+"]",tr="\\ud83c[\\udffb-\\udfff]",Y="(?:"+At+"|"+tr+")",$t="[^"+J+"]",gt="(?:\\ud83c[\\udde6-\\uddff]){2}",Je="[\\ud800-\\udbff][\\udc00-\\udfff]",xt="["+tt+"]",Qe="\\u200d",Kt="(?:"+lt+"|"+dt+")",Sr="(?:"+xt+"|"+dt+")",Br="(?:"+Vt+"(?:d|ll|m|re|s|t|ve))?",Jr="(?:"+Vt+"(?:D|LL|M|RE|S|T|VE))?",Te=Y+"?",Xe="["+Le+"]?",ke="(?:"+Qe+"(?:"+[$t,gt,Je].join("|")+")"+Xe+Te+")*",St="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",vt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",zt=Xe+Te+ke,Yt="(?:"+[It,gt,Je].join("|")+")"+zt,Cr=RegExp([xt+"?"+lt+"+"+Br+"(?="+[sr,xt,"$"].join("|")+")",Sr+"+"+Jr+"(?="+[sr,xt+Kt,"$"].join("|")+")",xt+"?"+Kt+"+"+Br,xt+"+"+Jr,vt,St,er,Yt].join("|"),"g");function Yn(hn){return hn.match(Cr)||[]}Mt.exports=Yn},68929:function(Mt,J,N){var ue=N(48403),ye=N(35393),m=ye(function(ve,j,le){return j=j.toLowerCase(),ve+(le?ue(j):j)});Mt.exports=m},48403:function(Mt,J,N){var ue=N(79833),ye=N(11700);function m(ve){return ye(ue(ve).toLowerCase())}Mt.exports=m},74691:function(Mt,J,N){var ue=N(29750),ye=N(14841);function m(ve,j,le){return le===void 0&&(le=j,j=void 0),le!==void 0&&(le=ye(le),le=le===le?le:0),j!==void 0&&(j=ye(j),j=j===j?j:0),ue(ye(ve),j,le)}Mt.exports=m},50361:function(Mt,J,N){var ue=N(85990),ye=1,m=4;function ve(j){return ue(j,ye|m)}Mt.exports=ve},53816:function(Mt,J,N){var ue=N(69389),ye=N(79833),m=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ve="\\u0300-\\u036f",j="\\ufe20-\\ufe2f",le="\\u20d0-\\u20ff",se=ve+j+le,Ne="["+se+"]",ae=RegExp(Ne,"g");function tt(Le){return Le=ye(Le),Le&&Le.replace(m,ue).replace(ae,"")}Mt.exports=tt},56688:function(Mt,J,N){var ue=N(25588),ye=N(7518),m=N(31167),ve=m&&m.isMap,j=ve?ye(ve):ue;Mt.exports=j},14293:function(Mt){function J(N){return N==null}Mt.exports=J},81763:function(Mt,J,N){var ue=N(44239),ye=N(37005),m="[object Number]";function ve(j){return typeof j=="number"||ye(j)&&ue(j)==m}Mt.exports=ve},72928:function(Mt,J,N){var ue=N(29221),ye=N(7518),m=N(31167),ve=m&&m.isSet,j=ve?ye(ve):ue;Mt.exports=j},47037:function(Mt,J,N){var ue=N(44239),ye=N(1469),m=N(37005),ve="[object String]";function j(le){return typeof le=="string"||!ye(le)&&m(le)&&ue(le)==ve}Mt.exports=j},52353:function(Mt){function J(N){return N===void 0}Mt.exports=J},30236:function(Mt,J,N){var ue=N(42980),ye=N(21463),m=ye(function(ve,j,le,se){ue(ve,j,le,se)});Mt.exports=m},50308:function(Mt){function J(){}Mt.exports=J},44908:function(Mt,J,N){var ue=N(45652);function ye(m){return m&&m.length?ue(m):[]}Mt.exports=ye},11700:function(Mt,J,N){var ue=N(98805),ye=ue("toUpperCase");Mt.exports=ye},58748:function(Mt,J,N){var ue=N(49029),ye=N(93157),m=N(79833),ve=N(2757);function j(le,se,Ne){return le=m(le),se=Ne?void 0:se,se===void 0?ye(le)?ve(le):ue(le):le.match(se)||[]}Mt.exports=j},6158:function(Mt){(function(J,N){Mt.exports=N()})(this,function(){"use strict";var J,N,ue;function ye(m,ve){if(!J)J=ve;else if(!N)N=ve;else{var j="var sharedChunk = {}; ("+J+")(sharedChunk); ("+N+")(sharedChunk);",le={};J(le),ue=ve(le),typeof window!="undefined"&&(ue.workerUrl=window.URL.createObjectURL(new Blob([j],{type:"text/javascript"})))}}return ye(["exports"],function(m){"use strict";function ve(t,o){return t(o={exports:{}},o.exports),o.exports}var j=le;function le(t,o,u,h){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(h-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=h,this.p2x=u,this.p2y=h}le.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},le.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},le.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},le.prototype.solveCurveX=function(t,o){var u,h,y,b,S;for(o===void 0&&(o=1e-6),y=t,S=0;S<8;S++){if(b=this.sampleCurveX(y)-t,Math.abs(b)<o)return y;var P=this.sampleCurveDerivativeX(y);if(Math.abs(P)<1e-6)break;y-=b/P}if((y=t)<(u=0))return u;if(y>(h=1))return h;for(;u<h;){if(b=this.sampleCurveX(y),Math.abs(b-t)<o)return y;t>b?u=y:h=y,y=.5*(h-u)+u}return y},le.prototype.solve=function(t,o){return this.sampleCurveY(this.solveCurveX(t,o))};var se=Ne;function Ne(t,o){this.x=t,this.y=o}Ne.prototype={clone:function(){return new Ne(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,o){return this.clone()._rotateAround(t,o)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var o=t.x-this.x,u=t.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,o){return Math.atan2(this.x*o-this.y*t,this.x*t+this.y*o)},_matMult:function(t){var o=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=o,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var o=Math.cos(t),u=Math.sin(t),h=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=h,this},_rotateAround:function(t,o){var u=Math.cos(t),h=Math.sin(t),y=o.y+h*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-h*(this.y-o.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ne.convert=function(t){return t instanceof Ne?t:Array.isArray(t)?new Ne(t[0],t[1]):t};var ae=typeof self!="undefined"?self:{},tt=Math.pow(2,53)-1;function Le(t,o,u,h){var y=new j(t,o,u,h);return function(b){return y.solve(b)}}var it=Le(.25,.1,.25,1);function Vt(t,o,u){return Math.min(u,Math.max(o,t))}function sr(t,o,u){var h=u-o,y=((t-o)%h+h)%h+o;return y===o?u:y}function At(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var h=0,y=o;h<y.length;h+=1){var b=y[h];for(var S in b)t[S]=b[S]}return t}var er=1;function It(){return er++}function lt(){return function t(o){return o?(o^16*Math.random()>>o/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function dt(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function tr(t,o){t.forEach(function(u){o[u]&&(o[u]=o[u].bind(o))})}function Y(t,o){return t.indexOf(o,t.length-o.length)!==-1}function $t(t,o,u){var h={};for(var y in t)h[y]=o.call(u||this,t[y],y,t);return h}function gt(t,o,u){var h={};for(var y in t)o.call(u||this,t[y],y,t)&&(h[y]=t[y]);return h}function Je(t){return Array.isArray(t)?t.map(Je):typeof t=="object"&&t?$t(t,Je):t}var xt={};function Qe(t){xt[t]||(typeof console!="undefined"&&console.warn(t),xt[t]=!0)}function Kt(t,o,u){return(u.y-t.y)*(o.x-t.x)>(o.y-t.y)*(u.x-t.x)}function Sr(t){for(var o=0,u=0,h=t.length,y=h-1,b=void 0,S=void 0;u<h;y=u++)o+=((S=t[y]).x-(b=t[u]).x)*(b.y+S.y);return o}function Br(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Jr(t){var o={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(h,y,b,S){var P=b||S;return o[y]=!P||P.toLowerCase(),""}),o["max-age"]){var u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o}var Te=null;function Xe(t){if(Te==null){var o=t.navigator?t.navigator.userAgent:null;Te=!!t.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return Te}function ke(t){try{var o=ae[t];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(u){return!1}}var St,vt,zt,Yt,Cr=ae.performance&&ae.performance.now?ae.performance.now.bind(ae.performance):Date.now.bind(Date),Yn=ae.requestAnimationFrame||ae.mozRequestAnimationFrame||ae.webkitRequestAnimationFrame||ae.msRequestAnimationFrame,hn=ae.cancelAnimationFrame||ae.mozCancelAnimationFrame||ae.webkitCancelAnimationFrame||ae.msCancelAnimationFrame,Ki={now:Cr,frame:function(t){var o=Yn(t);return{cancel:function(){return hn(o)}}},getImageData:function(t,o){o===void 0&&(o=0);var u=ae.document.createElement("canvas"),h=u.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return u.width=t.width,u.height=t.height,h.drawImage(t,0,0,t.width,t.height),h.getImageData(-o,-o,t.width+2*o,t.height+2*o)},resolveURL:function(t){return St||(St=ae.document.createElement("a")),St.href=t,St.href},hardwareConcurrency:ae.navigator&&ae.navigator.hardwareConcurrency||4,get devicePixelRatio(){return ae.devicePixelRatio},get prefersReducedMotion(){return!!ae.matchMedia&&(vt==null&&(vt=ae.matchMedia("(prefers-reduced-motion: reduce)")),vt.matches)}},Zn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Wn={supported:!1,testSupport:function(t){!mi&&Yt&&(qn?ui(t):zt=t)}},mi=!1,qn=!1;function ui(t){var o=t.createTexture();t.bindTexture(t.TEXTURE_2D,o);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Yt),t.isContextLost())return;Wn.supported=!0}catch(u){}t.deleteTexture(o),mi=!0}ae.document&&((Yt=ae.document.createElement("img")).onload=function(){zt&&ui(zt),zt=null,qn=!0},Yt.onerror=function(){mi=!0,zt=null},Yt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var ia="01",ki=function(t,o){this._transformRequestFn=t,this._customAccessToken=o,this._createSkuToken()};function Ai(t){return t.indexOf("mapbox:")===0}ki.prototype._createSkuToken=function(){var t=function(){for(var o="",u=0;u<10;u++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ia,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},ki.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},ki.prototype.transformRequest=function(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}},ki.prototype.normalizeStyleURL=function(t,o){if(!Ai(t))return t;var u=Ca(t);return u.path="/styles/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},ki.prototype.normalizeGlyphsURL=function(t,o){if(!Ai(t))return t;var u=Ca(t);return u.path="/fonts/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},ki.prototype.normalizeSourceURL=function(t,o){if(!Ai(t))return t;var u=Ca(t);return u.path="/v4/"+u.authority+".json",u.params.push("secure"),this._makeAPIURL(u,this._customAccessToken||o)},ki.prototype.normalizeSpriteURL=function(t,o,u,h){var y=Ca(t);return Ai(t)?(y.path="/styles/v1"+y.path+"/sprite"+o+u,this._makeAPIURL(y,this._customAccessToken||h)):(y.path+=""+o+u,Mn(y))},ki.prototype.normalizeTileURL=function(t,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Ai(t))return t;var u=Ca(t);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Ki.devicePixelRatio>=2||o===512?"@2x":"")+(Wn.supported?".webp":"$1")),u.path=u.path.replace(/^.+\/v4\//,"/"),u.path="/v4"+u.path;var h=this._customAccessToken||function(y){for(var b=0,S=y;b<S.length;b+=1){var P=S[b].match(/^access_token=(.*)$/);if(P)return P[1]}return null}(u.params)||Zn.ACCESS_TOKEN;return Zn.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&u.params.push("sku="+this._skuToken),this._makeAPIURL(u,h)},ki.prototype.canonicalizeTileURL=function(t,o){var u=Ca(t);if(!u.path.match(/(^\/v4\/)/)||!u.path.match(/\.[\w]+$/))return t;var h="mapbox://tiles/";h+=u.path.replace("/v4/","");var y=u.params;return o&&(y=y.filter(function(b){return!b.match(/^access_token=/)})),y.length&&(h+="?"+y.join("&")),h},ki.prototype.canonicalizeTileset=function(t,o){for(var u=!!o&&Ai(o),h=[],y=0,b=t.tiles||[];y<b.length;y+=1){var S=b[y];sa(S)?h.push(this.canonicalizeTileURL(S,u)):h.push(S)}return h},ki.prototype._makeAPIURL=function(t,o){var u="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",h=Ca(Zn.API_URL);if(t.protocol=h.protocol,t.authority=h.authority,t.protocol==="http"){var y=t.params.indexOf("secure");y>=0&&t.params.splice(y,1)}if(h.path!=="/"&&(t.path=""+h.path+t.path),!Zn.REQUIRE_ACCESS_TOKEN)return Mn(t);if(!(o=o||Zn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+u);if(o[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+u);return t.params=t.params.filter(function(b){return b.indexOf("access_token")===-1}),t.params.push("access_token="+o),Mn(t)};var Vi=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function sa(t){return Vi.test(t)}var wi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ca(t){var o=t.match(wi);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function Mn(t){var o=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+o}function Ei(t){if(!t)return null;var o=t.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(decodeURIComponent(ae.atob(o[1]).split("").map(function(u){return"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(u){return null}}var Zi=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Zi.prototype.getStorageKey=function(t){var o,u=Ei(Zn.ACCESS_TOKEN);return o=u&&u.u?ae.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,function(h,y){return String.fromCharCode(Number("0x"+y))})):Zn.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+o:"mapbox.eventData:"+o},Zi.prototype.fetchEventData=function(){var t=ke("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{var h=ae.localStorage.getItem(o);h&&(this.eventData=JSON.parse(h));var y=ae.localStorage.getItem(u);y&&(this.anonId=y)}catch(b){Qe("Unable to read from LocalStorage")}},Zi.prototype.saveEventData=function(){var t=ke("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{ae.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&ae.localStorage.setItem(o,JSON.stringify(this.eventData))}catch(h){Qe("Unable to write to LocalStorage")}},Zi.prototype.processRequests=function(t){},Zi.prototype.postEvent=function(t,o,u,h){var y=this;if(Zn.EVENTS_URL){var b=Ca(Zn.EVENTS_URL);b.params.push("access_token="+(h||Zn.ACCESS_TOKEN||""));var S={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:ia,userId:this.anonId},P=o?At(S,o):S,k={url:Mn(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([P])};this.pendingRequest=Ma(k,function(z){y.pendingRequest=null,u(z),y.saveEventData(),y.processRequests(h)})}},Zi.prototype.queueRequest=function(t,o){this.queue.push(t),this.processRequests(o)};var $i,Wa,de=function(t){function o(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postMapLoadEvent=function(u,h,y,b){this.skuToken=y,(Zn.EVENTS_URL&&b||Zn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(S){return Ai(S)||sa(S)}))&&this.queueRequest({id:h,timestamp:Date.now()},b)},o.prototype.processRequests=function(u){var h=this;if(!this.pendingRequest&&this.queue.length!==0){var y=this.queue.shift(),b=y.id,S=y.timestamp;b&&this.success[b]||(this.anonId||this.fetchEventData(),dt(this.anonId)||(this.anonId=lt()),this.postEvent(S,{skuToken:this.skuToken},function(P){P||b&&(h.success[b]=!0)},u))}},o}(Zi),Fn=new(function(t){function o(u){t.call(this,"appUserTurnstile"),this._customAccessToken=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postTurnstileEvent=function(u,h){Zn.EVENTS_URL&&Zn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(y){return Ai(y)||sa(y)})&&this.queueRequest(Date.now(),h)},o.prototype.processRequests=function(u){var h=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var y=Ei(Zn.ACCESS_TOKEN),b=y?y.u:Zn.ACCESS_TOKEN,S=b!==this.eventData.tokenU;dt(this.anonId)||(this.anonId=lt(),S=!0);var P=this.queue.shift();if(this.eventData.lastSuccess){var k=new Date(this.eventData.lastSuccess),z=new Date(P),Z=(P-this.eventData.lastSuccess)/864e5;S=S||Z>=1||Z<-1||k.getDate()!==z.getDate()}else S=!0;if(!S)return this.processRequests();this.postEvent(P,{"enabled.telemetry":!1},function(W){W||(h.eventData.lastSuccess=P,h.eventData.tokenU=b)},u)}},o}(Zi)),Xa=Fn.postTurnstileEvent.bind(Fn),vs=new de,jt=vs.postMapLoadEvent.bind(vs),or=500,Mr=50;function I(){ae.caches&&!$i&&($i=ae.caches.open("mapbox-tiles"))}function ar(t){var o=t.indexOf("?");return o<0?t:t.slice(0,o)}var kn,li=1/0;function jn(){return kn==null&&(kn=ae.OffscreenCanvas&&new ae.OffscreenCanvas(1,1).getContext("2d")&&typeof ae.createImageBitmap=="function"),kn}var an={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(an);var Pi=function(t){function o(u,h,y){h===401&&sa(y)&&(u+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,u),this.status=h,this.url=y,this.name=this.constructor.name,this.message=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},o}(Error),Ii=Br()?function(){return self.worker&&self.worker.referrer}:function(){return(ae.location.protocol==="blob:"?ae.parent:ae).location.href},Ja,ms,xa=function(t,o){if(!(/^file:/.test(u=t.url)||/^file:/.test(Ii())&&!/^\w+:/.test(u))){if(ae.fetch&&ae.Request&&ae.AbortController&&ae.Request.prototype.hasOwnProperty("signal"))return function(h,y){var b,S=new ae.AbortController,P=new ae.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Ii(),signal:S.signal}),k=!1,z=!1,Z=(b=P.url).indexOf("sku=")>0&&sa(b);h.type==="json"&&P.headers.set("Accept","application/json");var W=function(ne,Me,Oe){if(!z){if(ne&&ne.message!=="SecurityError"&&Qe(ne),Me&&Oe)return ee(Me);var Ye=Date.now();ae.fetch(P).then(function(Ze){if(Ze.ok){var st=Z?Ze.clone():null;return ee(Ze,st,Ye)}return y(new Pi(Ze.statusText,Ze.status,h.url))}).catch(function(Ze){Ze.code!==20&&y(new Error(Ze.message))})}},ee=function(ne,Me,Oe){(h.type==="arrayBuffer"?ne.arrayBuffer():h.type==="json"?ne.json():ne.text()).then(function(Ye){z||(Me&&Oe&&function(Ze,st,Ct){if(I(),$i){var Zt={status:st.status,statusText:st.statusText,headers:new ae.Headers};st.headers.forEach(function(lr,Lr){return Zt.headers.set(Lr,lr)});var Wt=Jr(st.headers.get("Cache-Control")||"");Wt["no-store"]||(Wt["max-age"]&&Zt.headers.set("Expires",new Date(Ct+1e3*Wt["max-age"]).toUTCString()),new Date(Zt.headers.get("Expires")).getTime()-Ct<42e4||function(lr,Lr){if(Wa===void 0)try{new Response(new ReadableStream),Wa=!0}catch(zr){Wa=!1}Wa?Lr(lr.body):lr.blob().then(Lr)}(st,function(lr){var Lr=new ae.Response(lr,Zt);I(),$i&&$i.then(function(zr){return zr.put(ar(Ze.url),Lr)}).catch(function(zr){return Qe(zr.message)})}))}}(P,Me,Oe),k=!0,y(null,Ye,ne.headers.get("Cache-Control"),ne.headers.get("Expires")))}).catch(function(Ye){z||y(new Error(Ye.message))})};return Z?function(ne,Me){if(I(),!$i)return Me(null);var Oe=ar(ne.url);$i.then(function(Ye){Ye.match(Oe).then(function(Ze){var st=function(Ct){if(!Ct)return!1;var Zt=new Date(Ct.headers.get("Expires")||0),Wt=Jr(Ct.headers.get("Cache-Control")||"");return Zt>Date.now()&&!Wt["no-cache"]}(Ze);Ye.delete(Oe),st&&Ye.put(Oe,Ze.clone()),Me(null,Ze,st)}).catch(Me)}).catch(Me)}(P,W):W(null,null),{cancel:function(){z=!0,k||S.abort()}}}(t,o);if(Br()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,o,void 0,!0)}var u;return function(h,y){var b=new ae.XMLHttpRequest;for(var S in b.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(b.responseType="arraybuffer"),h.headers)b.setRequestHeader(S,h.headers[S]);return h.type==="json"&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials=h.credentials==="include",b.onerror=function(){y(new Error(b.statusText))},b.onload=function(){if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){var P=b.response;if(h.type==="json")try{P=JSON.parse(b.response)}catch(k){return y(k)}y(null,P,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else y(new Pi(b.statusText,b.status,h.url))},b.send(h.body),{cancel:function(){return b.abort()}}}(t,o)},ka=function(t,o){return xa(At(t,{type:"arrayBuffer"}),o)},Ma=function(t,o){return xa(At(t,{method:"POST"}),o)},H="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Ja=[],ms=0;var $=function(t,o){if(Wn.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),ms>=Zn.MAX_PARALLEL_IMAGE_REQUESTS){var u={requestParameters:t,callback:o,cancelled:!1,cancel:function(){this.cancelled=!0}};return Ja.push(u),u}ms++;var h=!1,y=function(){if(!h)for(h=!0,ms--;Ja.length&&ms<Zn.MAX_PARALLEL_IMAGE_REQUESTS;){var S=Ja.shift();S.cancelled||(S.cancel=$(S.requestParameters,S.callback).cancel)}},b=ka(t,function(S,P,k,z){y(),S?o(S):P&&(jn()?function(Z,W){var ee=new ae.Blob([new Uint8Array(Z)],{type:"image/png"});ae.createImageBitmap(ee).then(function(ne){W(null,ne)}).catch(function(ne){W(new Error("Could not load image because of "+ne.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(P,o):function(Z,W,ee,ne){var Me=new ae.Image,Oe=ae.URL;Me.onload=function(){W(null,Me),Oe.revokeObjectURL(Me.src),Me.onload=null,ae.requestAnimationFrame(function(){Me.src=H})},Me.onerror=function(){return W(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Ye=new ae.Blob([new Uint8Array(Z)],{type:"image/png"});Me.cacheControl=ee,Me.expires=ne,Me.src=Z.byteLength?Oe.createObjectURL(Ye):H}(P,o,k,z))});return{cancel:function(){b.cancel(),y()}}};function re(t,o,u){u[t]&&u[t].indexOf(o)!==-1||(u[t]=u[t]||[],u[t].push(o))}function ge(t,o,u){if(u&&u[t]){var h=u[t].indexOf(o);h!==-1&&u[t].splice(h,1)}}var Ie=function(t,o){o===void 0&&(o={}),At(this,o),this.type=t},Ge=function(t){function o(u,h){h===void 0&&(h={}),t.call(this,"error",At({error:u},h))}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Ie),rt=function(){};rt.prototype.on=function(t,o){return this._listeners=this._listeners||{},re(t,o,this._listeners),this},rt.prototype.off=function(t,o){return ge(t,o,this._listeners),ge(t,o,this._oneTimeListeners),this},rt.prototype.once=function(t,o){return this._oneTimeListeners=this._oneTimeListeners||{},re(t,o,this._oneTimeListeners),this},rt.prototype.fire=function(t,o){typeof t=="string"&&(t=new Ie(t,o||{}));var u=t.type;if(this.listens(u)){t.target=this;for(var h=0,y=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];h<y.length;h+=1)y[h].call(this,t);for(var b=0,S=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];b<S.length;b+=1){var P=S[b];ge(u,P,this._oneTimeListeners),P.call(this,t)}var k=this._eventedParent;k&&(At(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),k.fire(t))}else t instanceof Ge&&console.error(t.error);return this},rt.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},rt.prototype.setEventedParent=function(t,o){return this._eventedParent=t,this._eventedParentData=o,this};var ce={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},De=function(t,o,u,h){this.message=(t?t+": ":"")+u,h&&(this.identifier=h),o!=null&&o.__line__&&(this.line=o.__line__)};function mt(t){var o=t.value;return o?[new De(t.key,o,"constants have been deprecated as of v8")]:[]}function mr(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var h=0,y=o;h<y.length;h+=1){var b=y[h];for(var S in b)t[S]=b[S]}return t}function Dt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Bt(t){if(Array.isArray(t))return t.map(Bt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var o={};for(var u in t)o[u]=Bt(t[u]);return o}return Dt(t)}var yr=function(t){function o(u,h){t.call(this,h),this.message=h,this.key=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Error),En=function(t,o){o===void 0&&(o=[]),this.parent=t,this.bindings={};for(var u=0,h=o;u<h.length;u+=1){var y=h[u];this.bindings[y[0]]=y[1]}};En.prototype.concat=function(t){return new En(this,t)},En.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},En.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var cn={kind:"null"},Pt={kind:"number"},un={kind:"string"},Gr={kind:"boolean"},Wr={kind:"color"},oi={kind:"object"},rn={kind:"value"},Ti={kind:"collator"},ea={kind:"formatted"},bi={kind:"resolvedImage"};function Oi(t,o){return{kind:"array",itemType:t,N:o}}function Si(t){if(t.kind==="array"){var o=Si(t.itemType);return typeof t.N=="number"?"array<"+o+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+o+">"}return t.kind}var ri=[cn,Pt,un,Gr,Wr,ea,oi,Oi(rn),bi];function Xi(t,o){if(o.kind==="error")return null;if(t.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!Xi(t.itemType,o.itemType))&&(typeof t.N!="number"||t.N===o.N))return null}else{if(t.kind===o.kind)return null;if(t.kind==="value"){for(var u=0,h=ri;u<h.length;u+=1)if(!Xi(h[u],o))return null}}return"Expected "+Si(t)+" but found "+Si(o)+" instead."}function Da(t,o){return o.some(function(u){return u.kind===t.kind})}function aa(t,o){return o.some(function(u){return u==="null"?t===null:u==="array"?Array.isArray(t):u==="object"?t&&!Array.isArray(t)&&typeof t=="object":u===typeof t})}var Ri=ve(function(t,o){var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function h(P){return(P=Math.round(P))<0?0:P>255?255:P}function y(P){return h(P[P.length-1]==="%"?parseFloat(P)/100*255:parseInt(P))}function b(P){return(k=P[P.length-1]==="%"?parseFloat(P)/100:parseFloat(P))<0?0:k>1?1:k;var k}function S(P,k,z){return z<0?z+=1:z>1&&(z-=1),6*z<1?P+(k-P)*z*6:2*z<1?k:3*z<2?P+(k-P)*(2/3-z)*6:P}try{o.parseCSSColor=function(P){var k,z=P.replace(/ /g,"").toLowerCase();if(z in u)return u[z].slice();if(z[0]==="#")return z.length===4?(k=parseInt(z.substr(1),16))>=0&&k<=4095?[(3840&k)>>4|(3840&k)>>8,240&k|(240&k)>>4,15&k|(15&k)<<4,1]:null:z.length===7&&(k=parseInt(z.substr(1),16))>=0&&k<=16777215?[(16711680&k)>>16,(65280&k)>>8,255&k,1]:null;var Z=z.indexOf("("),W=z.indexOf(")");if(Z!==-1&&W+1===z.length){var ee=z.substr(0,Z),ne=z.substr(Z+1,W-(Z+1)).split(","),Me=1;switch(ee){case"rgba":if(ne.length!==4)return null;Me=b(ne.pop());case"rgb":return ne.length!==3?null:[y(ne[0]),y(ne[1]),y(ne[2]),Me];case"hsla":if(ne.length!==4)return null;Me=b(ne.pop());case"hsl":if(ne.length!==3)return null;var Oe=(parseFloat(ne[0])%360+360)%360/360,Ye=b(ne[1]),Ze=b(ne[2]),st=Ze<=.5?Ze*(Ye+1):Ze+Ye-Ze*Ye,Ct=2*Ze-st;return[h(255*S(Ct,st,Oe+1/3)),h(255*S(Ct,st,Oe)),h(255*S(Ct,st,Oe-1/3)),Me];default:return null}}return null}}catch(P){}}).parseCSSColor,Gi=function(t,o,u,h){h===void 0&&(h=1),this.r=t,this.g=o,this.b=u,this.a=h};Gi.parse=function(t){if(t){if(t instanceof Gi)return t;if(typeof t=="string"){var o=Ri(t);if(o)return new Gi(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3])}}},Gi.prototype.toString=function(){var t=this.toArray(),o=t[1],u=t[2],h=t[3];return"rgba("+Math.round(t[0])+","+Math.round(o)+","+Math.round(u)+","+h+")"},Gi.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},Gi.black=new Gi(0,0,0,1),Gi.white=new Gi(1,1,1,1),Gi.transparent=new Gi(0,0,0,0),Gi.red=new Gi(1,0,0,1);var za=function(t,o,u){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};za.prototype.compare=function(t,o){return this.collator.compare(t,o)},za.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var su=function(t,o,u,h,y){this.text=t,this.image=o,this.scale=u,this.fontStack=h,this.textColor=y},Pa=function(t){this.sections=t};Pa.fromString=function(t){return new Pa([new su(t,null,null,null,null)])},Pa.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},Pa.factory=function(t){return t instanceof Pa?t:Pa.fromString(t)},Pa.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},Pa.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var h=u[o];if(h.image)t.push(["image",h.image.name]);else{t.push(h.text);var y={};h.fontStack&&(y["text-font"]=["literal",h.fontStack.split(",")]),h.scale&&(y["font-scale"]=h.scale),h.textColor&&(y["text-color"]=["rgba"].concat(h.textColor.toArray())),t.push(y)}}return t};var Ia=function(t){this.name=t.name,this.available=t.available};function As(t,o,u,h){return typeof t=="number"&&t>=0&&t<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:"Invalid rgba value ["+[t,o,u,h].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof h=="number"?[t,o,u,h]:[t,o,u]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function gs(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Gi||t instanceof za||t instanceof Pa||t instanceof Ia)return!0;if(Array.isArray(t)){for(var o=0,u=t;o<u.length;o+=1)if(!gs(u[o]))return!1;return!0}if(typeof t=="object"){for(var h in t)if(!gs(t[h]))return!1;return!0}return!1}function ta(t){if(t===null)return cn;if(typeof t=="string")return un;if(typeof t=="boolean")return Gr;if(typeof t=="number")return Pt;if(t instanceof Gi)return Wr;if(t instanceof za)return Ti;if(t instanceof Pa)return ea;if(t instanceof Ia)return bi;if(Array.isArray(t)){for(var o,u=t.length,h=0,y=t;h<y.length;h+=1){var b=ta(y[h]);if(o){if(o===b)continue;o=rn;break}o=b}return Oi(o||rn,u)}return oi}function Yu(t){var o=typeof t;return t===null?"":o==="string"||o==="number"||o==="boolean"?String(t):t instanceof Gi||t instanceof Pa||t instanceof Ia?t.toString():JSON.stringify(t)}Ia.prototype.toString=function(){return this.name},Ia.fromString=function(t){return t?new Ia({name:t,available:!1}):null},Ia.prototype.serialize=function(){return["image",this.name]};var _o=function(t,o){this.type=t,this.value=o};_o.parse=function(t,o){if(t.length!==2)return o.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!gs(t[1]))return o.error("invalid value");var u=t[1],h=ta(u),y=o.expectedType;return h.kind!=="array"||h.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(h=y),new _o(h,u)},_o.prototype.evaluate=function(){return this.value},_o.prototype.eachChild=function(){},_o.prototype.outputDefined=function(){return!0},_o.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Gi?["rgba"].concat(this.value.toArray()):this.value instanceof Pa?this.value.serialize():this.value};var Ua=function(t){this.name="ExpressionEvaluationError",this.message=t};Ua.prototype.toJSON=function(){return this.message};var so={string:un,number:Pt,boolean:Gr,object:oi},Qi=function(t,o){this.type=t,this.args=o};Qi.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u,h=1,y=t[0];if(y==="array"){var b,S;if(t.length>2){var P=t[1];if(typeof P!="string"||!(P in so)||P==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);b=so[P],h++}else b=rn;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);S=t[2],h++}u=Oi(b,S)}else u=so[y];for(var k=[];h<t.length;h++){var z=o.parse(t[h],h,rn);if(!z)return null;k.push(z)}return new Qi(u,k)},Qi.prototype.evaluate=function(t){for(var o=0;o<this.args.length;o++){var u=this.args[o].evaluate(t);if(!Xi(this.type,ta(u)))return u;if(o===this.args.length-1)throw new Ua("Expected value to be of type "+Si(this.type)+", but found "+Si(ta(u))+" instead.")}return null},Qi.prototype.eachChild=function(t){this.args.forEach(t)},Qi.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},Qi.prototype.serialize=function(){var t=this.type,o=[t.kind];if(t.kind==="array"){var u=t.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);var h=t.N;(typeof h=="number"||this.args.length>1)&&o.push(h)}}return o.concat(this.args.map(function(y){return y.serialize()}))};var qo=function(t){this.type=ea,this.sections=t};qo.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");for(var h=[],y=!1,b=1;b<=t.length-1;++b){var S=t[b];if(y&&typeof S=="object"&&!Array.isArray(S)){y=!1;var P=null;if(S["font-scale"]&&!(P=o.parse(S["font-scale"],1,Pt)))return null;var k=null;if(S["text-font"]&&!(k=o.parse(S["text-font"],1,Oi(un))))return null;var z=null;if(S["text-color"]&&!(z=o.parse(S["text-color"],1,Wr)))return null;var Z=h[h.length-1];Z.scale=P,Z.font=k,Z.textColor=z}else{var W=o.parse(t[b],1,rn);if(!W)return null;var ee=W.type.kind;if(ee!=="string"&&ee!=="value"&&ee!=="null"&&ee!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,h.push({content:W,scale:null,font:null,textColor:null})}}return new qo(h)},qo.prototype.evaluate=function(t){return new Pa(this.sections.map(function(o){var u=o.content.evaluate(t);return ta(u)===bi?new su("",u,null,null,null):new su(Yu(u),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null)}))},qo.prototype.eachChild=function(t){for(var o=0,u=this.sections;o<u.length;o+=1){var h=u[o];t(h.content),h.scale&&t(h.scale),h.font&&t(h.font),h.textColor&&t(h.textColor)}},qo.prototype.outputDefined=function(){return!1},qo.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var h=u[o];t.push(h.content.serialize());var y={};h.scale&&(y["font-scale"]=h.scale.serialize()),h.font&&(y["text-font"]=h.font.serialize()),h.textColor&&(y["text-color"]=h.textColor.serialize()),t.push(y)}return t};var Ko=function(t){this.type=bi,this.input=t};Ko.parse=function(t,o){if(t.length!==2)return o.error("Expected two arguments.");var u=o.parse(t[1],1,un);return u?new Ko(u):o.error("No image name provided.")},Ko.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=Ia.fromString(o);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(o)>-1),u},Ko.prototype.eachChild=function(t){t(this.input)},Ko.prototype.outputDefined=function(){return!1},Ko.prototype.serialize=function(){return["image",this.input.serialize()]};var qu={"to-boolean":Gr,"to-color":Wr,"to-number":Pt,"to-string":un},Ao=function(t,o){this.type=t,this.args=o};Ao.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[0];if((u==="to-boolean"||u==="to-string")&&t.length!==2)return o.error("Expected one argument.");for(var h=qu[u],y=[],b=1;b<t.length;b++){var S=o.parse(t[b],b,rn);if(!S)return null;y.push(S)}return new Ao(h,y)},Ao.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var o,u,h=0,y=this.args;h<y.length;h+=1){if(u=null,(o=y[h].evaluate(t))instanceof Gi)return o;if(typeof o=="string"){var b=t.parseColor(o);if(b)return b}else if(Array.isArray(o)&&!(u=o.length<3||o.length>4?"Invalid rbga value "+JSON.stringify(o)+": expected an array containing either three or four numeric values.":As(o[0],o[1],o[2],o[3])))return new Gi(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Ua(u||"Could not parse color from value '"+(typeof o=="string"?o:String(JSON.stringify(o)))+"'")}if(this.type.kind==="number"){for(var S=null,P=0,k=this.args;P<k.length;P+=1){if((S=k[P].evaluate(t))===null)return 0;var z=Number(S);if(!isNaN(z))return z}throw new Ua("Could not convert "+JSON.stringify(S)+" to number.")}return this.type.kind==="formatted"?Pa.fromString(Yu(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Ia.fromString(Yu(this.args[0].evaluate(t))):Yu(this.args[0].evaluate(t))},Ao.prototype.eachChild=function(t){this.args.forEach(t)},Ao.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},Ao.prototype.serialize=function(){if(this.type.kind==="formatted")return new qo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ko(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(o){t.push(o.serialize())}),t};var $o=["Unknown","Point","LineString","Polygon"],ba=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ba.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ba.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?$o[this.feature.type]:this.feature.type:null},ba.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ba.prototype.canonicalID=function(){return this.canonical},ba.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ba.prototype.parseColor=function(t){var o=this._parseColorCache[t];return o||(o=this._parseColorCache[t]=Gi.parse(t)),o};var xo=function(t,o,u,h){this.name=t,this.type=o,this._evaluate=u,this.args=h};xo.prototype.evaluate=function(t){return this._evaluate(t,this.args)},xo.prototype.eachChild=function(t){this.args.forEach(t)},xo.prototype.outputDefined=function(){return!1},xo.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},xo.parse=function(t,o){var u,h=t[0],y=xo.definitions[h];if(!y)return o.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0);for(var b=Array.isArray(y)?y[0]:y.type,S=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,P=S.filter(function(zn){var mn=zn[0];return!Array.isArray(mn)||mn.length===t.length-1}),k=null,z=0,Z=P;z<Z.length;z+=1){var W=Z[z],ee=W[0],ne=W[1];k=new Js(o.registry,o.path,null,o.scope);for(var Me=[],Oe=!1,Ye=1;Ye<t.length;Ye++){var Ze=t[Ye],st=Array.isArray(ee)?ee[Ye-1]:ee.type,Ct=k.parse(Ze,1+Me.length,st);if(!Ct){Oe=!0;break}Me.push(Ct)}if(!Oe)if(Array.isArray(ee)&&ee.length!==Me.length)k.error("Expected "+ee.length+" arguments, but found "+Me.length+" instead.");else{for(var Zt=0;Zt<Me.length;Zt++){var Wt=Array.isArray(ee)?ee[Zt]:ee.type,lr=Me[Zt];k.concat(Zt+1).checkSubtype(Wt,lr.type)}if(k.errors.length===0)return new xo(h,b,ne,Me)}}if(P.length===1)(u=o.errors).push.apply(u,k.errors);else{for(var Lr=(P.length?P:S).map(function(zn){var mn;return mn=zn[0],Array.isArray(mn)?"("+mn.map(Si).join(", ")+")":"("+Si(mn.type)+"...)"}).join(" | "),zr=[],Pn=1;Pn<t.length;Pn++){var pn=o.parse(t[Pn],1+zr.length);if(!pn)return null;zr.push(Si(pn.type))}o.error("Expected arguments of type "+Lr+", but found ("+zr.join(", ")+") instead.")}return null},xo.register=function(t,o){for(var u in xo.definitions=o,o)t[u]=xo};var Qo=function(t,o,u){this.type=Ti,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=o};function uo(t,o){t[0]=Math.min(t[0],o[0]),t[1]=Math.min(t[1],o[1]),t[2]=Math.max(t[2],o[0]),t[3]=Math.max(t[3],o[1])}function uu(t,o){return!(t[0]<=o[0]||t[2]>=o[2]||t[1]<=o[1]||t[3]>=o[3])}function Ac(t,o){var u=(180+t[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,y=Math.pow(2,o.z);return[Math.round(u*y*8192),Math.round(h*y*8192)]}function Fs(t,o,u){return o[1]>t[1]!=u[1]>t[1]&&t[0]<(u[0]-o[0])*(t[1]-o[1])/(u[1]-o[1])+o[0]}function Q(t,o){for(var u,h,y,b,S,P,k,z=!1,Z=0,W=o.length;Z<W;Z++)for(var ee=o[Z],ne=0,Me=ee.length;ne<Me-1;ne++){if((b=(u=t)[0]-(h=ee[ne])[0])*(k=u[1]-(y=ee[ne+1])[1])-(P=u[0]-y[0])*(S=u[1]-h[1])==0&&b*P<=0&&S*k<=0)return!1;Fs(t,ee[ne],ee[ne+1])&&(z=!z)}return z}function Ee(t,o){for(var u=0;u<o.length;u++)if(Q(t,o[u]))return!0;return!1}function Ke(t,o,u,h){var y=h[0]-u[0],b=h[1]-u[1],S=(t[0]-u[0])*b-y*(t[1]-u[1]),P=(o[0]-u[0])*b-y*(o[1]-u[1]);return S>0&&P<0||S<0&&P>0}function kt(t,o,u){for(var h=0,y=u;h<y.length;h+=1)for(var b=y[h],S=0;S<b.length-1;++S)if((W=[(Z=b[S+1])[0]-(z=b[S])[0],Z[1]-z[1]])[0]*(ee=[(k=o)[0]-(P=t)[0],k[1]-P[1]])[1]-W[1]*ee[0]!=0&&Ke(P,k,z,Z)&&Ke(z,Z,P,k))return!0;var P,k,z,Z,W,ee;return!1}function Fr(t,o){for(var u=0;u<t.length;++u)if(!Q(t[u],o))return!1;for(var h=0;h<t.length-1;++h)if(kt(t[h],t[h+1],o))return!1;return!0}function ot(t,o){for(var u=0;u<o.length;u++)if(Fr(t,o[u]))return!0;return!1}function wt(t,o,u){for(var h=[],y=0;y<t.length;y++){for(var b=[],S=0;S<t[y].length;S++){var P=Ac(t[y][S],u);uo(o,P),b.push(P)}h.push(b)}return h}function lo(t,o,u){for(var h=[],y=0;y<t.length;y++){var b=wt(t[y],o,u);h.push(b)}return h}function Ji(t,o,u,h){if(t[0]<u[0]||t[0]>u[2]){var y=.5*h,b=t[0]-u[0]>y?-h:u[0]-t[0]>y?h:0;b===0&&(b=t[0]-u[2]>y?-h:u[2]-t[0]>y?h:0),t[0]+=b}uo(o,t)}function Ya(t,o,u,h){for(var y=8192*Math.pow(2,h.z),b=[8192*h.x,8192*h.y],S=[],P=0,k=t;P<k.length;P+=1)for(var z=0,Z=k[P];z<Z.length;z+=1){var W=Z[z],ee=[W.x+b[0],W.y+b[1]];Ji(ee,o,u,y),S.push(ee)}return S}function Jo(t,o,u,h){for(var y,b=8192*Math.pow(2,h.z),S=[8192*h.x,8192*h.y],P=[],k=0,z=t;k<z.length;k+=1){for(var Z=[],W=0,ee=z[k];W<ee.length;W+=1){var ne=ee[W],Me=[ne.x+S[0],ne.y+S[1]];uo(o,Me),Z.push(Me)}P.push(Z)}if(o[2]-o[0]<=b/2){(y=o)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(var Oe=0,Ye=P;Oe<Ye.length;Oe+=1)for(var Ze=0,st=Ye[Oe];Ze<st.length;Ze+=1)Ji(st[Ze],o,u,b)}return P}Qo.parse=function(t,o){if(t.length!==2)return o.error("Expected one argument.");var u=t[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");var h=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Gr);if(!h)return null;var y=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Gr);if(!y)return null;var b=null;return u.locale&&!(b=o.parse(u.locale,1,un))?null:new Qo(h,y,b)},Qo.prototype.evaluate=function(t){return new za(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Qo.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Qo.prototype.outputDefined=function(){return!1},Qo.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var en=function(t,o){this.type=Gr,this.geojson=t,this.geometries=o};function $r(t){if(t instanceof xo&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof en)return!1;var o=!0;return t.eachChild(function(u){o&&!$r(u)&&(o=!1)}),o}function Rt(t){if(t instanceof xo&&t.name==="feature-state")return!1;var o=!0;return t.eachChild(function(u){o&&!Rt(u)&&(o=!1)}),o}function Vo(t,o){if(t instanceof xo&&o.indexOf(t.name)>=0)return!1;var u=!0;return t.eachChild(function(h){u&&!Vo(h,o)&&(u=!1)}),u}en.parse=function(t,o){if(t.length!==2)return o.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(gs(t[1])){var u=t[1];if(u.type==="FeatureCollection")for(var h=0;h<u.features.length;++h){var y=u.features[h].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new en(u,u.features[h].geometry)}else if(u.type==="Feature"){var b=u.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new en(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new en(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")},en.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(o,u){var h=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=wt(u.coordinates,y,b),P=Ya(o.geometry(),h,y,b);if(!uu(h,y))return!1;for(var k=0,z=P;k<z.length;k+=1)if(!Q(z[k],S))return!1}if(u.type==="MultiPolygon"){var Z=lo(u.coordinates,y,b),W=Ya(o.geometry(),h,y,b);if(!uu(h,y))return!1;for(var ee=0,ne=W;ee<ne.length;ee+=1)if(!Ee(ne[ee],Z))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(o,u){var h=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=wt(u.coordinates,y,b),P=Jo(o.geometry(),h,y,b);if(!uu(h,y))return!1;for(var k=0,z=P;k<z.length;k+=1)if(!Fr(z[k],S))return!1}if(u.type==="MultiPolygon"){var Z=lo(u.coordinates,y,b),W=Jo(o.geometry(),h,y,b);if(!uu(h,y))return!1;for(var ee=0,ne=W;ee<ne.length;ee+=1)if(!ot(ne[ee],Z))return!1}return!0}(t,this.geometries)}return!1},en.prototype.eachChild=function(){},en.prototype.outputDefined=function(){return!0},en.prototype.serialize=function(){return["within",this.geojson]};var he=function(t,o){this.type=o.type,this.name=t,this.boundExpression=o};he.parse=function(t,o){if(t.length!==2||typeof t[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");var u=t[1];return o.scope.has(u)?new he(u,o.scope.get(u)):o.error('Unknown variable "'+u+'". Make sure "'+u+'" has been bound in an enclosing "let" expression before using it.',1)},he.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},he.prototype.eachChild=function(){},he.prototype.outputDefined=function(){return!1},he.prototype.serialize=function(){return["var",this.name]};var Js=function(t,o,u,h,y){o===void 0&&(o=[]),h===void 0&&(h=new En),y===void 0&&(y=[]),this.registry=t,this.path=o,this.key=o.map(function(b){return"["+b+"]"}).join(""),this.scope=h,this.errors=y,this.expectedType=u};function lu(t,o){for(var u,h=t.length-1,y=0,b=h,S=0;y<=b;)if((u=t[S=Math.floor((y+b)/2)])<=o){if(S===h||o<t[S+1])return S;y=S+1}else{if(!(u>o))throw new Ua("Input is not a number.");b=S-1}return 0}Js.prototype.parse=function(t,o,u,h,y){return y===void 0&&(y={}),o?this.concat(o,u,h)._parse(t,y):this._parse(t,y)},Js.prototype._parse=function(t,o){function u(z,Z,W){return W==="assert"?new Qi(Z,[z]):W==="coerce"?new Ao(Z,[z]):z}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var h=t[0];if(typeof h!="string")return this.error("Expression name must be a string, but found "+typeof h+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var y=this.registry[h];if(y){var b=y.parse(t,this);if(!b)return null;if(this.expectedType){var S=this.expectedType,P=b.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||P.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string"){if(this.checkSubtype(S,P))return null}else b=u(b,S,o.typeAnnotation||"coerce");else b=u(b,S,o.typeAnnotation||"assert")}if(!(b instanceof _o)&&b.type.kind!=="resolvedImage"&&function z(Z){if(Z instanceof he)return z(Z.boundExpression);if(Z instanceof xo&&Z.name==="error"||Z instanceof Qo||Z instanceof en)return!1;var W=Z instanceof Ao||Z instanceof Qi,ee=!0;return Z.eachChild(function(ne){ee=W?ee&&z(ne):ee&&ne instanceof _o}),!!ee&&$r(Z)&&Vo(Z,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(b)){var k=new ba;try{b=new _o(b.type,b.evaluate(k))}catch(z){return this.error(z.message),null}}return b}return this.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Js.prototype.concat=function(t,o,u){var h=typeof t=="number"?this.path.concat(t):this.path,y=u?this.scope.concat(u):this.scope;return new Js(this.registry,h,o||null,y,this.errors)},Js.prototype.error=function(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];var h=""+this.key+o.map(function(y){return"["+y+"]"}).join("");this.errors.push(new yr(h,t))},Js.prototype.checkSubtype=function(t,o){var u=Xi(t,o);return u&&this.error(u),u};var ys=function(t,o,u){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(var h=0,y=u;h<y.length;h+=1){var b=y[h],S=b[1];this.labels.push(b[0]),this.outputs.push(S)}};function oa(t,o,u){return t*(1-u)+o*u}ys.parse=function(t,o){if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");var u=o.parse(t[1],1,Pt);if(!u)return null;var h=[],y=null;o.expectedType&&o.expectedType.kind!=="value"&&(y=o.expectedType);for(var b=1;b<t.length;b+=2){var S=b===1?-1/0:t[b],P=t[b+1],k=b,z=b+1;if(typeof S!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(h.length&&h[h.length-1][0]>=S)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);var Z=o.parse(P,z,y);if(!Z)return null;y=y||Z.type,h.push([S,Z])}return new ys(y,u,h)},ys.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var h=this.input.evaluate(t);if(h<=o[0])return u[0].evaluate(t);var y=o.length;return h>=o[y-1]?u[y-1].evaluate(t):u[lu(o,h)].evaluate(t)},ys.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},ys.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},ys.prototype.serialize=function(){for(var t=["step",this.input.serialize()],o=0;o<this.labels.length;o++)o>0&&t.push(this.labels[o]),t.push(this.outputs[o].serialize());return t};var bo=Object.freeze({__proto__:null,number:oa,color:function(t,o,u){return new Gi(oa(t.r,o.r,u),oa(t.g,o.g,u),oa(t.b,o.b,u),oa(t.a,o.a,u))},array:function(t,o,u){return t.map(function(h,y){return oa(h,o[y],u)})}}),Kl=6/29*3*(6/29),wc=Math.PI/180,Ku=180/Math.PI;function Tc(t){return t>.008856451679035631?Math.pow(t,1/3):t/Kl+4/29}function Ml(t){return t>6/29?t*t*t:Kl*(t-4/29)}function $u(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function cu(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Qu(t){var o=cu(t.r),u=cu(t.g),h=cu(t.b),y=Tc((.4124564*o+.3575761*u+.1804375*h)/.95047),b=Tc((.2126729*o+.7151522*u+.072175*h)/1);return{l:116*b-16,a:500*(y-b),b:200*(b-Tc((.0193339*o+.119192*u+.9503041*h)/1.08883)),alpha:t.a}}function _(t){var o=(t.l+16)/116,u=isNaN(t.a)?o:o+t.a/500,h=isNaN(t.b)?o:o-t.b/200;return o=1*Ml(o),u=.95047*Ml(u),h=1.08883*Ml(h),new Gi($u(3.2404542*u-1.5371385*o-.4985314*h),$u(-.969266*u+1.8760108*o+.041556*h),$u(.0556434*u-.2040259*o+1.0572252*h),t.alpha)}function T(t,o,u){var h=o-t;return t+u*(h>180||h<-180?h-360*Math.round(h/360):h)}var F={forward:Qu,reverse:_,interpolate:function(t,o,u){return{l:oa(t.l,o.l,u),a:oa(t.a,o.a,u),b:oa(t.b,o.b,u),alpha:oa(t.alpha,o.alpha,u)}}},R={forward:function(t){var o=Qu(t),u=o.l,h=o.a,y=o.b,b=Math.atan2(y,h)*Ku;return{h:b<0?b+360:b,c:Math.sqrt(h*h+y*y),l:u,alpha:t.a}},reverse:function(t){var o=t.h*wc,u=t.c;return _({l:t.l,a:Math.cos(o)*u,b:Math.sin(o)*u,alpha:t.alpha})},interpolate:function(t,o,u){return{h:T(t.h,o.h,u),c:oa(t.c,o.c,u),l:oa(t.l,o.l,u),alpha:oa(t.alpha,o.alpha,u)}}},K=Object.freeze({__proto__:null,lab:F,hcl:R}),xe=function(t,o,u,h,y){this.type=t,this.operator=o,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(var b=0,S=y;b<S.length;b+=1){var P=S[b],k=P[1];this.labels.push(P[0]),this.outputs.push(k)}};function We(t,o,u,h){var y=h-u,b=t-u;return y===0?0:o===1?b/y:(Math.pow(o,b)-1)/(Math.pow(o,y)-1)}xe.interpolationFactor=function(t,o,u,h){var y=0;if(t.name==="exponential")y=We(o,t.base,u,h);else if(t.name==="linear")y=We(o,1,u,h);else if(t.name==="cubic-bezier"){var b=t.controlPoints;y=new j(b[0],b[1],b[2],b[3]).solve(We(o,1,u,h))}return y},xe.parse=function(t,o){var u=t[0],h=t[1],y=t[2],b=t.slice(3);if(!Array.isArray(h)||h.length===0)return o.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){var S=h[1];if(typeof S!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:S}}else{if(h[0]!=="cubic-bezier")return o.error("Unknown interpolation type "+String(h[0]),1,0);var P=h.slice(1);if(P.length!==4||P.some(function(Ye){return typeof Ye!="number"||Ye<0||Ye>1}))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:P}}if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(!(y=o.parse(y,2,Pt)))return null;var k=[],z=null;u==="interpolate-hcl"||u==="interpolate-lab"?z=Wr:o.expectedType&&o.expectedType.kind!=="value"&&(z=o.expectedType);for(var Z=0;Z<b.length;Z+=2){var W=b[Z],ee=b[Z+1],ne=Z+3,Me=Z+4;if(typeof W!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ne);if(k.length&&k[k.length-1][0]>=W)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ne);var Oe=o.parse(ee,Me,z);if(!Oe)return null;z=z||Oe.type,k.push([W,Oe])}return z.kind==="number"||z.kind==="color"||z.kind==="array"&&z.itemType.kind==="number"&&typeof z.N=="number"?new xe(z,u,h,y,k):o.error("Type "+Si(z)+" is not interpolatable.")},xe.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var h=this.input.evaluate(t);if(h<=o[0])return u[0].evaluate(t);var y=o.length;if(h>=o[y-1])return u[y-1].evaluate(t);var b=lu(o,h),S=xe.interpolationFactor(this.interpolation,h,o[b],o[b+1]),P=u[b].evaluate(t),k=u[b+1].evaluate(t);return this.operator==="interpolate"?bo[this.type.kind.toLowerCase()](P,k,S):this.operator==="interpolate-hcl"?R.reverse(R.interpolate(R.forward(P),R.forward(k),S)):F.reverse(F.interpolate(F.forward(P),F.forward(k),S))},xe.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},xe.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},xe.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var o=[this.operator,t,this.input.serialize()],u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o};var ct=function(t,o){this.type=t,this.args=o};ct.parse=function(t,o){if(t.length<2)return o.error("Expectected at least one argument.");var u=null,h=o.expectedType;h&&h.kind!=="value"&&(u=h);for(var y=[],b=0,S=t.slice(1);b<S.length;b+=1){var P=o.parse(S[b],1+y.length,u,void 0,{typeAnnotation:"omit"});if(!P)return null;u=u||P.type,y.push(P)}var k=h&&y.some(function(z){return Xi(h,z.type)});return new ct(k?rn:u,y)},ct.prototype.evaluate=function(t){for(var o,u=null,h=0,y=0,b=this.args;y<b.length&&(h++,(u=b[y].evaluate(t))&&u instanceof Ia&&!u.available&&(o||(o=u.name),u=null,h===this.args.length&&(u=o)),u===null);y+=1);return u},ct.prototype.eachChild=function(t){this.args.forEach(t)},ct.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ct.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(o){t.push(o.serialize())}),t};var ht=function(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o};ht.prototype.evaluate=function(t){return this.result.evaluate(t)},ht.prototype.eachChild=function(t){for(var o=0,u=this.bindings;o<u.length;o+=1)t(u[o][1]);t(this.result)},ht.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var u=[],h=1;h<t.length-1;h+=2){var y=t[h];if(typeof y!="string")return o.error("Expected string, but found "+typeof y+" instead.",h);if(/[^a-zA-Z0-9_]/.test(y))return o.error("Variable names must contain only alphanumeric characters or '_'.",h);var b=o.parse(t[h+1],h+1);if(!b)return null;u.push([y,b])}var S=o.parse(t[t.length-1],t.length-1,o.expectedType,u);return S?new ht(u,S):null},ht.prototype.outputDefined=function(){return this.result.outputDefined()},ht.prototype.serialize=function(){for(var t=["let"],o=0,u=this.bindings;o<u.length;o+=1){var h=u[o];t.push(h[0],h[1].serialize())}return t.push(this.result.serialize()),t};var cr=function(t,o,u){this.type=t,this.index=o,this.input=u};cr.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Pt),h=o.parse(t[2],2,Oi(o.expectedType||rn));return u&&h?new cr(h.type.itemType,u,h):null},cr.prototype.evaluate=function(t){var o=this.index.evaluate(t),u=this.input.evaluate(t);if(o<0)throw new Ua("Array index out of bounds: "+o+" < 0.");if(o>=u.length)throw new Ua("Array index out of bounds: "+o+" > "+(u.length-1)+".");if(o!==Math.floor(o))throw new Ua("Array index must be an integer, but found "+o+" instead.");return u[o]},cr.prototype.eachChild=function(t){t(this.index),t(this.input)},cr.prototype.outputDefined=function(){return!1},cr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var xr=function(t,o){this.type=Gr,this.needle=t,this.haystack=o};xr.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,rn),h=o.parse(t[2],2,rn);return u&&h?Da(u.type,[Gr,un,Pt,cn,rn])?new xr(u,h):o.error("Expected first argument to be of type boolean, string, number or null, but found "+Si(u.type)+" instead"):null},xr.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!u)return!1;if(!aa(o,["boolean","string","number","null"]))throw new Ua("Expected first argument to be of type boolean, string, number or null, but found "+Si(ta(o))+" instead.");if(!aa(u,["string","array"]))throw new Ua("Expected second argument to be of type array or string, but found "+Si(ta(u))+" instead.");return u.indexOf(o)>=0},xr.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},xr.prototype.outputDefined=function(){return!0},xr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Rn=function(t,o,u){this.type=Pt,this.needle=t,this.haystack=o,this.fromIndex=u};Rn.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,rn),h=o.parse(t[2],2,rn);if(!u||!h)return null;if(!Da(u.type,[Gr,un,Pt,cn,rn]))return o.error("Expected first argument to be of type boolean, string, number or null, but found "+Si(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,Pt);return y?new Rn(u,h,y):null}return new Rn(u,h)},Rn.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!aa(o,["boolean","string","number","null"]))throw new Ua("Expected first argument to be of type boolean, string, number or null, but found "+Si(ta(o))+" instead.");if(!aa(u,["string","array"]))throw new Ua("Expected second argument to be of type array or string, but found "+Si(ta(u))+" instead.");if(this.fromIndex){var h=this.fromIndex.evaluate(t);return u.indexOf(o,h)}return u.indexOf(o)},Rn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},Rn.prototype.outputDefined=function(){return!1},Rn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var ci=function(t,o,u,h,y,b){this.inputType=t,this.type=o,this.input=u,this.cases=h,this.outputs=y,this.otherwise=b};ci.parse=function(t,o){if(t.length<5)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return o.error("Expected an even number of arguments.");var u,h;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);for(var y={},b=[],S=2;S<t.length-1;S+=2){var P=t[S],k=t[S+1];Array.isArray(P)||(P=[P]);var z=o.concat(S);if(P.length===0)return z.error("Expected at least one branch label.");for(var Z=0,W=P;Z<W.length;Z+=1){var ee=W[Z];if(typeof ee!="number"&&typeof ee!="string")return z.error("Branch labels must be numbers or strings.");if(typeof ee=="number"&&Math.abs(ee)>Number.MAX_SAFE_INTEGER)return z.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof ee=="number"&&Math.floor(ee)!==ee)return z.error("Numeric branch labels must be integer values.");if(u){if(z.checkSubtype(u,ta(ee)))return null}else u=ta(ee);if(y[String(ee)]!==void 0)return z.error("Branch labels must be unique.");y[String(ee)]=b.length}var ne=o.parse(k,S,h);if(!ne)return null;h=h||ne.type,b.push(ne)}var Me=o.parse(t[1],1,rn);if(!Me)return null;var Oe=o.parse(t[t.length-1],t.length-1,h);return Oe?Me.type.kind!=="value"&&o.concat(1).checkSubtype(u,Me.type)?null:new ci(u,h,Me,y,b,Oe):null},ci.prototype.evaluate=function(t){var o=this.input.evaluate(t);return(ta(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)},ci.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},ci.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},ci.prototype.serialize=function(){for(var t=this,o=["match",this.input.serialize()],u=[],h={},y=0,b=Object.keys(this.cases).sort();y<b.length;y+=1){var S=b[y];(W=h[this.cases[S]])===void 0?(h[this.cases[S]]=u.length,u.push([this.cases[S],[S]])):u[W][1].push(S)}for(var P=function(ne){return t.inputType.kind==="number"?Number(ne):ne},k=0,z=u;k<z.length;k+=1){var Z=z[k],W=Z[0],ee=Z[1];o.push(ee.length===1?P(ee[0]):ee.map(P)),o.push(this.outputs[outputIndex$1].serialize())}return o.push(this.otherwise.serialize()),o};var Jn=function(t,o,u){this.type=t,this.branches=o,this.otherwise=u};Jn.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return o.error("Expected an odd number of arguments.");var u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);for(var h=[],y=1;y<t.length-1;y+=2){var b=o.parse(t[y],y,Gr);if(!b)return null;var S=o.parse(t[y+1],y+1,u);if(!S)return null;h.push([b,S]),u=u||S.type}var P=o.parse(t[t.length-1],t.length-1,u);return P?new Jn(u,h,P):null},Jn.prototype.evaluate=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var h=u[o],y=h[1];if(h[0].evaluate(t))return y.evaluate(t)}return this.otherwise.evaluate(t)},Jn.prototype.eachChild=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var h=u[o],y=h[1];t(h[0]),t(y)}t(this.otherwise)},Jn.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},Jn.prototype.serialize=function(){var t=["case"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Yi=function(t,o,u,h){this.type=t,this.input=o,this.beginIndex=u,this.endIndex=h};function ha(t,o){return t==="=="||t==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function La(t,o,u,h){return h.compare(o,u)===0}function Hi(t,o,u){var h=t!=="=="&&t!=="!=";return function(){function y(b,S,P){this.type=Gr,this.lhs=b,this.rhs=S,this.collator=P,this.hasUntypedArgument=b.type.kind==="value"||S.type.kind==="value"}return y.parse=function(b,S){if(b.length!==3&&b.length!==4)return S.error("Expected two or three arguments.");var P=b[0],k=S.parse(b[1],1,rn);if(!k)return null;if(!ha(P,k.type))return S.concat(1).error('"'+P+`" comparisons are not supported for type '`+Si(k.type)+"'.");var z=S.parse(b[2],2,rn);if(!z)return null;if(!ha(P,z.type))return S.concat(2).error('"'+P+`" comparisons are not supported for type '`+Si(z.type)+"'.");if(k.type.kind!==z.type.kind&&k.type.kind!=="value"&&z.type.kind!=="value")return S.error("Cannot compare types '"+Si(k.type)+"' and '"+Si(z.type)+"'.");h&&(k.type.kind==="value"&&z.type.kind!=="value"?k=new Qi(z.type,[k]):k.type.kind!=="value"&&z.type.kind==="value"&&(z=new Qi(k.type,[z])));var Z=null;if(b.length===4){if(k.type.kind!=="string"&&z.type.kind!=="string"&&k.type.kind!=="value"&&z.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(Z=S.parse(b[3],3,Ti)))return null}return new y(k,z,Z)},y.prototype.evaluate=function(b){var S=this.lhs.evaluate(b),P=this.rhs.evaluate(b);if(h&&this.hasUntypedArgument){var k=ta(S),z=ta(P);if(k.kind!==z.kind||k.kind!=="string"&&k.kind!=="number")throw new Ua('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+k.kind+", "+z.kind+") instead.")}if(this.collator&&!h&&this.hasUntypedArgument){var Z=ta(S),W=ta(P);if(Z.kind!=="string"||W.kind!=="string")return o(b,S,P)}return this.collator?u(b,S,P,this.collator.evaluate(b)):o(b,S,P)},y.prototype.eachChild=function(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)},y.prototype.outputDefined=function(){return!0},y.prototype.serialize=function(){var b=[t];return this.eachChild(function(S){b.push(S.serialize())}),b},y}()}Yi.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,rn),h=o.parse(t[2],2,Pt);if(!u||!h)return null;if(!Da(u.type,[Oi(rn),un,rn]))return o.error("Expected first argument to be of type array or string, but found "+Si(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,Pt);return y?new Yi(u.type,u,h,y):null}return new Yi(u.type,u,h)},Yi.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!aa(o,["string","array"]))throw new Ua("Expected first argument to be of type array or string, but found "+Si(ta(o))+" instead.");if(this.endIndex){var h=this.endIndex.evaluate(t);return o.slice(u,h)}return o.slice(u)},Yi.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},Yi.prototype.outputDefined=function(){return!1},Yi.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Fo=Hi("==",function(t,o,u){return o===u},La),ws=Hi("!=",function(t,o,u){return o!==u},function(t,o,u,h){return!La(0,o,u,h)}),pl=Hi("<",function(t,o,u){return o<u},function(t,o,u,h){return h.compare(o,u)<0}),tf=Hi(">",function(t,o,u){return o>u},function(t,o,u,h){return h.compare(o,u)>0}),Ju=Hi("<=",function(t,o,u){return o<=u},function(t,o,u,h){return h.compare(o,u)<=0}),Mc=Hi(">=",function(t,o,u){return o>=u},function(t,o,u,h){return h.compare(o,u)>=0}),Ru=function(t,o,u,h,y){this.type=un,this.number=t,this.locale=o,this.currency=u,this.minFractionDigits=h,this.maxFractionDigits=y};Ru.parse=function(t,o){if(t.length!==3)return o.error("Expected two arguments.");var u=o.parse(t[1],1,Pt);if(!u)return null;var h=t[2];if(typeof h!="object"||Array.isArray(h))return o.error("NumberFormat options argument must be an object.");var y=null;if(h.locale&&!(y=o.parse(h.locale,1,un)))return null;var b=null;if(h.currency&&!(b=o.parse(h.currency,1,un)))return null;var S=null;if(h["min-fraction-digits"]&&!(S=o.parse(h["min-fraction-digits"],1,Pt)))return null;var P=null;return h["max-fraction-digits"]&&!(P=o.parse(h["max-fraction-digits"],1,Pt))?null:new Ru(u,y,b,S,P)},Ru.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Ru.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Ru.prototype.outputDefined=function(){return!1},Ru.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var yu=function(t){this.type=Pt,this.input=t};yu.parse=function(t,o){if(t.length!==2)return o.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error("Expected argument of type string or array, but found "+Si(u.type)+" instead."):new yu(u):null},yu.prototype.evaluate=function(t){var o=this.input.evaluate(t);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Ua("Expected value to be of type string or array, but found "+Si(ta(o))+" instead.")},yu.prototype.eachChild=function(t){t(this.input)},yu.prototype.outputDefined=function(){return!1},yu.prototype.serialize=function(){var t=["length"];return this.eachChild(function(o){t.push(o.serialize())}),t};var wo={"==":Fo,"!=":ws,">":tf,"<":pl,">=":Mc,"<=":Ju,array:Qi,at:cr,boolean:Qi,case:Jn,coalesce:ct,collator:Qo,format:qo,image:Ko,in:xr,"index-of":Rn,interpolate:xe,"interpolate-hcl":xe,"interpolate-lab":xe,length:yu,let:ht,literal:_o,match:ci,number:Qi,"number-format":Ru,object:Qi,slice:Yi,step:ys,string:Qi,"to-boolean":Ao,"to-color":Ao,"to-number":Ao,"to-string":Ao,var:he,within:en};function da(t,o){var u=o[0],h=o[1],y=o[2],b=o[3];u=u.evaluate(t),h=h.evaluate(t),y=y.evaluate(t);var S=b?b.evaluate(t):1,P=As(u,h,y,S);if(P)throw new Ua(P);return new Gi(u/255*S,h/255*S,y/255*S,S)}function yp(t,o){return t in o}function _p(t,o){var u=o[t];return u===void 0?null:u}function vo(t){return{type:t}}function Ff(t){return{result:"success",value:t}}function _u(t){return{result:"error",value:t}}function Bs(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function Pc(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function hl(t){return!!t.expression&&t.expression.interpolated}function Aa(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Pl(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function $l(t){return t}function os(t,o,u){return t!==void 0?t:o!==void 0?o:u!==void 0?u:void 0}function Bf(t,o,u,h,y){return os(typeof u===y?h[u]:void 0,t.default,o.default)}function xp(t,o,u){if(Aa(u)!=="number")return os(t.default,o.default);var h=t.stops.length;if(h===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[h-1][0])return t.stops[h-1][1];var y=lu(t.stops.map(function(b){return b[0]}),u);return t.stops[y][1]}function bp(t,o,u){var h=t.base!==void 0?t.base:1;if(Aa(u)!=="number")return os(t.default,o.default);var y=t.stops.length;if(y===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[y-1][0])return t.stops[y-1][1];var b=lu(t.stops.map(function(W){return W[0]}),u),S=function(W,ee,ne,Me){var Oe=Me-ne,Ye=W-ne;return Oe===0?0:ee===1?Ye/Oe:(Math.pow(ee,Ye)-1)/(Math.pow(ee,Oe)-1)}(u,h,t.stops[b][0],t.stops[b+1][0]),P=t.stops[b][1],k=t.stops[b+1][1],z=bo[o.type]||$l;if(t.colorSpace&&t.colorSpace!=="rgb"){var Z=K[t.colorSpace];z=function(W,ee){return Z.reverse(Z.interpolate(Z.forward(W),Z.forward(ee),S))}}return typeof P.evaluate=="function"?{evaluate:function(){for(var W=[],ee=arguments.length;ee--;)W[ee]=arguments[ee];var ne=P.evaluate.apply(void 0,W),Me=k.evaluate.apply(void 0,W);if(ne!==void 0&&Me!==void 0)return z(ne,Me,S)}}:z(P,k,S)}function rf(t,o,u){return o.type==="color"?u=Gi.parse(u):o.type==="formatted"?u=Pa.fromString(u.toString()):o.type==="resolvedImage"?u=Ia.fromString(u.toString()):Aa(u)===o.type||o.type==="enum"&&o.values[u]||(u=void 0),os(u,t.default,o.default)}xo.register(wo,{error:[{kind:"error"},[un],function(t,o){throw new Ua(o[0].evaluate(t))}],typeof:[un,[rn],function(t,o){return Si(ta(o[0].evaluate(t)))}],"to-rgba":[Oi(Pt,4),[Wr],function(t,o){return o[0].evaluate(t).toArray()}],rgb:[Wr,[Pt,Pt,Pt],da],rgba:[Wr,[Pt,Pt,Pt,Pt],da],has:{type:Gr,overloads:[[[un],function(t,o){return yp(o[0].evaluate(t),t.properties())}],[[un,oi],function(t,o){var u=o[1];return yp(o[0].evaluate(t),u.evaluate(t))}]]},get:{type:rn,overloads:[[[un],function(t,o){return _p(o[0].evaluate(t),t.properties())}],[[un,oi],function(t,o){var u=o[1];return _p(o[0].evaluate(t),u.evaluate(t))}]]},"feature-state":[rn,[un],function(t,o){return _p(o[0].evaluate(t),t.featureState||{})}],properties:[oi,[],function(t){return t.properties()}],"geometry-type":[un,[],function(t){return t.geometryType()}],id:[rn,[],function(t){return t.id()}],zoom:[Pt,[],function(t){return t.globals.zoom}],"heatmap-density":[Pt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Pt,[],function(t){return t.globals.lineProgress||0}],accumulated:[rn,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[Pt,vo(Pt),function(t,o){for(var u=0,h=0,y=o;h<y.length;h+=1)u+=y[h].evaluate(t);return u}],"*":[Pt,vo(Pt),function(t,o){for(var u=1,h=0,y=o;h<y.length;h+=1)u*=y[h].evaluate(t);return u}],"-":{type:Pt,overloads:[[[Pt,Pt],function(t,o){var u=o[1];return o[0].evaluate(t)-u.evaluate(t)}],[[Pt],function(t,o){return-o[0].evaluate(t)}]]},"/":[Pt,[Pt,Pt],function(t,o){var u=o[1];return o[0].evaluate(t)/u.evaluate(t)}],"%":[Pt,[Pt,Pt],function(t,o){var u=o[1];return o[0].evaluate(t)%u.evaluate(t)}],ln2:[Pt,[],function(){return Math.LN2}],pi:[Pt,[],function(){return Math.PI}],e:[Pt,[],function(){return Math.E}],"^":[Pt,[Pt,Pt],function(t,o){var u=o[1];return Math.pow(o[0].evaluate(t),u.evaluate(t))}],sqrt:[Pt,[Pt],function(t,o){return Math.sqrt(o[0].evaluate(t))}],log10:[Pt,[Pt],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN10}],ln:[Pt,[Pt],function(t,o){return Math.log(o[0].evaluate(t))}],log2:[Pt,[Pt],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN2}],sin:[Pt,[Pt],function(t,o){return Math.sin(o[0].evaluate(t))}],cos:[Pt,[Pt],function(t,o){return Math.cos(o[0].evaluate(t))}],tan:[Pt,[Pt],function(t,o){return Math.tan(o[0].evaluate(t))}],asin:[Pt,[Pt],function(t,o){return Math.asin(o[0].evaluate(t))}],acos:[Pt,[Pt],function(t,o){return Math.acos(o[0].evaluate(t))}],atan:[Pt,[Pt],function(t,o){return Math.atan(o[0].evaluate(t))}],min:[Pt,vo(Pt),function(t,o){return Math.min.apply(Math,o.map(function(u){return u.evaluate(t)}))}],max:[Pt,vo(Pt),function(t,o){return Math.max.apply(Math,o.map(function(u){return u.evaluate(t)}))}],abs:[Pt,[Pt],function(t,o){return Math.abs(o[0].evaluate(t))}],round:[Pt,[Pt],function(t,o){var u=o[0].evaluate(t);return u<0?-Math.round(-u):Math.round(u)}],floor:[Pt,[Pt],function(t,o){return Math.floor(o[0].evaluate(t))}],ceil:[Pt,[Pt],function(t,o){return Math.ceil(o[0].evaluate(t))}],"filter-==":[Gr,[un,rn],function(t,o){var u=o[0],h=o[1];return t.properties()[u.value]===h.value}],"filter-id-==":[Gr,[rn],function(t,o){var u=o[0];return t.id()===u.value}],"filter-type-==":[Gr,[un],function(t,o){var u=o[0];return t.geometryType()===u.value}],"filter-<":[Gr,[un,rn],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y<b}],"filter-id-<":[Gr,[rn],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h<y}],"filter->":[Gr,[un,rn],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y>b}],"filter-id->":[Gr,[rn],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h>y}],"filter-<=":[Gr,[un,rn],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y<=b}],"filter-id-<=":[Gr,[rn],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h<=y}],"filter->=":[Gr,[un,rn],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y>=b}],"filter-id->=":[Gr,[rn],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h>=y}],"filter-has":[Gr,[rn],function(t,o){return o[0].value in t.properties()}],"filter-has-id":[Gr,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[Gr,[Oi(un)],function(t,o){return o[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Gr,[Oi(rn)],function(t,o){return o[0].value.indexOf(t.id())>=0}],"filter-in-small":[Gr,[un,Oi(rn)],function(t,o){var u=o[0];return o[1].value.indexOf(t.properties()[u.value])>=0}],"filter-in-large":[Gr,[un,Oi(rn)],function(t,o){var u=o[0],h=o[1];return function(y,b,S,P){for(;S<=P;){var k=S+P>>1;if(b[k]===y)return!0;b[k]>y?P=k-1:S=k+1}return!1}(t.properties()[u.value],h.value,0,h.value.length-1)}],all:{type:Gr,overloads:[[[Gr,Gr],function(t,o){var u=o[1];return o[0].evaluate(t)&&u.evaluate(t)}],[vo(Gr),function(t,o){for(var u=0,h=o;u<h.length;u+=1)if(!h[u].evaluate(t))return!1;return!0}]]},any:{type:Gr,overloads:[[[Gr,Gr],function(t,o){var u=o[1];return o[0].evaluate(t)||u.evaluate(t)}],[vo(Gr),function(t,o){for(var u=0,h=o;u<h.length;u+=1)if(h[u].evaluate(t))return!0;return!1}]]},"!":[Gr,[Gr],function(t,o){return!o[0].evaluate(t)}],"is-supported-script":[Gr,[un],function(t,o){var u=t.globals&&t.globals.isSupportedScript;return!u||u(o[0].evaluate(t))}],upcase:[un,[un],function(t,o){return o[0].evaluate(t).toUpperCase()}],downcase:[un,[un],function(t,o){return o[0].evaluate(t).toLowerCase()}],concat:[un,vo(rn),function(t,o){return o.map(function(u){return Yu(u.evaluate(t))}).join("")}],"resolved-locale":[un,[Ti],function(t,o){return o[0].evaluate(t).resolvedLocale()}]});var dl=function(t,o){this.expression=t,this._warningHistory={},this._evaluator=new ba,this._defaultValue=o?function(u){return u.type==="color"&&Pl(u.default)?new Gi(0,0,0,0):u.type==="color"?Gi.parse(u.default)||null:u.default===void 0?null:u.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null};function Go(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in wo}function Lu(t,o){var u=new Js(wo,[],o?function(y){var b={color:Wr,string:un,number:Pt,enum:un,boolean:Gr,formatted:ea,resolvedImage:bi};return y.type==="array"?Oi(b[y.value]||rn,y.length):b[y.type]}(o):void 0),h=u.parse(t,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Ff(new dl(h,o)):_u(u.errors)}dl.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,y,b){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=h,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)},dl.prototype.evaluate=function(t,o,u,h,y,b){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Ua("Expected value to be one of "+Object.keys(this._enumValues).map(function(P){return JSON.stringify(P)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console!="undefined"&&console.warn(P.message)),this._defaultValue}};var el=function(t,o){this.kind=t,this._styleExpression=o,this.isStateDependent=t!=="constant"&&!Rt(o.expression)};el.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,h,y,b)},el.prototype.evaluate=function(t,o,u,h,y,b){return this._styleExpression.evaluate(t,o,u,h,y,b)};var Ho=function(t,o,u,h){this.kind=t,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=t!=="camera"&&!Rt(o.expression),this.interpolationType=h};function Il(t,o){if((t=Lu(t,o)).result==="error")return t;var u=t.value.expression,h=$r(u);if(!h&&!Bs(o))return _u([new yr("","data expressions not supported")]);var y=Vo(u,["zoom"]);if(!y&&!Pc(o))return _u([new yr("","zoom expressions not supported")]);var b=function S(P){var k=null;if(P instanceof ht)k=S(P.result);else if(P instanceof ct)for(var z=0,Z=P.args;z<Z.length&&!(k=S(Z[z]));z+=1);else(P instanceof ys||P instanceof xe)&&P.input instanceof xo&&P.input.name==="zoom"&&(k=P);return k instanceof yr||P.eachChild(function(W){var ee=S(W);ee instanceof yr?k=ee:!k&&ee?k=new yr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):k&&ee&&k!==ee&&(k=new yr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),k}(u);return b||y?b instanceof yr?_u([b]):b instanceof xe&&!hl(o)?_u([new yr("",'"interpolate" expressions cannot be used with this property')]):Ff(b?new Ho(h?"camera":"composite",t.value,b.labels,b instanceof xe?b.interpolation:void 0):new el(h?"constant":"source",t.value)):_u([new yr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Ho.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,h,y,b)},Ho.prototype.evaluate=function(t,o,u,h,y,b){return this._styleExpression.evaluate(t,o,u,h,y,b)},Ho.prototype.interpolationFactor=function(t,o,u){return this.interpolationType?xe.interpolationFactor(this.interpolationType,t,o,u):0};var tl=function(t,o){this._parameters=t,this._specification=o,mr(this,function u(h,y){var b,S,P,k=y.type==="color",z=h.stops&&typeof h.stops[0][0]=="object",Z=z||!(z||h.property!==void 0),W=h.type||(hl(y)?"exponential":"interval");if(k&&((h=mr({},h)).stops&&(h.stops=h.stops.map(function(pn){return[pn[0],Gi.parse(pn[1])]})),h.default=Gi.parse(h.default?h.default:y.default)),h.colorSpace&&h.colorSpace!=="rgb"&&!K[h.colorSpace])throw new Error("Unknown color space: "+h.colorSpace);if(W==="exponential")b=bp;else if(W==="interval")b=xp;else if(W==="categorical"){b=Bf,S=Object.create(null);for(var ee=0,ne=h.stops;ee<ne.length;ee+=1){var Me=ne[ee];S[Me[0]]=Me[1]}P=typeof h.stops[0][0]}else{if(W!=="identity")throw new Error('Unknown function type "'+W+'"');b=rf}if(z){for(var Oe={},Ye=[],Ze=0;Ze<h.stops.length;Ze++){var st=h.stops[Ze],Ct=st[0].zoom;Oe[Ct]===void 0&&(Oe[Ct]={zoom:Ct,type:h.type,property:h.property,default:h.default,stops:[]},Ye.push(Ct)),Oe[Ct].stops.push([st[0].value,st[1]])}for(var Zt=[],Wt=0,lr=Ye;Wt<lr.length;Wt+=1){var Lr=lr[Wt];Zt.push([Oe[Lr].zoom,u(Oe[Lr],y)])}var zr={name:"linear"};return{kind:"composite",interpolationType:zr,interpolationFactor:xe.interpolationFactor.bind(void 0,zr),zoomStops:Zt.map(function(pn){return pn[0]}),evaluate:function(pn,zn){var mn=pn.zoom;return bp({stops:Zt,base:h.base},y,mn).evaluate(mn,zn)}}}if(Z){var Pn=W==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:Pn,interpolationFactor:xe.interpolationFactor.bind(void 0,Pn),zoomStops:h.stops.map(function(pn){return pn[0]}),evaluate:function(pn){return b(h,y,pn.zoom,S,P)}}}return{kind:"source",evaluate:function(pn,zn){var mn=zn&&zn.properties?zn.properties[h.property]:void 0;return mn===void 0?os(h.default,y.default):b(h,y,mn,S,P)}}}(this._parameters,this._specification))};function eu(t){var o=t.key,u=t.value,h=t.valueSpec||{},y=t.objectElementValidators||{},b=t.style,S=t.styleSpec,P=[],k=Aa(u);if(k!=="object")return[new De(o,u,"object expected, "+k+" found")];for(var z in u){var Z=z.split(".")[0],W=h[Z]||h["*"],ee=void 0;if(y[Z])ee=y[Z];else if(h[Z])ee=Bi;else if(y["*"])ee=y["*"];else{if(!h["*"]){P.push(new De(o,u[z],'unknown property "'+z+'"'));continue}ee=Bi}P=P.concat(ee({key:(o&&o+".")+z,value:u[z],valueSpec:W,style:b,styleSpec:S,object:u,objectKey:z},u))}for(var ne in h)y[ne]||h[ne].required&&h[ne].default===void 0&&u[ne]===void 0&&P.push(new De(o,u,'missing required property "'+ne+'"'));return P}function nf(t){var o=t.value,u=t.valueSpec,h=t.style,y=t.styleSpec,b=t.key,S=t.arrayElementValidator||Bi;if(Aa(o)!=="array")return[new De(b,o,"array expected, "+Aa(o)+" found")];if(u.length&&o.length!==u.length)return[new De(b,o,"array length "+u.length+" expected, length "+o.length+" found")];if(u["min-length"]&&o.length<u["min-length"])return[new De(b,o,"array length at least "+u["min-length"]+" expected, length "+o.length+" found")];var P={type:u.value,values:u.values};y.$version<7&&(P.function=u.function),Aa(u.value)==="object"&&(P=u.value);for(var k=[],z=0;z<o.length;z++)k=k.concat(S({array:o,arrayIndex:z,value:o[z],valueSpec:P,style:h,styleSpec:y,key:b+"["+z+"]"}));return k}function af(t){var o=t.key,u=t.value,h=t.valueSpec,y=Aa(u);return y==="number"&&u!=u&&(y="NaN"),y!=="number"?[new De(o,u,"number expected, "+y+" found")]:"minimum"in h&&u<h.minimum?[new De(o,u,u+" is less than the minimum value "+h.minimum)]:"maximum"in h&&u>h.maximum?[new De(o,u,u+" is greater than the maximum value "+h.maximum)]:[]}function of(t){var o,u,h,y=t.valueSpec,b=Dt(t.value.type),S={},P=b!=="categorical"&&t.value.property===void 0,k=!P,z=Aa(t.value.stops)==="array"&&Aa(t.value.stops[0])==="array"&&Aa(t.value.stops[0][0])==="object",Z=eu({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(ne){if(b==="identity")return[new De(ne.key,ne.value,'identity function may not have a "stops" property')];var Me=[],Oe=ne.value;return Me=Me.concat(nf({key:ne.key,value:Oe,valueSpec:ne.valueSpec,style:ne.style,styleSpec:ne.styleSpec,arrayElementValidator:W})),Aa(Oe)==="array"&&Oe.length===0&&Me.push(new De(ne.key,Oe,"array must have at least one stop")),Me},default:function(ne){return Bi({key:ne.key,value:ne.value,valueSpec:y,style:ne.style,styleSpec:ne.styleSpec})}}});return b==="identity"&&P&&Z.push(new De(t.key,t.value,'missing required property "property"')),b==="identity"||t.value.stops||Z.push(new De(t.key,t.value,'missing required property "stops"')),b==="exponential"&&t.valueSpec.expression&&!hl(t.valueSpec)&&Z.push(new De(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(k&&!Bs(t.valueSpec)?Z.push(new De(t.key,t.value,"property functions not supported")):P&&!Pc(t.valueSpec)&&Z.push(new De(t.key,t.value,"zoom functions not supported"))),b!=="categorical"&&!z||t.value.property!==void 0||Z.push(new De(t.key,t.value,'"property" property is required')),Z;function W(ne){var Me=[],Oe=ne.value,Ye=ne.key;if(Aa(Oe)!=="array")return[new De(Ye,Oe,"array expected, "+Aa(Oe)+" found")];if(Oe.length!==2)return[new De(Ye,Oe,"array length 2 expected, length "+Oe.length+" found")];if(z){if(Aa(Oe[0])!=="object")return[new De(Ye,Oe,"object expected, "+Aa(Oe[0])+" found")];if(Oe[0].zoom===void 0)return[new De(Ye,Oe,"object stop key must have zoom")];if(Oe[0].value===void 0)return[new De(Ye,Oe,"object stop key must have value")];if(h&&h>Dt(Oe[0].zoom))return[new De(Ye,Oe[0].zoom,"stop zoom values must appear in ascending order")];Dt(Oe[0].zoom)!==h&&(h=Dt(Oe[0].zoom),u=void 0,S={}),Me=Me.concat(eu({key:Ye+"[0]",value:Oe[0],valueSpec:{zoom:{}},style:ne.style,styleSpec:ne.styleSpec,objectElementValidators:{zoom:af,value:ee}}))}else Me=Me.concat(ee({key:Ye+"[0]",value:Oe[0],valueSpec:{},style:ne.style,styleSpec:ne.styleSpec},Oe));return Go(Bt(Oe[1]))?Me.concat([new De(Ye+"[1]",Oe[1],"expressions are not allowed in function stops.")]):Me.concat(Bi({key:Ye+"[1]",value:Oe[1],valueSpec:y,style:ne.style,styleSpec:ne.styleSpec}))}function ee(ne,Me){var Oe=Aa(ne.value),Ye=Dt(ne.value),Ze=ne.value!==null?ne.value:Me;if(o){if(Oe!==o)return[new De(ne.key,Ze,Oe+" stop domain type must match previous stop domain type "+o)]}else o=Oe;if(Oe!=="number"&&Oe!=="string"&&Oe!=="boolean")return[new De(ne.key,Ze,"stop domain value must be a number, string, or boolean")];if(Oe!=="number"&&b!=="categorical"){var st="number expected, "+Oe+" found";return Bs(y)&&b===void 0&&(st+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new De(ne.key,Ze,st)]}return b!=="categorical"||Oe!=="number"||isFinite(Ye)&&Math.floor(Ye)===Ye?b!=="categorical"&&Oe==="number"&&u!==void 0&&Ye<u?[new De(ne.key,Ze,"stop domain values must appear in ascending order")]:(u=Ye,b==="categorical"&&Ye in S?[new De(ne.key,Ze,"stop domain values must be unique")]:(S[Ye]=!0,[])):[new De(ne.key,Ze,"integer expected, found "+Ye)]}}function rl(t){var o=(t.expressionContext==="property"?Il:Lu)(Bt(t.value),t.valueSpec);if(o.result==="error")return o.value.map(function(h){return new De(""+t.key+h.key,t.value,h.message)});var u=o.value.expression||o.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!u.outputDefined())return[new De(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Rt(u))return[new De(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!Rt(u))return[new De(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!Vo(u,["zoom","feature-state"]))return[new De(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!$r(u))return[new De(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ql(t){var o=t.key,u=t.value,h=t.valueSpec,y=[];return Array.isArray(h.values)?h.values.indexOf(Dt(u))===-1&&y.push(new De(o,u,"expected one of ["+h.values.join(", ")+"], "+JSON.stringify(u)+" found")):Object.keys(h.values).indexOf(Dt(u))===-1&&y.push(new De(o,u,"expected one of ["+Object.keys(h.values).join(", ")+"], "+JSON.stringify(u)+" found")),y}function Ic(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var o=0,u=t.slice(1);o<u.length;o+=1){var h=u[o];if(!Ic(h)&&typeof h!="boolean")return!1}return!0;default:return!0}}tl.deserialize=function(t){return new tl(t._parameters,t._specification)},tl.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var sf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Oc(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};Ic(t)||(t=Rc(t));var o=Lu(t,sf);if(o.result==="error")throw new Error(o.value.map(function(u){return u.key+": "+u.message}).join(", "));return{filter:function(u,h,y){return o.value.evaluate(u,h,{},y)},needGeometry:function u(h){if(!Array.isArray(h))return!1;if(h[0]==="within")return!0;for(var y=1;y<h.length;y++)if(u(h[y]))return!0;return!1}(t)}}function Ep(t,o){return t<o?-1:t>o?1:0}function Rc(t){if(!t)return!0;var o,u=t[0];return t.length<=1?u!=="any":u==="=="?vl(t[1],t[2],"=="):u==="!="?ku(vl(t[1],t[2],"==")):u==="<"||u===">"||u==="<="||u===">="?vl(t[1],t[2],u):u==="any"?(o=t.slice(1),["any"].concat(o.map(Rc))):u==="all"?["all"].concat(t.slice(1).map(Rc)):u==="none"?["all"].concat(t.slice(1).map(Rc).map(ku)):u==="in"?uf(t[1],t.slice(2)):u==="!in"?ku(uf(t[1],t.slice(2))):u==="has"?lf(t[1]):u==="!has"?ku(lf(t[1])):u!=="within"||t}function vl(t,o,u){switch(t){case"$type":return["filter-type-"+u,o];case"$id":return["filter-id-"+u,o];default:return["filter-"+u,t,o]}}function uf(t,o){if(o.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(function(u){return typeof u!=typeof o[0]})?["filter-in-large",t,["literal",o.sort(Ep)]]:["filter-in-small",t,["literal",o]]}}function lf(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function ku(t){return["!",t]}function cf(t){return Ic(Bt(t.value))?rl(mr({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function o(u){var h=u.value,y=u.key;if(Aa(h)!=="array")return[new De(y,h,"array expected, "+Aa(h)+" found")];var b,S=u.styleSpec,P=[];if(h.length<1)return[new De(y,h,"filter array must have at least 1 element")];switch(P=P.concat(Ql({key:y+"[0]",value:h[0],valueSpec:S.filter_operator,style:u.style,styleSpec:u.styleSpec})),Dt(h[0])){case"<":case"<=":case">":case">=":h.length>=2&&Dt(h[1])==="$type"&&P.push(new De(y,h,'"$type" cannot be use with operator "'+h[0]+'"'));case"==":case"!=":h.length!==3&&P.push(new De(y,h,'filter array for operator "'+h[0]+'" must have 3 elements'));case"in":case"!in":h.length>=2&&(b=Aa(h[1]))!=="string"&&P.push(new De(y+"[1]",h[1],"string expected, "+b+" found"));for(var k=2;k<h.length;k++)b=Aa(h[k]),Dt(h[1])==="$type"?P=P.concat(Ql({key:y+"["+k+"]",value:h[k],valueSpec:S.geometry_type,style:u.style,styleSpec:u.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&P.push(new De(y+"["+k+"]",h[k],"string, number, or boolean expected, "+b+" found"));break;case"any":case"all":case"none":for(var z=1;z<h.length;z++)P=P.concat(o({key:y+"["+z+"]",value:h[z],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":b=Aa(h[1]),h.length!==2?P.push(new De(y,h,'filter array for "'+h[0]+'" operator must have 2 elements')):b!=="string"&&P.push(new De(y+"[1]",h[1],"string expected, "+b+" found"));break;case"within":b=Aa(h[1]),h.length!==2?P.push(new De(y,h,'filter array for "'+h[0]+'" operator must have 2 elements')):b!=="object"&&P.push(new De(y+"[1]",h[1],"object expected, "+b+" found"))}return P}(t)}function Nf(t,o){var u=t.key,h=t.style,y=t.styleSpec,b=t.value,S=t.objectKey,P=y[o+"_"+t.layerType];if(!P)return[];var k=S.match(/^(.*)-transition$/);if(o==="paint"&&k&&P[k[1]]&&P[k[1]].transition)return Bi({key:u,value:b,valueSpec:y.transition,style:h,styleSpec:y});var z,Z=t.valueSpec||P[S];if(!Z)return[new De(u,b,'unknown property "'+S+'"')];if(Aa(b)==="string"&&Bs(Z)&&!Z.tokens&&(z=/^{([^}]+)}$/.exec(b)))return[new De(u,b,'"'+S+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(z[1])+" }`.")];var W=[];return t.layerType==="symbol"&&(S==="text-field"&&h&&!h.glyphs&&W.push(new De(u,b,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&Pl(Bt(b))&&Dt(b.type)==="identity"&&W.push(new De(u,b,'"text-font" does not support identity functions'))),W.concat(Bi({key:t.key,value:b,valueSpec:Z,style:h,styleSpec:y,expressionContext:"property",propertyType:o,propertyKey:S}))}function Sp(t){return Nf(t,"paint")}function Ol(t){return Nf(t,"layout")}function ih(t){var o=[],u=t.value,h=t.key,y=t.style,b=t.styleSpec;u.type||u.ref||o.push(new De(h,u,'either "type" or "ref" is required'));var S,P=Dt(u.type),k=Dt(u.ref);if(u.id)for(var z=Dt(u.id),Z=0;Z<t.arrayIndex;Z++){var W=y.layers[Z];Dt(W.id)===z&&o.push(new De(h,u.id,'duplicate layer id "'+u.id+'", previously used at line '+W.id.__line__))}if("ref"in u)["type","source","source-layer","filter","layout"].forEach(function(Me){Me in u&&o.push(new De(h,u[Me],'"'+Me+'" is prohibited for ref layers'))}),y.layers.forEach(function(Me){Dt(Me.id)===k&&(S=Me)}),S?S.ref?o.push(new De(h,u.ref,"ref cannot reference another ref layer")):P=Dt(S.type):o.push(new De(h,u.ref,'ref layer "'+k+'" not found'));else if(P!=="background")if(u.source){var ee=y.sources&&y.sources[u.source],ne=ee&&Dt(ee.type);ee?ne==="vector"&&P==="raster"?o.push(new De(h,u.source,'layer "'+u.id+'" requires a raster source')):ne==="raster"&&P!=="raster"?o.push(new De(h,u.source,'layer "'+u.id+'" requires a vector source')):ne!=="vector"||u["source-layer"]?ne==="raster-dem"&&P!=="hillshade"?o.push(new De(h,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="line"||!u.paint||!u.paint["line-gradient"]||ne==="geojson"&&ee.lineMetrics||o.push(new De(h,u,'layer "'+u.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):o.push(new De(h,u,'layer "'+u.id+'" must specify a "source-layer"')):o.push(new De(h,u.source,'source "'+u.source+'" not found'))}else o.push(new De(h,u,'missing required property "source"'));return o=o.concat(eu({key:h,value:u,valueSpec:b.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Bi({key:h+".type",value:u.type,valueSpec:b.layer.type,style:t.style,styleSpec:t.styleSpec,object:u,objectKey:"type"})},filter:cf,layout:function(Me){return eu({layer:u,key:Me.key,value:Me.value,style:Me.style,styleSpec:Me.styleSpec,objectElementValidators:{"*":function(Oe){return Ol(mr({layerType:P},Oe))}}})},paint:function(Me){return eu({layer:u,key:Me.key,value:Me.value,style:Me.style,styleSpec:Me.styleSpec,objectElementValidators:{"*":function(Oe){return Sp(mr({layerType:P},Oe))}}})}}}))}function ss(t){var o=t.value,u=t.key,h=Aa(o);return h!=="string"?[new De(u,o,"string expected, "+h+" found")]:[]}var qa={promoteId:function(t){var o=t.key,u=t.value;if(Aa(u)==="string")return ss({key:o,value:u});var h=[];for(var y in u)h.push.apply(h,ss({key:o+"."+y,value:u[y]}));return h}};function Jl(t){var o=t.value,u=t.key,h=t.styleSpec,y=t.style;if(!o.type)return[new De(u,o,'"type" is required')];var b,S=Dt(o.type);switch(S){case"vector":case"raster":case"raster-dem":return eu({key:u,value:o,valueSpec:h["source_"+S.replace("-","_")],style:t.style,styleSpec:h,objectElementValidators:qa});case"geojson":if(b=eu({key:u,value:o,valueSpec:h.source_geojson,style:y,styleSpec:h,objectElementValidators:qa}),o.cluster)for(var P in o.clusterProperties){var k=o.clusterProperties[P],z=k[0],Z=typeof z=="string"?[z,["accumulated"],["get",P]]:z;b.push.apply(b,rl({key:u+"."+P+".map",value:k[1],expressionContext:"cluster-map"})),b.push.apply(b,rl({key:u+"."+P+".reduce",value:Z,expressionContext:"cluster-reduce"}))}return b;case"video":return eu({key:u,value:o,valueSpec:h.source_video,style:y,styleSpec:h});case"image":return eu({key:u,value:o,valueSpec:h.source_image,style:y,styleSpec:h});case"canvas":return[new De(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ql({key:u+".type",value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:y,styleSpec:h})}}function Rl(t){var o=t.value,u=t.styleSpec,h=u.light,y=t.style,b=[],S=Aa(o);if(o===void 0)return b;if(S!=="object")return b.concat([new De("light",o,"object expected, "+S+" found")]);for(var P in o){var k=P.match(/^(.*)-transition$/);b=b.concat(k&&h[k[1]]&&h[k[1]].transition?Bi({key:P,value:o[P],valueSpec:u.transition,style:y,styleSpec:u}):h[P]?Bi({key:P,value:o[P],valueSpec:h[P],style:y,styleSpec:u}):[new De(P,o[P],'unknown property "'+P+'"')])}return b}var fu={"*":function(){return[]},array:nf,boolean:function(t){var o=t.value,u=t.key,h=Aa(o);return h!=="boolean"?[new De(u,o,"boolean expected, "+h+" found")]:[]},number:af,color:function(t){var o=t.key,u=t.value,h=Aa(u);return h!=="string"?[new De(o,u,"color expected, "+h+" found")]:Ri(u)===null?[new De(o,u,'color expected, "'+u+'" found')]:[]},constants:mt,enum:Ql,filter:cf,function:of,layer:ih,object:eu,source:Jl,light:Rl,string:ss,formatted:function(t){return ss(t).length===0?[]:rl(t)},resolvedImage:function(t){return ss(t).length===0?[]:rl(t)}};function Bi(t){var o=t.value,u=t.valueSpec,h=t.styleSpec;return u.expression&&Pl(Dt(o))?of(t):u.expression&&Go(Bt(o))?rl(t):u.type&&fu[u.type]?fu[u.type](t):eu(mr({},t,{valueSpec:u.type?h[u.type]:u}))}function Fa(t){var o=t.value,u=t.key,h=ss(t);return h.length||(o.indexOf("{fontstack}")===-1&&h.push(new De(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&h.push(new De(u,o,'"glyphs" url must include a "{range}" token'))),h}function Ns(t,o){o===void 0&&(o=ce);var u=[];return u=u.concat(Bi({key:"",value:t,valueSpec:o.$root,styleSpec:o,style:t,objectElementValidators:{glyphs:Fa,"*":function(){return[]}}})),t.constants&&(u=u.concat(mt({key:"constants",value:t.constants,style:t,styleSpec:o}))),ff(u)}function ff(t){return[].concat(t).sort(function(o,u){return o.line-u.line})}function ml(t){return function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];return ff(t.apply(this,o))}}Ns.source=ml(Jl),Ns.light=ml(Rl),Ns.layer=ml(ih),Ns.filter=ml(cf),Ns.paintProperty=ml(Sp),Ns.layoutProperty=ml(Ol);var pf=Ns,ah=pf.light,oh=pf.paintProperty,Lc=pf.layoutProperty;function ec(t,o){var u=!1;if(o&&o.length)for(var h=0,y=o;h<y.length;h+=1)t.fire(new Ge(new Error(y[h].message))),u=!0;return u}var nl=Bo;function Bo(t,o,u){var h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var y=new Int32Array(this.arrayBuffer);t=y[0],this.d=(o=y[1])+2*(u=y[2]);for(var b=0;b<this.d*this.d;b++){var S=y[3+b],P=y[3+b+1];h.push(S===P?null:y.subarray(S,P))}var k=y[3+h.length+1];this.keys=y.subarray(y[3+h.length],k),this.bboxes=y.subarray(k),this.insert=this._insertReadonly}else{this.d=o+2*u;for(var z=0;z<this.d*this.d;z++)h.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=t,this.padding=u,this.scale=o/t,this.uid=0;var Z=u/o*t;this.min=-Z,this.max=t+Z}Bo.prototype.insert=function(t,o,u,h,y){this._forEachCell(o,u,h,y,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(h),this.bboxes.push(y)},Bo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Bo.prototype._insertCell=function(t,o,u,h,y,b){this.cells[y].push(b)},Bo.prototype.query=function(t,o,u,h,y){var b=this.min,S=this.max;if(t<=b&&o<=b&&S<=u&&S<=h&&!y)return Array.prototype.slice.call(this.keys);var P=[];return this._forEachCell(t,o,u,h,this._queryCell,P,{},y),P},Bo.prototype._queryCell=function(t,o,u,h,y,b,S,P){var k=this.cells[y];if(k!==null)for(var z=this.keys,Z=this.bboxes,W=0;W<k.length;W++){var ee=k[W];if(S[ee]===void 0){var ne=4*ee;(P?P(Z[ne+0],Z[ne+1],Z[ne+2],Z[ne+3]):t<=Z[ne+2]&&o<=Z[ne+3]&&u>=Z[ne+0]&&h>=Z[ne+1])?(S[ee]=!0,b.push(z[ee])):S[ee]=!1}}},Bo.prototype._forEachCell=function(t,o,u,h,y,b,S,P){for(var k=this._convertToCellCoord(t),z=this._convertToCellCoord(o),Z=this._convertToCellCoord(u),W=this._convertToCellCoord(h),ee=k;ee<=Z;ee++)for(var ne=z;ne<=W;ne++){var Me=this.d*ne+ee;if((!P||P(this._convertFromCellCoord(ee),this._convertFromCellCoord(ne),this._convertFromCellCoord(ee+1),this._convertFromCellCoord(ne+1)))&&y.call(this,t,o,u,h,Me,b,S,P))return}},Bo.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Bo.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Bo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,o=3+this.cells.length+1+1,u=0,h=0;h<this.cells.length;h++)u+=this.cells[h].length;var y=new Int32Array(o+u+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var b=o,S=0;S<t.length;S++){var P=t[S];y[3+S]=b,y.set(P,b),b+=P.length}return y[3+t.length]=b,y.set(this.keys,b),y[3+t.length+1]=b+=this.keys.length,y.set(this.bboxes,b),b+=this.bboxes.length,y.buffer};var tc=ae.ImageData,rc=ae.ImageBitmap,eo={};function yn(t,o,u){u===void 0&&(u={}),Object.defineProperty(o,"_classRegistryKey",{value:t,writeable:!1}),eo[t]={klass:o,omit:u.omit||[],shallow:u.shallow||[]}}for(var co in yn("Object",Object),nl.serialize=function(t,o){var u=t.toArrayBuffer();return o&&o.push(u),{buffer:u}},nl.deserialize=function(t){return new nl(t.buffer)},yn("Grid",nl),yn("Color",Gi),yn("Error",Error),yn("ResolvedImage",Ia),yn("StylePropertyFunction",tl),yn("StyleExpression",dl,{omit:["_evaluator"]}),yn("ZoomDependentExpression",Ho),yn("ZoomConstantExpression",el),yn("CompoundExpression",xo,{omit:["_evaluate"]}),wo)wo[co]._classRegistryKey||yn("Expression_"+co,wo[co]);function il(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function al(t){return rc&&t instanceof rc}function xu(t,o){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(il(t)||al(t))return o&&o.push(t),t;if(ArrayBuffer.isView(t)){var u=t;return o&&o.push(u.buffer),u}if(t instanceof tc)return o&&o.push(t.data.buffer),t;if(Array.isArray(t)){for(var h=[],y=0,b=t;y<b.length;y+=1)h.push(xu(b[y],o));return h}if(typeof t=="object"){var S=t.constructor,P=S._classRegistryKey;if(!P)throw new Error("can't serialize object of unregistered class");var k=S.serialize?S.serialize(t,o):{};if(!S.serialize){for(var z in t)if(t.hasOwnProperty(z)&&!(eo[P].omit.indexOf(z)>=0)){var Z=t[z];k[z]=eo[P].shallow.indexOf(z)>=0?Z:xu(Z,o)}t instanceof Error&&(k.message=t.message)}if(k.$name)throw new Error("$name property is reserved for worker serialization logic.");return P!=="Object"&&(k.$name=P),k}throw new Error("can't serialize object of type "+typeof t)}function zs(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||il(t)||al(t)||ArrayBuffer.isView(t)||t instanceof tc)return t;if(Array.isArray(t))return t.map(zs);if(typeof t=="object"){var o=t.$name||"Object",u=eo[o].klass;if(!u)throw new Error("can't deserialize unregistered class "+o);if(u.deserialize)return u.deserialize(t);for(var h=Object.create(u.prototype),y=0,b=Object.keys(t);y<b.length;y+=1){var S=b[y];if(S!=="$name"){var P=t[S];h[S]=eo[o].shallow.indexOf(S)>=0?P:zs(P)}}return h}throw new Error("can't deserialize object of type "+typeof t)}var zf=function(){this.first=!0};zf.prototype.update=function(t,o){var u=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=o),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=u,!0))};var Kr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function hf(t){for(var o=0,u=t;o<u.length;o+=1)if(Uf(u[o].charCodeAt(0)))return!0;return!1}function Uf(t){return!(t!==746&&t!==747&&(t<4352||!(Kr["Bopomofo Extended"](t)||Kr.Bopomofo(t)||Kr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Kr["CJK Compatibility Ideographs"](t)||Kr["CJK Compatibility"](t)||Kr["CJK Radicals Supplement"](t)||Kr["CJK Strokes"](t)||!(!Kr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Kr["CJK Unified Ideographs Extension A"](t)||Kr["CJK Unified Ideographs"](t)||Kr["Enclosed CJK Letters and Months"](t)||Kr["Hangul Compatibility Jamo"](t)||Kr["Hangul Jamo Extended-A"](t)||Kr["Hangul Jamo Extended-B"](t)||Kr["Hangul Jamo"](t)||Kr["Hangul Syllables"](t)||Kr.Hiragana(t)||Kr["Ideographic Description Characters"](t)||Kr.Kanbun(t)||Kr["Kangxi Radicals"](t)||Kr["Katakana Phonetic Extensions"](t)||Kr.Katakana(t)&&t!==12540||!(!Kr["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Kr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Kr["Unified Canadian Aboriginal Syllabics"](t)||Kr["Unified Canadian Aboriginal Syllabics Extended"](t)||Kr["Vertical Forms"](t)||Kr["Yijing Hexagram Symbols"](t)||Kr["Yi Syllables"](t)||Kr["Yi Radicals"](t))))}function Du(t){return!(Uf(t)||function(o){return!!(Kr["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||Kr["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||Kr["Letterlike Symbols"](o)||Kr["Number Forms"](o)||Kr["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||Kr["Control Pictures"](o)&&o!==9251||Kr["Optical Character Recognition"](o)||Kr["Enclosed Alphanumerics"](o)||Kr["Geometric Shapes"](o)||Kr["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||Kr["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Kr["CJK Symbols and Punctuation"](o)||Kr.Katakana(o)||Kr["Private Use Area"](o)||Kr["CJK Compatibility Forms"](o)||Kr["Small Form Variants"](o)||Kr["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(t))}function Ha(t){return t>=1424&&t<=2303||Kr["Arabic Presentation Forms-A"](t)||Kr["Arabic Presentation Forms-B"](t)}function Us(t,o){return!(!o&&Ha(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Kr.Khmer(t))}function df(t){for(var o=0,u=t;o<u.length;o+=1)if(Ha(u[o].charCodeAt(0)))return!0;return!1}var Fu=null,Os="unavailable",To=null,Cp=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Os="error"),Fu&&Fu(t)};function Ea(){Zf.fire(new Ie("pluginStateChange",{pluginStatus:Os,pluginURL:To}))}var Zf=new rt,Ap=function(){return Os},tu=function(){if(Os!=="deferred"||!To)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Os="loading",Ea(),To&&ka({url:To},function(t){t?Cp(t):(Os="loaded",Ea())})},Rs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Os==="loaded"||Rs.applyArabicShaping!=null},isLoading:function(){return Os==="loading"},setState:function(t){Os=t.pluginStatus,To=t.pluginURL},isParsed:function(){return Rs.applyArabicShaping!=null&&Rs.processBidirectionalText!=null&&Rs.processStyledBidirectionalText!=null},getPluginURL:function(){return To}},Li=function(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new zf,this.transition={})};Li.prototype.isSupportedScript=function(t){return function(o,u){for(var h=0,y=o;h<y.length;h+=1)if(!Us(y[h].charCodeAt(0),u))return!1;return!0}(t,Rs.isLoaded())},Li.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Li.prototype.getCrossfadeParameters=function(){var t=this.zoom,o=t-Math.floor(t),u=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*o}};var bu=function(t,o){this.property=t,this.value=o,this.expression=function(u,h){if(Pl(u))return new tl(u,h);if(Go(u)){var y=Il(u,h);if(y.result==="error")throw new Error(y.value.map(function(S){return S.key+": "+S.message}).join(", "));return y.value}var b=u;return typeof u=="string"&&h.type==="color"&&(b=Gi.parse(u)),{kind:"constant",evaluate:function(){return b}}}(o===void 0?t.specification.default:o,t.specification)};bu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},bu.prototype.possiblyEvaluate=function(t,o,u){return this.property.possiblyEvaluate(this,t,o,u)};var va=function(t){this.property=t,this.value=new bu(t,void 0)};va.prototype.transitioned=function(t,o){return new Zs(this.property,this.value,o,At({},t.transition,this.transition),t.now)},va.prototype.untransitioned=function(){return new Zs(this.property,this.value,null,{},0)};var mo=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};mo.prototype.getValue=function(t){return Je(this._values[t].value.value)},mo.prototype.setValue=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new va(this._values[t].property)),this._values[t].value=new bu(this._values[t].property,o===null?void 0:Je(o))},mo.prototype.getTransition=function(t){return Je(this._values[t].transition)},mo.prototype.setTransition=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new va(this._values[t].property)),this._values[t].transition=Je(o)||void 0},mo.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o],y=this.getValue(h);y!==void 0&&(t[h]=y);var b=this.getTransition(h);b!==void 0&&(t[h+"-transition"]=b)}return t},mo.prototype.transitioned=function(t,o){for(var u=new pu(this._properties),h=0,y=Object.keys(this._values);h<y.length;h+=1){var b=y[h];u._values[b]=this._values[b].transitioned(t,o._values[b])}return u},mo.prototype.untransitioned=function(){for(var t=new pu(this._properties),o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o];t._values[h]=this._values[h].untransitioned()}return t};var Zs=function(t,o,u,h,y){this.property=t,this.value=o,this.begin=y+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=u)};Zs.prototype.possiblyEvaluate=function(t,o,u){var h=t.now||0,y=this.value.possiblyEvaluate(t,o,u),b=this.prior;if(b){if(h>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(h<this.begin)return b.possiblyEvaluate(t,o,u);var S=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(t,o,u),y,function(P){if(P<=0)return 0;if(P>=1)return 1;var k=P*P,z=k*P;return 4*(P<.5?z:3*(P-k)+z-.75)}(S))}return y};var pu=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};pu.prototype.possiblyEvaluate=function(t,o,u){for(var h=new Vs(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var S=b[y];h._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return h},pu.prototype.hasTransition=function(){for(var t=0,o=Object.keys(this._values);t<o.length;t+=1)if(this._values[o[t]].prior)return!0;return!1};var js=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};js.prototype.getValue=function(t){return Je(this._values[t].value)},js.prototype.setValue=function(t,o){this._values[t]=new bu(this._values[t].property,o===null?void 0:Je(o))},js.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o],y=this.getValue(h);y!==void 0&&(t[h]=y)}return t},js.prototype.possiblyEvaluate=function(t,o,u){for(var h=new Vs(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var S=b[y];h._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return h};var _s=function(t,o,u){this.property=t,this.value=o,this.parameters=u};_s.prototype.isConstant=function(){return this.value.kind==="constant"},_s.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},_s.prototype.evaluate=function(t,o,u,h){return this.property.evaluate(this.value,this.parameters,t,o,u,h)};var Vs=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};Vs.prototype.get=function(t){return this._values[t]};var Ln=function(t){this.specification=t};Ln.prototype.possiblyEvaluate=function(t,o){return t.expression.evaluate(o)},Ln.prototype.interpolate=function(t,o,u){var h=bo[this.specification.type];return h?h(t,o,u):t};var wn=function(t,o){this.specification=t,this.overrides=o};wn.prototype.possiblyEvaluate=function(t,o,u,h){return new _s(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(o,null,{},u,h)}:t.expression,o)},wn.prototype.interpolate=function(t,o,u){if(t.value.kind!=="constant"||o.value.kind!=="constant")return t;if(t.value.value===void 0||o.value.value===void 0)return new _s(this,{kind:"constant",value:void 0},t.parameters);var h=bo[this.specification.type];return h?new _s(this,{kind:"constant",value:h(t.value.value,o.value.value,u)},t.parameters):t},wn.prototype.evaluate=function(t,o,u,h,y,b){return t.kind==="constant"?t.value:t.evaluate(o,u,h,y,b)};var nc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,h,y,b){if(u.value===void 0)return new _s(this,{kind:"constant",value:void 0},h);if(u.expression.kind==="constant"){var S=u.expression.evaluate(h,null,{},y,b),P=u.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,k=this._calculate(P,P,P,h);return new _s(this,{kind:"constant",value:k},h)}if(u.expression.kind==="camera"){var z=this._calculate(u.expression.evaluate({zoom:h.zoom-1}),u.expression.evaluate({zoom:h.zoom}),u.expression.evaluate({zoom:h.zoom+1}),h);return new _s(this,{kind:"constant",value:z},h)}return new _s(this,u.expression,h)},o.prototype.evaluate=function(u,h,y,b,S,P){if(u.kind==="source"){var k=u.evaluate(h,y,b,S,P);return this._calculate(k,k,k,h)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(h.zoom)-1},y,b),u.evaluate({zoom:Math.floor(h.zoom)},y,b),u.evaluate({zoom:Math.floor(h.zoom)+1},y,b),h):u.value},o.prototype._calculate=function(u,h,y,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:u,to:h}:{from:y,to:h}},o.prototype.interpolate=function(u){return u},o}(wn),xs=function(t){this.specification=t};xs.prototype.possiblyEvaluate=function(t,o,u,h){if(t.value!==void 0){if(t.expression.kind==="constant"){var y=t.expression.evaluate(o,null,{},u,h);return this._calculate(y,y,y,o)}return this._calculate(t.expression.evaluate(new Li(Math.floor(o.zoom-1),o)),t.expression.evaluate(new Li(Math.floor(o.zoom),o)),t.expression.evaluate(new Li(Math.floor(o.zoom+1),o)),o)}},xs.prototype._calculate=function(t,o,u,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:u,to:o}},xs.prototype.interpolate=function(t){return t};var Eu=function(t){this.specification=t};Eu.prototype.possiblyEvaluate=function(t,o,u,h){return!!t.expression.evaluate(o,null,{},u,h)},Eu.prototype.interpolate=function(){return!1};var es=function(t){for(var o in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var u=t[o];u.specification.overridable&&this.overridableProperties.push(o);var h=this.defaultPropertyValues[o]=new bu(u,void 0),y=this.defaultTransitionablePropertyValues[o]=new va(u);this.defaultTransitioningPropertyValues[o]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=h.possiblyEvaluate({})}};yn("DataDrivenProperty",wn),yn("DataConstantProperty",Ln),yn("CrossFadedDataDrivenProperty",nc),yn("CrossFadedProperty",xs),yn("ColorRampProperty",Eu);var wa=function(t){function o(u,h){if(t.call(this),this.id=u.id,this.type=u.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},u.type!=="custom"&&(this.metadata=(u=u).metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),h.layout&&(this._unevaluatedLayout=new js(h.layout)),h.paint)){for(var y in this._transitionablePaint=new mo(h.paint),u.paint)this.setPaintProperty(y,u.paint[y],{validate:!1});for(var b in u.layout)this.setLayoutProperty(b,u.layout[b],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Vs(h.paint)}}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},o.prototype.getLayoutProperty=function(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)},o.prototype.setLayoutProperty=function(u,h,y){y===void 0&&(y={}),h!=null&&this._validate(Lc,"layers."+this.id+".layout."+u,u,h,y)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,h):this.visibility=h)},o.prototype.getPaintProperty=function(u){return Y(u,"-transition")?this._transitionablePaint.getTransition(u.slice(0,-"-transition".length)):this._transitionablePaint.getValue(u)},o.prototype.setPaintProperty=function(u,h,y){if(y===void 0&&(y={}),h!=null&&this._validate(oh,"layers."+this.id+".paint."+u,u,h,y))return!1;if(Y(u,"-transition"))return this._transitionablePaint.setTransition(u.slice(0,-"-transition".length),h||void 0),!1;var b=this._transitionablePaint._values[u],S=b.property.specification["property-type"]==="cross-faded-data-driven",P=b.value.isDataDriven(),k=b.value;this._transitionablePaint.setValue(u,h),this._handleSpecialPaintPropertyUpdate(u);var z=this._transitionablePaint._values[u].value;return z.isDataDriven()||P||S||this._handleOverridablePaintPropertyUpdate(u,k,z)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){},o.prototype._handleOverridablePaintPropertyUpdate=function(u,h,y){return!1},o.prototype.isHidden=function(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"},o.prototype.updateTransitions=function(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)},o.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},o.prototype.recalculate=function(u,h){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,h)},o.prototype.serialize=function(){var u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),gt(u,function(h,y){return!(h===void 0||y==="layout"&&!Object.keys(h).length||y==="paint"&&!Object.keys(h).length)})},o.prototype._validate=function(u,h,y,b,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&ec(this,u.call(pf,{key:h,layerType:this.type,objectKey:y,value:b,styleSpec:ce,style:{glyphs:!0,sprite:!0}}))},o.prototype.is3D=function(){return!1},o.prototype.isTileClipped=function(){return!1},o.prototype.hasOffscreenPass=function(){return!1},o.prototype.resize=function(){},o.prototype.isStateDependent=function(){for(var u in this.paint._values){var h=this.paint.get(u);if(h instanceof _s&&Bs(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1},o}(rt),kc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Dc=function(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ma=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Oa(t,o){o===void 0&&(o=1);var u=0,h=0;return{members:t.map(function(y){var b=kc[y.type].BYTES_PER_ELEMENT,S=u=Fc(u,Math.max(o,b)),P=y.components||1;return h=Math.max(h,b),u+=b*P,{name:y.name,type:y.type,components:P,offset:S}}),size:Fc(u,Math.max(h,o)),alignment:o}}function Fc(t,o){return Math.ceil(t/o)*o}ma.serialize=function(t,o){return t._trim(),o&&(t.isTransferred=!0,o.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},ma.deserialize=function(t){var o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o},ma.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ma.prototype.clear=function(){this.length=0},ma.prototype.resize=function(t){this.reserve(t),this.length=t},ma.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}},ma.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Ll=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var y=this.length;return this.resize(y+1),this.emplace(y,u,h)},o.prototype.emplace=function(u,h,y){var b=2*u;return this.int16[b+0]=h,this.int16[b+1]=y,u},o}(ma);Ll.prototype.bytesPerElement=4,yn("StructArrayLayout2i4",Ll);var Su=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,y,b)},o.prototype.emplace=function(u,h,y,b,S){var P=4*u;return this.int16[P+0]=h,this.int16[P+1]=y,this.int16[P+2]=b,this.int16[P+3]=S,u},o}(ma);Su.prototype.bytesPerElement=8,yn("StructArrayLayout4i8",Su);var ru=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,P){var k=this.length;return this.resize(k+1),this.emplace(k,u,h,y,b,S,P)},o.prototype.emplace=function(u,h,y,b,S,P,k){var z=6*u;return this.int16[z+0]=h,this.int16[z+1]=y,this.int16[z+2]=b,this.int16[z+3]=S,this.int16[z+4]=P,this.int16[z+5]=k,u},o}(ma);ru.prototype.bytesPerElement=12,yn("StructArrayLayout2i4i12",ru);var No=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,P){var k=this.length;return this.resize(k+1),this.emplace(k,u,h,y,b,S,P)},o.prototype.emplace=function(u,h,y,b,S,P,k){var z=4*u,Z=8*u;return this.int16[z+0]=h,this.int16[z+1]=y,this.uint8[Z+4]=b,this.uint8[Z+5]=S,this.uint8[Z+6]=P,this.uint8[Z+7]=k,u},o}(ma);No.prototype.bytesPerElement=8,yn("StructArrayLayout2i4ub8",No);var gl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var y=this.length;return this.resize(y+1),this.emplace(y,u,h)},o.prototype.emplace=function(u,h,y){var b=2*u;return this.float32[b+0]=h,this.float32[b+1]=y,u},o}(ma);gl.prototype.bytesPerElement=8,yn("StructArrayLayout2f8",gl);var Cu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,P,k,z,Z,W){var ee=this.length;return this.resize(ee+1),this.emplace(ee,u,h,y,b,S,P,k,z,Z,W)},o.prototype.emplace=function(u,h,y,b,S,P,k,z,Z,W,ee){var ne=10*u;return this.uint16[ne+0]=h,this.uint16[ne+1]=y,this.uint16[ne+2]=b,this.uint16[ne+3]=S,this.uint16[ne+4]=P,this.uint16[ne+5]=k,this.uint16[ne+6]=z,this.uint16[ne+7]=Z,this.uint16[ne+8]=W,this.uint16[ne+9]=ee,u},o}(ma);Cu.prototype.bytesPerElement=20,yn("StructArrayLayout10ui20",Cu);var vf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,P,k,z,Z,W,ee,ne){var Me=this.length;return this.resize(Me+1),this.emplace(Me,u,h,y,b,S,P,k,z,Z,W,ee,ne)},o.prototype.emplace=function(u,h,y,b,S,P,k,z,Z,W,ee,ne,Me){var Oe=12*u;return this.int16[Oe+0]=h,this.int16[Oe+1]=y,this.int16[Oe+2]=b,this.int16[Oe+3]=S,this.uint16[Oe+4]=P,this.uint16[Oe+5]=k,this.uint16[Oe+6]=z,this.uint16[Oe+7]=Z,this.int16[Oe+8]=W,this.int16[Oe+9]=ee,this.int16[Oe+10]=ne,this.int16[Oe+11]=Me,u},o}(ma);vf.prototype.bytesPerElement=24,yn("StructArrayLayout4i4ui4i24",vf);var kl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=3*u;return this.float32[S+0]=h,this.float32[S+1]=y,this.float32[S+2]=b,u},o}(ma);kl.prototype.bytesPerElement=12,yn("StructArrayLayout3f12",kl);var Dl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.uint32[1*u+0]=h,u},o}(ma);Dl.prototype.bytesPerElement=4,yn("StructArrayLayout1ul4",Dl);var Fl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,P,k,z,Z){var W=this.length;return this.resize(W+1),this.emplace(W,u,h,y,b,S,P,k,z,Z)},o.prototype.emplace=function(u,h,y,b,S,P,k,z,Z,W){var ee=10*u,ne=5*u;return this.int16[ee+0]=h,this.int16[ee+1]=y,this.int16[ee+2]=b,this.int16[ee+3]=S,this.int16[ee+4]=P,this.int16[ee+5]=k,this.uint32[ne+3]=z,this.uint16[ee+8]=Z,this.uint16[ee+9]=W,u},o}(ma);Fl.prototype.bytesPerElement=20,yn("StructArrayLayout6i1ul2ui20",Fl);var ic=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,P){var k=this.length;return this.resize(k+1),this.emplace(k,u,h,y,b,S,P)},o.prototype.emplace=function(u,h,y,b,S,P,k){var z=6*u;return this.int16[z+0]=h,this.int16[z+1]=y,this.int16[z+2]=b,this.int16[z+3]=S,this.int16[z+4]=P,this.int16[z+5]=k,u},o}(ma);ic.prototype.bytesPerElement=12,yn("StructArrayLayout2i2i2i12",ic);var yl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S){var P=this.length;return this.resize(P+1),this.emplace(P,u,h,y,b,S)},o.prototype.emplace=function(u,h,y,b,S,P){var k=4*u,z=8*u;return this.float32[k+0]=h,this.float32[k+1]=y,this.float32[k+2]=b,this.int16[z+6]=S,this.int16[z+7]=P,u},o}(ma);yl.prototype.bytesPerElement=16,yn("StructArrayLayout2f1f2i16",yl);var wp=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,y,b)},o.prototype.emplace=function(u,h,y,b,S){var P=12*u,k=3*u;return this.uint8[P+0]=h,this.uint8[P+1]=y,this.float32[k+1]=b,this.float32[k+2]=S,u},o}(ma);wp.prototype.bytesPerElement=12,yn("StructArrayLayout2ub2f12",wp);var ol=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=3*u;return this.uint16[S+0]=h,this.uint16[S+1]=y,this.uint16[S+2]=b,u},o}(ma);ol.prototype.bytesPerElement=6,yn("StructArrayLayout3ui6",ol);var Bu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,P,k,z,Z,W,ee,ne,Me,Oe,Ye,Ze,st){var Ct=this.length;return this.resize(Ct+1),this.emplace(Ct,u,h,y,b,S,P,k,z,Z,W,ee,ne,Me,Oe,Ye,Ze,st)},o.prototype.emplace=function(u,h,y,b,S,P,k,z,Z,W,ee,ne,Me,Oe,Ye,Ze,st,Ct){var Zt=24*u,Wt=12*u,lr=48*u;return this.int16[Zt+0]=h,this.int16[Zt+1]=y,this.uint16[Zt+2]=b,this.uint16[Zt+3]=S,this.uint32[Wt+2]=P,this.uint32[Wt+3]=k,this.uint32[Wt+4]=z,this.uint16[Zt+10]=Z,this.uint16[Zt+11]=W,this.uint16[Zt+12]=ee,this.float32[Wt+7]=ne,this.float32[Wt+8]=Me,this.uint8[lr+36]=Oe,this.uint8[lr+37]=Ye,this.uint8[lr+38]=Ze,this.uint32[Wt+10]=st,this.int16[Zt+22]=Ct,u},o}(ma);Bu.prototype.bytesPerElement=48,yn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Bu);var jf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,P,k,z,Z,W,ee,ne,Me,Oe,Ye,Ze,st,Ct,Zt,Wt,lr,Lr,zr,Pn,pn,zn,mn,Mi){var ti=this.length;return this.resize(ti+1),this.emplace(ti,u,h,y,b,S,P,k,z,Z,W,ee,ne,Me,Oe,Ye,Ze,st,Ct,Zt,Wt,lr,Lr,zr,Pn,pn,zn,mn,Mi)},o.prototype.emplace=function(u,h,y,b,S,P,k,z,Z,W,ee,ne,Me,Oe,Ye,Ze,st,Ct,Zt,Wt,lr,Lr,zr,Pn,pn,zn,mn,Mi,ti){var In=34*u,ji=17*u;return this.int16[In+0]=h,this.int16[In+1]=y,this.int16[In+2]=b,this.int16[In+3]=S,this.int16[In+4]=P,this.int16[In+5]=k,this.int16[In+6]=z,this.int16[In+7]=Z,this.uint16[In+8]=W,this.uint16[In+9]=ee,this.uint16[In+10]=ne,this.uint16[In+11]=Me,this.uint16[In+12]=Oe,this.uint16[In+13]=Ye,this.uint16[In+14]=Ze,this.uint16[In+15]=st,this.uint16[In+16]=Ct,this.uint16[In+17]=Zt,this.uint16[In+18]=Wt,this.uint16[In+19]=lr,this.uint16[In+20]=Lr,this.uint16[In+21]=zr,this.uint16[In+22]=Pn,this.uint32[ji+12]=pn,this.float32[ji+13]=zn,this.float32[ji+14]=mn,this.float32[ji+15]=Mi,this.float32[ji+16]=ti,u},o}(ma);jf.prototype.bytesPerElement=68,yn("StructArrayLayout8i15ui1ul4f68",jf);var _l=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.float32[1*u+0]=h,u},o}(ma);_l.prototype.bytesPerElement=4,yn("StructArrayLayout1f4",_l);var nu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=3*u;return this.int16[S+0]=h,this.int16[S+1]=y,this.int16[S+2]=b,u},o}(ma);nu.prototype.bytesPerElement=6,yn("StructArrayLayout3i6",nu);var mf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=4*u;return this.uint32[2*u+0]=h,this.uint16[S+2]=y,this.uint16[S+3]=b,u},o}(ma);mf.prototype.bytesPerElement=8,yn("StructArrayLayout1ul2ui8",mf);var Gs=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var y=this.length;return this.resize(y+1),this.emplace(y,u,h)},o.prototype.emplace=function(u,h,y){var b=2*u;return this.uint16[b+0]=h,this.uint16[b+1]=y,u},o}(ma);Gs.prototype.bytesPerElement=4,yn("StructArrayLayout2ui4",Gs);var Tp=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.uint16[1*u+0]=h,u},o}(ma);Tp.prototype.bytesPerElement=2,yn("StructArrayLayout1ui2",Tp);var ac=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,y,b)},o.prototype.emplace=function(u,h,y,b,S){var P=4*u;return this.float32[P+0]=h,this.float32[P+1]=y,this.float32[P+2]=b,this.float32[P+3]=S,u},o}(ma);ac.prototype.bytesPerElement=16,yn("StructArrayLayout4f16",ac);var l=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return u.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},u.x1.get=function(){return this._structArray.int16[this._pos2+2]},u.y1.get=function(){return this._structArray.int16[this._pos2+3]},u.x2.get=function(){return this._structArray.int16[this._pos2+4]},u.y2.get=function(){return this._structArray.int16[this._pos2+5]},u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.anchorPoint.get=function(){return new se(this.anchorPointX,this.anchorPointY)},Object.defineProperties(o.prototype,u),o}(Dc);l.prototype.size=20;var f=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new l(this,u)},o}(Fl);yn("CollisionBoxArray",f);var c=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},u.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},u.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},u.segment.get=function(){return this._structArray.uint16[this._pos2+10]},u.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},u.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},u.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},u.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},u.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},u.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},u.placedOrientation.set=function(h){this._structArray.uint8[this._pos1+37]=h},u.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},u.hidden.set=function(h){this._structArray.uint8[this._pos1+38]=h},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},u.crossTileID.set=function(h){this._structArray.uint32[this._pos4+10]=h},u.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(o.prototype,u),o}(Dc);c.prototype.size=48;var d=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new c(this,u)},o}(Bu);yn("PlacedSymbolArray",d);var E=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},u.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},u.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},u.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},u.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},u.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},u.key.get=function(){return this._structArray.uint16[this._pos2+8]},u.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},u.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},u.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},u.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},u.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},u.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},u.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},u.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},u.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},u.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},u.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},u.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},u.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},u.crossTileID.set=function(h){this._structArray.uint32[this._pos4+12]=h},u.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},u.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},u.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},u.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(o.prototype,u),o}(Dc);E.prototype.size=68;var A=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new E(this,u)},o}(jf);yn("SymbolInstanceArray",A);var M=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getoffsetX=function(u){return this.float32[1*u+0]},o}(_l);yn("GlyphOffsetArray",M);var L=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getx=function(u){return this.int16[3*u+0]},o.prototype.gety=function(u){return this.int16[3*u+1]},o.prototype.gettileUnitDistanceFromAnchor=function(u){return this.int16[3*u+2]},o}(nu);yn("SymbolLineVertexArray",L);var U=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(o.prototype,u),o}(Dc);U.prototype.size=8;var X=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new U(this,u)},o}(mf);yn("FeatureIndexArray",X);var oe=Oa([{name:"a_pos",components:2,type:"Int16"}],4).members,fe=function(t){t===void 0&&(t=[]),this.segments=t};function pe(t,o){return 256*(t=Vt(Math.floor(t),0,255))+Vt(Math.floor(o),0,255)}fe.prototype.prepareSegment=function(t,o,u,h){var y=this.segments[this.segments.length-1];return t>fe.MAX_VERTEX_ARRAY_LENGTH&&Qe("Max vertices per segment is "+fe.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!y||y.vertexLength+t>fe.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==h)&&(y={vertexOffset:o.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},h!==void 0&&(y.sortKey=h),this.segments.push(y)),y},fe.prototype.get=function(){return this.segments},fe.prototype.destroy=function(){for(var t=0,o=this.segments;t<o.length;t+=1){var u=o[t];for(var h in u.vaos)u.vaos[h].destroy()}},fe.simpleSegment=function(t,o,u,h){return new fe([{vertexOffset:t,primitiveOffset:o,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])},fe.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,yn("SegmentVector",fe);var Re=Oa([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Pe=ve(function(t){t.exports=function(o,u){var h,y,b,S,P,k,z,Z;for(y=o.length-(h=3&o.length),b=u,P=3432918353,k=461845907,Z=0;Z<y;)z=255&o.charCodeAt(Z)|(255&o.charCodeAt(++Z))<<8|(255&o.charCodeAt(++Z))<<16|(255&o.charCodeAt(++Z))<<24,++Z,b=27492+(65535&(S=5*(65535&(b=(b^=z=(65535&(z=(z=(65535&z)*P+(((z>>>16)*P&65535)<<16)&4294967295)<<15|z>>>17))*k+(((z>>>16)*k&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(z=0,h){case 3:z^=(255&o.charCodeAt(Z+2))<<16;case 2:z^=(255&o.charCodeAt(Z+1))<<8;case 1:b^=z=(65535&(z=(z=(65535&(z^=255&o.charCodeAt(Z)))*P+(((z>>>16)*P&65535)<<16)&4294967295)<<15|z>>>17))*k+(((z>>>16)*k&65535)<<16)&4294967295}return b^=o.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}}),He=ve(function(t){t.exports=function(o,u){for(var h,y=o.length,b=u^y,S=0;y>=4;)h=1540483477*(65535&(h=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24))+((1540483477*(h>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),y-=4,++S;switch(y){case 3:b^=(255&o.charCodeAt(S+2))<<16;case 2:b^=(255&o.charCodeAt(S+1))<<8;case 1:b=1540483477*(65535&(b^=255&o.charCodeAt(S)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}}),be=Pe,je=He;be.murmur3=Pe,be.murmur2=je;var et=function(){this.ids=[],this.positions=[],this.indexed=!1};et.prototype.add=function(t,o,u,h){this.ids.push(Ht(t)),this.positions.push(o,u,h)},et.prototype.getPositions=function(t){for(var o=Ht(t),u=0,h=this.ids.length-1;u<h;){var y=u+h>>1;this.ids[y]>=o?h=y:u=y+1}for(var b=[];this.ids[u]===o;)b.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return b},et.serialize=function(t,o){var u=new Float64Array(t.ids),h=new Uint32Array(t.positions);return function y(b,S,P,k){for(;P<k;){for(var z=b[P+k>>1],Z=P-1,W=k+1;;){do Z++;while(b[Z]<z);do W--;while(b[W]>z);if(Z>=W)break;Nt(b,Z,W),Nt(S,3*Z,3*W),Nt(S,3*Z+1,3*W+1),Nt(S,3*Z+2,3*W+2)}W-P<k-W?(y(b,S,P,W),P=W+1):(y(b,S,W+1,k),k=W)}}(u,h,0,u.length-1),o&&o.push(u.buffer,h.buffer),{ids:u,positions:h}},et.deserialize=function(t){var o=new et;return o.ids=t.ids,o.positions=t.positions,o.indexed=!0,o};var yt=Math.pow(2,53)-1;function Ht(t){var o=+t;return!isNaN(o)&&o<=yt?o:be(String(t))}function Nt(t,o,u){var h=t[o];t[o]=t[u],t[u]=h}yn("FeaturePositionMap",et);var Qt=function(t,o){this.gl=t.gl,this.location=o},rr=function(t){function o(u,h){t.call(this,u,h),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))},o}(Qt),Ir=function(t){function o(u,h){t.call(this,u,h),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))},o}(Qt),Or=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))},o}(Qt),ln=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))},o}(Qt),Bn=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))},o}(Qt),Dn=function(t){function o(u,h){t.call(this,u,h),this.current=Gi.transparent}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))},o}(Qt),Un=new Float32Array(16),Ni=function(t){function o(u,h){t.call(this,u,h),this.current=Un}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(var h=1;h<16;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}},o}(Qt);function on(t){return[pe(255*t.r,255*t.g),pe(255*t.b,255*t.a)]}var ni=function(t,o,u){this.value=t,this.uniformNames=o.map(function(h){return"u_"+h}),this.type=u};ni.prototype.setUniform=function(t,o,u){t.set(u.constantOr(this.value))},ni.prototype.getBinding=function(t,o,u){return this.type==="color"?new Dn(t,o):new Ir(t,o)};var pi=function(t,o){this.uniformNames=o.map(function(u){return"u_"+u}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};pi.prototype.setConstantPatternPositions=function(t,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=t.tlbr},pi.prototype.setUniform=function(t,o,u,h){var y=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&t.set(y)},pi.prototype.getBinding=function(t,o,u){return u.substr(0,9)==="u_pattern"?new Bn(t,o):new Ir(t,o)};var ei=function(t,o,u,h){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(function(y){return{name:"a_"+y,type:"Float32",components:u==="color"?2:1,offset:0}}),this.paintVertexArray=new h};ei.prototype.populatePaintArray=function(t,o,u,h,y){var b=this.paintVertexArray.length,S=this.expression.evaluate(new Li(0),o,{},h,[],y);this.paintVertexArray.resize(t),this._setPaintValue(b,t,S)},ei.prototype.updatePaintArray=function(t,o,u,h){var y=this.expression.evaluate({zoom:0},u,h);this._setPaintValue(t,o,y)},ei.prototype._setPaintValue=function(t,o,u){if(this.type==="color")for(var h=on(u),y=t;y<o;y++)this.paintVertexArray.emplace(y,h[0],h[1]);else{for(var b=t;b<o;b++)this.paintVertexArray.emplace(b,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}},ei.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ei.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Vn=function(t,o,u,h,y,b){this.expression=t,this.uniformNames=o.map(function(S){return"u_"+S+"_t"}),this.type=u,this.useIntegerZoom=h,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=o.map(function(S){return{name:"a_"+S,type:"Float32",components:u==="color"?4:2,offset:0}}),this.paintVertexArray=new b};Vn.prototype.populatePaintArray=function(t,o,u,h,y){var b=this.expression.evaluate(new Li(this.zoom),o,{},h,[],y),S=this.expression.evaluate(new Li(this.zoom+1),o,{},h,[],y),P=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(P,t,b,S)},Vn.prototype.updatePaintArray=function(t,o,u,h){var y=this.expression.evaluate({zoom:this.zoom},u,h),b=this.expression.evaluate({zoom:this.zoom+1},u,h);this._setPaintValue(t,o,y,b)},Vn.prototype._setPaintValue=function(t,o,u,h){if(this.type==="color")for(var y=on(u),b=on(h),S=t;S<o;S++)this.paintVertexArray.emplace(S,y[0],y[1],b[0],b[1]);else{for(var P=t;P<o;P++)this.paintVertexArray.emplace(P,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}},Vn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Vn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Vn.prototype.setUniform=function(t,o){var u=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,h=Vt(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);t.set(h)},Vn.prototype.getBinding=function(t,o,u){return new Ir(t,o)};var gi=function(t,o,u,h,y,b){this.expression=t,this.type=o,this.useIntegerZoom=u,this.zoom=h,this.layerId=b,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y};gi.prototype.populatePaintArray=function(t,o,u){var h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,o.patterns&&o.patterns[this.layerId],u)},gi.prototype.updatePaintArray=function(t,o,u,h,y){this._setPaintValues(t,o,u.patterns&&u.patterns[this.layerId],y)},gi.prototype._setPaintValues=function(t,o,u,h){if(h&&u){var y=h[u.min],b=h[u.mid],S=h[u.max];if(y&&b&&S)for(var P=t;P<o;P++)this.zoomInPaintVertexArray.emplace(P,b.tl[0],b.tl[1],b.br[0],b.br[1],y.tl[0],y.tl[1],y.br[0],y.br[1],b.pixelRatio,y.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,b.tl[0],b.tl[1],b.br[0],b.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],b.pixelRatio,S.pixelRatio)}},gi.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Re.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Re.members,this.expression.isStateDependent))},gi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Kn=function(t,o,u){this.binders={},this._buffers=[];var h=[];for(var y in t.paint._values)if(u(y)){var b=t.paint.get(y);if(b instanceof _s&&Bs(b.property.specification)){var S=Mo(y,t.type),P=b.value,k=b.property.specification.type,z=b.property.useIntegerZoom,Z=b.property.specification["property-type"],W=Z==="cross-faded"||Z==="cross-faded-data-driven";if(P.kind==="constant")this.binders[y]=W?new pi(P.value,S):new ni(P.value,S,k),h.push("/u_"+y);else if(P.kind==="source"||W){var ee=ua(y,k,"source");this.binders[y]=W?new gi(P,k,z,o,ee,t.id):new ei(P,S,k,ee),h.push("/a_"+y)}else{var ne=ua(y,k,"composite");this.binders[y]=new Vn(P,S,k,z,o,ne),h.push("/z_"+y)}}}this.cacheKey=h.sort().join("")};Kn.prototype.getMaxValue=function(t){var o=this.binders[t];return o instanceof ei||o instanceof Vn?o.maxValue:0},Kn.prototype.populatePaintArrays=function(t,o,u,h,y){for(var b in this.binders){var S=this.binders[b];(S instanceof ei||S instanceof Vn||S instanceof gi)&&S.populatePaintArray(t,o,u,h,y)}},Kn.prototype.setConstantPatternPositions=function(t,o){for(var u in this.binders){var h=this.binders[u];h instanceof pi&&h.setConstantPatternPositions(t,o)}},Kn.prototype.updatePaintArrays=function(t,o,u,h,y){var b=!1;for(var S in t)for(var P=0,k=o.getPositions(S);P<k.length;P+=1){var z=k[P],Z=u.feature(z.index);for(var W in this.binders){var ee=this.binders[W];if((ee instanceof ei||ee instanceof Vn||ee instanceof gi)&&ee.expression.isStateDependent===!0){var ne=h.paint.get(W);ee.expression=ne.value,ee.updatePaintArray(z.start,z.end,Z,t[S],y),b=!0}}}return b},Kn.prototype.defines=function(){var t=[];for(var o in this.binders){var u=this.binders[o];(u instanceof ni||u instanceof pi)&&t.push.apply(t,u.uniformNames.map(function(h){return"#define HAS_UNIFORM_"+h}))}return t},Kn.prototype.getBinderAttributes=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof ei||u instanceof Vn)for(var h=0;h<u.paintVertexAttributes.length;h++)t.push(u.paintVertexAttributes[h].name);else if(u instanceof gi)for(var y=0;y<Re.members.length;y++)t.push(Re.members[y].name)}return t},Kn.prototype.getBinderUniforms=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof ni||u instanceof pi||u instanceof Vn)for(var h=0,y=u.uniformNames;h<y.length;h+=1)t.push(y[h])}return t},Kn.prototype.getPaintVertexBuffers=function(){return this._buffers},Kn.prototype.getUniforms=function(t,o){var u=[];for(var h in this.binders){var y=this.binders[h];if(y instanceof ni||y instanceof pi||y instanceof Vn)for(var b=0,S=y.uniformNames;b<S.length;b+=1){var P=S[b];if(o[P]){var k=y.getBinding(t,o[P],P);u.push({name:P,property:h,binding:k})}}}return u},Kn.prototype.setUniforms=function(t,o,u,h){for(var y=0,b=o;y<b.length;y+=1){var S=b[y],P=S.name,k=S.property;this.binders[k].setUniform(S.binding,h,u.get(k),P)}},Kn.prototype.updatePaintBuffers=function(t){for(var o in this._buffers=[],this.binders){var u=this.binders[o];if(t&&u instanceof gi){var h=t.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(u instanceof ei||u instanceof Vn)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}},Kn.prototype.upload=function(t){for(var o in this.binders){var u=this.binders[o];(u instanceof ei||u instanceof Vn||u instanceof gi)&&u.upload(t)}this.updatePaintBuffers()},Kn.prototype.destroy=function(){for(var t in this.binders){var o=this.binders[t];(o instanceof ei||o instanceof Vn||o instanceof gi)&&o.destroy()}};var Gn=function(t,o,u){u===void 0&&(u=function(){return!0}),this.programConfigurations={};for(var h=0,y=t;h<y.length;h+=1){var b=y[h];this.programConfigurations[b.id]=new Kn(b,o,u)}this.needsUpload=!1,this._featureMap=new et,this._bufferOffset=0};function Mo(t,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(o+"-","").replace(/-/g,"_")]}function ua(t,o,u){var h={color:{source:gl,composite:ac},number:{source:_l,composite:gl}},y=function(b){return{"line-pattern":{source:Cu,composite:Cu},"fill-pattern":{source:Cu,composite:Cu},"fill-extrusion-pattern":{source:Cu,composite:Cu}}[b]}(t);return y&&y[u]||h[o][u]}Gn.prototype.populatePaintArrays=function(t,o,u,h,y,b){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,o,h,y,b);o.id!==void 0&&this._featureMap.add(o.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Gn.prototype.updatePaintArrays=function(t,o,u,h){for(var y=0,b=u;y<b.length;y+=1){var S=b[y];this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(t,this._featureMap,o,S,h)||this.needsUpload}},Gn.prototype.get=function(t){return this.programConfigurations[t]},Gn.prototype.upload=function(t){if(this.needsUpload){for(var o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}},Gn.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},yn("ConstantBinder",ni),yn("CrossFadedConstantBinder",pi),yn("SourceExpressionBinder",ei),yn("CrossFadedCompositeBinder",gi),yn("CompositeExpressionBinder",Vn),yn("ProgramConfiguration",Kn,{omit:["_buffers"]}),yn("ProgramConfigurationSet",Gn);var Wo=Math.pow(2,14)-1,to=-Wo-1;function ro(t){for(var o=8192/t.extent,u=t.loadGeometry(),h=0;h<u.length;h++)for(var y=u[h],b=0;b<y.length;b++){var S=y[b],P=Math.round(S.x*o),k=Math.round(S.y*o);S.x=Vt(P,to,Wo),S.y=Vt(k,to,Wo),(P<S.x||P>S.x+1||k<S.y||k>S.y+1)&&Qe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return u}function Za(t,o){return{type:t.type,id:t.id,properties:t.properties,geometry:o?ro(t):[]}}function bs(t,o,u,h,y){t.emplaceBack(2*o+(h+1)/2,2*u+(y+1)/2)}var Es=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ll,this.indexArray=new ol,this.segments=new fe,this.programConfigurations=new Gn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function Nu(t,o){for(var u=0;u<t.length;u++)if(wu(o,t[u]))return!0;for(var h=0;h<o.length;h++)if(wu(t,o[h]))return!0;return!!fo(t,o)}function Ss(t,o,u){return!!wu(t,o)||!!Au(o,t,u)}function hu(t,o){if(t.length===1)return Bc(o,t[0]);for(var u=0;u<o.length;u++)for(var h=o[u],y=0;y<h.length;y++)if(wu(t,h[y]))return!0;for(var b=0;b<t.length;b++)if(Bc(o,t[b]))return!0;for(var S=0;S<o.length;S++)if(fo(t,o[S]))return!0;return!1}function Ra(t,o,u){if(t.length>1){if(fo(t,o))return!0;for(var h=0;h<o.length;h++)if(Au(o[h],t,u))return!0}for(var y=0;y<t.length;y++)if(Au(t[y],o,u))return!0;return!1}function fo(t,o){if(t.length===0||o.length===0)return!1;for(var u=0;u<t.length-1;u++)for(var h=t[u],y=t[u+1],b=0;b<o.length-1;b++)if(zu(h,y,o[b],o[b+1]))return!0;return!1}function zu(t,o,u,h){return Kt(t,u,h)!==Kt(o,u,h)&&Kt(t,o,u)!==Kt(t,o,h)}function Au(t,o,u){var h=u*u;if(o.length===1)return t.distSqr(o[0])<h;for(var y=1;y<o.length;y++)if(du(t,o[y-1],o[y])<h)return!0;return!1}function du(t,o,u){var h=o.distSqr(u);if(h===0)return t.distSqr(o);var y=((t.x-o.x)*(u.x-o.x)+(t.y-o.y)*(u.y-o.y))/h;return t.distSqr(y<0?o:y>1?u:u.sub(o)._mult(y)._add(o))}function Bc(t,o){for(var u,h,y,b=!1,S=0;S<t.length;S++)for(var P=0,k=(u=t[S]).length-1;P<u.length;k=P++)(h=u[P]).y>o.y!=(y=u[k]).y>o.y&&o.x<(y.x-h.x)*(o.y-h.y)/(y.y-h.y)+h.x&&(b=!b);return b}function wu(t,o){for(var u=!1,h=0,y=t.length-1;h<t.length;y=h++){var b=t[h],S=t[y];b.y>o.y!=S.y>o.y&&o.x<(S.x-b.x)*(o.y-b.y)/(S.y-b.y)+b.x&&(u=!u)}return u}function oc(t,o,u){var h=u[0],y=u[2];if(t.x<h.x&&o.x<h.x||t.x>y.x&&o.x>y.x||t.y<h.y&&o.y<h.y||t.y>y.y&&o.y>y.y)return!1;var b=Kt(t,o,u[0]);return b!==Kt(t,o,u[1])||b!==Kt(t,o,u[2])||b!==Kt(t,o,u[3])}function Uu(t,o,u){var h=o.paint.get(t).value;return h.kind==="constant"?h.value:u.programConfigurations.get(o.id).getMaxValue(t)}function Eo(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Xo(t,o,u,h,y){if(!o[0]&&!o[1])return t;var b=se.convert(o)._mult(y);u==="viewport"&&b._rotate(-h);for(var S=[],P=0;P<t.length;P++)S.push(t[P].sub(b));return S}Es.prototype.populate=function(t,o,u){var h=this.layers[0],y=[],b=null;h.type==="circle"&&(b=h.layout.get("circle-sort-key"));for(var S=0,P=t;S<P.length;S+=1){var k=P[S],z=k.feature,Z=k.id,W=k.index,ee=k.sourceLayerIndex,ne=this.layers[0]._featureFilter.needGeometry,Me=Za(z,ne);if(this.layers[0]._featureFilter.filter(new Li(this.zoom),Me,u)){var Oe=b?b.evaluate(Me,{},u):void 0,Ye={id:Z,properties:z.properties,type:z.type,sourceLayerIndex:ee,index:W,geometry:ne?Me.geometry:ro(z),patterns:{},sortKey:Oe};y.push(Ye)}}b&&y.sort(function(zr,Pn){return zr.sortKey-Pn.sortKey});for(var Ze=0,st=y;Ze<st.length;Ze+=1){var Ct=st[Ze],Zt=Ct.geometry,Wt=Ct.index,lr=Ct.sourceLayerIndex,Lr=t[Wt].feature;this.addFeature(Ct,Zt,Wt,u),o.featureIndex.insert(Lr,Zt,Wt,lr,this.index)}},Es.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},Es.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Es.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Es.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,oe),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Es.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Es.prototype.addFeature=function(t,o,u,h){for(var y=0,b=o;y<b.length;y+=1)for(var S=0,P=b[y];S<P.length;S+=1){var k=P[S],z=k.x,Z=k.y;if(!(z<0||z>=8192||Z<0||Z>=8192)){var W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),ee=W.vertexLength;bs(this.layoutVertexArray,z,Z,-1,-1),bs(this.layoutVertexArray,z,Z,1,-1),bs(this.layoutVertexArray,z,Z,1,1),bs(this.layoutVertexArray,z,Z,-1,1),this.indexArray.emplaceBack(ee,ee+1,ee+2),this.indexArray.emplaceBack(ee,ee+3,ee+2),W.vertexLength+=4,W.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},h)},yn("CircleBucket",Es,{omit:["layers"]});var xl=new es({"circle-sort-key":new wn(ce.layout_circle["circle-sort-key"])}),bl={paint:new es({"circle-radius":new wn(ce.paint_circle["circle-radius"]),"circle-color":new wn(ce.paint_circle["circle-color"]),"circle-blur":new wn(ce.paint_circle["circle-blur"]),"circle-opacity":new wn(ce.paint_circle["circle-opacity"]),"circle-translate":new Ln(ce.paint_circle["circle-translate"]),"circle-translate-anchor":new Ln(ce.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ln(ce.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ln(ce.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new wn(ce.paint_circle["circle-stroke-width"]),"circle-stroke-color":new wn(ce.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new wn(ce.paint_circle["circle-stroke-opacity"])}),layout:xl},la=typeof Float32Array!="undefined"?Float32Array:Array;function ts(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function rs(t,o,u){var h=o[0],y=o[1],b=o[2],S=o[3],P=o[4],k=o[5],z=o[6],Z=o[7],W=o[8],ee=o[9],ne=o[10],Me=o[11],Oe=o[12],Ye=o[13],Ze=o[14],st=o[15],Ct=u[0],Zt=u[1],Wt=u[2],lr=u[3];return t[0]=Ct*h+Zt*P+Wt*W+lr*Oe,t[1]=Ct*y+Zt*k+Wt*ee+lr*Ye,t[2]=Ct*b+Zt*z+Wt*ne+lr*Ze,t[3]=Ct*S+Zt*Z+Wt*Me+lr*st,t[4]=(Ct=u[4])*h+(Zt=u[5])*P+(Wt=u[6])*W+(lr=u[7])*Oe,t[5]=Ct*y+Zt*k+Wt*ee+lr*Ye,t[6]=Ct*b+Zt*z+Wt*ne+lr*Ze,t[7]=Ct*S+Zt*Z+Wt*Me+lr*st,t[8]=(Ct=u[8])*h+(Zt=u[9])*P+(Wt=u[10])*W+(lr=u[11])*Oe,t[9]=Ct*y+Zt*k+Wt*ee+lr*Ye,t[10]=Ct*b+Zt*z+Wt*ne+lr*Ze,t[11]=Ct*S+Zt*Z+Wt*Me+lr*st,t[12]=(Ct=u[12])*h+(Zt=u[13])*P+(Wt=u[14])*W+(lr=u[15])*Oe,t[13]=Ct*y+Zt*k+Wt*ee+lr*Ye,t[14]=Ct*b+Zt*z+Wt*ne+lr*Ze,t[15]=Ct*S+Zt*Z+Wt*Me+lr*st,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,o=0,u=arguments.length;u--;)o+=t[u]*t[u];return Math.sqrt(o)});var vu,sc=rs;function uc(t,o,u){var h=o[0],y=o[1],b=o[2],S=o[3];return t[0]=u[0]*h+u[4]*y+u[8]*b+u[12]*S,t[1]=u[1]*h+u[5]*y+u[9]*b+u[13]*S,t[2]=u[2]*h+u[6]*y+u[10]*b+u[14]*S,t[3]=u[3]*h+u[7]*y+u[11]*b+u[15]*S,t}vu=new la(3),la!=Float32Array&&(vu[0]=0,vu[1]=0,vu[2]=0),function(){var t=new la(4);la!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var Bl=(function(){var t=new la(2);la!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function o(u){t.call(this,u,bl)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new Es(u)},o.prototype.queryRadius=function(u){var h=u;return Uu("circle-radius",this,h)+Uu("circle-stroke-width",this,h)+Eo(this.paint.get("circle-translate"))},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,P,k,z){for(var Z=Xo(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),P.angle,k),W=this.paint.get("circle-radius").evaluate(h,y)+this.paint.get("circle-stroke-width").evaluate(h,y),ee=this.paint.get("circle-pitch-alignment")==="map",ne=ee?Z:function(Lr,zr){return Lr.map(function(Pn){return Ts(Pn,zr)})}(Z,z),Me=ee?W*k:W,Oe=0,Ye=b;Oe<Ye.length;Oe+=1)for(var Ze=0,st=Ye[Oe];Ze<st.length;Ze+=1){var Ct=st[Ze],Zt=ee?Ct:Ts(Ct,z),Wt=Me,lr=uc([],[Ct.x,Ct.y,0,1],z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Wt*=lr[3]/P.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Wt*=P.cameraToCenterDistance/lr[3]),Ss(ne,Zt,Wt))return!0}return!1},o}(wa));function Ts(t,o){var u=uc([],[t.x,t.y,0,1],o);return new se(u[0]/u[3],u[1]/u[3])}var Nl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Es);function iu(t,o,u,h){var y=o.width,b=o.height;if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==y*b*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(y*b*u);return t.width=y,t.height=b,t.data=h,t}function Zu(t,o,u){var h=o.width,y=o.height;if(h!==t.width||y!==t.height){var b=iu({},{width:h,height:y},u);lc(t,b,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,h),height:Math.min(t.height,y)},u),t.width=h,t.height=y,t.data=b.data}}function lc(t,o,u,h,y,b){if(y.width===0||y.height===0)return o;if(y.width>t.width||y.height>t.height||u.x>t.width-y.width||u.y>t.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>o.width||y.height>o.height||h.x>o.width-y.width||h.y>o.height-y.height)throw new RangeError("out of range destination coordinates for image copy");for(var S=t.data,P=o.data,k=0;k<y.height;k++)for(var z=((u.y+k)*t.width+u.x)*b,Z=((h.y+k)*o.width+h.x)*b,W=0;W<y.width*b;W++)P[Z+W]=S[z+W];return o}yn("HeatmapBucket",Nl,{omit:["layers"]});var Tu=function(t,o){iu(this,t,1,o)};Tu.prototype.resize=function(t){Zu(this,t,1)},Tu.prototype.clone=function(){return new Tu({width:this.width,height:this.height},new Uint8Array(this.data))},Tu.copy=function(t,o,u,h,y){lc(t,o,u,h,y,1)};var zo=function(t,o){iu(this,t,4,o)};zo.prototype.resize=function(t){Zu(this,t,4)},zo.prototype.replace=function(t,o){o?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},zo.prototype.clone=function(){return new zo({width:this.width,height:this.height},new Uint8Array(this.data))},zo.copy=function(t,o,u,h,y){lc(t,o,u,h,y,4)},yn("AlphaImage",Tu),yn("RGBAImage",zo);var Hs={paint:new es({"heatmap-radius":new wn(ce.paint_heatmap["heatmap-radius"]),"heatmap-weight":new wn(ce.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ln(ce.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Eu(ce.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ln(ce.paint_heatmap["heatmap-opacity"])})};function gf(t){var o={},u=t.resolution||256,h=t.clips?t.clips.length:1,y=t.image||new zo({width:u,height:h}),b=function(Me,Oe,Ye){o[t.evaluationKey]=Ye;var Ze=t.expression.evaluate(o);y.data[Me+Oe+0]=Math.floor(255*Ze.r/Ze.a),y.data[Me+Oe+1]=Math.floor(255*Ze.g/Ze.a),y.data[Me+Oe+2]=Math.floor(255*Ze.b/Ze.a),y.data[Me+Oe+3]=Math.floor(255*Ze.a)};if(t.clips)for(var S=0,P=0;S<h;++S,P+=4*u)for(var k=0,z=0;k<u;k++,z+=4){var Z=k/(u-1),W=t.clips[S];b(P,z,W.start*(1-Z)+W.end*Z)}else for(var ee=0,ne=0;ee<u;ee++,ne+=4)b(0,ne,ee/(u-1));return y}var Mp=function(t){function o(u){t.call(this,u,Hs),this._updateColorRamp()}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new Nl(u)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="heatmap-color"&&this._updateColorRamp()},o.prototype._updateColorRamp=function(){this.colorRamp=gf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},o.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},o}(wa),Vf={paint:new es({"hillshade-illumination-direction":new Ln(ce.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ln(ce.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ln(ce.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ln(ce.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ln(ce.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ln(ce.paint_hillshade["hillshade-accent-color"])})},sh=function(t){function o(u){t.call(this,u,Vf)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},o}(wa),uh=Oa([{name:"a_pos",components:2,type:"Int16"}],4).members,cc=_f,yf=_f;function _f(t,o,u){u=u||2;var h,y,b,S,P,k,z,Z=o&&o.length,W=Z?o[0]*u:t.length,ee=ju(t,0,W,u,!0),ne=[];if(!ee||ee.next===ee.prev)return ne;if(Z&&(ee=function(Oe,Ye,Ze,st){var Ct,Zt,Wt,lr=[];for(Ct=0,Zt=Ye.length;Ct<Zt;Ct++)(Wt=ju(Oe,Ye[Ct]*st,Ct<Zt-1?Ye[Ct+1]*st:Oe.length,st,!1))===Wt.next&&(Wt.steiner=!0),lr.push(Sd(Wt));for(lr.sort(bd),Ct=0;Ct<lr.length;Ct++)Ed(lr[Ct],Ze),Ze=zl(Ze,Ze.next);return Ze}(t,o,ee,u)),t.length>80*u){h=b=t[0],y=S=t[1];for(var Me=u;Me<W;Me+=u)(P=t[Me])<h&&(h=P),(k=t[Me+1])<y&&(y=k),P>b&&(b=P),k>S&&(S=k);z=(z=Math.max(b-h,S-y))!==0?1/z:0}return xf(ee,ne,u,h,y,z),ne}function ju(t,o,u,h,y){var b,S;if(y===Zc(t,o,u,h)>0)for(b=o;b<u;b+=h)S=Ef(b,t[b],t[b+1],S);else for(b=u-h;b>=o;b-=h)S=Ef(b,t[b],t[b+1],S);return S&&zc(S,S.next)&&(fc(S),S=S.next),S}function zl(t,o){if(!t)return t;o||(o=t);var u,h=t;do if(u=!1,h.steiner||!zc(h,h.next)&&Po(h.prev,h,h.next)!==0)h=h.next;else{if(fc(h),(h=o=h.prev)===h.next)break;u=!0}while(u||h!==o);return o}function xf(t,o,u,h,y,b,S){if(t){!S&&b&&function(Z,W,ee,ne){var Me=Z;do Me.z===null&&(Me.z=Ip(Me.x,Me.y,W,ee,ne)),Me.prevZ=Me.prev,Me.nextZ=Me.next,Me=Me.next;while(Me!==Z);Me.prevZ.nextZ=null,Me.prevZ=null,function(Oe){var Ye,Ze,st,Ct,Zt,Wt,lr,Lr,zr=1;do{for(Ze=Oe,Oe=null,Zt=null,Wt=0;Ze;){for(Wt++,st=Ze,lr=0,Ye=0;Ye<zr&&(lr++,st=st.nextZ);Ye++);for(Lr=zr;lr>0||Lr>0&&st;)lr!==0&&(Lr===0||!st||Ze.z<=st.z)?(Ct=Ze,Ze=Ze.nextZ,lr--):(Ct=st,st=st.nextZ,Lr--),Zt?Zt.nextZ=Ct:Oe=Ct,Ct.prevZ=Zt,Zt=Ct;Ze=st}Zt.nextZ=null,zr*=2}while(Wt>1)}(Me)}(t,h,y,b);for(var P,k,z=t;t.prev!==t.next;)if(P=t.prev,k=t.next,b?Hh(t,h,y,b):lh(t))o.push(P.i/u),o.push(t.i/u),o.push(k.i/u),fc(t),t=k.next,z=k.next;else if((t=k)===z){S?S===1?xf(t=Nc(zl(t),o,u),o,u,h,y,b,2):S===2&&Pp(t,o,u,h,y,b):xf(zl(t),o,u,h,y,b,1);break}}}function lh(t){var o=t.prev,u=t,h=t.next;if(Po(o,u,h)>=0)return!1;for(var y=t.next.next;y!==t.prev;){if(bf(o.x,o.y,u.x,u.y,h.x,h.y,y.x,y.y)&&Po(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function Hh(t,o,u,h){var y=t.prev,b=t,S=t.next;if(Po(y,b,S)>=0)return!1;for(var P=y.x>b.x?y.x>S.x?y.x:S.x:b.x>S.x?b.x:S.x,k=y.y>b.y?y.y>S.y?y.y:S.y:b.y>S.y?b.y:S.y,z=Ip(y.x<b.x?y.x<S.x?y.x:S.x:b.x<S.x?b.x:S.x,y.y<b.y?y.y<S.y?y.y:S.y:b.y<S.y?b.y:S.y,o,u,h),Z=Ip(P,k,o,u,h),W=t.prevZ,ee=t.nextZ;W&&W.z>=z&&ee&&ee.z<=Z;){if(W!==t.prev&&W!==t.next&&bf(y.x,y.y,b.x,b.y,S.x,S.y,W.x,W.y)&&Po(W.prev,W,W.next)>=0||(W=W.prevZ,ee!==t.prev&&ee!==t.next&&bf(y.x,y.y,b.x,b.y,S.x,S.y,ee.x,ee.y)&&Po(ee.prev,ee,ee.next)>=0))return!1;ee=ee.nextZ}for(;W&&W.z>=z;){if(W!==t.prev&&W!==t.next&&bf(y.x,y.y,b.x,b.y,S.x,S.y,W.x,W.y)&&Po(W.prev,W,W.next)>=0)return!1;W=W.prevZ}for(;ee&&ee.z<=Z;){if(ee!==t.prev&&ee!==t.next&&bf(y.x,y.y,b.x,b.y,S.x,S.y,ee.x,ee.y)&&Po(ee.prev,ee,ee.next)>=0)return!1;ee=ee.nextZ}return!0}function Nc(t,o,u){var h=t;do{var y=h.prev,b=h.next.next;!zc(y,b)&&Xh(y,h,h.next,b)&&Gf(y,b)&&Gf(b,y)&&(o.push(y.i/u),o.push(h.i/u),o.push(b.i/u),fc(h),fc(h.next),h=t=b),h=h.next}while(h!==t);return zl(h)}function Pp(t,o,u,h,y,b){var S=t;do{for(var P=S.next.next;P!==S.prev;){if(S.i!==P.i&&Cd(S,P)){var k=Lp(S,P);return S=zl(S,S.next),k=zl(k,k.next),xf(S,o,u,h,y,b),void xf(k,o,u,h,y,b)}P=P.next}S=S.next}while(S!==t)}function bd(t,o){return t.x-o.x}function Ed(t,o){if(o=function(h,y){var b,S=y,P=h.x,k=h.y,z=-1/0;do{if(k<=S.y&&k>=S.next.y&&S.next.y!==S.y){var Z=S.x+(k-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(Z<=P&&Z>z){if(z=Z,Z===P){if(k===S.y)return S;if(k===S.next.y)return S.next}b=S.x<S.next.x?S:S.next}}S=S.next}while(S!==y);if(!b)return null;if(P===z)return b;var W,ee=b,ne=b.x,Me=b.y,Oe=1/0;S=b;do P>=S.x&&S.x>=ne&&P!==S.x&&bf(k<Me?P:z,k,ne,Me,k<Me?z:P,k,S.x,S.y)&&(W=Math.abs(k-S.y)/(P-S.x),Gf(S,h)&&(W<Oe||W===Oe&&(S.x>b.x||S.x===b.x&&Wh(b,S)))&&(b=S,Oe=W)),S=S.next;while(S!==ee);return b}(t,o)){var u=Lp(o,t);zl(o,o.next),zl(u,u.next)}}function Wh(t,o){return Po(t.prev,t,o.prev)<0&&Po(o.next,t,t.next)<0}function Ip(t,o,u,h,y){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-u)*y)|t<<8))|t<<4))|t<<2))|t<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-h)*y)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Sd(t){var o=t,u=t;do(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next;while(o!==t);return u}function bf(t,o,u,h,y,b,S,P){return(y-S)*(o-P)-(t-S)*(b-P)>=0&&(t-S)*(h-P)-(u-S)*(o-P)>=0&&(u-S)*(b-P)-(y-S)*(h-P)>=0}function Cd(t,o){return t.next.i!==o.i&&t.prev.i!==o.i&&!function(u,h){var y=u;do{if(y.i!==u.i&&y.next.i!==u.i&&y.i!==h.i&&y.next.i!==h.i&&Xh(y,y.next,u,h))return!0;y=y.next}while(y!==u);return!1}(t,o)&&(Gf(t,o)&&Gf(o,t)&&function(u,h){var y=u,b=!1,S=(u.x+h.x)/2,P=(u.y+h.y)/2;do y.y>P!=y.next.y>P&&y.next.y!==y.y&&S<(y.next.x-y.x)*(P-y.y)/(y.next.y-y.y)+y.x&&(b=!b),y=y.next;while(y!==u);return b}(t,o)&&(Po(t.prev,t,o.prev)||Po(t,o.prev,o))||zc(t,o)&&Po(t.prev,t,t.next)>0&&Po(o.prev,o,o.next)>0)}function Po(t,o,u){return(o.y-t.y)*(u.x-o.x)-(o.x-t.x)*(u.y-o.y)}function zc(t,o){return t.x===o.x&&t.y===o.y}function Xh(t,o,u,h){var y=Rp(Po(t,o,u)),b=Rp(Po(t,o,h)),S=Rp(Po(u,h,t)),P=Rp(Po(u,h,o));return y!==b&&S!==P||!(y!==0||!Op(t,u,o))||!(b!==0||!Op(t,h,o))||!(S!==0||!Op(u,t,h))||!(P!==0||!Op(u,o,h))}function Op(t,o,u){return o.x<=Math.max(t.x,u.x)&&o.x>=Math.min(t.x,u.x)&&o.y<=Math.max(t.y,u.y)&&o.y>=Math.min(t.y,u.y)}function Rp(t){return t>0?1:t<0?-1:0}function Gf(t,o){return Po(t.prev,t,t.next)<0?Po(t,o,t.next)>=0&&Po(t,t.prev,o)>=0:Po(t,o,t.prev)<0||Po(t,t.next,o)<0}function Lp(t,o){var u=new Uc(t.i,t.x,t.y),h=new Uc(o.i,o.x,o.y),y=t.next,b=o.prev;return t.next=o,o.prev=t,u.next=y,y.prev=u,h.next=u,u.prev=h,b.next=h,h.prev=b,h}function Ef(t,o,u,h){var y=new Uc(t,o,u);return h?(y.next=h.next,y.prev=h,h.next.prev=y,h.next=y):(y.prev=y,y.next=y),y}function fc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Uc(t,o,u){this.i=t,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Zc(t,o,u,h){for(var y=0,b=o,S=u-h;b<u;b+=h)y+=(t[S]-t[b])*(t[b+1]+t[S+1]),S=b;return y}function kp(t,o,u,h,y){(function b(S,P,k,z,Z){for(;z>k;){if(z-k>600){var W=z-k+1,ee=P-k+1,ne=Math.log(W),Me=.5*Math.exp(2*ne/3),Oe=.5*Math.sqrt(ne*Me*(W-Me)/W)*(ee-W/2<0?-1:1);b(S,P,Math.max(k,Math.floor(P-ee*Me/W+Oe)),Math.min(z,Math.floor(P+(W-ee)*Me/W+Oe)),Z)}var Ye=S[P],Ze=k,st=z;for(pc(S,k,P),Z(S[z],Ye)>0&&pc(S,k,z);Ze<st;){for(pc(S,Ze,st),Ze++,st--;Z(S[Ze],Ye)<0;)Ze++;for(;Z(S[st],Ye)>0;)st--}Z(S[k],Ye)===0?pc(S,k,st):pc(S,++st,z),st<=P&&(k=st+1),P<=st&&(z=st-1)}})(t,o,u||0,h||t.length-1,y||Dp)}function pc(t,o,u){var h=t[o];t[o]=t[u],t[u]=h}function Dp(t,o){return t<o?-1:t>o?1:0}function Hf(t,o){var u=t.length;if(u<=1)return[t];for(var h,y,b=[],S=0;S<u;S++){var P=Sr(t[S]);P!==0&&(t[S].area=Math.abs(P),y===void 0&&(y=P<0),y===P<0?(h&&b.push(h),h=[t[S]]):h.push(t[S]))}if(h&&b.push(h),o>1)for(var k=0;k<b.length;k++)b[k].length<=o||(kp(b[k],o,1,b[k].length-1,Fp),b[k]=b[k].slice(0,o));return b}function Fp(t,o){return o.area-t.area}function Sf(t,o,u){for(var h=u.patternDependencies,y=!1,b=0,S=o;b<S.length;b+=1){var P=S[b].paint.get(t+"-pattern");P.isConstant()||(y=!0);var k=P.constantOr(null);k&&(y=!0,h[k.to]=!0,h[k.from]=!0)}return y}function sl(t,o,u,h,y){for(var b=y.patternDependencies,S=0,P=o;S<P.length;S+=1){var k=P[S],z=k.paint.get(t+"-pattern").value;if(z.kind!=="constant"){var Z=z.evaluate({zoom:h-1},u,{},y.availableImages),W=z.evaluate({zoom:h},u,{},y.availableImages),ee=z.evaluate({zoom:h+1},u,{},y.availableImages);W=W&&W.name?W.name:W,ee=ee&&ee.name?ee.name:ee,b[Z=Z&&Z.name?Z.name:Z]=!0,b[W]=!0,b[ee]=!0,u.patterns[k.id]={min:Z,mid:W,max:ee}}}return u}_f.deviation=function(t,o,u,h){var y=o&&o.length,b=Math.abs(Zc(t,0,y?o[0]*u:t.length,u));if(y)for(var S=0,P=o.length;S<P;S++)b-=Math.abs(Zc(t,o[S]*u,S<P-1?o[S+1]*u:t.length,u));var k=0;for(S=0;S<h.length;S+=3){var z=h[S]*u,Z=h[S+1]*u,W=h[S+2]*u;k+=Math.abs((t[z]-t[W])*(t[Z+1]-t[z+1])-(t[z]-t[Z])*(t[W+1]-t[z+1]))}return b===0&&k===0?0:Math.abs((k-b)/b)},_f.flatten=function(t){for(var o=t[0][0].length,u={vertices:[],holes:[],dimensions:o},h=0,y=0;y<t.length;y++){for(var b=0;b<t[y].length;b++)for(var S=0;S<o;S++)u.vertices.push(t[y][b][S]);y>0&&u.holes.push(h+=t[y-1].length)}return u},cc.default=yf;var au=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ll,this.indexArray=new ol,this.indexArray2=new Gs,this.programConfigurations=new Gn(t.layers,t.zoom),this.segments=new fe,this.segments2=new fe,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};au.prototype.populate=function(t,o,u){this.hasPattern=Sf("fill",this.layers,o);for(var h=this.layers[0].layout.get("fill-sort-key"),y=[],b=0,S=t;b<S.length;b+=1){var P=S[b],k=P.feature,z=P.id,Z=P.index,W=P.sourceLayerIndex,ee=this.layers[0]._featureFilter.needGeometry,ne=Za(k,ee);if(this.layers[0]._featureFilter.filter(new Li(this.zoom),ne,u)){var Me=h?h.evaluate(ne,{},u,o.availableImages):void 0,Oe={id:z,properties:k.properties,type:k.type,sourceLayerIndex:W,index:Z,geometry:ee?ne.geometry:ro(k),patterns:{},sortKey:Me};y.push(Oe)}}h&&y.sort(function(Lr,zr){return Lr.sortKey-zr.sortKey});for(var Ye=0,Ze=y;Ye<Ze.length;Ye+=1){var st=Ze[Ye],Ct=st.geometry,Zt=st.index,Wt=st.sourceLayerIndex;if(this.hasPattern){var lr=sl("fill",this.layers,st,this.zoom,o);this.patternFeatures.push(lr)}else this.addFeature(st,Ct,Zt,u,{});o.featureIndex.insert(t[Zt].feature,Ct,Zt,Wt,this.index)}},au.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},au.prototype.addFeatures=function(t,o,u){for(var h=0,y=this.patternFeatures;h<y.length;h+=1){var b=y[h];this.addFeature(b,b.geometry,b.index,o,u)}},au.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},au.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},au.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,uh),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},au.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},au.prototype.addFeature=function(t,o,u,h,y){for(var b=0,S=Hf(o,500);b<S.length;b+=1){for(var P=S[b],k=0,z=0,Z=P;z<Z.length;z+=1)k+=Z[z].length;for(var W=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray),ee=W.vertexLength,ne=[],Me=[],Oe=0,Ye=P;Oe<Ye.length;Oe+=1){var Ze=Ye[Oe];if(Ze.length!==0){Ze!==P[0]&&Me.push(ne.length/2);var st=this.segments2.prepareSegment(Ze.length,this.layoutVertexArray,this.indexArray2),Ct=st.vertexLength;this.layoutVertexArray.emplaceBack(Ze[0].x,Ze[0].y),this.indexArray2.emplaceBack(Ct+Ze.length-1,Ct),ne.push(Ze[0].x),ne.push(Ze[0].y);for(var Zt=1;Zt<Ze.length;Zt++)this.layoutVertexArray.emplaceBack(Ze[Zt].x,Ze[Zt].y),this.indexArray2.emplaceBack(Ct+Zt-1,Ct+Zt),ne.push(Ze[Zt].x),ne.push(Ze[Zt].y);st.vertexLength+=Ze.length,st.primitiveLength+=Ze.length}}for(var Wt=cc(ne,Me),lr=0;lr<Wt.length;lr+=3)this.indexArray.emplaceBack(ee+Wt[lr],ee+Wt[lr+1],ee+Wt[lr+2]);W.vertexLength+=k,W.primitiveLength+=Wt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,h)},yn("FillBucket",au,{omit:["layers","patternFeatures"]});var Wf=new es({"fill-sort-key":new wn(ce.layout_fill["fill-sort-key"])}),Xf={paint:new es({"fill-antialias":new Ln(ce.paint_fill["fill-antialias"]),"fill-opacity":new wn(ce.paint_fill["fill-opacity"]),"fill-color":new wn(ce.paint_fill["fill-color"]),"fill-outline-color":new wn(ce.paint_fill["fill-outline-color"]),"fill-translate":new Ln(ce.paint_fill["fill-translate"]),"fill-translate-anchor":new Ln(ce.paint_fill["fill-translate-anchor"]),"fill-pattern":new nc(ce.paint_fill["fill-pattern"])}),layout:Wf},Yf=function(t){function o(u){t.call(this,u,Xf)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,h){t.prototype.recalculate.call(this,u,h);var y=this.paint._values["fill-outline-color"];y.value.kind==="constant"&&y.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},o.prototype.createBucket=function(u){return new au(u)},o.prototype.queryRadius=function(){return Eo(this.paint.get("fill-translate"))},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,P,k){return hu(Xo(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),P.angle,k),b)},o.prototype.isTileClipped=function(){return!0},o}(wa),Cf=Oa([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,qf=El;function El(t,o,u,h,y){this.properties={},this.extent=u,this.type=0,this._pbf=t,this._geometry=-1,this._keys=h,this._values=y,t.readFields(jc,this,o)}function jc(t,o,u){t==1?o.id=u.readVarint():t==2?function(h,y){for(var b=h.readVarint()+h.pos;h.pos<b;){var S=y._keys[h.readVarint()],P=y._values[h.readVarint()];y.properties[S]=P}}(u,o):t==3?o.type=u.readVarint():t==4&&(o._geometry=u.pos)}function ch(t){for(var o,u,h=0,y=0,b=t.length,S=b-1;y<b;S=y++)h+=((u=t[S]).x-(o=t[y]).x)*(o.y+u.y);return h}El.types=["Unknown","Point","LineString","Polygon"],El.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var o,u=t.readVarint()+t.pos,h=1,y=0,b=0,S=0,P=[];t.pos<u;){if(y<=0){var k=t.readVarint();h=7&k,y=k>>3}if(y--,h===1||h===2)b+=t.readSVarint(),S+=t.readSVarint(),h===1&&(o&&P.push(o),o=[]),o.push(new se(b,S));else{if(h!==7)throw new Error("unknown command "+h);o&&o.push(o[0].clone())}}return o&&P.push(o),P},El.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var o=t.readVarint()+t.pos,u=1,h=0,y=0,b=0,S=1/0,P=-1/0,k=1/0,z=-1/0;t.pos<o;){if(h<=0){var Z=t.readVarint();u=7&Z,h=Z>>3}if(h--,u===1||u===2)(y+=t.readSVarint())<S&&(S=y),y>P&&(P=y),(b+=t.readSVarint())<k&&(k=b),b>z&&(z=b);else if(u!==7)throw new Error("unknown command "+u)}return[S,k,P,z]},El.prototype.toGeoJSON=function(t,o,u){var h,y,b=this.extent*Math.pow(2,u),S=this.extent*t,P=this.extent*o,k=this.loadGeometry(),z=El.types[this.type];function Z(ne){for(var Me=0;Me<ne.length;Me++){var Oe=ne[Me];ne[Me]=[360*(Oe.x+S)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(Oe.y+P)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var W=[];for(h=0;h<k.length;h++)W[h]=k[h][0];Z(k=W);break;case 2:for(h=0;h<k.length;h++)Z(k[h]);break;case 3:for(k=function(ne){var Me=ne.length;if(Me<=1)return[ne];for(var Oe,Ye,Ze=[],st=0;st<Me;st++){var Ct=ch(ne[st]);Ct!==0&&(Ye===void 0&&(Ye=Ct<0),Ye===Ct<0?(Oe&&Ze.push(Oe),Oe=[ne[st]]):Oe.push(ne[st]))}return Oe&&Ze.push(Oe),Ze}(k),h=0;h<k.length;h++)for(y=0;y<k[h].length;y++)Z(k[h][y])}k.length===1?k=k[0]:z="Multi"+z;var ee={type:"Feature",geometry:{type:z,coordinates:k},properties:this.properties};return"id"in this&&(ee.id=this.id),ee};var Kf=Yh;function Yh(t,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Ad,this,o),this.length=this._features.length}function Ad(t,o,u){t===15?o.version=u.readVarint():t===1?o.name=u.readString():t===5?o.extent=u.readVarint():t===2?o._features.push(u.pos):t===3?o._keys.push(u.readString()):t===4&&o._values.push(function(h){for(var y=null,b=h.readVarint()+h.pos;h.pos<b;){var S=h.readVarint()>>3;y=S===1?h.readString():S===2?h.readFloat():S===3?h.readDouble():S===4?h.readVarint64():S===5?h.readVarint():S===6?h.readSVarint():S===7?h.readBoolean():null}return y}(u))}function wd(t,o,u){if(t===3){var h=new Kf(u,u.readVarint()+u.pos);h.length&&(o[h.name]=h)}}Yh.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var o=this._pbf.readVarint()+this._pbf.pos;return new qf(this._pbf,o,this.extent,this._keys,this._values)};var Mu={VectorTile:function(t,o){this.layers=t.readFields(wd,{},o)},VectorTileFeature:qf,VectorTileLayer:Kf},Bp=Mu.VectorTileFeature.types,fh=Math.pow(2,13);function Ur(t,o,u,h,y,b,S,P){t.emplaceBack(o,u,2*Math.floor(h*fh)+S,y*fh*2,b*fh*2,Math.round(P))}var ul=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ru,this.indexArray=new ol,this.programConfigurations=new Gn(t.layers,t.zoom),this.segments=new fe,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function qt(t,o){return t.x===o.x&&(t.x<0||t.x>8192)||t.y===o.y&&(t.y<0||t.y>8192)}ul.prototype.populate=function(t,o,u){this.features=[],this.hasPattern=Sf("fill-extrusion",this.layers,o);for(var h=0,y=t;h<y.length;h+=1){var b=y[h],S=b.feature,P=b.id,k=b.index,z=b.sourceLayerIndex,Z=this.layers[0]._featureFilter.needGeometry,W=Za(S,Z);if(this.layers[0]._featureFilter.filter(new Li(this.zoom),W,u)){var ee={id:P,sourceLayerIndex:z,index:k,geometry:Z?W.geometry:ro(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(sl("fill-extrusion",this.layers,ee,this.zoom,o)):this.addFeature(ee,ee.geometry,k,u,{}),o.featureIndex.insert(S,ee.geometry,k,z,this.index,!0)}}},ul.prototype.addFeatures=function(t,o,u){for(var h=0,y=this.features;h<y.length;h+=1){var b=y[h];this.addFeature(b,b.geometry,b.index,o,u)}},ul.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},ul.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ul.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ul.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Cf),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},ul.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ul.prototype.addFeature=function(t,o,u,h,y){for(var b=0,S=Hf(o,500);b<S.length;b+=1){for(var P=S[b],k=0,z=0,Z=P;z<Z.length;z+=1)k+=Z[z].length;for(var W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),ee=0,ne=P;ee<ne.length;ee+=1){var Me=ne[ee];if(Me.length!==0&&!((ji=Me).every(function(Ci){return Ci.x<0})||ji.every(function(Ci){return Ci.x>8192})||ji.every(function(Ci){return Ci.y<0})||ji.every(function(Ci){return Ci.y>8192})))for(var Oe=0,Ye=0;Ye<Me.length;Ye++){var Ze=Me[Ye];if(Ye>=1){var st=Me[Ye-1];if(!qt(Ze,st)){W.vertexLength+4>fe.MAX_VERTEX_ARRAY_LENGTH&&(W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Ct=Ze.sub(st)._perp()._unit(),Zt=st.dist(Ze);Oe+Zt>32768&&(Oe=0),Ur(this.layoutVertexArray,Ze.x,Ze.y,Ct.x,Ct.y,0,0,Oe),Ur(this.layoutVertexArray,Ze.x,Ze.y,Ct.x,Ct.y,0,1,Oe),Ur(this.layoutVertexArray,st.x,st.y,Ct.x,Ct.y,0,0,Oe+=Zt),Ur(this.layoutVertexArray,st.x,st.y,Ct.x,Ct.y,0,1,Oe);var Wt=W.vertexLength;this.indexArray.emplaceBack(Wt,Wt+2,Wt+1),this.indexArray.emplaceBack(Wt+1,Wt+2,Wt+3),W.vertexLength+=4,W.primitiveLength+=2}}}}if(W.vertexLength+k>fe.MAX_VERTEX_ARRAY_LENGTH&&(W=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray)),Bp[t.type]==="Polygon"){for(var lr=[],Lr=[],zr=W.vertexLength,Pn=0,pn=P;Pn<pn.length;Pn+=1){var zn=pn[Pn];if(zn.length!==0){zn!==P[0]&&Lr.push(lr.length/2);for(var mn=0;mn<zn.length;mn++){var Mi=zn[mn];Ur(this.layoutVertexArray,Mi.x,Mi.y,0,0,1,1,0),lr.push(Mi.x),lr.push(Mi.y)}}}for(var ti=cc(lr,Lr),In=0;In<ti.length;In+=3)this.indexArray.emplaceBack(zr+ti[In],zr+ti[In+2],zr+ti[In+1]);W.primitiveLength+=ti.length/3,W.vertexLength+=k}}var ji;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,h)},yn("FillExtrusionBucket",ul,{omit:["layers","features"]});var Td={paint:new es({"fill-extrusion-opacity":new Ln(ce["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new wn(ce["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ln(ce["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ln(ce["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new nc(ce["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new wn(ce["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new wn(ce["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ln(ce["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Sl=function(t){function o(u){t.call(this,u,Td)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new ul(u)},o.prototype.queryRadius=function(){return Eo(this.paint.get("fill-extrusion-translate"))},o.prototype.is3D=function(){return!0},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,P,k,z){var Z=Xo(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),P.angle,k),W=this.paint.get("fill-extrusion-height").evaluate(h,y),ee=this.paint.get("fill-extrusion-base").evaluate(h,y),ne=function(Oe,Ye,Ze,st){for(var Ct=[],Zt=0,Wt=Oe;Zt<Wt.length;Zt+=1){var lr=Wt[Zt],Lr=[lr.x,lr.y,0,1];uc(Lr,Lr,Ye),Ct.push(new se(Lr[0]/Lr[3],Lr[1]/Lr[3]))}return Ct}(Z,z),Me=function(Oe,Ye,Ze,st){for(var Ct=[],Zt=[],Wt=st[8]*Ye,lr=st[9]*Ye,Lr=st[10]*Ye,zr=st[11]*Ye,Pn=st[8]*Ze,pn=st[9]*Ze,zn=st[10]*Ze,mn=st[11]*Ze,Mi=0,ti=Oe;Mi<ti.length;Mi+=1){for(var In=[],ji=[],Ci=0,Wi=ti[Mi];Ci<Wi.length;Ci+=1){var An=Wi[Ci],ca=An.x,no=An.y,So=st[0]*ca+st[4]*no+st[12],ho=st[1]*ca+st[5]*no+st[13],io=st[2]*ca+st[6]*no+st[14],Lo=st[3]*ca+st[7]*no+st[15],hs=io+Lr,ds=Lo+zr,Xs=So+Pn,Ta=ho+pn,Ys=io+zn,di=Lo+mn,Cs=new se((So+Wt)/ds,(ho+lr)/ds);Cs.z=hs/ds,In.push(Cs);var qi=new se(Xs/di,Ta/di);qi.z=Ys/di,ji.push(qi)}Ct.push(In),Zt.push(ji)}return[Ct,Zt]}(b,ee,W,z);return function(Oe,Ye,Ze){var st=1/0;hu(Ze,Ye)&&(st=hc(Ze,Ye[0]));for(var Ct=0;Ct<Ye.length;Ct++)for(var Zt=Ye[Ct],Wt=Oe[Ct],lr=0;lr<Zt.length-1;lr++){var Lr=Zt[lr],zr=[Lr,Zt[lr+1],Wt[lr+1],Wt[lr],Lr];Nu(Ze,zr)&&(st=Math.min(st,hc(Ze,zr)))}return st!==1/0&&st}(Me[0],Me[1],ne)},o}(wa);function Vc(t,o){return t.x*o.x+t.y*o.y}function hc(t,o){if(t.length===1){for(var u,h=0,y=o[h++];!u||y.equals(u);)if(!(u=o[h++]))return 1/0;for(;h<o.length;h++){var b=o[h],S=t[0],P=u.sub(y),k=b.sub(y),z=S.sub(y),Z=Vc(P,P),W=Vc(P,k),ee=Vc(k,k),ne=Vc(z,P),Me=Vc(z,k),Oe=Z*ee-W*W,Ye=(ee*ne-W*Me)/Oe,Ze=(Z*Me-W*ne)/Oe,st=y.z*(1-Ye-Ze)+u.z*Ye+b.z*Ze;if(isFinite(st))return st}return 1/0}for(var Ct=1/0,Zt=0,Wt=o;Zt<Wt.length;Zt+=1)Ct=Math.min(Ct,Wt[Zt].z);return Ct}var Ul=Oa([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,qh=Oa([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Np=Mu.VectorTileFeature.types,dc=Math.cos(Math.PI/180*37.5),ph=Math.pow(2,14)/.5,Sa=function(t){var o=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(u){o.gradients[u.id]={}}),this.layoutVertexArray=new No,this.layoutVertexArray2=new gl,this.indexArray=new ol,this.programConfigurations=new Gn(t.layers,t.zoom),this.segments=new fe,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};Sa.prototype.populate=function(t,o,u){this.hasPattern=Sf("line",this.layers,o);for(var h=this.layers[0].layout.get("line-sort-key"),y=[],b=0,S=t;b<S.length;b+=1){var P=S[b],k=P.feature,z=P.id,Z=P.index,W=P.sourceLayerIndex,ee=this.layers[0]._featureFilter.needGeometry,ne=Za(k,ee);if(this.layers[0]._featureFilter.filter(new Li(this.zoom),ne,u)){var Me=h?h.evaluate(ne,{},u):void 0,Oe={id:z,properties:k.properties,type:k.type,sourceLayerIndex:W,index:Z,geometry:ee?ne.geometry:ro(k),patterns:{},sortKey:Me};y.push(Oe)}}h&&y.sort(function(Lr,zr){return Lr.sortKey-zr.sortKey});for(var Ye=0,Ze=y;Ye<Ze.length;Ye+=1){var st=Ze[Ye],Ct=st.geometry,Zt=st.index,Wt=st.sourceLayerIndex;if(this.hasPattern){var lr=sl("line",this.layers,st,this.zoom,o);this.patternFeatures.push(lr)}else this.addFeature(st,Ct,Zt,u,{});o.featureIndex.insert(t[Zt].feature,Ct,Zt,Wt,this.index)}},Sa.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},Sa.prototype.addFeatures=function(t,o,u){for(var h=0,y=this.patternFeatures;h<y.length;h+=1){var b=y[h];this.addFeature(b,b.geometry,b.index,o,u)}},Sa.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Sa.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Sa.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,qh)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ul),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Sa.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Sa.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},Sa.prototype.addFeature=function(t,o,u,h,y){var b=this.layers[0].layout,S=b.get("line-join").evaluate(t,{}),P=b.get("line-cap"),k=b.get("line-miter-limit"),z=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var Z=0,W=o;Z<W.length;Z+=1)this.addLine(W[Z],t,S,P,k,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,h)},Sa.prototype.addLine=function(t,o,u,h,y,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var S=0;S<t.length-1;S++)this.totalDistance+=t[S].dist(t[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var P=Np[o.type]==="Polygon",k=t.length;k>=2&&t[k-1].equals(t[k-2]);)k--;for(var z=0;z<k-1&&t[z].equals(t[z+1]);)z++;if(!(k<(P?3:2))){u==="bevel"&&(y=1.05);var Z,W=this.overscaling<=16?122880/(512*this.overscaling):0,ee=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray),ne=void 0,Me=void 0,Oe=void 0,Ye=void 0;this.e1=this.e2=-1,P&&(Ye=t[z].sub(Z=t[k-2])._unit()._perp());for(var Ze=z;Ze<k;Ze++)if(!(Me=Ze===k-1?P?t[z+1]:void 0:t[Ze+1])||!t[Ze].equals(Me)){Ye&&(Oe=Ye),Z&&(ne=Z),Z=t[Ze],Ye=Me?Me.sub(Z)._unit()._perp():Oe;var st=(Oe=Oe||Ye).add(Ye);st.x===0&&st.y===0||st._unit();var Ct=Oe.x*Ye.x+Oe.y*Ye.y,Zt=st.x*Ye.x+st.y*Ye.y,Wt=Zt!==0?1/Zt:1/0,lr=2*Math.sqrt(2-2*Zt),Lr=Zt<dc&&ne&&Me,zr=Oe.x*Ye.y-Oe.y*Ye.x>0;if(Lr&&Ze>z){var Pn=Z.dist(ne);if(Pn>2*W){var pn=Z.sub(Z.sub(ne)._mult(W/Pn)._round());this.updateDistance(ne,pn),this.addCurrentVertex(pn,Oe,0,0,ee),ne=pn}}var zn=ne&&Me,mn=zn?u:P?"butt":h;if(zn&&mn==="round"&&(Wt<b?mn="miter":Wt<=2&&(mn="fakeround")),mn==="miter"&&Wt>y&&(mn="bevel"),mn==="bevel"&&(Wt>2&&(mn="flipbevel"),Wt<y&&(mn="miter")),ne&&this.updateDistance(ne,Z),mn==="miter")st._mult(Wt),this.addCurrentVertex(Z,st,0,0,ee);else if(mn==="flipbevel"){if(Wt>100)st=Ye.mult(-1);else{var Mi=Wt*Oe.add(Ye).mag()/Oe.sub(Ye).mag();st._perp()._mult(Mi*(zr?-1:1))}this.addCurrentVertex(Z,st,0,0,ee),this.addCurrentVertex(Z,st.mult(-1),0,0,ee)}else if(mn==="bevel"||mn==="fakeround"){var ti=-Math.sqrt(Wt*Wt-1),In=zr?ti:0,ji=zr?0:ti;if(ne&&this.addCurrentVertex(Z,Oe,In,ji,ee),mn==="fakeround")for(var Ci=Math.round(180*lr/Math.PI/20),Wi=1;Wi<Ci;Wi++){var An=Wi/Ci;if(An!==.5){var ca=An-.5;An+=An*ca*(An-1)*((1.0904+Ct*(Ct*(3.55645-1.43519*Ct)-3.2452))*ca*ca+(.848013+Ct*(.215638*Ct-1.06021)))}var no=Ye.sub(Oe)._mult(An)._add(Oe)._unit()._mult(zr?-1:1);this.addHalfVertex(Z,no.x,no.y,!1,zr,0,ee)}Me&&this.addCurrentVertex(Z,Ye,-In,-ji,ee)}else if(mn==="butt")this.addCurrentVertex(Z,st,0,0,ee);else if(mn==="square"){var So=ne?1:-1;this.addCurrentVertex(Z,st,So,So,ee)}else mn==="round"&&(ne&&(this.addCurrentVertex(Z,Oe,0,0,ee),this.addCurrentVertex(Z,Oe,1,1,ee,!0)),Me&&(this.addCurrentVertex(Z,Ye,-1,-1,ee,!0),this.addCurrentVertex(Z,Ye,0,0,ee)));if(Lr&&Ze<k-1){var ho=Z.dist(Me);if(ho>2*W){var io=Z.add(Me.sub(Z)._mult(W/ho)._round());this.updateDistance(Z,io),this.addCurrentVertex(io,Ye,0,0,ee),Z=io}}}}},Sa.prototype.addCurrentVertex=function(t,o,u,h,y,b){b===void 0&&(b=!1);var S=o.y*h-o.x,P=-o.y-o.x*h;this.addHalfVertex(t,o.x+o.y*u,o.y-o.x*u,b,!1,u,y),this.addHalfVertex(t,S,P,b,!0,-h,y),this.distance>ph/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,o,u,h,y,b))},Sa.prototype.addHalfVertex=function(t,o,u,h,y,b,S){var P=.5*(this.lineClips?this.scaledDistance*(ph-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(h?1:0),(t.y<<1)+(y?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(b===0?0:b<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var k=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),S.primitiveLength++),y?this.e2=k:this.e1=k},Sa.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Sa.prototype.updateDistance=function(t,o){this.distance+=t.dist(o),this.updateScaledDistance()},yn("LineBucket",Sa,{omit:["layers","patternFeatures"]});var Zl=new es({"line-cap":new Ln(ce.layout_line["line-cap"]),"line-join":new wn(ce.layout_line["line-join"]),"line-miter-limit":new Ln(ce.layout_line["line-miter-limit"]),"line-round-limit":new Ln(ce.layout_line["line-round-limit"]),"line-sort-key":new wn(ce.layout_line["line-sort-key"])}),Io={paint:new es({"line-opacity":new wn(ce.paint_line["line-opacity"]),"line-color":new wn(ce.paint_line["line-color"]),"line-translate":new Ln(ce.paint_line["line-translate"]),"line-translate-anchor":new Ln(ce.paint_line["line-translate-anchor"]),"line-width":new wn(ce.paint_line["line-width"]),"line-gap-width":new wn(ce.paint_line["line-gap-width"]),"line-offset":new wn(ce.paint_line["line-offset"]),"line-blur":new wn(ce.paint_line["line-blur"]),"line-dasharray":new xs(ce.paint_line["line-dasharray"]),"line-pattern":new nc(ce.paint_line["line-pattern"]),"line-gradient":new Eu(ce.paint_line["line-gradient"])}),layout:Zl},Ws=new(function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,h){return h=new Li(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),t.prototype.possiblyEvaluate.call(this,u,h)},o.prototype.evaluate=function(u,h,y,b){return h=At({},h,{zoom:Math.floor(h.zoom)}),t.prototype.evaluate.call(this,u,h,y,b)},o}(wn))(Io.paint.properties["line-width"].specification);Ws.useIntegerZoom=!0;var hh=function(t){function o(u){t.call(this,u,Io),this.gradientVersion=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ys,this.gradientVersion=(this.gradientVersion+1)%tt)},o.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},o.prototype.recalculate=function(u,h){t.prototype.recalculate.call(this,u,h),this.paint._values["line-floorwidth"]=Ws.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)},o.prototype.createBucket=function(u){return new Sa(u)},o.prototype.queryRadius=function(u){var h=u,y=dh(Uu("line-width",this,h),Uu("line-gap-width",this,h)),b=Uu("line-offset",this,h);return y/2+Math.abs(b)+Eo(this.paint.get("line-translate"))},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,P,k){var z=Xo(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),P.angle,k),Z=k/2*dh(this.paint.get("line-width").evaluate(h,y),this.paint.get("line-gap-width").evaluate(h,y)),W=this.paint.get("line-offset").evaluate(h,y);return W&&(b=function(ee,ne){for(var Me=[],Oe=new se(0,0),Ye=0;Ye<ee.length;Ye++){for(var Ze=ee[Ye],st=[],Ct=0;Ct<Ze.length;Ct++){var Zt=Ze[Ct],Wt=Ze[Ct+1],lr=Ct===0?Oe:Zt.sub(Ze[Ct-1])._unit()._perp(),Lr=Ct===Ze.length-1?Oe:Wt.sub(Zt)._unit()._perp(),zr=lr._add(Lr)._unit();zr._mult(1/(zr.x*Lr.x+zr.y*Lr.y)),st.push(zr._mult(ne)._add(Zt))}Me.push(st)}return Me}(b,W*k)),function(ee,ne,Me){for(var Oe=0;Oe<ne.length;Oe++){var Ye=ne[Oe];if(ee.length>=3){for(var Ze=0;Ze<Ye.length;Ze++)if(wu(ee,Ye[Ze]))return!0}if(Ra(ee,Ye,Me))return!0}return!1}(z,b,Z)},o.prototype.isTileClipped=function(){return!0},o}(wa);function dh(t,o){return o>0?o+2*t:t}var Md=Oa([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Kh=Oa([{name:"a_projected_pos",components:3,type:"Float32"}],4),$h=(Oa([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Oa([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),$f=(Oa([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Oa([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Pd=Oa([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Id(t,o,u){return t.sections.forEach(function(h){h.text=function(y,b,S){var P=b.layout.get("text-transform").evaluate(S,{});return P==="uppercase"?y=y.toLocaleUpperCase():P==="lowercase"&&(y=y.toLocaleLowerCase()),Rs.applyArabicShaping&&(y=Rs.applyArabicShaping(y)),y}(h.text,o,u)}),t}Oa([{name:"triangle",components:3,type:"Uint16"}]),Oa([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Oa([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Oa([{type:"Float32",name:"offsetX"}]),Oa([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Qf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Qh=function(t,o,u,h,y){var b,S,P=8*y-h-1,k=(1<<P)-1,z=k>>1,Z=-7,W=u?y-1:0,ee=u?-1:1,ne=t[o+W];for(W+=ee,b=ne&(1<<-Z)-1,ne>>=-Z,Z+=P;Z>0;b=256*b+t[o+W],W+=ee,Z-=8);for(S=b&(1<<-Z)-1,b>>=-Z,Z+=h;Z>0;S=256*S+t[o+W],W+=ee,Z-=8);if(b===0)b=1-z;else{if(b===k)return S?NaN:1/0*(ne?-1:1);S+=Math.pow(2,h),b-=z}return(ne?-1:1)*S*Math.pow(2,b-h)},Jh=function(t,o,u,h,y,b){var S,P,k,z=8*b-y-1,Z=(1<<z)-1,W=Z>>1,ee=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,ne=h?0:b-1,Me=h?1:-1,Oe=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(P=isNaN(o)?1:0,S=Z):(S=Math.floor(Math.log(o)/Math.LN2),o*(k=Math.pow(2,-S))<1&&(S--,k*=2),(o+=S+W>=1?ee/k:ee*Math.pow(2,1-W))*k>=2&&(S++,k/=2),S+W>=Z?(P=0,S=Z):S+W>=1?(P=(o*k-1)*Math.pow(2,y),S+=W):(P=o*Math.pow(2,W-1)*Math.pow(2,y),S=0));y>=8;t[u+ne]=255&P,ne+=Me,P/=256,y-=8);for(S=S<<y|P,z+=y;z>0;t[u+ne]=255&S,ne+=Me,S/=256,z-=8);t[u+ne-Me]|=128*Oe},Jf=Ba;function Ba(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Ba.Varint=0,Ba.Fixed64=1,Ba.Bytes=2,Ba.Fixed32=5;var zp=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function jl(t){return t.type===Ba.Bytes?t.readVarint()+t.pos:t.pos+1}function Gc(t,o,u){return u?4294967296*o+(t>>>0):4294967296*(o>>>0)+(t>>>0)}function vh(t,o,u){var h=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(h);for(var y=u.pos-1;y>=t;y--)u.buf[y+h]=u.buf[y]}function y0(t,o){for(var u=0;u<t.length;u++)o.writeVarint(t[u])}function B(t,o){for(var u=0;u<t.length;u++)o.writeSVarint(t[u])}function me(t,o){for(var u=0;u<t.length;u++)o.writeFloat(t[u])}function Be(t,o){for(var u=0;u<t.length;u++)o.writeDouble(t[u])}function Ft(t,o){for(var u=0;u<t.length;u++)o.writeBoolean(t[u])}function ur(t,o){for(var u=0;u<t.length;u++)o.writeFixed32(t[u])}function Lt(t,o){for(var u=0;u<t.length;u++)o.writeSFixed32(t[u])}function nr(t,o){for(var u=0;u<t.length;u++)o.writeFixed64(t[u])}function hr(t,o){for(var u=0;u<t.length;u++)o.writeSFixed64(t[u])}function _r(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+16777216*t[o+3]}function br(t,o,u){t[u]=o,t[u+1]=o>>>8,t[u+2]=o>>>16,t[u+3]=o>>>24}function Tr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+(t[o+3]<<24)}function kr(t,o,u){t===1&&u.readMessage(dr,o)}function dr(t,o,u){if(t===3){var h=u.readMessage(gr,{}),y=h.width,b=h.height,S=h.left,P=h.top,k=h.advance;o.push({id:h.id,bitmap:new Tu({width:y+6,height:b+6},h.bitmap),metrics:{width:y,height:b,left:S,top:P,advance:k}})}}function gr(t,o,u){t===1?o.id=u.readVarint():t===2?o.bitmap=u.readBytes():t===3?o.width=u.readVarint():t===4?o.height=u.readVarint():t===5?o.left=u.readSVarint():t===6?o.top=u.readSVarint():t===7&&(o.advance=u.readVarint())}function Pr(t){for(var o=0,u=0,h=0,y=t;h<y.length;h+=1){var b=y[h];o+=b.w*b.h,u=Math.max(u,b.w)}t.sort(function(Oe,Ye){return Ye.h-Oe.h});for(var S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}],P=0,k=0,z=0,Z=t;z<Z.length;z+=1)for(var W=Z[z],ee=S.length-1;ee>=0;ee--){var ne=S[ee];if(!(W.w>ne.w||W.h>ne.h)){if(W.x=ne.x,W.y=ne.y,k=Math.max(k,W.y+W.h),P=Math.max(P,W.x+W.w),W.w===ne.w&&W.h===ne.h){var Me=S.pop();ee<S.length&&(S[ee]=Me)}else W.h===ne.h?(ne.x+=W.w,ne.w-=W.w):W.w===ne.w?(ne.y+=W.h,ne.h-=W.h):(S.push({x:ne.x+W.w,y:ne.y,w:ne.w-W.w,h:W.h}),ne.y+=W.h,ne.h-=W.h);break}}return{w:P,h:k,fill:o/(P*k)||0}}Ba.prototype={destroy:function(){this.buf=null},readFields:function(t,o,u){for(u=u||this.length;this.pos<u;){var h=this.readVarint(),y=h>>3,b=this.pos;this.type=7&h,t(y,o,this),this.pos===b&&this.skip(h)}return o},readMessage:function(t,o){return this.readFields(t,o,this.readVarint()+this.pos)},readFixed32:function(){var t=_r(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Tr(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=_r(this.buf,this.pos)+4294967296*_r(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=_r(this.buf,this.pos)+4294967296*Tr(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Qh(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Qh(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var o,u,h=this.buf;return o=127&(u=h[this.pos++]),u<128?o:(o|=(127&(u=h[this.pos++]))<<7,u<128?o:(o|=(127&(u=h[this.pos++]))<<14,u<128?o:(o|=(127&(u=h[this.pos++]))<<21,u<128?o:function(y,b,S){var P,k,z=S.buf;if(P=(112&(k=z[S.pos++]))>>4,k<128||(P|=(127&(k=z[S.pos++]))<<3,k<128)||(P|=(127&(k=z[S.pos++]))<<10,k<128)||(P|=(127&(k=z[S.pos++]))<<17,k<128)||(P|=(127&(k=z[S.pos++]))<<24,k<128)||(P|=(1&(k=z[S.pos++]))<<31,k<128))return Gc(y,P,b);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(u=h[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,o=this.pos;return this.pos=t,t-o>=12&&zp?function(u,h,y){return zp.decode(u.subarray(h,y))}(this.buf,o,t):function(u,h,y){for(var b="",S=h;S<y;){var P,k,z,Z=u[S],W=null,ee=Z>239?4:Z>223?3:Z>191?2:1;if(S+ee>y)break;ee===1?Z<128&&(W=Z):ee===2?(192&(P=u[S+1]))==128&&(W=(31&Z)<<6|63&P)<=127&&(W=null):ee===3?(k=u[S+2],(192&(P=u[S+1]))==128&&(192&k)==128&&((W=(15&Z)<<12|(63&P)<<6|63&k)<=2047||W>=55296&&W<=57343)&&(W=null)):ee===4&&(k=u[S+2],z=u[S+3],(192&(P=u[S+1]))==128&&(192&k)==128&&(192&z)==128&&((W=(15&Z)<<18|(63&P)<<12|(63&k)<<6|63&z)<=65535||W>=1114112)&&(W=null)),W===null?(W=65533,ee=1):W>65535&&(W-=65536,b+=String.fromCharCode(W>>>10&1023|55296),W=56320|1023&W),b+=String.fromCharCode(W),S+=ee}return b}(this.buf,o,t)},readBytes:function(){var t=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,t);return this.pos=t,o},readPackedVarint:function(t,o){if(this.type!==Ba.Bytes)return t.push(this.readVarint(o));var u=jl(this);for(t=t||[];this.pos<u;)t.push(this.readVarint(o));return t},readPackedSVarint:function(t){if(this.type!==Ba.Bytes)return t.push(this.readSVarint());var o=jl(this);for(t=t||[];this.pos<o;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Ba.Bytes)return t.push(this.readBoolean());var o=jl(this);for(t=t||[];this.pos<o;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Ba.Bytes)return t.push(this.readFloat());var o=jl(this);for(t=t||[];this.pos<o;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Ba.Bytes)return t.push(this.readDouble());var o=jl(this);for(t=t||[];this.pos<o;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Ba.Bytes)return t.push(this.readFixed32());var o=jl(this);for(t=t||[];this.pos<o;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Ba.Bytes)return t.push(this.readSFixed32());var o=jl(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Ba.Bytes)return t.push(this.readFixed64());var o=jl(this);for(t=t||[];this.pos<o;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Ba.Bytes)return t.push(this.readSFixed64());var o=jl(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed64());return t},skip:function(t){var o=7&t;if(o===Ba.Varint)for(;this.buf[this.pos++]>127;);else if(o===Ba.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Ba.Fixed32)this.pos+=4;else{if(o!==Ba.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(t,o){this.writeVarint(t<<3|o)},realloc:function(t){for(var o=this.length||16;o<this.pos+t;)o*=2;if(o!==this.length){var u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),br(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),br(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),br(this.buf,-1&t,this.pos),br(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),br(this.buf,-1&t,this.pos),br(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(o,u){var h,y;if(o>=0?(h=o%4294967296|0,y=o/4294967296|0):(y=~(-o/4294967296),4294967295^(h=~(-o%4294967296))?h=h+1|0:(h=0,y=y+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(b,S,P){P.buf[P.pos++]=127&b|128,b>>>=7,P.buf[P.pos++]=127&b|128,b>>>=7,P.buf[P.pos++]=127&b|128,b>>>=7,P.buf[P.pos++]=127&b|128,P.buf[P.pos]=127&(b>>>=7)}(h,0,u),function(b,S){var P=(7&b)<<4;S.buf[S.pos++]|=P|((b>>>=3)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b)))))}(y,u)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var o=this.pos;this.pos=function(h,y,b){for(var S,P,k=0;k<y.length;k++){if((S=y.charCodeAt(k))>55295&&S<57344){if(!P){S>56319||k+1===y.length?(h[b++]=239,h[b++]=191,h[b++]=189):P=S;continue}if(S<56320){h[b++]=239,h[b++]=191,h[b++]=189,P=S;continue}S=P-55296<<10|S-56320|65536,P=null}else P&&(h[b++]=239,h[b++]=191,h[b++]=189,P=null);S<128?h[b++]=S:(S<2048?h[b++]=S>>6|192:(S<65536?h[b++]=S>>12|224:(h[b++]=S>>18|240,h[b++]=S>>12&63|128),h[b++]=S>>6&63|128),h[b++]=63&S|128)}return b}(this.buf,t,this.pos);var u=this.pos-o;u>=128&&vh(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeFloat:function(t){this.realloc(4),Jh(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Jh(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var o=t.length;this.writeVarint(o),this.realloc(o);for(var u=0;u<o;u++)this.buf[this.pos++]=t[u]},writeRawMessage:function(t,o){this.pos++;var u=this.pos;t(o,this);var h=this.pos-u;h>=128&&vh(u,h,this),this.pos=u-1,this.writeVarint(h),this.pos+=h},writeMessage:function(t,o,u){this.writeTag(t,Ba.Bytes),this.writeRawMessage(o,u)},writePackedVarint:function(t,o){o.length&&this.writeMessage(t,y0,o)},writePackedSVarint:function(t,o){o.length&&this.writeMessage(t,B,o)},writePackedBoolean:function(t,o){o.length&&this.writeMessage(t,Ft,o)},writePackedFloat:function(t,o){o.length&&this.writeMessage(t,me,o)},writePackedDouble:function(t,o){o.length&&this.writeMessage(t,Be,o)},writePackedFixed32:function(t,o){o.length&&this.writeMessage(t,ur,o)},writePackedSFixed32:function(t,o){o.length&&this.writeMessage(t,Lt,o)},writePackedFixed64:function(t,o){o.length&&this.writeMessage(t,nr,o)},writePackedSFixed64:function(t,o){o.length&&this.writeMessage(t,hr,o)},writeBytesField:function(t,o){this.writeTag(t,Ba.Bytes),this.writeBytes(o)},writeFixed32Field:function(t,o){this.writeTag(t,Ba.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(t,o){this.writeTag(t,Ba.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(t,o){this.writeTag(t,Ba.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(t,o){this.writeTag(t,Ba.Fixed64),this.writeSFixed64(o)},writeVarintField:function(t,o){this.writeTag(t,Ba.Varint),this.writeVarint(o)},writeSVarintField:function(t,o){this.writeTag(t,Ba.Varint),this.writeSVarint(o)},writeStringField:function(t,o){this.writeTag(t,Ba.Bytes),this.writeString(o)},writeFloatField:function(t,o){this.writeTag(t,Ba.Fixed32),this.writeFloat(o)},writeDoubleField:function(t,o){this.writeTag(t,Ba.Fixed64),this.writeDouble(o)},writeBooleanField:function(t,o){this.writeVarintField(t,Boolean(o))}};var ut=function(t,o){var u=o.pixelRatio,h=o.version,y=o.stretchX,b=o.stretchY,S=o.content;this.paddedRect=t,this.pixelRatio=u,this.stretchX=y,this.stretchY=b,this.content=S,this.version=h},Gt={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Gt.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Gt.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Gt.tlbr.get=function(){return this.tl.concat(this.br)},Gt.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(ut.prototype,Gt);var Ar=function(t,o){var u={},h={};this.haveRenderCallbacks=[];var y=[];this.addImages(t,u,y),this.addImages(o,h,y);var b=Pr(y),S=new zo({width:b.w||1,height:b.h||1});for(var P in t){var k=t[P],z=u[P].paddedRect;zo.copy(k.data,S,{x:0,y:0},{x:z.x+1,y:z.y+1},k.data)}for(var Z in o){var W=o[Z],ee=h[Z].paddedRect,ne=ee.x+1,Me=ee.y+1,Oe=W.data.width,Ye=W.data.height;zo.copy(W.data,S,{x:0,y:0},{x:ne,y:Me},W.data),zo.copy(W.data,S,{x:0,y:Ye-1},{x:ne,y:Me-1},{width:Oe,height:1}),zo.copy(W.data,S,{x:0,y:0},{x:ne,y:Me+Ye},{width:Oe,height:1}),zo.copy(W.data,S,{x:Oe-1,y:0},{x:ne-1,y:Me},{width:1,height:Ye}),zo.copy(W.data,S,{x:0,y:0},{x:ne+Oe,y:Me},{width:1,height:Ye})}this.image=S,this.iconPositions=u,this.patternPositions=h};Ar.prototype.addImages=function(t,o,u){for(var h in t){var y=t[h],b={x:0,y:0,w:y.data.width+2,h:y.data.height+2};u.push(b),o[h]=new ut(b,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(h)}},Ar.prototype.patchUpdatedImages=function(t,o){for(var u in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),o),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),o)},Ar.prototype.patchUpdatedImage=function(t,o,u){if(t&&o&&t.version!==o.version){t.version=o.version;var h=t.tl;u.update(o.data,void 0,{x:h[0],y:h[1]})}},yn("ImagePosition",ut),yn("ImageAtlas",Ar);var Zr={horizontal:1,vertical:2,horizontalOnly:3},pr=function(){this.scale=1,this.fontStack="",this.imageName=null};pr.forText=function(t,o){var u=new pr;return u.scale=t||1,u.fontStack=o,u},pr.forImage=function(t){var o=new pr;return o.imageName=t,o};var Rr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Qr(t,o,u,h,y,b,S,P,k,z,Z,W,ee,ne,Me,Oe){var Ye,Ze=Rr.fromFeature(t,y);W===Zr.vertical&&Ze.verticalizePunctuation();var st=Rs.processBidirectionalText,Ct=Rs.processStyledBidirectionalText;if(st&&Ze.sections.length===1){Ye=[];for(var Zt=0,Wt=st(Ze.toString(),Hr(Ze,z,b,o,h,ne,Me));Zt<Wt.length;Zt+=1){var lr=Wt[Zt],Lr=new Rr;Lr.text=lr,Lr.sections=Ze.sections;for(var zr=0;zr<lr.length;zr++)Lr.sectionIndex.push(0);Ye.push(Lr)}}else if(Ct){Ye=[];for(var Pn=0,pn=Ct(Ze.text,Ze.sectionIndex,Hr(Ze,z,b,o,h,ne,Me));Pn<pn.length;Pn+=1){var zn=pn[Pn],mn=new Rr;mn.text=zn[0],mn.sectionIndex=zn[1],mn.sections=Ze.sections,Ye.push(mn)}}else Ye=function(In,ji){for(var Ci=[],Wi=In.text,An=0,ca=0,no=ji;ca<no.length;ca+=1){var So=no[ca];Ci.push(In.substring(An,So)),An=So}return An<Wi.length&&Ci.push(In.substring(An,Wi.length)),Ci}(Ze,Hr(Ze,z,b,o,h,ne,Me));var Mi=[],ti={positionedLines:Mi,text:Ze.toString(),top:Z[1],bottom:Z[1],left:Z[0],right:Z[0],writingMode:W,iconsInText:!1,verticalizable:!1};return function(In,ji,Ci,Wi,An,ca,no,So,ho,io,Lo,hs){for(var ds=0,Xs=-17,Ta=0,Ys=0,di=So==="right"?1:So==="left"?0:.5,Cs=0,qi=0,Va=An;qi<Va.length;qi+=1){var V=Va[qi];V.trim();var na=V.getMaxScale(),qs=24*(na-1),Ps={positionedGlyphs:[],lineOffset:0};In.positionedLines[Cs]=Ps;var $a=Ps.positionedGlyphs,jo=0;if(V.length()){for(var Is=0;Is<V.length();Is++){var fa=V.getSection(Is),mu=V.getSectionIndex(Is),Pu=V.getCharCode(Is),Vl=0,ko=null,Gl=null,ll=null,tp=24,vc=!(ho===Zr.horizontal||!Lo&&!Uf(Pu)||Lo&&(Nn[Pu]||(mc=Pu,Kr.Arabic(mc)||Kr["Arabic Supplement"](mc)||Kr["Arabic Extended-A"](mc)||Kr["Arabic Presentation Forms-A"](mc)||Kr["Arabic Presentation Forms-B"](mc))));if(fa.imageName){var Zp=Wi[fa.imageName];if(!Zp)continue;ll=fa.imageName,In.iconsInText=In.iconsInText||!0,Gl=Zp.paddedRect;var Xc=Zp.displaySize;fa.scale=24*fa.scale/hs,Vl=qs+(24-Xc[1]*fa.scale),tp=(ko={width:Xc[0],height:Xc[1],left:1,top:-3,advance:vc?Xc[1]:Xc[0]}).advance;var rp=vc?Xc[0]*fa.scale-24*na:Xc[1]*fa.scale-24*na;rp>0&&rp>jo&&(jo=rp)}else{var yh=Ci[fa.fontStack],np=yh&&yh[Pu];if(np&&np.rect)Gl=np.rect,ko=np.metrics;else{var jp=ji[fa.fontStack],_h=jp&&jp[Pu];if(!_h)continue;ko=_h.metrics}Vl=24*(na-fa.scale)}vc?(In.verticalizable=!0,$a.push({glyph:Pu,imageName:ll,x:ds,y:Xs+Vl,vertical:vc,scale:fa.scale,fontStack:fa.fontStack,sectionIndex:mu,metrics:ko,rect:Gl}),ds+=tp*fa.scale+io):($a.push({glyph:Pu,imageName:ll,x:ds,y:Xs+Vl,vertical:vc,scale:fa.scale,fontStack:fa.fontStack,sectionIndex:mu,metrics:ko,rect:Gl}),ds+=ko.advance*fa.scale+io)}$a.length!==0&&(Ta=Math.max(ds-io,Ta),yi($a,0,$a.length-1,di,jo)),ds=0;var wf=ca*na+jo;Ps.lineOffset=Math.max(jo,qs),Xs+=wf,Ys=Math.max(wf,Ys),++Cs}else Xs+=ca,++Cs}var mc,Vp=Xs- -17,ip=Yr(no),Tf=ip.horizontalAlign,Gp=ip.verticalAlign;(function(xh,td,gc,bh,Al,Eh,Sh,Ch,Mf){var ap,Ah=(td-gc)*Al;ap=Eh!==Sh?-Ch*bh- -17:(-bh*Mf+.5)*Sh;for(var op=0,sp=xh;op<sp.length;op+=1)for(var Pf=0,Hp=sp[op].positionedGlyphs;Pf<Hp.length;Pf+=1){var Yc=Hp[Pf];Yc.x+=Ah,Yc.y+=ap}})(In.positionedLines,di,Tf,Gp,Ta,Ys,ca,Vp,An.length),In.top+=-Gp*Vp,In.bottom=In.top+Vp,In.left+=-Tf*Ta,In.right=In.left+Ta}(ti,o,u,h,Ye,S,P,k,W,z,ee,Oe),!function(In){for(var ji=0,Ci=In;ji<Ci.length;ji+=1)if(Ci[ji].positionedGlyphs.length!==0)return!1;return!0}(Mi)&&ti}Rr.fromFeature=function(t,o){for(var u=new Rr,h=0;h<t.sections.length;h++){var y=t.sections[h];y.image?u.addImageSection(y):u.addTextSection(y,o)}return u},Rr.prototype.length=function(){return this.text.length},Rr.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Rr.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Rr.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Rr.prototype.verticalizePunctuation=function(){this.text=function(t){for(var o="",u=0;u<t.length;u++){var h=t.charCodeAt(u+1)||null,y=t.charCodeAt(u-1)||null;o+=h&&Du(h)&&!Qf[t[u+1]]||y&&Du(y)&&!Qf[t[u-1]]||!Qf[t[u]]?t[u]:Qf[t[u]]}return o}(this.text)},Rr.prototype.trim=function(){for(var t=0,o=0;o<this.text.length&&Nn[this.text.charCodeAt(o)];o++)t++;for(var u=this.text.length,h=this.text.length-1;h>=0&&h>=t&&Nn[this.text.charCodeAt(h)];h--)u--;this.text=this.text.substring(t,u),this.sectionIndex=this.sectionIndex.slice(t,u)},Rr.prototype.substring=function(t,o){var u=new Rr;return u.text=this.text.substring(t,o),u.sectionIndex=this.sectionIndex.slice(t,o),u.sections=this.sections,u},Rr.prototype.toString=function(){return this.text},Rr.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(o,u){return Math.max(o,t.sections[u].scale)},0)},Rr.prototype.addTextSection=function(t,o){this.text+=t.text,this.sections.push(pr.forText(t.scale,t.fontStack||o));for(var u=this.sections.length-1,h=0;h<t.text.length;++h)this.sectionIndex.push(u)},Rr.prototype.addImageSection=function(t){var o=t.image?t.image.name:"";if(o.length!==0){var u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(pr.forImage(o)),this.sectionIndex.push(this.sections.length-1)):Qe("Reached maximum number of images 6401")}else Qe("Can't add FormattedSection with an empty image.")},Rr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Nn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Xt={};function ir(t,o,u,h,y,b){if(o.imageName){var S=h[o.imageName];return S?S.displaySize[0]*o.scale*24/b+y:0}var P=u[o.fontStack],k=P&&P[t];return k?k.metrics.advance*o.scale+y:0}function dn(t,o,u,h){var y=Math.pow(t-o,2);return h?t<o?y/2:2*y:y+Math.abs(u)*u}function Xr(t,o,u){var h=0;return t===10&&(h-=1e4),u&&(h+=150),t!==40&&t!==65288||(h+=50),o!==41&&o!==65289||(h+=50),h}function Er(t,o,u,h,y,b){for(var S=null,P=dn(o,u,y,b),k=0,z=h;k<z.length;k+=1){var Z=z[k],W=dn(o-Z.x,u,y,b)+Z.badness;W<=P&&(S=Z,P=W)}return{index:t,x:o,priorBreak:S,badness:P}}function Hr(t,o,u,h,y,b,S){if(b!=="point")return[];if(!t)return[];for(var P,k=[],z=function(Ye,Ze,st,Ct,Zt,Wt){for(var lr=0,Lr=0;Lr<Ye.length();Lr++){var zr=Ye.getSection(Lr);lr+=ir(Ye.getCharCode(Lr),zr,Ct,Zt,Ze,Wt)}return lr/Math.max(1,Math.ceil(lr/st))}(t,o,u,h,y,S),Z=t.text.indexOf("\u200B")>=0,W=0,ee=0;ee<t.length();ee++){var ne=t.getSection(ee),Me=t.getCharCode(ee);if(Nn[Me]||(W+=ir(Me,ne,h,y,o,S)),ee<t.length()-1){var Oe=!((P=Me)<11904||!(Kr["Bopomofo Extended"](P)||Kr.Bopomofo(P)||Kr["CJK Compatibility Forms"](P)||Kr["CJK Compatibility Ideographs"](P)||Kr["CJK Compatibility"](P)||Kr["CJK Radicals Supplement"](P)||Kr["CJK Strokes"](P)||Kr["CJK Symbols and Punctuation"](P)||Kr["CJK Unified Ideographs Extension A"](P)||Kr["CJK Unified Ideographs"](P)||Kr["Enclosed CJK Letters and Months"](P)||Kr["Halfwidth and Fullwidth Forms"](P)||Kr.Hiragana(P)||Kr["Ideographic Description Characters"](P)||Kr["Kangxi Radicals"](P)||Kr["Katakana Phonetic Extensions"](P)||Kr.Katakana(P)||Kr["Vertical Forms"](P)||Kr["Yi Radicals"](P)||Kr["Yi Syllables"](P)));(Xt[Me]||Oe||ne.imageName)&&k.push(Er(ee+1,W,z,k,Xr(Me,t.getCharCode(ee+1),Oe&&Z),!1))}}return function Ye(Ze){return Ze?Ye(Ze.priorBreak).concat(Ze.index):[]}(Er(t.length(),W,z,k,0,!0))}function Yr(t){var o=.5,u=.5;switch(t){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function yi(t,o,u,h,y){if(h||y)for(var b=t[u],S=(t[u].x+b.metrics.advance*b.scale)*h,P=o;P<=u;P++)t[P].x-=S,t[P].y+=y}function ai(t,o,u,h,y,b){var S,P=t.image;if(P.content){var k=P.content,z=P.pixelRatio||1;S=[k[0]/z,k[1]/z,P.displaySize[0]-k[2]/z,P.displaySize[1]-k[3]/z]}var Z,W,ee,ne,Me=o.left*b,Oe=o.right*b;u==="width"||u==="both"?(ne=y[0]+Me-h[3],W=y[0]+Oe+h[1]):W=(ne=y[0]+(Me+Oe-P.displaySize[0])/2)+P.displaySize[0];var Ye=o.top*b,Ze=o.bottom*b;return u==="height"||u==="both"?(Z=y[1]+Ye-h[0],ee=y[1]+Ze+h[2]):ee=(Z=y[1]+(Ye+Ze-P.displaySize[1])/2)+P.displaySize[1],{image:P,top:Z,right:W,bottom:ee,left:ne,collisionPadding:S}}Xt[10]=!0,Xt[32]=!0,Xt[38]=!0,Xt[40]=!0,Xt[41]=!0,Xt[43]=!0,Xt[45]=!0,Xt[47]=!0,Xt[173]=!0,Xt[183]=!0,Xt[8203]=!0,Xt[8208]=!0,Xt[8211]=!0,Xt[8231]=!0;var qr=function(t){function o(u,h,y,b){t.call(this,u,h),this.angle=y,b!==void 0&&(this.segment=b)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.clone=function(){return new o(this.x,this.y,this.angle,this.segment)},o}(se);function sn(t,o){var u=o.expression;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Li(t+1))};if(u.kind==="source")return{kind:"source"};for(var h=u.zoomStops,y=u.interpolationType,b=0;b<h.length&&h[b]<=t;)b++;for(var S=b=Math.max(0,b-1);S<h.length&&h[S]<t+1;)S++;S=Math.min(h.length-1,S);var P=h[b],k=h[S];return u.kind==="composite"?{kind:"composite",minZoom:P,maxZoom:k,interpolationType:y}:{kind:"camera",minZoom:P,maxZoom:k,minSize:u.evaluate(new Li(P)),maxSize:u.evaluate(new Li(k)),interpolationType:y}}function Qn(t,o,u){var h=o.uSize,y=u.lowerSize;return t.kind==="source"?y/128:t.kind==="composite"?oa(y/128,u.upperSize/128,o.uSizeT):h}function hi(t,o){var u=0,h=0;if(t.kind==="constant")h=t.layoutSize;else if(t.kind!=="source"){var y=t.interpolationType,b=y?Vt(xe.interpolationFactor(y,o,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?h=oa(t.minSize,t.maxSize,b):u=b}return{uSizeT:u,uSize:h}}yn("Anchor",qr);var zi=Object.freeze({__proto__:null,getSizeData:sn,evaluateSizeForFeature:Qn,evaluateSizeForZoom:hi,SIZE_PACK_FACTOR:128});function po(t,o,u,h,y){if(o.segment===void 0)return!0;for(var b=o,S=o.segment+1,P=0;P>-u/2;){if(--S<0)return!1;P-=t[S].dist(b),b=t[S]}P+=t[S].dist(t[S+1]),S++;for(var k=[],z=0;P<u/2;){var Z=t[S],W=t[S+1];if(!W)return!1;var ee=t[S-1].angleTo(Z)-Z.angleTo(W);for(ee=Math.abs((ee+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:P,angleDelta:ee}),z+=ee;P-k[0].distance>h;)z-=k.shift().angleDelta;if(z>y)return!1;S++,P+=Z.dist(W)}return!0}function go(t){for(var o=0,u=0;u<t.length-1;u++)o+=t[u].dist(t[u+1]);return o}function Di(t,o,u){return t?.6*o*u:0}function us(t,o){return Math.max(t?t.right-t.left:0,o?o.right-o.left:0)}function Ka(t,o,u,h,y,b){for(var S=Di(u,y,b),P=us(u,h)*b,k=0,z=go(t)/2,Z=0;Z<t.length-1;Z++){var W=t[Z],ee=t[Z+1],ne=W.dist(ee);if(k+ne>z){var Me=(z-k)/ne,Oe=oa(W.x,ee.x,Me),Ye=oa(W.y,ee.y,Me),Ze=new qr(Oe,Ye,ee.angleTo(W),Z);return Ze._round(),!S||po(t,Ze,P,S,o)?Ze:void 0}k+=ne}}function ns(t,o,u,h,y,b,S,P,k){var z=Di(h,b,S),Z=us(h,y),W=Z*S,ee=t[0].x===0||t[0].x===k||t[0].y===0||t[0].y===k;return o-W<o/4&&(o=W+o/4),function ne(Me,Oe,Ye,Ze,st,Ct,Zt,Wt,lr){for(var Lr=Ct/2,zr=go(Me),Pn=0,pn=Oe-Ye,zn=[],mn=0;mn<Me.length-1;mn++){for(var Mi=Me[mn],ti=Me[mn+1],In=Mi.dist(ti),ji=ti.angleTo(Mi);pn+Ye<Pn+In;){var Ci=((pn+=Ye)-Pn)/In,Wi=oa(Mi.x,ti.x,Ci),An=oa(Mi.y,ti.y,Ci);if(Wi>=0&&Wi<lr&&An>=0&&An<lr&&pn-Lr>=0&&pn+Lr<=zr){var ca=new qr(Wi,An,ji,mn);ca._round(),Ze&&!po(Me,ca,Ct,Ze,st)||zn.push(ca)}}Pn+=In}return Wt||zn.length||Zt||(zn=ne(Me,Pn/2,Ye,Ze,st,Ct,Zt,!0,lr)),zn}(t,ee?o/2*P%o:(Z/2+2*b)*S*P%o,o,z,u,W,ee,!1,k)}function Oo(t,o,u,h,y){for(var b=[],S=0;S<t.length;S++)for(var P=t[S],k=void 0,z=0;z<P.length-1;z++){var Z=P[z],W=P[z+1];Z.x<o&&W.x<o||(Z.x<o?Z=new se(o,Z.y+(o-Z.x)/(W.x-Z.x)*(W.y-Z.y))._round():W.x<o&&(W=new se(o,Z.y+(o-Z.x)/(W.x-Z.x)*(W.y-Z.y))._round()),Z.y<u&&W.y<u||(Z.y<u?Z=new se(Z.x+(u-Z.y)/(W.y-Z.y)*(W.x-Z.x),u)._round():W.y<u&&(W=new se(Z.x+(u-Z.y)/(W.y-Z.y)*(W.x-Z.x),u)._round()),Z.x>=h&&W.x>=h||(Z.x>=h?Z=new se(h,Z.y+(h-Z.x)/(W.x-Z.x)*(W.y-Z.y))._round():W.x>=h&&(W=new se(h,Z.y+(h-Z.x)/(W.x-Z.x)*(W.y-Z.y))._round()),Z.y>=y&&W.y>=y||(Z.y>=y?Z=new se(Z.x+(y-Z.y)/(W.y-Z.y)*(W.x-Z.x),y)._round():W.y>=y&&(W=new se(Z.x+(y-Z.y)/(W.y-Z.y)*(W.x-Z.x),y)._round()),k&&Z.equals(k[k.length-1])||b.push(k=[Z]),k.push(W)))))}return b}function is(t,o,u,h){var y=[],b=t.image,S=b.pixelRatio,P=b.paddedRect.w-2,k=b.paddedRect.h-2,z=t.right-t.left,Z=t.bottom-t.top,W=b.stretchX||[[0,P]],ee=b.stretchY||[[0,k]],ne=function(Wi,An){return Wi+An[1]-An[0]},Me=W.reduce(ne,0),Oe=ee.reduce(ne,0),Ye=P-Me,Ze=k-Oe,st=0,Ct=Me,Zt=0,Wt=Oe,lr=0,Lr=Ye,zr=0,Pn=Ze;if(b.content&&h){var pn=b.content;st=Uo(W,0,pn[0]),Zt=Uo(ee,0,pn[1]),Ct=Uo(W,pn[0],pn[2]),Wt=Uo(ee,pn[1],pn[3]),lr=pn[0]-st,zr=pn[1]-Zt,Lr=pn[2]-pn[0]-Ct,Pn=pn[3]-pn[1]-Wt}var zn=function(Wi,An,ca,no){var So=yo(Wi.stretch-st,Ct,z,t.left),ho=_i(Wi.fixed-lr,Lr,Wi.stretch,Me),io=yo(An.stretch-Zt,Wt,Z,t.top),Lo=_i(An.fixed-zr,Pn,An.stretch,Oe),hs=yo(ca.stretch-st,Ct,z,t.left),ds=_i(ca.fixed-lr,Lr,ca.stretch,Me),Xs=yo(no.stretch-Zt,Wt,Z,t.top),Ta=_i(no.fixed-zr,Pn,no.stretch,Oe),Ys=new se(So,io),di=new se(hs,io),Cs=new se(hs,Xs),qi=new se(So,Xs),Va=new se(ho/S,Lo/S),V=new se(ds/S,Ta/S),na=o*Math.PI/180;if(na){var qs=Math.sin(na),Ps=Math.cos(na),$a=[Ps,-qs,qs,Ps];Ys._matMult($a),di._matMult($a),qi._matMult($a),Cs._matMult($a)}var jo=Wi.stretch+Wi.fixed,Is=An.stretch+An.fixed;return{tl:Ys,tr:di,bl:qi,br:Cs,tex:{x:b.paddedRect.x+1+jo,y:b.paddedRect.y+1+Is,w:ca.stretch+ca.fixed-jo,h:no.stretch+no.fixed-Is},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Va,pixelOffsetBR:V,minFontScaleX:Lr/S/z,minFontScaleY:Pn/S/Z,isSDF:u}};if(h&&(b.stretchX||b.stretchY))for(var mn=ls(W,Ye,Me),Mi=ls(ee,Ze,Oe),ti=0;ti<mn.length-1;ti++)for(var In=mn[ti],ji=mn[ti+1],Ci=0;Ci<Mi.length-1;Ci++)y.push(zn(In,Mi[Ci],ji,Mi[Ci+1]));else y.push(zn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:P+1},{fixed:0,stretch:k+1}));return y}function Uo(t,o,u){for(var h=0,y=0,b=t;y<b.length;y+=1){var S=b[y];h+=Math.max(o,Math.min(u,S[1]))-Math.max(o,Math.min(u,S[0]))}return h}function ls(t,o,u){for(var h=[{fixed:-1,stretch:0}],y=0,b=t;y<b.length;y+=1){var S=b[y],P=S[0],k=S[1],z=h[h.length-1];h.push({fixed:P-z.stretch,stretch:z.stretch}),h.push({fixed:P-z.stretch,stretch:z.stretch+(k-P)})}return h.push({fixed:o+1,stretch:u}),h}function yo(t,o,u,h){return t/o*u+h}function _i(t,o,u,h){return t-o*u/h}var Zo=function(t,o,u,h,y,b,S,P,k,z){if(this.boxStartIndex=t.length,k){var Z=b.top,W=b.bottom,ee=b.collisionPadding;ee&&(Z-=ee[1],W+=ee[3]);var ne=W-Z;ne>0&&(ne=Math.max(10,ne),this.circleDiameter=ne)}else{var Me=b.top*S-P,Oe=b.bottom*S+P,Ye=b.left*S-P,Ze=b.right*S+P,st=b.collisionPadding;if(st&&(Ye-=st[0]*S,Me-=st[1]*S,Ze+=st[2]*S,Oe+=st[3]*S),z){var Ct=new se(Ye,Me),Zt=new se(Ze,Me),Wt=new se(Ye,Oe),lr=new se(Ze,Oe),Lr=z*Math.PI/180;Ct._rotate(Lr),Zt._rotate(Lr),Wt._rotate(Lr),lr._rotate(Lr),Ye=Math.min(Ct.x,Zt.x,Wt.x,lr.x),Ze=Math.max(Ct.x,Zt.x,Wt.x,lr.x),Me=Math.min(Ct.y,Zt.y,Wt.y,lr.y),Oe=Math.max(Ct.y,Zt.y,Wt.y,lr.y)}t.emplaceBack(o.x,o.y,Ye,Me,Ze,Oe,u,h,y)}this.boxEndIndex=t.length},ra=function(t,o){if(t===void 0&&(t=[]),o===void 0&&(o=cs),this.data=t,this.length=this.data.length,this.compare=o,this.length>0)for(var u=(this.length>>1)-1;u>=0;u--)this._down(u)};function cs(t,o){return t<o?-1:t>o?1:0}function ii(t,o,u){o===void 0&&(o=1),u===void 0&&(u=!1);for(var h=1/0,y=1/0,b=-1/0,S=-1/0,P=t[0],k=0;k<P.length;k++){var z=P[k];(!k||z.x<h)&&(h=z.x),(!k||z.y<y)&&(y=z.y),(!k||z.x>b)&&(b=z.x),(!k||z.y>S)&&(S=z.y)}var Z=Math.min(b-h,S-y),W=Z/2,ee=new ra([],Ui);if(Z===0)return new se(h,y);for(var ne=h;ne<b;ne+=Z)for(var Me=y;Me<S;Me+=Z)ee.push(new ga(ne+W,Me+W,W,t));for(var Oe=function(st){for(var Ct=0,Zt=0,Wt=0,lr=st[0],Lr=0,zr=lr.length,Pn=zr-1;Lr<zr;Pn=Lr++){var pn=lr[Lr],zn=lr[Pn],mn=pn.x*zn.y-zn.x*pn.y;Zt+=(pn.x+zn.x)*mn,Wt+=(pn.y+zn.y)*mn,Ct+=3*mn}return new ga(Zt/Ct,Wt/Ct,0,st)}(t),Ye=ee.length;ee.length;){var Ze=ee.pop();(Ze.d>Oe.d||!Oe.d)&&(Oe=Ze,u&&console.log("found best %d after %d probes",Math.round(1e4*Ze.d)/1e4,Ye)),Ze.max-Oe.d<=o||(ee.push(new ga(Ze.p.x-(W=Ze.h/2),Ze.p.y-W,W,t)),ee.push(new ga(Ze.p.x+W,Ze.p.y-W,W,t)),ee.push(new ga(Ze.p.x-W,Ze.p.y+W,W,t)),ee.push(new ga(Ze.p.x+W,Ze.p.y+W,W,t)),Ye+=4)}return u&&(console.log("num probes: "+Ye),console.log("best distance: "+Oe.d)),Oe.p}function Ui(t,o){return o.max-t.max}function ga(t,o,u,h){this.p=new se(t,o),this.h=u,this.d=function(y,b){for(var S=!1,P=1/0,k=0;k<b.length;k++)for(var z=b[k],Z=0,W=z.length,ee=W-1;Z<W;ee=Z++){var ne=z[Z],Me=z[ee];ne.y>y.y!=Me.y>y.y&&y.x<(Me.x-ne.x)*(y.y-ne.y)/(Me.y-ne.y)+ne.x&&(S=!S),P=Math.min(P,du(y,ne,Me))}return(S?1:-1)*Math.sqrt(P)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}ra.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},ra.prototype.pop=function(){if(this.length!==0){var t=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),t}},ra.prototype.peek=function(){return this.data[0]},ra.prototype._up=function(t){for(var o=this.data,u=this.compare,h=o[t];t>0;){var y=t-1>>1,b=o[y];if(u(h,b)>=0)break;o[t]=b,t=y}o[t]=h},ra.prototype._down=function(t){for(var o=this.data,u=this.compare,h=this.length>>1,y=o[t];t<h;){var b=1+(t<<1),S=o[b],P=b+1;if(P<this.length&&u(o[P],S)<0&&(b=P,S=o[P]),u(S,y)>=0)break;o[t]=S,t=b}o[t]=y};var Ro=Number.POSITIVE_INFINITY;function Cl(t,o){return o[1]!==Ro?function(u,h,y){var b=0,S=0;switch(h=Math.abs(h),y=Math.abs(y),u){case"top-right":case"top-left":case"top":S=y-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-y}switch(u){case"top-right":case"bottom-right":case"right":b=-h;break;case"top-left":case"bottom-left":case"left":b=h}return[b,S]}(t,o[0],o[1]):function(u,h){var y=0,b=0;h<0&&(h=0);var S=h/Math.sqrt(2);switch(u){case"top-right":case"top-left":b=S-7;break;case"bottom-right":case"bottom-left":b=7-S;break;case"bottom":b=7-h;break;case"top":b=h-7}switch(u){case"top-right":case"bottom-right":y=-S;break;case"top-left":case"bottom-left":y=S;break;case"left":y=h;break;case"right":y=-h}return[y,b]}(t,o[0])}function we(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ut(t,o,u,h,y,b,S,P,k,z,Z,W,ee,ne,Me){var Oe=function(Zt,Wt,lr,Lr,zr,Pn,pn,zn){for(var mn=Lr.layout.get("text-rotate").evaluate(Pn,{})*Math.PI/180,Mi=[],ti=0,In=Wt.positionedLines;ti<In.length;ti+=1)for(var ji=In[ti],Ci=0,Wi=ji.positionedGlyphs;Ci<Wi.length;Ci+=1){var An=Wi[Ci];if(An.rect){var ca=An.rect||{},no=4,So=!0,ho=1,io=0,Lo=(zr||zn)&&An.vertical,hs=An.metrics.advance*An.scale/2;if(zn&&Wt.verticalizable&&(io=ji.lineOffset/2-(An.imageName?-(24-An.metrics.width*An.scale)/2:24*(An.scale-1))),An.imageName){var ds=pn[An.imageName];So=ds.sdf,no=1/(ho=ds.pixelRatio)}var Xs=zr?[An.x+hs,An.y]:[0,0],Ta=zr?[0,0]:[An.x+hs+lr[0],An.y+lr[1]-io],Ys=[0,0];Lo&&(Ys=Ta,Ta=[0,0]);var di=(An.metrics.left-no)*An.scale-hs+Ta[0],Cs=(-An.metrics.top-no)*An.scale+Ta[1],qi=di+ca.w*An.scale/ho,Va=Cs+ca.h*An.scale/ho,V=new se(di,Cs),na=new se(qi,Cs),qs=new se(di,Va),Ps=new se(qi,Va);if(Lo){var $a=new se(-hs,hs- -17),jo=-Math.PI/2,Is=12-hs,fa=new se(22-Is,-(An.imageName?Is:0)),mu=new(Function.prototype.bind.apply(se,[null].concat(Ys)));V._rotateAround(jo,$a)._add(fa)._add(mu),na._rotateAround(jo,$a)._add(fa)._add(mu),qs._rotateAround(jo,$a)._add(fa)._add(mu),Ps._rotateAround(jo,$a)._add(fa)._add(mu)}if(mn){var Pu=Math.sin(mn),Vl=Math.cos(mn),ko=[Vl,-Pu,Pu,Vl];V._matMult(ko),na._matMult(ko),qs._matMult(ko),Ps._matMult(ko)}var Gl=new se(0,0),ll=new se(0,0);Mi.push({tl:V,tr:na,bl:qs,br:Ps,tex:ca,writingMode:Wt.writingMode,glyphOffset:Xs,sectionIndex:An.sectionIndex,isSDF:So,pixelOffsetTL:Gl,pixelOffsetBR:ll,minFontScaleX:0,minFontScaleY:0})}}return Mi}(0,u,P,y,b,S,h,t.allowVerticalPlacement),Ye=t.textSizeData,Ze=null;Ye.kind==="source"?(Ze=[128*y.layout.get("text-size").evaluate(S,{})])[0]>32640&&Qe(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Ye.kind==="composite"&&((Ze=[128*ne.compositeTextSizes[0].evaluate(S,{},Me),128*ne.compositeTextSizes[1].evaluate(S,{},Me)])[0]>32640||Ze[1]>32640)&&Qe(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,Oe,Ze,P,b,S,z,o,k.lineStartIndex,k.lineLength,ee,Me);for(var st=0,Ct=Z;st<Ct.length;st+=1)W[Ct[st]]=t.text.placedSymbolArray.length-1;return 4*Oe.length}function bt(t){for(var o in t)return t[o];return null}function gn(t,o,u,h){var y=t.compareText;if(o in y){for(var b=y[o],S=b.length-1;S>=0;S--)if(h.dist(b[S])<u)return!0}else y[o]=[];return y[o].push(h),!1}var Fi=Mu.VectorTileFeature.types,Ce=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ie(t,o,u,h,y,b,S,P,k,z,Z,W,ee){var ne=P?Math.min(32640,Math.round(P[0])):0,Me=P?Math.min(32640,Math.round(P[1])):0;t.emplaceBack(o,u,Math.round(32*h),Math.round(32*y),b,S,(ne<<1)+(k?1:0),Me,16*z,16*Z,256*W,256*ee)}function Ve(t,o,u){t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u)}function ft(t){for(var o=0,u=t.sections;o<u.length;o+=1)if(df(u[o].text))return!0;return!1}var Ot=function(t){this.layoutVertexArray=new vf,this.indexArray=new ol,this.programConfigurations=t,this.segments=new fe,this.dynamicLayoutVertexArray=new kl,this.opacityVertexArray=new Dl,this.placedSymbolArray=new d};Ot.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Ot.prototype.upload=function(t,o,u,h){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Md.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Kh.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Ce,!0),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(t))},Ot.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},yn("SymbolBuffers",Ot);var qe=function(t,o,u){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new u,this.segments=new fe,this.collisionVertexArray=new wp};qe.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,$h.members,!0)},qe.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},yn("CollisionBuffers",qe);var Fe=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(b){return b.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ts([]),this.placementViewportMatrix=ts([]);var o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=sn(this.zoom,o["text-size"]),this.iconSizeData=sn(this.zoom,o["icon-size"]);var u=this.layers[0].layout,h=u.get("symbol-sort-key"),y=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(function(b){return Zr[b]})),this.stateDependentLayerIds=this.layers.filter(function(b){return b.isStateDependent()}).map(function(b){return b.id}),this.sourceID=t.sourceID};Fe.prototype.createArrays=function(){this.text=new Ot(new Gn(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new Ot(new Gn(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new M,this.lineVertexArray=new L,this.symbolInstances=new A},Fe.prototype.calculateGlyphDependencies=function(t,o,u,h,y){for(var b=0;b<t.length;b++)if(o[t.charCodeAt(b)]=!0,(u||h)&&y){var S=Qf[t.charAt(b)];S&&(o[S.charCodeAt(0)]=!0)}},Fe.prototype.populate=function(t,o,u){var h=this.layers[0],y=h.layout,b=y.get("text-font"),S=y.get("text-field"),P=y.get("icon-image"),k=(S.value.kind!=="constant"||S.value.value instanceof Pa&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),z=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,Z=y.get("symbol-sort-key");if(this.features=[],k||z){for(var W=o.iconDependencies,ee=o.glyphDependencies,ne=o.availableImages,Me=new Li(this.zoom),Oe=0,Ye=t;Oe<Ye.length;Oe+=1){var Ze=Ye[Oe],st=Ze.feature,Ct=Ze.id,Zt=Ze.index,Wt=Ze.sourceLayerIndex,lr=h._featureFilter.needGeometry,Lr=Za(st,lr);if(h._featureFilter.filter(Me,Lr,u)){lr||(Lr.geometry=ro(st));var zr=void 0;if(k){var Pn=h.getValueAndResolveTokens("text-field",Lr,u,ne),pn=Pa.factory(Pn);ft(pn)&&(this.hasRTLText=!0),(!this.hasRTLText||Ap()==="unavailable"||this.hasRTLText&&Rs.isParsed())&&(zr=Id(pn,h,Lr))}var zn=void 0;if(z){var mn=h.getValueAndResolveTokens("icon-image",Lr,u,ne);zn=mn instanceof Ia?mn:Ia.fromString(mn)}if(zr||zn){var Mi=this.sortFeaturesByKey?Z.evaluate(Lr,{},u):void 0;if(this.features.push({id:Ct,text:zr,icon:zn,index:Zt,sourceLayerIndex:Wt,geometry:Lr.geometry,properties:st.properties,type:Fi[st.type],sortKey:Mi}),zn&&(W[zn.name]=!0),zr){var ti=b.evaluate(Lr,{},u).join(","),In=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Zr.vertical)>=0;for(var ji=0,Ci=zr.sections;ji<Ci.length;ji+=1){var Wi=Ci[ji];if(Wi.image)W[Wi.image.name]=!0;else{var An=hf(zr.toString()),ca=Wi.fontStack||ti,no=ee[ca]=ee[ca]||{};this.calculateGlyphDependencies(Wi.text,no,In,this.allowVerticalPlacement,An)}}}}}}y.get("symbol-placement")==="line"&&(this.features=function(So){var ho={},io={},Lo=[],hs=0;function ds($a){Lo.push(So[$a]),hs++}function Xs($a,jo,Is){var fa=io[$a];return delete io[$a],io[jo]=fa,Lo[fa].geometry[0].pop(),Lo[fa].geometry[0]=Lo[fa].geometry[0].concat(Is[0]),fa}function Ta($a,jo,Is){var fa=ho[jo];return delete ho[jo],ho[$a]=fa,Lo[fa].geometry[0].shift(),Lo[fa].geometry[0]=Is[0].concat(Lo[fa].geometry[0]),fa}function Ys($a,jo,Is){var fa=Is?jo[0][jo[0].length-1]:jo[0][0];return $a+":"+fa.x+":"+fa.y}for(var di=0;di<So.length;di++){var Cs=So[di],qi=Cs.geometry,Va=Cs.text?Cs.text.toString():null;if(Va){var V=Ys(Va,qi),na=Ys(Va,qi,!0);if(V in io&&na in ho&&io[V]!==ho[na]){var qs=Ta(V,na,qi),Ps=Xs(V,na,Lo[qs].geometry);delete ho[V],delete io[na],io[Ys(Va,Lo[Ps].geometry,!0)]=Ps,Lo[qs].geometry=null}else V in io?Xs(V,na,qi):na in ho?Ta(V,na,qi):(ds(di),ho[V]=hs-1,io[na]=hs-1)}else ds(di)}return Lo.filter(function($a){return $a.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(So,ho){return So.sortKey-ho.sortKey})}},Fe.prototype.update=function(t,o,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,o,this.layers,u),this.icon.programConfigurations.updatePaintArrays(t,o,this.layers,u))},Fe.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Fe.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Fe.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Fe.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Fe.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Fe.prototype.addToLineVertexArray=function(t,o){var u=this.lineVertexArray.length;if(t.segment!==void 0){for(var h=t.dist(o[t.segment+1]),y=t.dist(o[t.segment]),b={},S=t.segment+1;S<o.length;S++)b[S]={x:o[S].x,y:o[S].y,tileUnitDistanceFromAnchor:h},S<o.length-1&&(h+=o[S+1].dist(o[S]));for(var P=t.segment||0;P>=0;P--)b[P]={x:o[P].x,y:o[P].y,tileUnitDistanceFromAnchor:y},P>0&&(y+=o[P-1].dist(o[P]));for(var k=0;k<o.length;k++){var z=b[k];this.lineVertexArray.emplaceBack(z.x,z.y,z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}},Fe.prototype.addSymbols=function(t,o,u,h,y,b,S,P,k,z,Z,W){for(var ee=t.indexArray,ne=t.layoutVertexArray,Me=t.segments.prepareSegment(4*o.length,ne,ee,this.canOverlap?b.sortKey:void 0),Oe=this.glyphOffsetArray.length,Ye=Me.vertexLength,Ze=this.allowVerticalPlacement&&S===Zr.vertical?Math.PI/2:0,st=b.text&&b.text.sections,Ct=0;Ct<o.length;Ct++){var Zt=o[Ct],Wt=Zt.tl,lr=Zt.tr,Lr=Zt.bl,zr=Zt.br,Pn=Zt.tex,pn=Zt.pixelOffsetTL,zn=Zt.pixelOffsetBR,mn=Zt.minFontScaleX,Mi=Zt.minFontScaleY,ti=Zt.glyphOffset,In=Zt.isSDF,ji=Zt.sectionIndex,Ci=Me.vertexLength,Wi=ti[1];ie(ne,P.x,P.y,Wt.x,Wi+Wt.y,Pn.x,Pn.y,u,In,pn.x,pn.y,mn,Mi),ie(ne,P.x,P.y,lr.x,Wi+lr.y,Pn.x+Pn.w,Pn.y,u,In,zn.x,pn.y,mn,Mi),ie(ne,P.x,P.y,Lr.x,Wi+Lr.y,Pn.x,Pn.y+Pn.h,u,In,pn.x,zn.y,mn,Mi),ie(ne,P.x,P.y,zr.x,Wi+zr.y,Pn.x+Pn.w,Pn.y+Pn.h,u,In,zn.x,zn.y,mn,Mi),Ve(t.dynamicLayoutVertexArray,P,Ze),ee.emplaceBack(Ci,Ci+1,Ci+2),ee.emplaceBack(Ci+1,Ci+2,Ci+3),Me.vertexLength+=4,Me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ti[0]),Ct!==o.length-1&&ji===o[Ct+1].sectionIndex||t.programConfigurations.populatePaintArrays(ne.length,b,b.index,{},W,st&&st[ji])}t.placedSymbolArray.emplaceBack(P.x,P.y,Oe,this.glyphOffsetArray.length-Oe,Ye,k,z,P.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],S,0,!1,0,Z)},Fe.prototype._addCollisionDebugVertex=function(t,o,u,h,y,b){return o.emplaceBack(0,0),t.emplaceBack(u.x,u.y,h,y,Math.round(b.x),Math.round(b.y))},Fe.prototype.addCollisionDebugVertices=function(t,o,u,h,y,b,S){var P=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),k=P.vertexLength,z=y.layoutVertexArray,Z=y.collisionVertexArray,W=S.anchorX,ee=S.anchorY;this._addCollisionDebugVertex(z,Z,b,W,ee,new se(t,o)),this._addCollisionDebugVertex(z,Z,b,W,ee,new se(u,o)),this._addCollisionDebugVertex(z,Z,b,W,ee,new se(u,h)),this._addCollisionDebugVertex(z,Z,b,W,ee,new se(t,h)),P.vertexLength+=4;var ne=y.indexArray;ne.emplaceBack(k,k+1),ne.emplaceBack(k+1,k+2),ne.emplaceBack(k+2,k+3),ne.emplaceBack(k+3,k),P.primitiveLength+=4},Fe.prototype.addDebugCollisionBoxes=function(t,o,u,h){for(var y=t;y<o;y++){var b=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,h?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,u)}},Fe.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new qe(ic,$f.members,Gs),this.iconCollisionBox=new qe(ic,$f.members,Gs);for(var t=0;t<this.symbolInstances.length;t++){var o=this.symbolInstances.get(t);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}},Fe.prototype._deserializeCollisionBoxesForSymbol=function(t,o,u,h,y,b,S,P,k){for(var z={},Z=o;Z<u;Z++){var W=t.get(Z);z.textBox={x1:W.x1,y1:W.y1,x2:W.x2,y2:W.y2,anchorPointX:W.anchorPointX,anchorPointY:W.anchorPointY},z.textFeatureIndex=W.featureIndex;break}for(var ee=h;ee<y;ee++){var ne=t.get(ee);z.verticalTextBox={x1:ne.x1,y1:ne.y1,x2:ne.x2,y2:ne.y2,anchorPointX:ne.anchorPointX,anchorPointY:ne.anchorPointY},z.verticalTextFeatureIndex=ne.featureIndex;break}for(var Me=b;Me<S;Me++){var Oe=t.get(Me);z.iconBox={x1:Oe.x1,y1:Oe.y1,x2:Oe.x2,y2:Oe.y2,anchorPointX:Oe.anchorPointX,anchorPointY:Oe.anchorPointY},z.iconFeatureIndex=Oe.featureIndex;break}for(var Ye=P;Ye<k;Ye++){var Ze=t.get(Ye);z.verticalIconBox={x1:Ze.x1,y1:Ze.y1,x2:Ze.x2,y2:Ze.y2,anchorPointX:Ze.anchorPointX,anchorPointY:Ze.anchorPointY},z.verticalIconFeatureIndex=Ze.featureIndex;break}return z},Fe.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var o=0;o<this.symbolInstances.length;o++){var u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}},Fe.prototype.hasTextData=function(){return this.text.segments.get().length>0},Fe.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Fe.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Fe.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Fe.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Fe.prototype.addIndicesForPlacedSymbol=function(t,o){for(var u=t.placedSymbolArray.get(o),h=u.vertexStartIndex+4*u.numGlyphs,y=u.vertexStartIndex;y<h;y+=4)t.indexArray.emplaceBack(y,y+1,y+2),t.indexArray.emplaceBack(y+1,y+2,y+3)},Fe.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var o=Math.sin(t),u=Math.cos(t),h=[],y=[],b=[],S=0;S<this.symbolInstances.length;++S){b.push(S);var P=this.symbolInstances.get(S);h.push(0|Math.round(o*P.anchorX+u*P.anchorY)),y.push(P.featureIndex)}return b.sort(function(k,z){return h[k]-h[z]||y[z]-y[k]}),b},Fe.prototype.addToSortKeyRanges=function(t,o){var u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})},Fe.prototype.sortFeatures=function(t){var o=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var u=0,h=this.symbolInstanceIndexes;u<h.length;u+=1){var y=this.symbolInstances.get(h[u]);this.featureSortOrder.push(y.featureIndex),[y.rightJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.leftJustifiedTextSymbolIndex].forEach(function(b,S,P){b>=0&&P.indexOf(b)===S&&o.addIndicesForPlacedSymbol(o.text,b)}),y.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,y.verticalPlacedTextSymbolIndex),y.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.placedIconSymbolIndex),y.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},yn("SymbolBucket",Fe,{omit:["layers","collisionBoxArray","features","compareText"]}),Fe.MAX_GLYPHS=65535,Fe.addDynamicAttributes=Ve;var nt=new es({"symbol-placement":new Ln(ce.layout_symbol["symbol-placement"]),"symbol-spacing":new Ln(ce.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ln(ce.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new wn(ce.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ln(ce.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ln(ce.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ln(ce.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ln(ce.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ln(ce.layout_symbol["icon-rotation-alignment"]),"icon-size":new wn(ce.layout_symbol["icon-size"]),"icon-text-fit":new Ln(ce.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ln(ce.layout_symbol["icon-text-fit-padding"]),"icon-image":new wn(ce.layout_symbol["icon-image"]),"icon-rotate":new wn(ce.layout_symbol["icon-rotate"]),"icon-padding":new Ln(ce.layout_symbol["icon-padding"]),"icon-keep-upright":new Ln(ce.layout_symbol["icon-keep-upright"]),"icon-offset":new wn(ce.layout_symbol["icon-offset"]),"icon-anchor":new wn(ce.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ln(ce.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ln(ce.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ln(ce.layout_symbol["text-rotation-alignment"]),"text-field":new wn(ce.layout_symbol["text-field"]),"text-font":new wn(ce.layout_symbol["text-font"]),"text-size":new wn(ce.layout_symbol["text-size"]),"text-max-width":new wn(ce.layout_symbol["text-max-width"]),"text-line-height":new Ln(ce.layout_symbol["text-line-height"]),"text-letter-spacing":new wn(ce.layout_symbol["text-letter-spacing"]),"text-justify":new wn(ce.layout_symbol["text-justify"]),"text-radial-offset":new wn(ce.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ln(ce.layout_symbol["text-variable-anchor"]),"text-anchor":new wn(ce.layout_symbol["text-anchor"]),"text-max-angle":new Ln(ce.layout_symbol["text-max-angle"]),"text-writing-mode":new Ln(ce.layout_symbol["text-writing-mode"]),"text-rotate":new wn(ce.layout_symbol["text-rotate"]),"text-padding":new Ln(ce.layout_symbol["text-padding"]),"text-keep-upright":new Ln(ce.layout_symbol["text-keep-upright"]),"text-transform":new wn(ce.layout_symbol["text-transform"]),"text-offset":new wn(ce.layout_symbol["text-offset"]),"text-allow-overlap":new Ln(ce.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ln(ce.layout_symbol["text-ignore-placement"]),"text-optional":new Ln(ce.layout_symbol["text-optional"])}),_e={paint:new es({"icon-opacity":new wn(ce.paint_symbol["icon-opacity"]),"icon-color":new wn(ce.paint_symbol["icon-color"]),"icon-halo-color":new wn(ce.paint_symbol["icon-halo-color"]),"icon-halo-width":new wn(ce.paint_symbol["icon-halo-width"]),"icon-halo-blur":new wn(ce.paint_symbol["icon-halo-blur"]),"icon-translate":new Ln(ce.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ln(ce.paint_symbol["icon-translate-anchor"]),"text-opacity":new wn(ce.paint_symbol["text-opacity"]),"text-color":new wn(ce.paint_symbol["text-color"],{runtimeType:Wr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new wn(ce.paint_symbol["text-halo-color"]),"text-halo-width":new wn(ce.paint_symbol["text-halo-width"]),"text-halo-blur":new wn(ce.paint_symbol["text-halo-blur"]),"text-translate":new Ln(ce.paint_symbol["text-translate"]),"text-translate-anchor":new Ln(ce.paint_symbol["text-translate-anchor"])}),layout:nt},Ue=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:cn,this.defaultValue=t};Ue.prototype.evaluate=function(t){if(t.formattedSection){var o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},Ue.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},Ue.prototype.outputDefined=function(){return!1},Ue.prototype.serialize=function(){return null},yn("FormatSectionOverride",Ue,{omit:["defaultValue"]});var Ae=function(t){function o(u){t.call(this,u,_e)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,h){if(t.prototype.recalculate.call(this,u,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var y=this.layout.get("text-writing-mode");if(y){for(var b=[],S=0,P=y;S<P.length;S+=1){var k=P[S];b.indexOf(k)<0&&b.push(k)}this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},o.prototype.getValueAndResolveTokens=function(u,h,y,b){var S=this.layout.get(u).evaluate(h,{},y,b),P=this._unevaluatedLayout._values[u];return P.isDataDriven()||Go(P.value)||!S?S:function(k,z){return z.replace(/{([^{}]+)}/g,function(Z,W){return W in k?String(k[W]):""})}(h.properties,S)},o.prototype.createBucket=function(u){return new Fe(u)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype._setPaintOverrides=function(){for(var u=0,h=_e.paint.overridableProperties;u<h.length;u+=1){var y=h[u];if(o.hasPaintOverride(this.layout,y)){var b,S=this.paint.get(y),P=new Ue(S),k=new dl(P,S.property.specification);b=S.value.kind==="constant"||S.value.kind==="source"?new el("source",k):new Ho("composite",k,S.value.zoomStops,S.value._interpolationType),this.paint._values[y]=new _s(S.property,b,S.parameters)}}},o.prototype._handleOverridablePaintPropertyUpdate=function(u,h,y){return!(!this.layout||h.isDataDriven()||y.isDataDriven())&&o.hasPaintOverride(this.layout,u)},o.hasPaintOverride=function(u,h){var y=u.get("text-field"),b=_e.paint.properties[h],S=!1,P=function(Z){for(var W=0,ee=Z;W<ee.length;W+=1)if(b.overrides&&b.overrides.hasOverride(ee[W]))return void(S=!0)};if(y.value.kind==="constant"&&y.value.value instanceof Pa)P(y.value.value.sections);else if(y.value.kind==="source"){var k=function(Z){S||(Z instanceof _o&&ta(Z.value)===ea?P(Z.value.sections):Z instanceof qo?P(Z.sections):Z.eachChild(k))},z=y.value;z._styleExpression&&k(z._styleExpression.expression)}return S},o}(wa),pt={paint:new es({"background-color":new Ln(ce.paint_background["background-color"]),"background-pattern":new xs(ce.paint_background["background-pattern"]),"background-opacity":new Ln(ce.paint_background["background-opacity"])})},_t=function(t){function o(u){t.call(this,u,pt)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(wa),vr={paint:new es({"raster-opacity":new Ln(ce.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ln(ce.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ln(ce.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ln(ce.paint_raster["raster-brightness-max"]),"raster-saturation":new Ln(ce.paint_raster["raster-saturation"]),"raster-contrast":new Ln(ce.paint_raster["raster-contrast"]),"raster-resampling":new Ln(ce.paint_raster["raster-resampling"]),"raster-fade-duration":new Ln(ce.paint_raster["raster-fade-duration"])})},jr=function(t){function o(u){t.call(this,u,vr)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(wa),Vr=function(t){function o(u){t.call(this,u,{}),this.implementation=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},o.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},o.prototype.recalculate=function(){},o.prototype.updateTransitions=function(){},o.prototype.hasTransition=function(){},o.prototype.serialize=function(){},o.prototype.onAdd=function(u){this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},o.prototype.onRemove=function(u){this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},o}(wa),nn={circle:Bl,heatmap:Mp,hillshade:sh,fill:Yf,"fill-extrusion":Sl,line:hh,symbol:Ae,background:_t,raster:jr},Nr=ae.HTMLImageElement,Cn=ae.HTMLCanvasElement,fn=ae.HTMLVideoElement,Sn=ae.ImageData,_n=ae.ImageBitmap,vn=function(t,o,u,h){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(o,h)};vn.prototype.update=function(t,o,u){var h=t.width,y=t.height,b=!(this.size&&this.size[0]===h&&this.size[1]===y||u),S=this.context,P=S.gl;if(this.useMipmap=Boolean(o&&o.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!o||o.premultiply!==!1)),b)this.size=[h,y],t instanceof Nr||t instanceof Cn||t instanceof fn||t instanceof Sn||_n&&t instanceof _n?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,t):P.texImage2D(P.TEXTURE_2D,0,this.format,h,y,0,this.format,P.UNSIGNED_BYTE,t.data);else{var k=u||{x:0,y:0},z=k.x,Z=k.y;t instanceof Nr||t instanceof Cn||t instanceof fn||t instanceof Sn||_n&&t instanceof _n?P.texSubImage2D(P.TEXTURE_2D,0,z,Z,P.RGBA,P.UNSIGNED_BYTE,t):P.texSubImage2D(P.TEXTURE_2D,0,z,Z,h,y,P.RGBA,P.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D)},vn.prototype.bind=function(t,o,u){var h=this.context.gl;h.bindTexture(h.TEXTURE_2D,this.texture),u!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=h.LINEAR),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,u||t),this.filter=t),o!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,o),this.wrap=o)},vn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},vn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Xn=function(t){var o=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){o._triggered=!1,o._callback()})};Xn.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},Xn.prototype.remove=function(){delete this._channel,this._callback=function(){}};var ya=function(t,o,u){this.target=t,this.parent=o,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},tr(["receive","process"],this),this.invoker=new Xn(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Br()?t:ae};function fs(t,o,u){var h=2*Math.PI*6378137/256/Math.pow(2,u);return[t*h-2*Math.PI*6378137/2,o*h-2*Math.PI*6378137/2]}ya.prototype.send=function(t,o,u,h,y){var b=this;y===void 0&&(y=!1);var S=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[S]=u);var P=Xe(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:t,hasCallback:!!u,targetMapId:h,mustQueue:y,sourceMapId:this.mapId,data:xu(o,P)},P),{cancel:function(){u&&delete b.callbacks[S],b.target.postMessage({id:S,type:"<cancel>",targetMapId:h,sourceMapId:b.mapId})}}},ya.prototype.receive=function(t){var o=t.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){delete this.tasks[u];var h=this.cancelCallbacks[u];delete this.cancelCallbacks[u],h&&h()}else Br()||o.mustQueue?(this.tasks[u]=o,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,o)},ya.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),o=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(t,o)}},ya.prototype.processTask=function(t,o){var u=this;if(o.type==="<response>"){var h=this.callbacks[t];delete this.callbacks[t],h&&(o.error?h(zs(o.error)):h(null,zs(o.data)))}else{var y=!1,b=Xe(this.globalScope)?void 0:[],S=o.hasCallback?function(Z,W){y=!0,delete u.cancelCallbacks[t],u.target.postMessage({id:t,type:"<response>",sourceMapId:u.mapId,error:Z?xu(Z):null,data:xu(W,b)},b)}:function(Z){y=!0},P=null,k=zs(o.data);if(this.parent[o.type])P=this.parent[o.type](o.sourceMapId,k,S);else if(this.parent.getWorkerSource){var z=o.type.split(".");P=this.parent.getWorkerSource(o.sourceMapId,z[0],k.source)[z[1]](k,S)}else S(new Error("Could not find function "+o.type));!y&&P&&P.cancel&&(this.cancelCallbacks[t]=P.cancel)}},ya.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var ja=function(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};ja.prototype.setNorthEast=function(t){return this._ne=t instanceof _a?new _a(t.lng,t.lat):_a.convert(t),this},ja.prototype.setSouthWest=function(t){return this._sw=t instanceof _a?new _a(t.lng,t.lat):_a.convert(t),this},ja.prototype.extend=function(t){var o,u,h=this._sw,y=this._ne;if(t instanceof _a)o=t,u=t;else{if(!(t instanceof ja))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(ja.convert(t)):this.extend(_a.convert(t)):this;if(u=t._ne,!(o=t._sw)||!u)return this}return h||y?(h.lng=Math.min(o.lng,h.lng),h.lat=Math.min(o.lat,h.lat),y.lng=Math.max(u.lng,y.lng),y.lat=Math.max(u.lat,y.lat)):(this._sw=new _a(o.lng,o.lat),this._ne=new _a(u.lng,u.lat)),this},ja.prototype.getCenter=function(){return new _a((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},ja.prototype.getSouthWest=function(){return this._sw},ja.prototype.getNorthEast=function(){return this._ne},ja.prototype.getNorthWest=function(){return new _a(this.getWest(),this.getNorth())},ja.prototype.getSouthEast=function(){return new _a(this.getEast(),this.getSouth())},ja.prototype.getWest=function(){return this._sw.lng},ja.prototype.getSouth=function(){return this._sw.lat},ja.prototype.getEast=function(){return this._ne.lng},ja.prototype.getNorth=function(){return this._ne.lat},ja.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},ja.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},ja.prototype.isEmpty=function(){return!(this._sw&&this._ne)},ja.prototype.contains=function(t){var o=_a.convert(t),u=o.lng,h=o.lat,y=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&y},ja.convert=function(t){return!t||t instanceof ja?t:new ja(t)};var _a=function(t,o){if(isNaN(t)||isNaN(o))throw new Error("Invalid LngLat object: ("+t+", "+o+")");if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};_a.prototype.wrap=function(){return new _a(sr(this.lng,-180,180),this.lat)},_a.prototype.toArray=function(){return[this.lng,this.lat]},_a.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},_a.prototype.distanceTo=function(t){var o=Math.PI/180,u=this.lat*o,h=t.lat*o,y=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((t.lng-this.lng)*o);return 63710088e-1*Math.acos(Math.min(y,1))},_a.prototype.toBounds=function(t){t===void 0&&(t=0);var o=360*t/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new ja(new _a(this.lng-u,this.lat-o),new _a(this.lng+u,this.lat+o))},_a.convert=function(t){if(t instanceof _a)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new _a(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new _a(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var fi=2*Math.PI*63710088e-1;function Hn(t){return fi*Math.cos(t*Math.PI/180)}function Vu(t){return(180+t)/360}function Gu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function mh(t,o){return t/Hn(o)}function Hu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var Hc=function(t,o,u){u===void 0&&(u=0),this.x=+t,this.y=+o,this.z=+u};Hc.fromLngLat=function(t,o){o===void 0&&(o=0);var u=_a.convert(t);return new Hc(Vu(u.lng),Gu(u.lat),mh(o,u.lat))},Hc.prototype.toLngLat=function(){return new _a(360*this.x-180,Hu(this.y))},Hc.prototype.toAltitude=function(){return this.z*Hn(Hu(this.y))},Hc.prototype.meterInMercatorCoordinateUnits=function(){return 1/fi*(t=Hu(this.y),1/Math.cos(t*Math.PI/180));var t};var Up=function(t,o,u){this.z=t,this.x=o,this.y=u,this.key=ed(0,t,t,o,u)};Up.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Up.prototype.url=function(t,o){var u,h,y,b,S,P=(h=this.y,y=this.z,b=fs(256*(u=this.x),256*(h=Math.pow(2,y)-h-1),y),S=fs(256*(u+1),256*(h+1),y),b[0]+","+b[1]+","+S[0]+","+S[1]),k=function(z,Z,W){for(var ee,ne="",Me=z;Me>0;Me--)ne+=(Z&(ee=1<<Me-1)?1:0)+(W&ee?2:0);return ne}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",k).replace("{bbox-epsg-3857}",P)},Up.prototype.getTilePoint=function(t){var o=Math.pow(2,this.z);return new se(8192*(t.x*o-this.x),8192*(t.y*o-this.y))},Up.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var yv=function(t,o){this.wrap=t,this.canonical=o,this.key=ed(t,o.z,o.z,o.x,o.y)},ps=function(t,o,u,h,y){this.overscaledZ=t,this.wrap=o,this.canonical=new Up(u,+h,+y),this.key=ed(o,t,u,h,y)};function ed(t,o,u,h,y){(t*=2)<0&&(t=-1*t-1);var b=1<<u;return(b*b*t+b*y+h).toString(36)+u.toString(36)+o.toString(36)}ps.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},ps.prototype.scaledTo=function(t){var o=this.canonical.z-t;return t>this.canonical.z?new ps(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ps(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)},ps.prototype.calculateScaledKey=function(t,o){var u=this.canonical.z-t;return t>this.canonical.z?ed(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y):ed(this.wrap*+o,t,t,this.canonical.x>>u,this.canonical.y>>u)},ps.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var o=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o},ps.prototype.children=function(t){if(this.overscaledZ>=t)return[new ps(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var o=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new ps(o,this.wrap,o,u,h),new ps(o,this.wrap,o,u+1,h),new ps(o,this.wrap,o,u,h+1),new ps(o,this.wrap,o,u+1,h+1)]},ps.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},ps.prototype.wrapped=function(){return new ps(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},ps.prototype.unwrapTo=function(t){return new ps(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},ps.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},ps.prototype.toUnwrapped=function(){return new yv(this.wrap,this.canonical)},ps.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},ps.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new Hc(t.x-this.wrap,t.y))},yn("CanonicalTileID",Up),yn("OverscaledTileID",ps,{omit:["posMatrix"]});var Af=function(t,o,u){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return Qe('"'+u+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=o.height;var h=this.dim=o.height-2;this.data=new Uint32Array(o.data.buffer),this.encoding=u||"mapbox";for(var y=0;y<h;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(h,y)]=this.data[this._idx(h-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,h)]=this.data[this._idx(y,h-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(h,-1)]=this.data[this._idx(h-1,0)],this.data[this._idx(-1,h)]=this.data[this._idx(0,h-1)],this.data[this._idx(h,h)]=this.data[this._idx(h-1,h-1)]};Af.prototype.get=function(t,o){var u=new Uint8Array(this.data.buffer),h=4*this._idx(t,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[h],u[h+1],u[h+2])},Af.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Af.prototype._idx=function(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)},Af.prototype._unpackMapbox=function(t,o,u){return(256*t*256+256*o+u)/10-1e4},Af.prototype._unpackTerrarium=function(t,o,u){return 256*t+o+u/256-32768},Af.prototype.getPixels=function(){return new zo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Af.prototype.backfillBorder=function(t,o,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var h=o*this.dim,y=o*this.dim+this.dim,b=u*this.dim,S=u*this.dim+this.dim;switch(o){case-1:h=y-1;break;case 1:y=h+1}switch(u){case-1:b=S-1;break;case 1:S=b+1}for(var P=-o*this.dim,k=-u*this.dim,z=b;z<S;z++)for(var Z=h;Z<y;Z++)this.data[this._idx(Z,z)]=t.data[this._idx(Z+P,z+k)]},yn("DEMData",Af);var Od=function(t){this._stringToNumber={},this._numberToString=[];for(var o=0;o<t.length;o++){var u=t[o];this._stringToNumber[u]=o,this._numberToString[o]=u}};Od.prototype.encode=function(t){return this._stringToNumber[t]},Od.prototype.decode=function(t){return this._numberToString[t]};var Rd=function(t,o,u,h,y){this.type="Feature",this._vectorTileFeature=t,t._z=o,t._x=u,t._y=h,this.properties=t.properties,this.id=y},_0={geometry:{configurable:!0}};_0.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},_0.geometry.set=function(t){this._geometry=t},Rd.prototype.toJSON=function(){var t={geometry:this.geometry};for(var o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(t[o]=this[o]);return t},Object.defineProperties(Rd.prototype,_0);var gh=function(){this.state={},this.stateChanges={},this.deletedStates={}};gh.prototype.updateState=function(t,o,u){var h=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},At(this.stateChanges[t][h],u),this.deletedStates[t]===null)for(var y in this.deletedStates[t]={},this.state[t])y!==h&&(this.deletedStates[t][y]=null);else if(this.deletedStates[t]&&this.deletedStates[t][h]===null)for(var b in this.deletedStates[t][h]={},this.state[t][h])u[b]||(this.deletedStates[t][h][b]=null);else for(var S in u)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][S]===null&&delete this.deletedStates[t][h][S]},gh.prototype.removeFeatureState=function(t,o,u){if(this.deletedStates[t]!==null){var h=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&o!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][u]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(u in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][u]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}},gh.prototype.getState=function(t,o){var u=String(o),h=At({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var y=this.deletedStates[t][o];if(y===null)return{};for(var b in y)delete h[b]}return h},gh.prototype.initializeTileState=function(t,o){t.setFeatureState(this.state,o)},gh.prototype.coalesceChanges=function(t,o){var u={};for(var h in this.stateChanges){this.state[h]=this.state[h]||{};var y={};for(var b in this.stateChanges[h])this.state[h][b]||(this.state[h][b]={}),At(this.state[h][b],this.stateChanges[h][b]),y[b]=this.state[h][b];u[h]=y}for(var S in this.deletedStates){this.state[S]=this.state[S]||{};var P={};if(this.deletedStates[S]===null)for(var k in this.state[S])P[k]={},this.state[S][k]={};else for(var z in this.deletedStates[S]){if(this.deletedStates[S][z]===null)this.state[S][z]={};else for(var Z=0,W=Object.keys(this.deletedStates[S][z]);Z<W.length;Z+=1)delete this.state[S][z][W[Z]];P[z]=this.state[S][z]}u[S]=u[S]||{},At(u[S],P)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(var ee in t)t[ee].setFeatureState(u,o)};var Wc=function(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new nl(8192,16,0),this.grid3D=new nl(8192,16,0),this.featureIndexArray=new X,this.promoteId=o};function _v(t,o,u,h,y){return $t(t,function(b,S){var P=o instanceof Vs?o.get(S):null;return P&&P.evaluate?P.evaluate(u,h,y):P})}function xv(t){for(var o=1/0,u=1/0,h=-1/0,y=-1/0,b=0,S=t;b<S.length;b+=1){var P=S[b];o=Math.min(o,P.x),u=Math.min(u,P.y),h=Math.max(h,P.x),y=Math.max(y,P.y)}return{minX:o,minY:u,maxX:h,maxY:y}}function ym(t,o){return o-t}Wc.prototype.insert=function(t,o,u,h,y,b){var S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,y);for(var P=b?this.grid3D:this.grid,k=0;k<o.length;k++){for(var z=o[k],Z=[1/0,1/0,-1/0,-1/0],W=0;W<z.length;W++){var ee=z[W];Z[0]=Math.min(Z[0],ee.x),Z[1]=Math.min(Z[1],ee.y),Z[2]=Math.max(Z[2],ee.x),Z[3]=Math.max(Z[3],ee.y)}Z[0]<8192&&Z[1]<8192&&Z[2]>=0&&Z[3]>=0&&P.insert(S,Z[0],Z[1],Z[2],Z[3])}},Wc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Mu.VectorTile(new Jf(this.rawTileData)).layers,this.sourceLayerCoder=new Od(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Wc.prototype.query=function(t,o,u,h){var y=this;this.loadVTLayers();for(var b=t.params||{},S=8192/t.tileSize/t.scale,P=Oc(b.filter),k=t.queryGeometry,z=t.queryPadding*S,Z=xv(k),W=this.grid.query(Z.minX-z,Z.minY-z,Z.maxX+z,Z.maxY+z),ee=xv(t.cameraQueryGeometry),ne=this.grid3D.query(ee.minX-z,ee.minY-z,ee.maxX+z,ee.maxY+z,function(Zt,Wt,lr,Lr){return function(zr,Pn,pn,zn,mn){for(var Mi=0,ti=zr;Mi<ti.length;Mi+=1){var In=ti[Mi];if(Pn<=In.x&&pn<=In.y&&zn>=In.x&&mn>=In.y)return!0}var ji=[new se(Pn,pn),new se(Pn,mn),new se(zn,mn),new se(zn,pn)];if(zr.length>2){for(var Ci=0,Wi=ji;Ci<Wi.length;Ci+=1)if(wu(zr,Wi[Ci]))return!0}for(var An=0;An<zr.length-1;An++)if(oc(zr[An],zr[An+1],ji))return!0;return!1}(t.cameraQueryGeometry,Zt-z,Wt-z,lr+z,Lr+z)}),Me=0,Oe=ne;Me<Oe.length;Me+=1)W.push(Oe[Me]);W.sort(ym);for(var Ye,Ze={},st=function(Zt){var Wt=W[Zt];if(Wt!==Ye){Ye=Wt;var lr=y.featureIndexArray.get(Wt),Lr=null;y.loadMatchingFeature(Ze,lr.bucketIndex,lr.sourceLayerIndex,lr.featureIndex,P,b.layers,b.availableImages,o,u,h,function(zr,Pn,pn){return Lr||(Lr=ro(zr)),Pn.queryIntersectsFeature(k,zr,pn,Lr,y.z,t.transform,S,t.pixelPosMatrix)})}},Ct=0;Ct<W.length;Ct++)st(Ct);return Ze},Wc.prototype.loadMatchingFeature=function(t,o,u,h,y,b,S,P,k,z,Z){var W=this.bucketLayerIDs[o];if(!b||function(zr,Pn){for(var pn=0;pn<zr.length;pn++)if(Pn.indexOf(zr[pn])>=0)return!0;return!1}(b,W)){var ee=this.sourceLayerCoder.decode(u),ne=this.vtLayers[ee].feature(h);if(y.needGeometry){var Me=Za(ne,!0);if(!y.filter(new Li(this.tileID.overscaledZ),Me,this.tileID.canonical))return}else if(!y.filter(new Li(this.tileID.overscaledZ),ne))return;for(var Oe=this.getId(ne,ee),Ye=0;Ye<W.length;Ye++){var Ze=W[Ye];if(!(b&&b.indexOf(Ze)<0)){var st=P[Ze];if(st){var Ct={};Oe!==void 0&&z&&(Ct=z.getState(st.sourceLayer||"_geojsonTileLayer",Oe));var Zt=At({},k[Ze]);Zt.paint=_v(Zt.paint,st.paint,ne,Ct,S),Zt.layout=_v(Zt.layout,st.layout,ne,Ct,S);var Wt=!Z||Z(ne,st,Ct);if(Wt){var lr=new Rd(ne,this.z,this.x,this.y,Oe);lr.layer=Zt;var Lr=t[Ze];Lr===void 0&&(Lr=t[Ze]=[]),Lr.push({featureIndex:h,feature:lr,intersectionZ:Wt})}}}}}},Wc.prototype.lookupSymbolFeatures=function(t,o,u,h,y,b,S,P){var k={};this.loadVTLayers();for(var z=Oc(y),Z=0,W=t;Z<W.length;Z+=1)this.loadMatchingFeature(k,u,h,W[Z],z,b,S,P,o);return k},Wc.prototype.hasLayer=function(t){for(var o=0,u=this.bucketLayerIDs;o<u.length;o+=1)for(var h=0,y=u[o];h<y.length;h+=1)if(t===y[h])return!0;return!1},Wc.prototype.getId=function(t,o){var u=t.id;return this.promoteId&&typeof(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]])=="boolean"&&(u=Number(u)),u},yn("FeatureIndex",Wc,{omit:["rawTileData","sourceLayerCoder"]});var Ms=function(t,o){this.tileID=t,this.uid=It(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Ms.prototype.registerFadeDuration=function(t){var o=t+this.timeAdded;o<Ki.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)},Ms.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Ms.prototype.loadVectorData=function(t,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var h in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(z,Z){var W={};if(!Z)return W;for(var ee=function(){var Oe=Me[ne],Ye=Oe.layerIds.map(function(Ct){return Z.getLayer(Ct)}).filter(Boolean);if(Ye.length!==0){Oe.layers=Ye,Oe.stateDependentLayerIds&&(Oe.stateDependentLayers=Oe.stateDependentLayerIds.map(function(Ct){return Ye.filter(function(Zt){return Zt.id===Ct})[0]}));for(var Ze=0,st=Ye;Ze<st.length;Ze+=1)W[st[Ze].id]=Oe}},ne=0,Me=z;ne<Me.length;ne+=1)ee();return W}(t.buckets,o.style),this.hasSymbolBuckets=!1,this.buckets){var y=this.buckets[h];if(y instanceof Fe){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var b in this.buckets){var S=this.buckets[b];if(S instanceof Fe&&S.hasRTLText){this.hasRTLText=!0,Rs.isLoading()||Rs.isLoaded()||Ap()!=="deferred"||tu();break}}for(var P in this.queryPadding=0,this.buckets){var k=this.buckets[P];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(P).queryRadius(k))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new f},Ms.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Ms.prototype.getBucket=function(t){return this.buckets[t.id]},Ms.prototype.upload=function(t){for(var o in this.buckets){var u=this.buckets[o];u.uploadPending()&&u.upload(t)}var h=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new vn(t,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new vn(t,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)},Ms.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},Ms.prototype.queryRenderedFeatures=function(t,o,u,h,y,b,S,P,k,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:y,scale:b,tileSize:this.tileSize,pixelPosMatrix:z,transform:P,params:S,queryPadding:this.queryPadding*k},t,o,u):{}},Ms.prototype.querySourceFeatures=function(t,o){var u=this.latestFeatureIndex;if(u&&u.rawTileData){var h=u.loadVTLayers(),y=o?o.sourceLayer:"",b=h._geojsonTileLayer||h[y];if(b)for(var S=Oc(o&&o.filter),P=this.tileID.canonical,k=P.z,z=P.x,Z=P.y,W={z:k,x:z,y:Z},ee=0;ee<b.length;ee++){var ne=b.feature(ee);if(S.needGeometry){var Me=Za(ne,!0);if(!S.filter(new Li(this.tileID.overscaledZ),Me,this.tileID.canonical))continue}else if(!S.filter(new Li(this.tileID.overscaledZ),ne))continue;var Oe=u.getId(ne,y),Ye=new Rd(ne,k,z,Z,Oe);Ye.tile=W,t.push(Ye)}}},Ms.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Ms.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Ms.prototype.setExpiryData=function(t){var o=this.expirationTime;if(t.cacheControl){var u=Jr(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var h=Date.now(),y=!1;if(this.expirationTime>h)y=!1;else if(o)if(this.expirationTime<o)y=!0;else{var b=this.expirationTime-o;b?this.expirationTime=h+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Ms.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Ms.prototype.setFeatureState=function(t,o){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var u=this.latestFeatureIndex.loadVTLayers();for(var h in this.buckets)if(o.style.hasLayer(h)){var y=this.buckets[h],b=y.layers[0].sourceLayer||"_geojsonTileLayer",S=u[b],P=t[b];if(S&&P&&Object.keys(P).length!==0){y.update(P,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});var k=o&&o.style&&o.style.getLayer(h);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(y)))}}}},Ms.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Ms.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ki.now()},Ms.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Ms.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=Ki.now()+t},Ms.prototype.setDependencies=function(t,o){for(var u={},h=0,y=o;h<y.length;h+=1)u[y[h]]=!0;this.dependencies[t]=u},Ms.prototype.hasDependency=function(t,o){for(var u=0,h=t;u<h.length;u+=1){var y=this.dependencies[h[u]];if(y){for(var b=0,S=o;b<S.length;b+=1)if(y[S[b]])return!0}}return!1};var ep=ae.performance,bv=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},ep.mark(this._marks.start)};bv.prototype.finish=function(){ep.mark(this._marks.end);var t=ep.getEntriesByName(this._marks.measure);return t.length===0&&(ep.measure(this._marks.measure,this._marks.start,this._marks.end),t=ep.getEntriesByName(this._marks.measure),ep.clearMarks(this._marks.start),ep.clearMarks(this._marks.end),ep.clearMeasures(this._marks.measure)),t},m.Actor=ya,m.AlphaImage=Tu,m.CanonicalTileID=Up,m.CollisionBoxArray=f,m.Color=Gi,m.DEMData=Af,m.DataConstantProperty=Ln,m.DictionaryCoder=Od,m.EXTENT=8192,m.ErrorEvent=Ge,m.EvaluationParameters=Li,m.Event=Ie,m.Evented=rt,m.FeatureIndex=Wc,m.FillBucket=au,m.FillExtrusionBucket=ul,m.ImageAtlas=Ar,m.ImagePosition=ut,m.LineBucket=Sa,m.LngLat=_a,m.LngLatBounds=ja,m.MercatorCoordinate=Hc,m.ONE_EM=24,m.OverscaledTileID=ps,m.Point=se,m.Point$1=se,m.Properties=es,m.Protobuf=Jf,m.RGBAImage=zo,m.RequestManager=ki,m.RequestPerformance=bv,m.ResourceType=an,m.SegmentVector=fe,m.SourceFeatureState=gh,m.StructArrayLayout1ui2=Tp,m.StructArrayLayout2f1f2i16=yl,m.StructArrayLayout2i4=Ll,m.StructArrayLayout3ui6=ol,m.StructArrayLayout4i8=Su,m.SymbolBucket=Fe,m.Texture=vn,m.Tile=Ms,m.Transitionable=mo,m.Uniform1f=Ir,m.Uniform1i=rr,m.Uniform2f=Or,m.Uniform3f=ln,m.Uniform4f=Bn,m.UniformColor=Dn,m.UniformMatrix4f=Ni,m.UnwrappedTileID=yv,m.ValidationError=De,m.WritingMode=Zr,m.ZoomHistory=zf,m.add=function(t,o,u){return t[0]=o[0]+u[0],t[1]=o[1]+u[1],t[2]=o[2]+u[2],t},m.addDynamicAttributes=Ve,m.asyncAll=function(t,o,u){if(!t.length)return u(null,[]);var h=t.length,y=new Array(t.length),b=null;t.forEach(function(S,P){o(S,function(k,z){k&&(b=k),y[P]=z,--h==0&&u(b,y)})})},m.bezier=Le,m.bindAll=tr,m.browser=Ki,m.cacheEntryPossiblyAdded=function(t){++li>Mr&&(t.getActor().send("enforceCacheSizeLimit",or),li=0)},m.clamp=Vt,m.clearTileCache=function(t){var o=ae.caches.delete("mapbox-tiles");t&&o.catch(t).then(function(){return t()})},m.clipLine=Oo,m.clone=function(t){var o=new la(16);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},m.clone$1=Je,m.clone$2=function(t){var o=new la(3);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o},m.collisionCircleLayout=Pd,m.config=Zn,m.create=function(){var t=new la(16);return la!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},m.create$1=function(){var t=new la(9);return la!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},m.create$2=function(){var t=new la(4);return la!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},m.createCommonjsModule=ve,m.createExpression=Lu,m.createLayout=Oa,m.createStyleLayer=function(t){return t.type==="custom"?new Vr(t):new nn[t.type](t)},m.cross=function(t,o,u){var h=o[0],y=o[1],b=o[2],S=u[0],P=u[1],k=u[2];return t[0]=y*k-b*P,t[1]=b*S-h*k,t[2]=h*P-y*S,t},m.deepEqual=function t(o,u){if(Array.isArray(o)){if(!Array.isArray(u)||o.length!==u.length)return!1;for(var h=0;h<o.length;h++)if(!t(o[h],u[h]))return!1;return!0}if(typeof o=="object"&&o!==null&&u!==null){if(typeof u!="object"||Object.keys(o).length!==Object.keys(u).length)return!1;for(var y in o)if(!t(o[y],u[y]))return!1;return!0}return o===u},m.dot=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]},m.dot$1=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]+t[3]*o[3]},m.ease=it,m.emitValidationErrors=ec,m.endsWith=Y,m.enforceCacheSizeLimit=function(t){I(),$i&&$i.then(function(o){o.keys().then(function(u){for(var h=0;h<u.length-t;h++)o.delete(u[h])})})},m.evaluateSizeForFeature=Qn,m.evaluateSizeForZoom=hi,m.evaluateVariableOffset=Cl,m.evented=Zf,m.extend=At,m.featureFilter=Oc,m.filterObject=gt,m.fromRotation=function(t,o){var u=Math.sin(o),h=Math.cos(o);return t[0]=h,t[1]=u,t[2]=0,t[3]=-u,t[4]=h,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},m.getAnchorAlignment=Yr,m.getAnchorJustification=we,m.getArrayBuffer=ka,m.getImage=$,m.getJSON=function(t,o){return xa(At(t,{type:"json"}),o)},m.getRTLTextPluginStatus=Ap,m.getReferrer=Ii,m.getVideo=function(t,o){var u,h,y=ae.document.createElement("video");y.muted=!0,y.onloadstart=function(){o(null,y)};for(var b=0;b<t.length;b++){var S=ae.document.createElement("source");u=t[b],h=void 0,(h=ae.document.createElement("a")).href=u,(h.protocol!==ae.document.location.protocol||h.host!==ae.document.location.host)&&(y.crossOrigin="Anonymous"),S.src=t[b],y.appendChild(S)}return{cancel:function(){}}},m.identity=ts,m.invert=function(t,o){var u=o[0],h=o[1],y=o[2],b=o[3],S=o[4],P=o[5],k=o[6],z=o[7],Z=o[8],W=o[9],ee=o[10],ne=o[11],Me=o[12],Oe=o[13],Ye=o[14],Ze=o[15],st=u*P-h*S,Ct=u*k-y*S,Zt=u*z-b*S,Wt=h*k-y*P,lr=h*z-b*P,Lr=y*z-b*k,zr=Z*Oe-W*Me,Pn=Z*Ye-ee*Me,pn=Z*Ze-ne*Me,zn=W*Ye-ee*Oe,mn=W*Ze-ne*Oe,Mi=ee*Ze-ne*Ye,ti=st*Mi-Ct*mn+Zt*zn+Wt*pn-lr*Pn+Lr*zr;return ti?(t[0]=(P*Mi-k*mn+z*zn)*(ti=1/ti),t[1]=(y*mn-h*Mi-b*zn)*ti,t[2]=(Oe*Lr-Ye*lr+Ze*Wt)*ti,t[3]=(ee*lr-W*Lr-ne*Wt)*ti,t[4]=(k*pn-S*Mi-z*Pn)*ti,t[5]=(u*Mi-y*pn+b*Pn)*ti,t[6]=(Ye*Zt-Me*Lr-Ze*Ct)*ti,t[7]=(Z*Lr-ee*Zt+ne*Ct)*ti,t[8]=(S*mn-P*pn+z*zr)*ti,t[9]=(h*pn-u*mn-b*zr)*ti,t[10]=(Me*lr-Oe*Zt+Ze*st)*ti,t[11]=(W*Zt-Z*lr-ne*st)*ti,t[12]=(P*Pn-S*zn-k*zr)*ti,t[13]=(u*zn-h*Pn+y*zr)*ti,t[14]=(Oe*Ct-Me*Wt-Ye*st)*ti,t[15]=(Z*Wt-W*Ct+ee*st)*ti,t):null},m.isChar=Kr,m.isMapboxURL=Ai,m.keysDifference=function(t,o){var u=[];for(var h in t)h in o||u.push(h);return u},m.makeRequest=xa,m.mapObject=$t,m.mercatorXfromLng=Vu,m.mercatorYfromLat=Gu,m.mercatorZfromAltitude=mh,m.mul=sc,m.multiply=rs,m.mvt=Mu,m.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},m.normalize=function(t,o){var u=o[0],h=o[1],y=o[2],b=u*u+h*h+y*y;return b>0&&(b=1/Math.sqrt(b)),t[0]=o[0]*b,t[1]=o[1]*b,t[2]=o[2]*b,t},m.number=oa,m.offscreenCanvasSupported=jn,m.ortho=function(t,o,u,h,y,b,S){var P=1/(o-u),k=1/(h-y),z=1/(b-S);return t[0]=-2*P,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*k,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*z,t[11]=0,t[12]=(o+u)*P,t[13]=(y+h)*k,t[14]=(S+b)*z,t[15]=1,t},m.parseGlyphPBF=function(t){return new Jf(t).readFields(kr,[])},m.pbf=Jf,m.performSymbolLayout=function(t,o,u,h,y,b,S){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var P=t.layers[0].layout,k=t.layers[0]._unevaluatedLayout._values,z={};if(t.textSizeData.kind==="composite"){var Z=t.textSizeData,W=Z.maxZoom;z.compositeTextSizes=[k["text-size"].possiblyEvaluate(new Li(Z.minZoom),S),k["text-size"].possiblyEvaluate(new Li(W),S)]}if(t.iconSizeData.kind==="composite"){var ee=t.iconSizeData,ne=ee.maxZoom;z.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new Li(ee.minZoom),S),k["icon-size"].possiblyEvaluate(new Li(ne),S)]}z.layoutTextSize=k["text-size"].possiblyEvaluate(new Li(t.zoom+1),S),z.layoutIconSize=k["icon-size"].possiblyEvaluate(new Li(t.zoom+1),S),z.textMaxSize=k["text-size"].possiblyEvaluate(new Li(18));for(var Me=24*P.get("text-line-height"),Oe=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",Ye=P.get("text-keep-upright"),Ze=P.get("text-size"),st=function(){var Wt=Zt[Ct],lr=P.get("text-font").evaluate(Wt,{},S).join(","),Lr=Ze.evaluate(Wt,{},S),zr=z.layoutTextSize.evaluate(Wt,{},S),Pn=z.layoutIconSize.evaluate(Wt,{},S),pn={horizontal:{},vertical:void 0},zn=Wt.text,mn=[0,0];if(zn){var Mi=zn.toString(),ti=24*P.get("text-letter-spacing").evaluate(Wt,{},S),In=function(qi){for(var Va=0,V=qi;Va<V.length;Va+=1)if(na=V[Va].charCodeAt(0),Kr.Arabic(na)||Kr["Arabic Supplement"](na)||Kr["Arabic Extended-A"](na)||Kr["Arabic Presentation Forms-A"](na)||Kr["Arabic Presentation Forms-B"](na))return!1;var na;return!0}(Mi)?ti:0,ji=P.get("text-anchor").evaluate(Wt,{},S),Ci=P.get("text-variable-anchor");if(!Ci){var Wi=P.get("text-radial-offset").evaluate(Wt,{},S);mn=Wi?Cl(ji,[24*Wi,Ro]):P.get("text-offset").evaluate(Wt,{},S).map(function(qi){return 24*qi})}var An=Oe?"center":P.get("text-justify").evaluate(Wt,{},S),ca=P.get("symbol-placement"),no=ca==="point"?24*P.get("text-max-width").evaluate(Wt,{},S):0,So=function(){t.allowVerticalPlacement&&hf(Mi)&&(pn.vertical=Qr(zn,o,u,y,lr,no,Me,ji,"left",In,mn,Zr.vertical,!0,ca,zr,Lr))};if(!Oe&&Ci){for(var ho=An==="auto"?Ci.map(function(qi){return we(qi)}):[An],io=!1,Lo=0;Lo<ho.length;Lo++){var hs=ho[Lo];if(!pn.horizontal[hs])if(io)pn.horizontal[hs]=pn.horizontal[0];else{var ds=Qr(zn,o,u,y,lr,no,Me,"center",hs,In,mn,Zr.horizontal,!1,ca,zr,Lr);ds&&(pn.horizontal[hs]=ds,io=ds.positionedLines.length===1)}}So()}else{An==="auto"&&(An=we(ji));var Xs=Qr(zn,o,u,y,lr,no,Me,ji,An,In,mn,Zr.horizontal,!1,ca,zr,Lr);Xs&&(pn.horizontal[An]=Xs),So(),hf(Mi)&&Oe&&Ye&&(pn.vertical=Qr(zn,o,u,y,lr,no,Me,ji,An,In,mn,Zr.vertical,!1,ca,zr,Lr))}}var Ta=void 0,Ys=!1;if(Wt.icon&&Wt.icon.name){var di=h[Wt.icon.name];di&&(Ta=function(qi,Va,V){var na=Yr(V),qs=Va[0]-qi.displaySize[0]*na.horizontalAlign,Ps=Va[1]-qi.displaySize[1]*na.verticalAlign;return{image:qi,top:Ps,bottom:Ps+qi.displaySize[1],left:qs,right:qs+qi.displaySize[0]}}(y[Wt.icon.name],P.get("icon-offset").evaluate(Wt,{},S),P.get("icon-anchor").evaluate(Wt,{},S)),Ys=di.sdf,t.sdfIcons===void 0?t.sdfIcons=di.sdf:t.sdfIcons!==di.sdf&&Qe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(di.pixelRatio!==t.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var Cs=bt(pn.horizontal)||pn.vertical;t.iconsInText=!!Cs&&Cs.iconsInText,(Cs||Ta)&&function(qi,Va,V,na,qs,Ps,$a,jo,Is,fa,mu){var Pu=Ps.textMaxSize.evaluate(Va,{});Pu===void 0&&(Pu=$a);var Vl,ko=qi.layers[0].layout,Gl=ko.get("icon-offset").evaluate(Va,{},mu),ll=bt(V.horizontal),tp=$a/24,vc=qi.tilePixelRatio*tp,Zp=qi.tilePixelRatio*Pu/24,Xc=qi.tilePixelRatio*jo,rp=qi.tilePixelRatio*ko.get("symbol-spacing"),yh=ko.get("text-padding")*qi.tilePixelRatio,np=ko.get("icon-padding")*qi.tilePixelRatio,jp=ko.get("text-max-angle")/180*Math.PI,_h=ko.get("text-rotation-alignment")==="map"&&ko.get("symbol-placement")!=="point",wf=ko.get("icon-rotation-alignment")==="map"&&ko.get("symbol-placement")!=="point",mc=ko.get("symbol-placement"),Vp=rp/2,ip=ko.get("icon-text-fit");na&&ip!=="none"&&(qi.allowVerticalPlacement&&V.vertical&&(Vl=ai(na,V.vertical,ip,ko.get("icon-text-fit-padding"),Gl,tp)),ll&&(na=ai(na,ll,ip,ko.get("icon-text-fit-padding"),Gl,tp)));var Tf=function(E0,Wp){Wp.x<0||Wp.x>=8192||Wp.y<0||Wp.y>=8192||function(Do,wl,S0,qc,rd,Fd,wh,Hl,Th,Xp,Mh,Ph,nd,Bd,Yp,Ks,Nd,zd,Ud,Zd,Iu,Ih,jd,Wl,C0){var Vd,If,up,lp,cp,fp=Do.addToLineVertexArray(wl,S0),A0=0,w0=0,T0=0,M0=0,id=-1,Gd=-1,Kc={},Hd=be(""),ad=0,od=0;if(Hl._unevaluatedLayout.getValue("text-radial-offset")===void 0?(ad=(Vd=Hl.layout.get("text-offset").evaluate(Iu,{},Wl).map(function(qp){return 24*qp}))[0],od=Vd[1]):(ad=24*Hl.layout.get("text-radial-offset").evaluate(Iu,{},Wl),od=Ro),Do.allowVerticalPlacement&&qc.vertical){var Wd=Hl.layout.get("text-rotate").evaluate(Iu,{},Wl)+90;lp=new Zo(Th,wl,Xp,Mh,Ph,qc.vertical,nd,Bd,Yp,Wd),wh&&(cp=new Zo(Th,wl,Xp,Mh,Ph,wh,Nd,zd,Yp,Wd))}if(rd){var pp=Hl.layout.get("icon-rotate").evaluate(Iu,{}),Xd=Hl.layout.get("icon-text-fit")!=="none",P0=is(rd,pp,jd,Xd),Yd=wh?is(wh,pp,jd,Xd):void 0;up=new Zo(Th,wl,Xp,Mh,Ph,rd,Nd,zd,!1,pp),A0=4*P0.length;var I0=Do.iconSizeData,Oh=null;I0.kind==="source"?(Oh=[128*Hl.layout.get("icon-size").evaluate(Iu,{})])[0]>32640&&Qe(Do.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):I0.kind==="composite"&&((Oh=[128*Ih.compositeIconSizes[0].evaluate(Iu,{},Wl),128*Ih.compositeIconSizes[1].evaluate(Iu,{},Wl)])[0]>32640||Oh[1]>32640)&&Qe(Do.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Do.addSymbols(Do.icon,P0,Oh,Zd,Ud,Iu,!1,wl,fp.lineStartIndex,fp.lineLength,-1,Wl),id=Do.icon.placedSymbolArray.length-1,Yd&&(w0=4*Yd.length,Do.addSymbols(Do.icon,Yd,Oh,Zd,Ud,Iu,Zr.vertical,wl,fp.lineStartIndex,fp.lineLength,-1,Wl),Gd=Do.icon.placedSymbolArray.length-1)}for(var O0 in qc.horizontal){var sd=qc.horizontal[O0];if(!If){Hd=be(sd.text);var Ev=Hl.layout.get("text-rotate").evaluate(Iu,{},Wl);If=new Zo(Th,wl,Xp,Mh,Ph,sd,nd,Bd,Yp,Ev)}var R0=sd.positionedLines.length===1;if(T0+=Ut(Do,wl,sd,Fd,Hl,Yp,Iu,Ks,fp,qc.vertical?Zr.horizontal:Zr.horizontalOnly,R0?Object.keys(qc.horizontal):[O0],Kc,id,Ih,Wl),R0)break}qc.vertical&&(M0+=Ut(Do,wl,qc.vertical,Fd,Hl,Yp,Iu,Ks,fp,Zr.vertical,["vertical"],Kc,Gd,Ih,Wl));var Sv=If?If.boxStartIndex:Do.collisionBoxArray.length,Cv=If?If.boxEndIndex:Do.collisionBoxArray.length,Av=lp?lp.boxStartIndex:Do.collisionBoxArray.length,wv=lp?lp.boxEndIndex:Do.collisionBoxArray.length,Tv=up?up.boxStartIndex:Do.collisionBoxArray.length,Mv=up?up.boxEndIndex:Do.collisionBoxArray.length,Pv=cp?cp.boxStartIndex:Do.collisionBoxArray.length,Iv=cp?cp.boxEndIndex:Do.collisionBoxArray.length,yc=-1,hp=function(qp,qd){return qp&&qp.circleDiameter?Math.max(qp.circleDiameter,qd):qd};yc=hp(If,yc),yc=hp(lp,yc),yc=hp(up,yc);var $c=(yc=hp(cp,yc))>-1?1:0;$c&&(yc*=C0/24),Do.glyphOffsetArray.length>=Fe.MAX_GLYPHS&&Qe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Iu.sortKey!==void 0&&Do.addToSortKeyRanges(Do.symbolInstances.length,Iu.sortKey),Do.symbolInstances.emplaceBack(wl.x,wl.y,Kc.right>=0?Kc.right:-1,Kc.center>=0?Kc.center:-1,Kc.left>=0?Kc.left:-1,Kc.vertical||-1,id,Gd,Hd,Sv,Cv,Av,wv,Tv,Mv,Pv,Iv,Xp,T0,M0,A0,w0,$c,0,nd,ad,od,yc)}(qi,Wp,E0,V,na,qs,Vl,qi.layers[0],qi.collisionBoxArray,Va.index,Va.sourceLayerIndex,qi.index,vc,yh,_h,Is,Xc,np,wf,Gl,Va,Ps,fa,mu,$a)};if(mc==="line")for(var Gp=0,xh=Oo(Va.geometry,0,0,8192,8192);Gp<xh.length;Gp+=1)for(var td=xh[Gp],gc=0,bh=ns(td,rp,jp,V.vertical||ll,na,24,Zp,qi.overscaling,8192);gc<bh.length;gc+=1){var Al=bh[gc];ll&&gn(qi,ll.text,Vp,Al)||Tf(td,Al)}else if(mc==="line-center")for(var Eh=0,Sh=Va.geometry;Eh<Sh.length;Eh+=1){var Ch=Sh[Eh];if(Ch.length>1){var Mf=Ka(Ch,jp,V.vertical||ll,na,24,Zp);Mf&&Tf(Ch,Mf)}}else if(Va.type==="Polygon")for(var ap=0,Ah=Hf(Va.geometry,0);ap<Ah.length;ap+=1){var op=Ah[ap],sp=ii(op,16);Tf(op[0],new qr(sp.x,sp.y,0))}else if(Va.type==="LineString")for(var Pf=0,Hp=Va.geometry;Pf<Hp.length;Pf+=1){var Yc=Hp[Pf];Tf(Yc,new qr(Yc[0].x,Yc[0].y,0))}else if(Va.type==="Point")for(var x0=0,b0=Va.geometry;x0<b0.length;x0+=1)for(var Ld=0,kd=b0[x0];Ld<kd.length;Ld+=1){var Dd=kd[Ld];Tf([Dd],new qr(Dd.x,Dd.y,0))}}(t,Wt,pn,Ta,h,z,zr,Pn,mn,Ys,S)},Ct=0,Zt=t.features;Ct<Zt.length;Ct+=1)st();b&&t.generateCollisionDebugBuffers()},m.perspective=function(t,o,u,h,y){var b,S=1/Math.tan(o/2);return t[0]=S/u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=S,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,y!=null&&y!==1/0?(t[10]=(y+h)*(b=1/(h-y)),t[14]=2*y*h*b):(t[10]=-1,t[14]=-2*h),t},m.pick=function(t,o){for(var u={},h=0;h<o.length;h++){var y=o[h];y in t&&(u[y]=t[y])}return u},m.plugin=Rs,m.polygonIntersectsPolygon=Nu,m.postMapLoadEvent=jt,m.postTurnstileEvent=Xa,m.potpack=Pr,m.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],m.register=yn,m.registerForPluginStateChange=function(t){return t({pluginStatus:Os,pluginURL:To}),Zf.on("pluginStateChange",t),t},m.renderColorRamp=gf,m.rotate=function(t,o,u){var h=o[0],y=o[1],b=o[2],S=o[3],P=Math.sin(u),k=Math.cos(u);return t[0]=h*k+b*P,t[1]=y*k+S*P,t[2]=h*-P+b*k,t[3]=y*-P+S*k,t},m.rotateX=function(t,o,u){var h=Math.sin(u),y=Math.cos(u),b=o[4],S=o[5],P=o[6],k=o[7],z=o[8],Z=o[9],W=o[10],ee=o[11];return o!==t&&(t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[4]=b*y+z*h,t[5]=S*y+Z*h,t[6]=P*y+W*h,t[7]=k*y+ee*h,t[8]=z*y-b*h,t[9]=Z*y-S*h,t[10]=W*y-P*h,t[11]=ee*y-k*h,t},m.rotateZ=function(t,o,u){var h=Math.sin(u),y=Math.cos(u),b=o[0],S=o[1],P=o[2],k=o[3],z=o[4],Z=o[5],W=o[6],ee=o[7];return o!==t&&(t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[0]=b*y+z*h,t[1]=S*y+Z*h,t[2]=P*y+W*h,t[3]=k*y+ee*h,t[4]=z*y-b*h,t[5]=Z*y-S*h,t[6]=W*y-P*h,t[7]=ee*y-k*h,t},m.scale=function(t,o,u){var h=u[0],y=u[1],b=u[2];return t[0]=o[0]*h,t[1]=o[1]*h,t[2]=o[2]*h,t[3]=o[3]*h,t[4]=o[4]*y,t[5]=o[5]*y,t[6]=o[6]*y,t[7]=o[7]*y,t[8]=o[8]*b,t[9]=o[9]*b,t[10]=o[10]*b,t[11]=o[11]*b,t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},m.scale$1=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t[3]=o[3]*u,t},m.scale$2=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t},m.setCacheLimits=function(t,o){or=t,Mr=o},m.setRTLTextPlugin=function(t,o,u){if(u===void 0&&(u=!1),Os==="deferred"||Os==="loading"||Os==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");To=Ki.resolveURL(t),Os="deferred",Fu=o,Ea(),u||tu()},m.sphericalToCartesian=function(t){var o=t[0],u=t[1],h=t[2];return u+=90,u*=Math.PI/180,h*=Math.PI/180,{x:o*Math.cos(u)*Math.sin(h),y:o*Math.sin(u)*Math.sin(h),z:o*Math.cos(h)}},m.sqrLen=function(t){var o=t[0],u=t[1];return o*o+u*u},m.styleSpec=ce,m.sub=function(t,o,u){return t[0]=o[0]-u[0],t[1]=o[1]-u[1],t[2]=o[2]-u[2],t},m.symbolSize=zi,m.transformMat3=function(t,o,u){var h=o[0],y=o[1],b=o[2];return t[0]=h*u[0]+y*u[3]+b*u[6],t[1]=h*u[1]+y*u[4]+b*u[7],t[2]=h*u[2]+y*u[5]+b*u[8],t},m.transformMat4=uc,m.translate=function(t,o,u){var h,y,b,S,P,k,z,Z,W,ee,ne,Me,Oe=u[0],Ye=u[1],Ze=u[2];return o===t?(t[12]=o[0]*Oe+o[4]*Ye+o[8]*Ze+o[12],t[13]=o[1]*Oe+o[5]*Ye+o[9]*Ze+o[13],t[14]=o[2]*Oe+o[6]*Ye+o[10]*Ze+o[14],t[15]=o[3]*Oe+o[7]*Ye+o[11]*Ze+o[15]):(y=o[1],b=o[2],S=o[3],P=o[4],k=o[5],z=o[6],Z=o[7],W=o[8],ee=o[9],ne=o[10],Me=o[11],t[0]=h=o[0],t[1]=y,t[2]=b,t[3]=S,t[4]=P,t[5]=k,t[6]=z,t[7]=Z,t[8]=W,t[9]=ee,t[10]=ne,t[11]=Me,t[12]=h*Oe+P*Ye+W*Ze+o[12],t[13]=y*Oe+k*Ye+ee*Ze+o[13],t[14]=b*Oe+z*Ye+ne*Ze+o[14],t[15]=S*Oe+Z*Ye+Me*Ze+o[15]),t},m.triggerPluginCompletionEvent=Cp,m.uniqueId=It,m.validateCustomStyleLayer=function(t){var o=[],u=t.id;return u===void 0&&o.push({message:"layers."+u+': missing required property "id"'}),t.render===void 0&&o.push({message:"layers."+u+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&o.push({message:"layers."+u+': property "renderingMode" must be either "2d" or "3d"'}),o},m.validateLight=ah,m.validateStyle=pf,m.values=function(t){var o=[];for(var u in t)o.push(t[u]);return o},m.vectorTile=Mu,m.version="1.13.2",m.warnOnce=Qe,m.webpSupported=Wn,m.window=ae,m.wrap=sr}),ye(["./shared"],function(m){"use strict";function ve(H){var $=typeof H;if($==="number"||$==="boolean"||$==="string"||H==null)return JSON.stringify(H);if(Array.isArray(H)){for(var re="[",ge=0,Ie=H;ge<Ie.length;ge+=1)re+=ve(Ie[ge])+",";return re+"]"}for(var Ge=Object.keys(H).sort(),rt="{",ce=0;ce<Ge.length;ce++)rt+=JSON.stringify(Ge[ce])+":"+ve(H[Ge[ce]])+",";return rt+"}"}function j(H){for(var $="",re=0,ge=m.refProperties;re<ge.length;re+=1)$+="/"+ve(H[ge[re]]);return $}var le=function(H){this.keyCache={},H&&this.replace(H)};le.prototype.replace=function(H){this._layerConfigs={},this._layers={},this.update(H,[])},le.prototype.update=function(H,$){for(var re=this,ge=0,Ie=H;ge<Ie.length;ge+=1){var Ge=Ie[ge];this._layerConfigs[Ge.id]=Ge;var rt=this._layers[Ge.id]=m.createStyleLayer(Ge);rt._featureFilter=m.featureFilter(rt.filter),this.keyCache[Ge.id]&&delete this.keyCache[Ge.id]}for(var ce=0,De=$;ce<De.length;ce+=1){var mt=De[ce];delete this.keyCache[mt],delete this._layerConfigs[mt],delete this._layers[mt]}this.familiesBySource={};for(var mr=0,Dt=function(Gr,Wr){for(var oi={},rn=0;rn<Gr.length;rn++){var Ti=Wr&&Wr[Gr[rn].id]||j(Gr[rn]);Wr&&(Wr[Gr[rn].id]=Ti);var ea=oi[Ti];ea||(ea=oi[Ti]=[]),ea.push(Gr[rn])}var bi=[];for(var Oi in oi)bi.push(oi[Oi]);return bi}(m.values(this._layerConfigs),this.keyCache);mr<Dt.length;mr+=1){var Bt=Dt[mr].map(function(Gr){return re._layers[Gr.id]}),yr=Bt[0];if(yr.visibility!=="none"){var En=yr.source||"",cn=this.familiesBySource[En];cn||(cn=this.familiesBySource[En]={});var Pt=yr.sourceLayer||"_geojsonTileLayer",un=cn[Pt];un||(un=cn[Pt]=[]),un.push(Bt)}}};var se=function(H){var $={},re=[];for(var ge in H){var Ie=H[ge],Ge=$[ge]={};for(var rt in Ie){var ce=Ie[+rt];if(ce&&ce.bitmap.width!==0&&ce.bitmap.height!==0){var De={x:0,y:0,w:ce.bitmap.width+2,h:ce.bitmap.height+2};re.push(De),Ge[rt]={rect:De,metrics:ce.metrics}}}}var mt=m.potpack(re),mr=new m.AlphaImage({width:mt.w||1,height:mt.h||1});for(var Dt in H){var Bt=H[Dt];for(var yr in Bt){var En=Bt[+yr];if(En&&En.bitmap.width!==0&&En.bitmap.height!==0){var cn=$[Dt][yr].rect;m.AlphaImage.copy(En.bitmap,mr,{x:0,y:0},{x:cn.x+1,y:cn.y+1},En.bitmap)}}}this.image=mr,this.positions=$};m.register("GlyphAtlas",se);var Ne=function(H){this.tileID=new m.OverscaledTileID(H.tileID.overscaledZ,H.tileID.wrap,H.tileID.canonical.z,H.tileID.canonical.x,H.tileID.canonical.y),this.uid=H.uid,this.zoom=H.zoom,this.pixelRatio=H.pixelRatio,this.tileSize=H.tileSize,this.source=H.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=H.showCollisionBoxes,this.collectResourceTiming=!!H.collectResourceTiming,this.returnDependencies=!!H.returnDependencies,this.promoteId=H.promoteId};function ae(H,$,re){for(var ge=new m.EvaluationParameters($),Ie=0,Ge=H;Ie<Ge.length;Ie+=1)Ge[Ie].recalculate(ge,re)}function tt(H,$){var re=m.getArrayBuffer(H.request,function(ge,Ie,Ge,rt){ge?$(ge):Ie&&$(null,{vectorTile:new m.vectorTile.VectorTile(new m.pbf(Ie)),rawData:Ie,cacheControl:Ge,expires:rt})});return function(){re.cancel(),$()}}Ne.prototype.parse=function(H,$,re,ge,Ie){var Ge=this;this.status="parsing",this.data=H,this.collisionBoxArray=new m.CollisionBoxArray;var rt=new m.DictionaryCoder(Object.keys(H.layers).sort()),ce=new m.FeatureIndex(this.tileID,this.promoteId);ce.bucketLayerIDs=[];var De,mt,mr,Dt,Bt={},yr={featureIndex:ce,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:re},En=$.familiesBySource[this.source];for(var cn in En){var Pt=H.layers[cn];if(Pt){Pt.version===1&&m.warnOnce('Vector tile source "'+this.source+'" layer "'+cn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var un=rt.encode(cn),Gr=[],Wr=0;Wr<Pt.length;Wr++){var oi=Pt.feature(Wr),rn=ce.getId(oi,cn);Gr.push({feature:oi,id:rn,index:Wr,sourceLayerIndex:un})}for(var Ti=0,ea=En[cn];Ti<ea.length;Ti+=1){var bi=ea[Ti],Oi=bi[0];Oi.minzoom&&this.zoom<Math.floor(Oi.minzoom)||Oi.maxzoom&&this.zoom>=Oi.maxzoom||Oi.visibility!=="none"&&(ae(bi,this.zoom,re),(Bt[Oi.id]=Oi.createBucket({index:ce.bucketLayerIDs.length,layers:bi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:un,sourceID:this.source})).populate(Gr,yr,this.tileID.canonical),ce.bucketLayerIDs.push(bi.map(function(aa){return aa.id})))}}}var Si=m.mapObject(yr.glyphDependencies,function(aa){return Object.keys(aa).map(Number)});Object.keys(Si).length?ge.send("getGlyphs",{uid:this.uid,stacks:Si},function(aa,Ri){De||(De=aa,mt=Ri,Da.call(Ge))}):mt={};var ri=Object.keys(yr.iconDependencies);ri.length?ge.send("getImages",{icons:ri,source:this.source,tileID:this.tileID,type:"icons"},function(aa,Ri){De||(De=aa,mr=Ri,Da.call(Ge))}):mr={};var Xi=Object.keys(yr.patternDependencies);function Da(){if(De)return Ie(De);if(mt&&mr&&Dt){var aa=new se(mt),Ri=new m.ImageAtlas(mr,Dt);for(var Gi in Bt){var za=Bt[Gi];za instanceof m.SymbolBucket?(ae(za.layers,this.zoom,re),m.performSymbolLayout(za,mt,aa.positions,mr,Ri.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):za.hasPattern&&(za instanceof m.LineBucket||za instanceof m.FillBucket||za instanceof m.FillExtrusionBucket)&&(ae(za.layers,this.zoom,re),za.addFeatures(yr,this.tileID.canonical,Ri.patternPositions))}this.status="done",Ie(null,{buckets:m.values(Bt).filter(function(su){return!su.isEmpty()}),featureIndex:ce,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:aa.image,imageAtlas:Ri,glyphMap:this.returnDependencies?mt:null,iconMap:this.returnDependencies?mr:null,glyphPositions:this.returnDependencies?aa.positions:null})}}Xi.length?ge.send("getImages",{icons:Xi,source:this.source,tileID:this.tileID,type:"patterns"},function(aa,Ri){De||(De=aa,Dt=Ri,Da.call(Ge))}):Dt={},Da.call(this)};var Le=function(H,$,re,ge){this.actor=H,this.layerIndex=$,this.availableImages=re,this.loadVectorData=ge||tt,this.loading={},this.loaded={}};Le.prototype.loadTile=function(H,$){var re=this,ge=H.uid;this.loading||(this.loading={});var Ie=!!(H&&H.request&&H.request.collectResourceTiming)&&new m.RequestPerformance(H.request),Ge=this.loading[ge]=new Ne(H);Ge.abort=this.loadVectorData(H,function(rt,ce){if(delete re.loading[ge],rt||!ce)return Ge.status="done",re.loaded[ge]=Ge,$(rt);var De=ce.rawData,mt={};ce.expires&&(mt.expires=ce.expires),ce.cacheControl&&(mt.cacheControl=ce.cacheControl);var mr={};if(Ie){var Dt=Ie.finish();Dt&&(mr.resourceTiming=JSON.parse(JSON.stringify(Dt)))}Ge.vectorTile=ce.vectorTile,Ge.parse(ce.vectorTile,re.layerIndex,re.availableImages,re.actor,function(Bt,yr){if(Bt||!yr)return $(Bt);$(null,m.extend({rawTileData:De.slice(0)},yr,mt,mr))}),re.loaded=re.loaded||{},re.loaded[ge]=Ge})},Le.prototype.reloadTile=function(H,$){var re=this,ge=this.loaded,Ie=H.uid,Ge=this;if(ge&&ge[Ie]){var rt=ge[Ie];rt.showCollisionBoxes=H.showCollisionBoxes;var ce=function(De,mt){var mr=rt.reloadCallback;mr&&(delete rt.reloadCallback,rt.parse(rt.vectorTile,Ge.layerIndex,re.availableImages,Ge.actor,mr)),$(De,mt)};rt.status==="parsing"?rt.reloadCallback=ce:rt.status==="done"&&(rt.vectorTile?rt.parse(rt.vectorTile,this.layerIndex,this.availableImages,this.actor,ce):ce())}},Le.prototype.abortTile=function(H,$){var re=this.loading,ge=H.uid;re&&re[ge]&&re[ge].abort&&(re[ge].abort(),delete re[ge]),$()},Le.prototype.removeTile=function(H,$){var re=this.loaded,ge=H.uid;re&&re[ge]&&delete re[ge],$()};var it=m.window.ImageBitmap,Vt=function(){this.loaded={}};function sr(H,$){if(H.length!==0){At(H[0],$);for(var re=1;re<H.length;re++)At(H[re],!$)}}function At(H,$){for(var re=0,ge=0,Ie=H.length,Ge=Ie-1;ge<Ie;Ge=ge++)re+=(H[ge][0]-H[Ge][0])*(H[Ge][1]+H[ge][1]);re>=0!=!!$&&H.reverse()}Vt.prototype.loadTile=function(H,$){var re=H.uid,ge=H.encoding,Ie=H.rawImageData,Ge=it&&Ie instanceof it?this.getImageData(Ie):Ie,rt=new m.DEMData(re,Ge,ge);this.loaded=this.loaded||{},this.loaded[re]=rt,$(null,rt)},Vt.prototype.getImageData=function(H){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(H.width,H.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=H.width,this.offscreenCanvas.height=H.height,this.offscreenCanvasContext.drawImage(H,0,0,H.width,H.height);var $=this.offscreenCanvasContext.getImageData(-1,-1,H.width+2,H.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new m.RGBAImage({width:$.width,height:$.height},$.data)},Vt.prototype.removeTile=function(H){var $=this.loaded,re=H.uid;$&&$[re]&&delete $[re]};var er=m.vectorTile.VectorTileFeature.prototype.toGeoJSON,It=function(H){this._feature=H,this.extent=m.EXTENT,this.type=H.type,this.properties=H.tags,"id"in H&&!isNaN(H.id)&&(this.id=parseInt(H.id,10))};It.prototype.loadGeometry=function(){if(this._feature.type===1){for(var H=[],$=0,re=this._feature.geometry;$<re.length;$+=1){var ge=re[$];H.push([new m.Point$1(ge[0],ge[1])])}return H}for(var Ie=[],Ge=0,rt=this._feature.geometry;Ge<rt.length;Ge+=1){for(var ce=[],De=0,mt=rt[Ge];De<mt.length;De+=1){var mr=mt[De];ce.push(new m.Point$1(mr[0],mr[1]))}Ie.push(ce)}return Ie},It.prototype.toGeoJSON=function(H,$,re){return er.call(this,H,$,re)};var lt=function(H){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.EXTENT,this.length=H.length,this._features=H};lt.prototype.feature=function(H){return new It(this._features[H])};var dt=m.vectorTile.VectorTileFeature,tr=Y;function Y(H,$){this.options=$||{},this.features=H,this.length=H.length}function $t(H,$){this.id=typeof H.id=="number"?H.id:void 0,this.type=H.type,this.rawGeometry=H.type===1?[H.geometry]:H.geometry,this.properties=H.tags,this.extent=$||4096}Y.prototype.feature=function(H){return new $t(this.features[H],this.options.extent)},$t.prototype.loadGeometry=function(){var H=this.rawGeometry;this.geometry=[];for(var $=0;$<H.length;$++){for(var re=H[$],ge=[],Ie=0;Ie<re.length;Ie++)ge.push(new m.Point$1(re[Ie][0],re[Ie][1]));this.geometry.push(ge)}return this.geometry},$t.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var H=this.geometry,$=1/0,re=-1/0,ge=1/0,Ie=-1/0,Ge=0;Ge<H.length;Ge++)for(var rt=H[Ge],ce=0;ce<rt.length;ce++){var De=rt[ce];$=Math.min($,De.x),re=Math.max(re,De.x),ge=Math.min(ge,De.y),Ie=Math.max(Ie,De.y)}return[$,ge,re,Ie]},$t.prototype.toGeoJSON=dt.prototype.toGeoJSON;var gt=xt,Je=tr;function xt(H){var $=new m.pbf;return function(re,ge){for(var Ie in re.layers)ge.writeMessage(3,Qe,re.layers[Ie])}(H,$),$.finish()}function Qe(H,$){var re;$.writeVarintField(15,H.version||1),$.writeStringField(1,H.name||""),$.writeVarintField(5,H.extent||4096);var ge={keys:[],values:[],keycache:{},valuecache:{}};for(re=0;re<H.length;re++)ge.feature=H.feature(re),$.writeMessage(2,Kt,ge);var Ie=ge.keys;for(re=0;re<Ie.length;re++)$.writeStringField(3,Ie[re]);var Ge=ge.values;for(re=0;re<Ge.length;re++)$.writeMessage(4,Xe,Ge[re])}function Kt(H,$){var re=H.feature;re.id!==void 0&&$.writeVarintField(1,re.id),$.writeMessage(2,Sr,H),$.writeVarintField(3,re.type),$.writeMessage(4,Te,re)}function Sr(H,$){var re=H.feature,ge=H.keys,Ie=H.values,Ge=H.keycache,rt=H.valuecache;for(var ce in re.properties){var De=Ge[ce];De===void 0&&(ge.push(ce),Ge[ce]=De=ge.length-1),$.writeVarint(De);var mt=re.properties[ce],mr=typeof mt;mr!=="string"&&mr!=="boolean"&&mr!=="number"&&(mt=JSON.stringify(mt));var Dt=mr+":"+mt,Bt=rt[Dt];Bt===void 0&&(Ie.push(mt),rt[Dt]=Bt=Ie.length-1),$.writeVarint(Bt)}}function Br(H,$){return($<<3)+(7&H)}function Jr(H){return H<<1^H>>31}function Te(H,$){for(var re=H.loadGeometry(),ge=H.type,Ie=0,Ge=0,rt=re.length,ce=0;ce<rt;ce++){var De=re[ce],mt=1;ge===1&&(mt=De.length),$.writeVarint(Br(1,mt));for(var mr=ge===3?De.length-1:De.length,Dt=0;Dt<mr;Dt++){Dt===1&&ge!==1&&$.writeVarint(Br(2,mr-1));var Bt=De[Dt].x-Ie,yr=De[Dt].y-Ge;$.writeVarint(Jr(Bt)),$.writeVarint(Jr(yr)),Ie+=Bt,Ge+=yr}ge===3&&$.writeVarint(Br(7,1))}}function Xe(H,$){var re=typeof H;re==="string"?$.writeStringField(1,H):re==="boolean"?$.writeBooleanField(7,H):re==="number"&&(H%1!=0?$.writeDoubleField(3,H):H<0?$.writeSVarintField(6,H):$.writeVarintField(5,H))}function ke(H,$,re,ge){St(H,re,ge),St($,2*re,2*ge),St($,2*re+1,2*ge+1)}function St(H,$,re){var ge=H[$];H[$]=H[re],H[re]=ge}function vt(H,$,re,ge){var Ie=H-re,Ge=$-ge;return Ie*Ie+Ge*Ge}gt.fromVectorTileJs=xt,gt.fromGeojsonVt=function(H,$){$=$||{};var re={};for(var ge in H)re[ge]=new tr(H[ge].features,$),re[ge].name=ge,re[ge].version=$.version,re[ge].extent=$.extent;return xt({layers:re})},gt.GeoJSONWrapper=Je;var zt=function(H){return H[0]},Yt=function(H){return H[1]},Cr=function(H,$,re,ge,Ie){$===void 0&&($=zt),re===void 0&&(re=Yt),ge===void 0&&(ge=64),Ie===void 0&&(Ie=Float64Array),this.nodeSize=ge,this.points=H;for(var Ge=H.length<65536?Uint16Array:Uint32Array,rt=this.ids=new Ge(H.length),ce=this.coords=new Ie(2*H.length),De=0;De<H.length;De++)rt[De]=De,ce[2*De]=$(H[De]),ce[2*De+1]=re(H[De]);(function mt(mr,Dt,Bt,yr,En,cn){if(!(En-yr<=Bt)){var Pt=yr+En>>1;(function un(Gr,Wr,oi,rn,Ti,ea){for(;Ti>rn;){if(Ti-rn>600){var bi=Ti-rn+1,Oi=oi-rn+1,Si=Math.log(bi),ri=.5*Math.exp(2*Si/3),Xi=.5*Math.sqrt(Si*ri*(bi-ri)/bi)*(Oi-bi/2<0?-1:1);un(Gr,Wr,oi,Math.max(rn,Math.floor(oi-Oi*ri/bi+Xi)),Math.min(Ti,Math.floor(oi+(bi-Oi)*ri/bi+Xi)),ea)}var Da=Wr[2*oi+ea],aa=rn,Ri=Ti;for(ke(Gr,Wr,rn,oi),Wr[2*Ti+ea]>Da&&ke(Gr,Wr,rn,Ti);aa<Ri;){for(ke(Gr,Wr,aa,Ri),aa++,Ri--;Wr[2*aa+ea]<Da;)aa++;for(;Wr[2*Ri+ea]>Da;)Ri--}Wr[2*rn+ea]===Da?ke(Gr,Wr,rn,Ri):ke(Gr,Wr,++Ri,Ti),Ri<=oi&&(rn=Ri+1),oi<=Ri&&(Ti=Ri-1)}})(mr,Dt,Pt,yr,En,cn%2),mt(mr,Dt,Bt,yr,Pt-1,cn+1),mt(mr,Dt,Bt,Pt+1,En,cn+1)}})(rt,ce,ge,0,rt.length-1,0)};Cr.prototype.range=function(H,$,re,ge){return function(Ie,Ge,rt,ce,De,mt,mr){for(var Dt,Bt,yr=[0,Ie.length-1,0],En=[];yr.length;){var cn=yr.pop(),Pt=yr.pop(),un=yr.pop();if(Pt-un<=mr)for(var Gr=un;Gr<=Pt;Gr++)Bt=Ge[2*Gr+1],(Dt=Ge[2*Gr])>=rt&&Dt<=De&&Bt>=ce&&Bt<=mt&&En.push(Ie[Gr]);else{var Wr=Math.floor((un+Pt)/2);Bt=Ge[2*Wr+1],(Dt=Ge[2*Wr])>=rt&&Dt<=De&&Bt>=ce&&Bt<=mt&&En.push(Ie[Wr]);var oi=(cn+1)%2;(cn===0?rt<=Dt:ce<=Bt)&&(yr.push(un),yr.push(Wr-1),yr.push(oi)),(cn===0?De>=Dt:mt>=Bt)&&(yr.push(Wr+1),yr.push(Pt),yr.push(oi))}}return En}(this.ids,this.coords,H,$,re,ge,this.nodeSize)},Cr.prototype.within=function(H,$,re){return function(ge,Ie,Ge,rt,ce,De){for(var mt=[0,ge.length-1,0],mr=[],Dt=ce*ce;mt.length;){var Bt=mt.pop(),yr=mt.pop(),En=mt.pop();if(yr-En<=De)for(var cn=En;cn<=yr;cn++)vt(Ie[2*cn],Ie[2*cn+1],Ge,rt)<=Dt&&mr.push(ge[cn]);else{var Pt=Math.floor((En+yr)/2),un=Ie[2*Pt],Gr=Ie[2*Pt+1];vt(un,Gr,Ge,rt)<=Dt&&mr.push(ge[Pt]);var Wr=(Bt+1)%2;(Bt===0?Ge-ce<=un:rt-ce<=Gr)&&(mt.push(En),mt.push(Pt-1),mt.push(Wr)),(Bt===0?Ge+ce>=un:rt+ce>=Gr)&&(mt.push(Pt+1),mt.push(yr),mt.push(Wr))}}return mr}(this.ids,this.coords,H,$,re,this.nodeSize)};var Yn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(H){return H}},hn=function(H){this.options=ia(Object.create(Yn),H),this.trees=new Array(this.options.maxZoom+1)};function Ki(H,$,re,ge,Ie){return{x:H,y:$,zoom:1/0,id:re,parentId:-1,numPoints:ge,properties:Ie}}function Zn(H,$){var re=H.geometry.coordinates,ge=re[1];return{x:qn(re[0]),y:ui(ge),zoom:1/0,index:$,parentId:-1}}function Wn(H){return{type:"Feature",id:H.id,properties:mi(H),geometry:{type:"Point",coordinates:[(ge=H.x,360*(ge-.5)),($=H.y,re=(180-360*$)*Math.PI/180,360*Math.atan(Math.exp(re))/Math.PI-90)]}};var $,re,ge}function mi(H){var $=H.numPoints,re=$>=1e4?Math.round($/1e3)+"k":$>=1e3?Math.round($/100)/10+"k":$;return ia(ia({},H.properties),{cluster:!0,cluster_id:H.id,point_count:$,point_count_abbreviated:re})}function qn(H){return H/360+.5}function ui(H){var $=Math.sin(H*Math.PI/180),re=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return re<0?0:re>1?1:re}function ia(H,$){for(var re in $)H[re]=$[re];return H}function ki(H){return H.x}function Ai(H){return H.y}function Vi(H,$,re,ge,Ie,Ge){var rt=Ie-re,ce=Ge-ge;if(rt!==0||ce!==0){var De=((H-re)*rt+($-ge)*ce)/(rt*rt+ce*ce);De>1?(re=Ie,ge=Ge):De>0&&(re+=rt*De,ge+=ce*De)}return(rt=H-re)*rt+(ce=$-ge)*ce}function sa(H,$,re,ge){var Ie={id:H===void 0?null:H,type:$,geometry:re,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ge){var rt=Ge.geometry,ce=Ge.type;if(ce==="Point"||ce==="MultiPoint"||ce==="LineString")wi(Ge,rt);else if(ce==="Polygon"||ce==="MultiLineString")for(var De=0;De<rt.length;De++)wi(Ge,rt[De]);else if(ce==="MultiPolygon")for(De=0;De<rt.length;De++)for(var mt=0;mt<rt[De].length;mt++)wi(Ge,rt[De][mt])}(Ie),Ie}function wi(H,$){for(var re=0;re<$.length;re+=3)H.minX=Math.min(H.minX,$[re]),H.minY=Math.min(H.minY,$[re+1]),H.maxX=Math.max(H.maxX,$[re]),H.maxY=Math.max(H.maxY,$[re+1])}function Ca(H,$,re,ge){if($.geometry){var Ie=$.geometry.coordinates,Ge=$.geometry.type,rt=Math.pow(re.tolerance/((1<<re.maxZoom)*re.extent),2),ce=[],De=$.id;if(re.promoteId?De=$.properties[re.promoteId]:re.generateId&&(De=ge||0),Ge==="Point")Mn(Ie,ce);else if(Ge==="MultiPoint")for(var mt=0;mt<Ie.length;mt++)Mn(Ie[mt],ce);else if(Ge==="LineString")Ei(Ie,ce,rt,!1);else if(Ge==="MultiLineString"){if(re.lineMetrics){for(mt=0;mt<Ie.length;mt++)Ei(Ie[mt],ce=[],rt,!1),H.push(sa(De,"LineString",ce,$.properties));return}Zi(Ie,ce,rt,!1)}else if(Ge==="Polygon")Zi(Ie,ce,rt,!0);else{if(Ge!=="MultiPolygon"){if(Ge==="GeometryCollection"){for(mt=0;mt<$.geometry.geometries.length;mt++)Ca(H,{id:De,geometry:$.geometry.geometries[mt],properties:$.properties},re,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(mt=0;mt<Ie.length;mt++){var mr=[];Zi(Ie[mt],mr,rt,!0),ce.push(mr)}}H.push(sa(De,Ge,ce,$.properties))}}function Mn(H,$){$.push($i(H[0])),$.push(Wa(H[1])),$.push(0)}function Ei(H,$,re,ge){for(var Ie,Ge,rt=0,ce=0;ce<H.length;ce++){var De=$i(H[ce][0]),mt=Wa(H[ce][1]);$.push(De),$.push(mt),$.push(0),ce>0&&(rt+=ge?(Ie*mt-De*Ge)/2:Math.sqrt(Math.pow(De-Ie,2)+Math.pow(mt-Ge,2))),Ie=De,Ge=mt}var mr=$.length-3;$[2]=1,function Dt(Bt,yr,En,cn){for(var Pt,un=cn,Gr=En-yr>>1,Wr=En-yr,oi=Bt[yr],rn=Bt[yr+1],Ti=Bt[En],ea=Bt[En+1],bi=yr+3;bi<En;bi+=3){var Oi=Vi(Bt[bi],Bt[bi+1],oi,rn,Ti,ea);if(Oi>un)Pt=bi,un=Oi;else if(Oi===un){var Si=Math.abs(bi-Gr);Si<Wr&&(Pt=bi,Wr=Si)}}un>cn&&(Pt-yr>3&&Dt(Bt,yr,Pt,cn),Bt[Pt+2]=un,En-Pt>3&&Dt(Bt,Pt,En,cn))}($,0,mr,re),$[mr+2]=1,$.size=Math.abs(rt),$.start=0,$.end=$.size}function Zi(H,$,re,ge){for(var Ie=0;Ie<H.length;Ie++){var Ge=[];Ei(H[Ie],Ge,re,ge),$.push(Ge)}}function $i(H){return H/360+.5}function Wa(H){var $=Math.sin(H*Math.PI/180),re=.5-.25*Math.log((1+$)/(1-$))/Math.PI;return re<0?0:re>1?1:re}function de(H,$,re,ge,Ie,Ge,rt,ce){if(ge/=$,Ge>=(re/=$)&&rt<ge)return H;if(rt<re||Ge>=ge)return null;for(var De=[],mt=0;mt<H.length;mt++){var mr=H[mt],Dt=mr.geometry,Bt=mr.type,yr=Ie===0?mr.minX:mr.minY,En=Ie===0?mr.maxX:mr.maxY;if(yr>=re&&En<ge)De.push(mr);else if(!(En<re||yr>=ge)){var cn=[];if(Bt==="Point"||Bt==="MultiPoint")Fn(Dt,cn,re,ge,Ie);else if(Bt==="LineString")Xa(Dt,cn,re,ge,Ie,!1,ce.lineMetrics);else if(Bt==="MultiLineString")jt(Dt,cn,re,ge,Ie,!1);else if(Bt==="Polygon")jt(Dt,cn,re,ge,Ie,!0);else if(Bt==="MultiPolygon")for(var Pt=0;Pt<Dt.length;Pt++){var un=[];jt(Dt[Pt],un,re,ge,Ie,!0),un.length&&cn.push(un)}if(cn.length){if(ce.lineMetrics&&Bt==="LineString"){for(Pt=0;Pt<cn.length;Pt++)De.push(sa(mr.id,Bt,cn[Pt],mr.tags));continue}Bt!=="LineString"&&Bt!=="MultiLineString"||(cn.length===1?(Bt="LineString",cn=cn[0]):Bt="MultiLineString"),Bt!=="Point"&&Bt!=="MultiPoint"||(Bt=cn.length===3?"Point":"MultiPoint"),De.push(sa(mr.id,Bt,cn,mr.tags))}}}return De.length?De:null}function Fn(H,$,re,ge,Ie){for(var Ge=0;Ge<H.length;Ge+=3){var rt=H[Ge+Ie];rt>=re&&rt<=ge&&($.push(H[Ge]),$.push(H[Ge+1]),$.push(H[Ge+2]))}}function Xa(H,$,re,ge,Ie,Ge,rt){for(var ce,De,mt=vs(H),mr=Ie===0?Mr:I,Dt=H.start,Bt=0;Bt<H.length-3;Bt+=3){var yr=H[Bt],En=H[Bt+1],cn=H[Bt+2],Pt=H[Bt+3],un=H[Bt+4],Gr=Ie===0?yr:En,Wr=Ie===0?Pt:un,oi=!1;rt&&(ce=Math.sqrt(Math.pow(yr-Pt,2)+Math.pow(En-un,2))),Gr<re?Wr>re&&(De=mr(mt,yr,En,Pt,un,re),rt&&(mt.start=Dt+ce*De)):Gr>ge?Wr<ge&&(De=mr(mt,yr,En,Pt,un,ge),rt&&(mt.start=Dt+ce*De)):or(mt,yr,En,cn),Wr<re&&Gr>=re&&(De=mr(mt,yr,En,Pt,un,re),oi=!0),Wr>ge&&Gr<=ge&&(De=mr(mt,yr,En,Pt,un,ge),oi=!0),!Ge&&oi&&(rt&&(mt.end=Dt+ce*De),$.push(mt),mt=vs(H)),rt&&(Dt+=ce)}var rn=H.length-3;yr=H[rn],En=H[rn+1],cn=H[rn+2],(Gr=Ie===0?yr:En)>=re&&Gr<=ge&&or(mt,yr,En,cn),rn=mt.length-3,Ge&&rn>=3&&(mt[rn]!==mt[0]||mt[rn+1]!==mt[1])&&or(mt,mt[0],mt[1],mt[2]),mt.length&&$.push(mt)}function vs(H){var $=[];return $.size=H.size,$.start=H.start,$.end=H.end,$}function jt(H,$,re,ge,Ie,Ge){for(var rt=0;rt<H.length;rt++)Xa(H[rt],$,re,ge,Ie,Ge,!1)}function or(H,$,re,ge){H.push($),H.push(re),H.push(ge)}function Mr(H,$,re,ge,Ie,Ge){var rt=(Ge-$)/(ge-$);return H.push(Ge),H.push(re+(Ie-re)*rt),H.push(1),rt}function I(H,$,re,ge,Ie,Ge){var rt=(Ge-re)/(Ie-re);return H.push($+(ge-$)*rt),H.push(Ge),H.push(1),rt}function ar(H,$){for(var re=[],ge=0;ge<H.length;ge++){var Ie,Ge=H[ge],rt=Ge.type;if(rt==="Point"||rt==="MultiPoint"||rt==="LineString")Ie=kn(Ge.geometry,$);else if(rt==="MultiLineString"||rt==="Polygon"){Ie=[];for(var ce=0;ce<Ge.geometry.length;ce++)Ie.push(kn(Ge.geometry[ce],$))}else if(rt==="MultiPolygon")for(Ie=[],ce=0;ce<Ge.geometry.length;ce++){for(var De=[],mt=0;mt<Ge.geometry[ce].length;mt++)De.push(kn(Ge.geometry[ce][mt],$));Ie.push(De)}re.push(sa(Ge.id,rt,Ie,Ge.tags))}return re}function kn(H,$){var re=[];re.size=H.size,H.start!==void 0&&(re.start=H.start,re.end=H.end);for(var ge=0;ge<H.length;ge+=3)re.push(H[ge]+$,H[ge+1],H[ge+2]);return re}function li(H,$){if(H.transformed)return H;var re,ge,Ie,Ge=1<<H.z,rt=H.x,ce=H.y;for(re=0;re<H.features.length;re++){var De=H.features[re],mt=De.geometry,mr=De.type;if(De.geometry=[],mr===1)for(ge=0;ge<mt.length;ge+=2)De.geometry.push(jn(mt[ge],mt[ge+1],$,Ge,rt,ce));else for(ge=0;ge<mt.length;ge++){var Dt=[];for(Ie=0;Ie<mt[ge].length;Ie+=2)Dt.push(jn(mt[ge][Ie],mt[ge][Ie+1],$,Ge,rt,ce));De.geometry.push(Dt)}}return H.transformed=!0,H}function jn(H,$,re,ge,Ie,Ge){return[Math.round(re*(H*ge-Ie)),Math.round(re*($*ge-Ge))]}function an(H,$,re,ge,Ie){for(var Ge=$===Ie.maxZoom?0:Ie.tolerance/((1<<$)*Ie.extent),rt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:re,y:ge,z:$,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ce=0;ce<H.length;ce++){rt.numFeatures++,Pi(rt,H[ce],Ge,Ie);var De=H[ce].minX,mt=H[ce].minY,mr=H[ce].maxX,Dt=H[ce].maxY;De<rt.minX&&(rt.minX=De),mt<rt.minY&&(rt.minY=mt),mr>rt.maxX&&(rt.maxX=mr),Dt>rt.maxY&&(rt.maxY=Dt)}return rt}function Pi(H,$,re,ge){var Ie=$.geometry,Ge=$.type,rt=[];if(Ge==="Point"||Ge==="MultiPoint")for(var ce=0;ce<Ie.length;ce+=3)rt.push(Ie[ce]),rt.push(Ie[ce+1]),H.numPoints++,H.numSimplified++;else if(Ge==="LineString")Ii(rt,Ie,H,re,!1,!1);else if(Ge==="MultiLineString"||Ge==="Polygon")for(ce=0;ce<Ie.length;ce++)Ii(rt,Ie[ce],H,re,Ge==="Polygon",ce===0);else if(Ge==="MultiPolygon")for(var De=0;De<Ie.length;De++){var mt=Ie[De];for(ce=0;ce<mt.length;ce++)Ii(rt,mt[ce],H,re,!0,ce===0)}if(rt.length){var mr=$.tags||null;if(Ge==="LineString"&&ge.lineMetrics){for(var Dt in mr={},$.tags)mr[Dt]=$.tags[Dt];mr.mapbox_clip_start=Ie.start/Ie.size,mr.mapbox_clip_end=Ie.end/Ie.size}var Bt={geometry:rt,type:Ge==="Polygon"||Ge==="MultiPolygon"?3:Ge==="LineString"||Ge==="MultiLineString"?2:1,tags:mr};$.id!==null&&(Bt.id=$.id),H.features.push(Bt)}}function Ii(H,$,re,ge,Ie,Ge){var rt=ge*ge;if(ge>0&&$.size<(Ie?rt:ge))re.numPoints+=$.length/3;else{for(var ce=[],De=0;De<$.length;De+=3)(ge===0||$[De+2]>rt)&&(re.numSimplified++,ce.push($[De]),ce.push($[De+1])),re.numPoints++;Ie&&function(mt,mr){for(var Dt=0,Bt=0,yr=mt.length,En=yr-2;Bt<yr;En=Bt,Bt+=2)Dt+=(mt[Bt]-mt[En])*(mt[Bt+1]+mt[En+1]);if(Dt>0===mr)for(Bt=0,yr=mt.length;Bt<yr/2;Bt+=2){var cn=mt[Bt],Pt=mt[Bt+1];mt[Bt]=mt[yr-2-Bt],mt[Bt+1]=mt[yr-1-Bt],mt[yr-2-Bt]=cn,mt[yr-1-Bt]=Pt}}(ce,Ge),H.push(ce)}}function Ja(H,$){var re=($=this.options=function(Ie,Ge){for(var rt in Ge)Ie[rt]=Ge[rt];return Ie}(Object.create(this.options),$)).debug;if(re&&console.time("preprocess data"),$.maxZoom<0||$.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if($.promoteId&&$.generateId)throw new Error("promoteId and generateId cannot be used together.");var ge=function(Ie,Ge){var rt=[];if(Ie.type==="FeatureCollection")for(var ce=0;ce<Ie.features.length;ce++)Ca(rt,Ie.features[ce],Ge,ce);else Ca(rt,Ie.type==="Feature"?Ie:{geometry:Ie},Ge);return rt}(H,$);this.tiles={},this.tileCoords=[],re&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",$.indexMaxZoom,$.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ge=function(Ie,Ge){var rt=Ge.buffer/Ge.extent,ce=Ie,De=de(Ie,1,-1-rt,rt,0,-1,2,Ge),mt=de(Ie,1,1-rt,2+rt,0,-1,2,Ge);return(De||mt)&&(ce=de(Ie,1,-rt,1+rt,0,-1,2,Ge)||[],De&&(ce=ar(De,1).concat(ce)),mt&&(ce=ce.concat(ar(mt,-1)))),ce}(ge,$)).length&&this.splitTile(ge,0,0,0),re&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ms(H,$,re){return 32*((1<<H)*re+$)+H}function xa(H,$){var re=H.tileID.canonical;if(!this._geoJSONIndex)return $(null,null);var ge=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!ge)return $(null,null);var Ie=new lt(ge.features),Ge=gt(Ie);Ge.byteOffset===0&&Ge.byteLength===Ge.buffer.byteLength||(Ge=new Uint8Array(Ge)),$(null,{vectorTile:Ie,rawData:Ge.buffer})}hn.prototype.load=function(H){var $=this.options,re=$.log,ge=$.minZoom,Ie=$.maxZoom,Ge=$.nodeSize;re&&console.time("total time");var rt="prepare "+H.length+" points";re&&console.time(rt),this.points=H;for(var ce=[],De=0;De<H.length;De++)H[De].geometry&&ce.push(Zn(H[De],De));this.trees[Ie+1]=new Cr(ce,ki,Ai,Ge,Float32Array),re&&console.timeEnd(rt);for(var mt=Ie;mt>=ge;mt--){var mr=+Date.now();ce=this._cluster(ce,mt),this.trees[mt]=new Cr(ce,ki,Ai,Ge,Float32Array),re&&console.log("z%d: %d clusters in %dms",mt,ce.length,+Date.now()-mr)}return re&&console.timeEnd("total time"),this},hn.prototype.getClusters=function(H,$){var re=((H[0]+180)%360+360)%360-180,ge=Math.max(-90,Math.min(90,H[1])),Ie=H[2]===180?180:((H[2]+180)%360+360)%360-180,Ge=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)re=-180,Ie=180;else if(re>Ie){var rt=this.getClusters([re,ge,180,Ge],$),ce=this.getClusters([-180,ge,Ie,Ge],$);return rt.concat(ce)}for(var De=this.trees[this._limitZoom($)],mt=[],mr=0,Dt=De.range(qn(re),ui(Ge),qn(Ie),ui(ge));mr<Dt.length;mr+=1){var Bt=De.points[Dt[mr]];mt.push(Bt.numPoints?Wn(Bt):this.points[Bt.index])}return mt},hn.prototype.getChildren=function(H){var $=this._getOriginId(H),re=this._getOriginZoom(H),ge="No cluster with the specified id.",Ie=this.trees[re];if(!Ie)throw new Error(ge);var Ge=Ie.points[$];if(!Ge)throw new Error(ge);for(var rt=this.options.radius/(this.options.extent*Math.pow(2,re-1)),ce=[],De=0,mt=Ie.within(Ge.x,Ge.y,rt);De<mt.length;De+=1){var mr=Ie.points[mt[De]];mr.parentId===H&&ce.push(mr.numPoints?Wn(mr):this.points[mr.index])}if(ce.length===0)throw new Error(ge);return ce},hn.prototype.getLeaves=function(H,$,re){var ge=[];return this._appendLeaves(ge,H,$=$||10,re=re||0,0),ge},hn.prototype.getTile=function(H,$,re){var ge=this.trees[this._limitZoom(H)],Ie=Math.pow(2,H),Ge=this.options,rt=Ge.radius/Ge.extent,ce=(re-rt)/Ie,De=(re+1+rt)/Ie,mt={features:[]};return this._addTileFeatures(ge.range(($-rt)/Ie,ce,($+1+rt)/Ie,De),ge.points,$,re,Ie,mt),$===0&&this._addTileFeatures(ge.range(1-rt/Ie,ce,1,De),ge.points,Ie,re,Ie,mt),$===Ie-1&&this._addTileFeatures(ge.range(0,ce,rt/Ie,De),ge.points,-1,re,Ie,mt),mt.features.length?mt:null},hn.prototype.getClusterExpansionZoom=function(H){for(var $=this._getOriginZoom(H)-1;$<=this.options.maxZoom;){var re=this.getChildren(H);if($++,re.length!==1)break;H=re[0].properties.cluster_id}return $},hn.prototype._appendLeaves=function(H,$,re,ge,Ie){for(var Ge=0,rt=this.getChildren($);Ge<rt.length;Ge+=1){var ce=rt[Ge],De=ce.properties;if(De&&De.cluster?Ie+De.point_count<=ge?Ie+=De.point_count:Ie=this._appendLeaves(H,De.cluster_id,re,ge,Ie):Ie<ge?Ie++:H.push(ce),H.length===re)break}return Ie},hn.prototype._addTileFeatures=function(H,$,re,ge,Ie,Ge){for(var rt=0,ce=H;rt<ce.length;rt+=1){var De=$[ce[rt]],mt=De.numPoints,mr={type:1,geometry:[[Math.round(this.options.extent*(De.x*Ie-re)),Math.round(this.options.extent*(De.y*Ie-ge))]],tags:mt?mi(De):this.points[De.index].properties},Dt=void 0;mt?Dt=De.id:this.options.generateId?Dt=De.index:this.points[De.index].id&&(Dt=this.points[De.index].id),Dt!==void 0&&(mr.id=Dt),Ge.features.push(mr)}},hn.prototype._limitZoom=function(H){return Math.max(this.options.minZoom,Math.min(+H,this.options.maxZoom+1))},hn.prototype._cluster=function(H,$){for(var re=[],ge=this.options,Ie=ge.reduce,Ge=ge.minPoints,rt=ge.radius/(ge.extent*Math.pow(2,$)),ce=0;ce<H.length;ce++){var De=H[ce];if(!(De.zoom<=$)){De.zoom=$;for(var mt=this.trees[$+1],mr=mt.within(De.x,De.y,rt),Dt=De.numPoints||1,Bt=Dt,yr=0,En=mr;yr<En.length;yr+=1){var cn=mt.points[En[yr]];cn.zoom>$&&(Bt+=cn.numPoints||1)}if(Bt>=Ge){for(var Pt=De.x*Dt,un=De.y*Dt,Gr=Ie&&Dt>1?this._map(De,!0):null,Wr=(ce<<5)+($+1)+this.points.length,oi=0,rn=mr;oi<rn.length;oi+=1){var Ti=mt.points[rn[oi]];if(!(Ti.zoom<=$)){Ti.zoom=$;var ea=Ti.numPoints||1;Pt+=Ti.x*ea,un+=Ti.y*ea,Ti.parentId=Wr,Ie&&(Gr||(Gr=this._map(De,!0)),Ie(Gr,this._map(Ti)))}}De.parentId=Wr,re.push(Ki(Pt/Bt,un/Bt,Wr,Bt,Gr))}else if(re.push(De),Bt>1)for(var bi=0,Oi=mr;bi<Oi.length;bi+=1){var Si=mt.points[Oi[bi]];Si.zoom<=$||(Si.zoom=$,re.push(Si))}}}return re},hn.prototype._getOriginId=function(H){return H-this.points.length>>5},hn.prototype._getOriginZoom=function(H){return(H-this.points.length)%32},hn.prototype._map=function(H,$){if(H.numPoints)return $?ia({},H.properties):H.properties;var re=this.points[H.index].properties,ge=this.options.map(re);return $&&ge===re?ia({},ge):ge},Ja.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ja.prototype.splitTile=function(H,$,re,ge,Ie,Ge,rt){for(var ce=[H,$,re,ge],De=this.options,mt=De.debug;ce.length;){ge=ce.pop(),re=ce.pop(),$=ce.pop(),H=ce.pop();var mr=1<<$,Dt=ms($,re,ge),Bt=this.tiles[Dt];if(!Bt&&(mt>1&&console.time("creation"),Bt=this.tiles[Dt]=an(H,$,re,ge,De),this.tileCoords.push({z:$,x:re,y:ge}),mt)){mt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$,re,ge,Bt.numFeatures,Bt.numPoints,Bt.numSimplified),console.timeEnd("creation"));var yr="z"+$;this.stats[yr]=(this.stats[yr]||0)+1,this.total++}if(Bt.source=H,Ie){if($===De.maxZoom||$===Ie)continue;var En=1<<Ie-$;if(re!==Math.floor(Ge/En)||ge!==Math.floor(rt/En))continue}else if($===De.indexMaxZoom||Bt.numPoints<=De.indexMaxPoints)continue;if(Bt.source=null,H.length!==0){mt>1&&console.time("clipping");var cn,Pt,un,Gr,Wr,oi,rn=.5*De.buffer/De.extent,Ti=.5-rn,ea=.5+rn,bi=1+rn;cn=Pt=un=Gr=null,Wr=de(H,mr,re-rn,re+ea,0,Bt.minX,Bt.maxX,De),oi=de(H,mr,re+Ti,re+bi,0,Bt.minX,Bt.maxX,De),H=null,Wr&&(cn=de(Wr,mr,ge-rn,ge+ea,1,Bt.minY,Bt.maxY,De),Pt=de(Wr,mr,ge+Ti,ge+bi,1,Bt.minY,Bt.maxY,De),Wr=null),oi&&(un=de(oi,mr,ge-rn,ge+ea,1,Bt.minY,Bt.maxY,De),Gr=de(oi,mr,ge+Ti,ge+bi,1,Bt.minY,Bt.maxY,De),oi=null),mt>1&&console.timeEnd("clipping"),ce.push(cn||[],$+1,2*re,2*ge),ce.push(Pt||[],$+1,2*re,2*ge+1),ce.push(un||[],$+1,2*re+1,2*ge),ce.push(Gr||[],$+1,2*re+1,2*ge+1)}}},Ja.prototype.getTile=function(H,$,re){var ge=this.options,Ie=ge.extent,Ge=ge.debug;if(H<0||H>24)return null;var rt=1<<H,ce=ms(H,$=($%rt+rt)%rt,re);if(this.tiles[ce])return li(this.tiles[ce],Ie);Ge>1&&console.log("drilling down to z%d-%d-%d",H,$,re);for(var De,mt=H,mr=$,Dt=re;!De&&mt>0;)mt--,mr=Math.floor(mr/2),Dt=Math.floor(Dt/2),De=this.tiles[ms(mt,mr,Dt)];return De&&De.source?(Ge>1&&console.log("found parent tile z%d-%d-%d",mt,mr,Dt),Ge>1&&console.time("drilling down"),this.splitTile(De.source,mt,mr,Dt,H,$,re),Ge>1&&console.timeEnd("drilling down"),this.tiles[ce]?li(this.tiles[ce],Ie):null):null};var ka=function(H){function $(re,ge,Ie,Ge){H.call(this,re,ge,Ie,xa),Ge&&(this.loadGeoJSON=Ge)}return H&&($.__proto__=H),($.prototype=Object.create(H&&H.prototype)).constructor=$,$.prototype.loadData=function(re,ge){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=ge,this._pendingLoadDataParams=re,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},$.prototype._loadData=function(){var re=this;if(this._pendingCallback&&this._pendingLoadDataParams){var ge=this._pendingCallback,Ie=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ge=!!(Ie&&Ie.request&&Ie.request.collectResourceTiming)&&new m.RequestPerformance(Ie.request);this.loadGeoJSON(Ie,function(rt,ce){if(rt||!ce)return ge(rt);if(typeof ce!="object")return ge(new Error("Input data given to '"+Ie.source+"' is not a valid GeoJSON object."));(function Bt(yr,En){var cn,Pt=yr&&yr.type;if(Pt==="FeatureCollection")for(cn=0;cn<yr.features.length;cn++)Bt(yr.features[cn],En);else if(Pt==="GeometryCollection")for(cn=0;cn<yr.geometries.length;cn++)Bt(yr.geometries[cn],En);else if(Pt==="Feature")Bt(yr.geometry,En);else if(Pt==="Polygon")sr(yr.coordinates,En);else if(Pt==="MultiPolygon")for(cn=0;cn<yr.coordinates.length;cn++)sr(yr.coordinates[cn],En);return yr})(ce,!0);try{if(Ie.filter){var De=m.createExpression(Ie.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(De.result==="error")throw new Error(De.value.map(function(Bt){return Bt.key+": "+Bt.message}).join(", "));var mt=ce.features.filter(function(Bt){return De.value.evaluate({zoom:0},Bt)});ce={type:"FeatureCollection",features:mt}}re._geoJSONIndex=Ie.cluster?new hn(function(Bt){var yr=Bt.superclusterOptions,En=Bt.clusterProperties;if(!En||!yr)return yr;for(var cn={},Pt={},un={accumulated:null,zoom:0},Gr={properties:null},Wr=Object.keys(En),oi=0,rn=Wr;oi<rn.length;oi+=1){var Ti=rn[oi],ea=En[Ti],bi=ea[0],Oi=m.createExpression(ea[1]),Si=m.createExpression(typeof bi=="string"?[bi,["accumulated"],["get",Ti]]:bi);cn[Ti]=Oi.value,Pt[Ti]=Si.value}return yr.map=function(ri){Gr.properties=ri;for(var Xi={},Da=0,aa=Wr;Da<aa.length;Da+=1){var Ri=aa[Da];Xi[Ri]=cn[Ri].evaluate(un,Gr)}return Xi},yr.reduce=function(ri,Xi){Gr.properties=Xi;for(var Da=0,aa=Wr;Da<aa.length;Da+=1){var Ri=aa[Da];un.accumulated=ri[Ri],ri[Ri]=Pt[Ri].evaluate(un,Gr)}},yr}(Ie)).load(ce.features):function(Bt,yr){return new Ja(Bt,yr)}(ce,Ie.geojsonVtOptions)}catch(Bt){return ge(Bt)}re.loaded={};var mr={};if(Ge){var Dt=Ge.finish();Dt&&(mr.resourceTiming={},mr.resourceTiming[Ie.source]=JSON.parse(JSON.stringify(Dt)))}ge(null,mr)})}},$.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},$.prototype.reloadTile=function(re,ge){var Ie=this.loaded;return Ie&&Ie[re.uid]?H.prototype.reloadTile.call(this,re,ge):this.loadTile(re,ge)},$.prototype.loadGeoJSON=function(re,ge){if(re.request)m.getJSON(re.request,ge);else{if(typeof re.data!="string")return ge(new Error("Input data given to '"+re.source+"' is not a valid GeoJSON object."));try{return ge(null,JSON.parse(re.data))}catch(Ie){return ge(new Error("Input data given to '"+re.source+"' is not a valid GeoJSON object."))}}},$.prototype.removeSource=function(re,ge){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ge()},$.prototype.getClusterExpansionZoom=function(re,ge){try{ge(null,this._geoJSONIndex.getClusterExpansionZoom(re.clusterId))}catch(Ie){ge(Ie)}},$.prototype.getClusterChildren=function(re,ge){try{ge(null,this._geoJSONIndex.getChildren(re.clusterId))}catch(Ie){ge(Ie)}},$.prototype.getClusterLeaves=function(re,ge){try{ge(null,this._geoJSONIndex.getLeaves(re.clusterId,re.limit,re.offset))}catch(Ie){ge(Ie)}},$}(Le),Ma=function(H){var $=this;this.self=H,this.actor=new m.Actor(H,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Le,geojson:ka},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(re,ge){if($.workerSourceTypes[re])throw new Error('Worker source with name "'+re+'" already registered.');$.workerSourceTypes[re]=ge},this.self.registerRTLTextPlugin=function(re){if(m.plugin.isParsed())throw new Error("RTL text plugin already registered.");m.plugin.applyArabicShaping=re.applyArabicShaping,m.plugin.processBidirectionalText=re.processBidirectionalText,m.plugin.processStyledBidirectionalText=re.processStyledBidirectionalText}};return Ma.prototype.setReferrer=function(H,$){this.referrer=$},Ma.prototype.setImages=function(H,$,re){for(var ge in this.availableImages[H]=$,this.workerSources[H]){var Ie=this.workerSources[H][ge];for(var Ge in Ie)Ie[Ge].availableImages=$}re()},Ma.prototype.setLayers=function(H,$,re){this.getLayerIndex(H).replace($),re()},Ma.prototype.updateLayers=function(H,$,re){this.getLayerIndex(H).update($.layers,$.removedIds),re()},Ma.prototype.loadTile=function(H,$,re){this.getWorkerSource(H,$.type,$.source).loadTile($,re)},Ma.prototype.loadDEMTile=function(H,$,re){this.getDEMWorkerSource(H,$.source).loadTile($,re)},Ma.prototype.reloadTile=function(H,$,re){this.getWorkerSource(H,$.type,$.source).reloadTile($,re)},Ma.prototype.abortTile=function(H,$,re){this.getWorkerSource(H,$.type,$.source).abortTile($,re)},Ma.prototype.removeTile=function(H,$,re){this.getWorkerSource(H,$.type,$.source).removeTile($,re)},Ma.prototype.removeDEMTile=function(H,$){this.getDEMWorkerSource(H,$.source).removeTile($)},Ma.prototype.removeSource=function(H,$,re){if(this.workerSources[H]&&this.workerSources[H][$.type]&&this.workerSources[H][$.type][$.source]){var ge=this.workerSources[H][$.type][$.source];delete this.workerSources[H][$.type][$.source],ge.removeSource!==void 0?ge.removeSource($,re):re()}},Ma.prototype.loadWorkerSource=function(H,$,re){try{this.self.importScripts($.url),re()}catch(ge){re(ge.toString())}},Ma.prototype.syncRTLPluginState=function(H,$,re){try{m.plugin.setState($);var ge=m.plugin.getPluginURL();if(m.plugin.isLoaded()&&!m.plugin.isParsed()&&ge!=null){this.self.importScripts(ge);var Ie=m.plugin.isParsed();re(Ie?void 0:new Error("RTL Text Plugin failed to import scripts from "+ge),Ie)}}catch(Ge){re(Ge.toString())}},Ma.prototype.getAvailableImages=function(H){var $=this.availableImages[H];return $||($=[]),$},Ma.prototype.getLayerIndex=function(H){var $=this.layerIndexes[H];return $||($=this.layerIndexes[H]=new le),$},Ma.prototype.getWorkerSource=function(H,$,re){var ge=this;return this.workerSources[H]||(this.workerSources[H]={}),this.workerSources[H][$]||(this.workerSources[H][$]={}),this.workerSources[H][$][re]||(this.workerSources[H][$][re]=new this.workerSourceTypes[$]({send:function(Ie,Ge,rt){ge.actor.send(Ie,Ge,rt,H)}},this.getLayerIndex(H),this.getAvailableImages(H))),this.workerSources[H][$][re]},Ma.prototype.getDEMWorkerSource=function(H,$){return this.demWorkerSources[H]||(this.demWorkerSources[H]={}),this.demWorkerSources[H][$]||(this.demWorkerSources[H][$]=new Vt),this.demWorkerSources[H][$]},Ma.prototype.enforceCacheSizeLimit=function(H,$){m.enforceCacheSizeLimit($)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Ma(self)),Ma}),ye(["./shared"],function(m){"use strict";var ve=m.createCommonjsModule(function(l){function f(E){return!c(E)}function c(E){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var M,L,U=new Blob([""],{type:"text/javascript"}),X=URL.createObjectURL(U);try{L=new Worker(X),M=!0}catch(oe){M=!1}return L&&L.terminate(),URL.revokeObjectURL(X),M}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var M=document.createElement("canvas");M.width=M.height=1;var L=M.getContext("2d");if(!L)return!1;var U=L.getImageData(0,0,1,1);return U&&U.width===M.width}()?(d[A=E&&E.failIfMajorPerformanceCaveat]===void 0&&(d[A]=function(M){var L=function(X){var oe=document.createElement("canvas"),fe=Object.create(f.webGLContextAttributes);return fe.failIfMajorPerformanceCaveat=X,oe.probablySupportsContext?oe.probablySupportsContext("webgl",fe)||oe.probablySupportsContext("experimental-webgl",fe):oe.supportsContext?oe.supportsContext("webgl",fe)||oe.supportsContext("experimental-webgl",fe):oe.getContext("webgl",fe)||oe.getContext("experimental-webgl",fe)}(M);if(!L)return!1;var U=L.createShader(L.VERTEX_SHADER);return!(!U||L.isContextLost())&&(L.shaderSource(U,"void main() {}"),L.compileShader(U),L.getShaderParameter(U,L.COMPILE_STATUS)===!0)}(A)),d[A]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var A}l.exports?l.exports=f:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=f,window.mapboxgl.notSupportedReason=c);var d={};f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),j={create:function(l,f,c){var d=m.window.document.createElement(l);return f!==void 0&&(d.className=f),c&&c.appendChild(d),d},createNS:function(l,f){return m.window.document.createElementNS(l,f)}},le=m.window.document&&m.window.document.documentElement.style;function se(l){if(!le)return l[0];for(var f=0;f<l.length;f++)if(l[f]in le)return l[f];return l[0]}var Ne,ae=se(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);j.disableDrag=function(){le&&ae&&(Ne=le[ae],le[ae]="none")},j.enableDrag=function(){le&&ae&&(le[ae]=Ne)};var tt=se(["transform","WebkitTransform"]);j.setTransform=function(l,f){l.style[tt]=f};var Le=!1;try{var it=Object.defineProperty({},"passive",{get:function(){Le=!0}});m.window.addEventListener("test",it,it),m.window.removeEventListener("test",it,it)}catch(l){Le=!1}j.addEventListener=function(l,f,c,d){d===void 0&&(d={}),l.addEventListener(f,c,"passive"in d&&Le?d:d.capture)},j.removeEventListener=function(l,f,c,d){d===void 0&&(d={}),l.removeEventListener(f,c,"passive"in d&&Le?d:d.capture)};var Vt=function(l){l.preventDefault(),l.stopPropagation(),m.window.removeEventListener("click",Vt,!0)};function sr(l){var f=l.userImage;return!!(f&&f.render&&f.render())&&(l.data.replace(new Uint8Array(f.data.buffer)),!0)}j.suppressClick=function(){m.window.addEventListener("click",Vt,!0),m.window.setTimeout(function(){m.window.removeEventListener("click",Vt,!0)},0)},j.mousePos=function(l,f){var c=l.getBoundingClientRect();return new m.Point(f.clientX-c.left-l.clientLeft,f.clientY-c.top-l.clientTop)},j.touchPos=function(l,f){for(var c=l.getBoundingClientRect(),d=[],E=0;E<f.length;E++)d.push(new m.Point(f[E].clientX-c.left-l.clientLeft,f[E].clientY-c.top-l.clientTop));return d},j.mouseButton=function(l){return m.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&m.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},j.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var At=function(l){function f(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new m.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.isLoaded=function(){return this.loaded},f.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var d=0,E=this.requestors;d<E.length;d+=1){var A=E[d];this._notify(A.ids,A.callback)}this.requestors=[]}},f.prototype.getImage=function(c){return this.images[c]},f.prototype.addImage=function(c,d){this._validate(c,d)&&(this.images[c]=d)},f.prototype._validate=function(c,d){var E=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),E=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),E=!1),this._validateContent(d.content,d)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),E=!1),E},f.prototype._validateStretch=function(c,d){if(!c)return!0;for(var E=0,A=0,M=c;A<M.length;A+=1){var L=M[A];if(L[0]<E||L[1]<L[0]||d<L[1])return!1;E=L[1]}return!0},f.prototype._validateContent=function(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},f.prototype.updateImage=function(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0},f.prototype.removeImage=function(c){var d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()},f.prototype.listImages=function(){return Object.keys(this.images)},f.prototype.getImages=function(c,d){var E=!0;if(!this.isLoaded())for(var A=0,M=c;A<M.length;A+=1)this.images[M[A]]||(E=!1);this.isLoaded()||E?this._notify(c,d):this.requestors.push({ids:c,callback:d})},f.prototype._notify=function(c,d){for(var E={},A=0,M=c;A<M.length;A+=1){var L=M[A];this.images[L]||this.fire(new m.Event("styleimagemissing",{id:L}));var U=this.images[L];U?E[L]={data:U.data.clone(),pixelRatio:U.pixelRatio,sdf:U.sdf,version:U.version,stretchX:U.stretchX,stretchY:U.stretchY,content:U.content,hasRenderCallback:Boolean(U.userImage&&U.userImage.render)}:m.warnOnce('Image "'+L+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}d(null,E)},f.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},f.prototype.getPattern=function(c){var d=this.patterns[c],E=this.getImage(c);if(!E)return null;if(d&&d.position.version===E.version)return d.position;if(d)d.position.version=E.version;else{var A={w:E.data.width+2,h:E.data.height+2,x:0,y:0},M=new m.ImagePosition(A,E);this.patterns[c]={bin:A,position:M}}return this._updatePatternAtlas(),this.patterns[c].position},f.prototype.bind=function(c){var d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new m.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)},f.prototype._updatePatternAtlas=function(){var c=[];for(var d in this.patterns)c.push(this.patterns[d].bin);var E=m.potpack(c),A=E.w,M=E.h,L=this.atlasImage;for(var U in L.resize({width:A||1,height:M||1}),this.patterns){var X=this.patterns[U].bin,oe=X.x+1,fe=X.y+1,pe=this.images[U].data,Re=pe.width,Pe=pe.height;m.RGBAImage.copy(pe,L,{x:0,y:0},{x:oe,y:fe},{width:Re,height:Pe}),m.RGBAImage.copy(pe,L,{x:0,y:Pe-1},{x:oe,y:fe-1},{width:Re,height:1}),m.RGBAImage.copy(pe,L,{x:0,y:0},{x:oe,y:fe+Pe},{width:Re,height:1}),m.RGBAImage.copy(pe,L,{x:Re-1,y:0},{x:oe-1,y:fe},{width:1,height:Pe}),m.RGBAImage.copy(pe,L,{x:0,y:0},{x:oe+Re,y:fe},{width:1,height:Pe})}this.dirty=!0},f.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},f.prototype.dispatchRenderCallbacks=function(c){for(var d=0,E=c;d<E.length;d+=1){var A=E[d];if(!this.callbackDispatchedThisFrame[A]){this.callbackDispatchedThisFrame[A]=!0;var M=this.images[A];sr(M)&&this.updateImage(A,M)}}},f}(m.Evented),er=dt,It=dt,lt=1e20;function dt(l,f,c,d,E,A){this.fontSize=l||24,this.buffer=f===void 0?3:f,this.cutoff=d||.25,this.fontFamily=E||"sans-serif",this.fontWeight=A||"normal",this.radius=c||8;var M=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=M,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.d=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Int16Array(M),this.middle=Math.round(M/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function tr(l,f,c,d,E,A,M){for(var L=0;L<f;L++){for(var U=0;U<c;U++)d[U]=l[U*f+L];for(Y(d,E,A,M,c),U=0;U<c;U++)l[U*f+L]=E[U]}for(U=0;U<c;U++){for(L=0;L<f;L++)d[L]=l[U*f+L];for(Y(d,E,A,M,f),L=0;L<f;L++)l[U*f+L]=Math.sqrt(E[L])}}function Y(l,f,c,d,E){c[0]=0,d[0]=-lt,d[1]=+lt;for(var A=1,M=0;A<E;A++){for(var L=(l[A]+A*A-(l[c[M]]+c[M]*c[M]))/(2*A-2*c[M]);L<=d[M];)M--,L=(l[A]+A*A-(l[c[M]]+c[M]*c[M]))/(2*A-2*c[M]);c[++M]=A,d[M]=L,d[M+1]=+lt}for(A=0,M=0;A<E;A++){for(;d[M+1]<A;)M++;f[A]=(A-c[M])*(A-c[M])+l[c[M]]}}dt.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var f=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),d=0;d<this.size*this.size;d++){var E=f.data[4*d+3]/255;this.gridOuter[d]=E===1?0:E===0?lt:Math.pow(Math.max(0,.5-E),2),this.gridInner[d]=E===1?lt:E===0?0:Math.pow(Math.max(0,E-.5),2)}for(tr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),tr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),d=0;d<this.size*this.size;d++)c[d]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[d]-this.gridInner[d])/this.radius+this.cutoff))));return c},er.default=It;var $t=function(l,f){this.requestManager=l,this.localIdeographFontFamily=f,this.entries={}};$t.prototype.setURL=function(l){this.url=l},$t.prototype.getGlyphs=function(l,f){var c=this,d=[];for(var E in l)for(var A=0,M=l[E];A<M.length;A+=1)d.push({stack:E,id:M[A]});m.asyncAll(d,function(L,U){var X=L.stack,oe=L.id,fe=c.entries[X];fe||(fe=c.entries[X]={glyphs:{},requests:{},ranges:{}});var pe=fe.glyphs[oe];if(pe===void 0){if(pe=c._tinySDF(fe,X,oe))return fe.glyphs[oe]=pe,void U(null,{stack:X,id:oe,glyph:pe});var Re=Math.floor(oe/256);if(256*Re>65535)U(new Error("glyphs > 65535 not supported"));else if(fe.ranges[Re])U(null,{stack:X,id:oe,glyph:pe});else{var Pe=fe.requests[Re];Pe||(Pe=fe.requests[Re]=[],$t.loadGlyphRange(X,Re,c.url,c.requestManager,function(He,be){if(be){for(var je in be)c._doesCharSupportLocalGlyph(+je)||(fe.glyphs[+je]=be[+je]);fe.ranges[Re]=!0}for(var et=0,yt=Pe;et<yt.length;et+=1)(0,yt[et])(He,be);delete fe.requests[Re]})),Pe.push(function(He,be){He?U(He):be&&U(null,{stack:X,id:oe,glyph:be[oe]||null})})}}else U(null,{stack:X,id:oe,glyph:pe})},function(L,U){if(L)f(L);else if(U){for(var X={},oe=0,fe=U;oe<fe.length;oe+=1){var pe=fe[oe],Re=pe.stack,Pe=pe.id,He=pe.glyph;(X[Re]||(X[Re]={}))[Pe]=He&&{id:He.id,bitmap:He.bitmap.clone(),metrics:He.metrics}}f(null,X)}})},$t.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(m.isChar["CJK Unified Ideographs"](l)||m.isChar["Hangul Syllables"](l)||m.isChar.Hiragana(l)||m.isChar.Katakana(l))},$t.prototype._tinySDF=function(l,f,c){var d=this.localIdeographFontFamily;if(d&&this._doesCharSupportLocalGlyph(c)){var E=l.tinySDF;if(!E){var A="400";/bold/i.test(f)?A="900":/medium/i.test(f)?A="500":/light/i.test(f)&&(A="200"),E=l.tinySDF=new $t.TinySDF(24,3,8,.25,d,A)}return{id:c,bitmap:new m.AlphaImage({width:30,height:30},E.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},$t.loadGlyphRange=function(l,f,c,d,E){var A=256*f,M=A+255,L=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",A+"-"+M),m.ResourceType.Glyphs);m.getArrayBuffer(L,function(U,X){if(U)E(U);else if(X){for(var oe={},fe=0,pe=m.parseGlyphPBF(X);fe<pe.length;fe+=1){var Re=pe[fe];oe[Re.id]=Re}E(null,oe)}})},$t.TinySDF=er;var gt=function(){this.specification=m.styleSpec.light.position};gt.prototype.possiblyEvaluate=function(l,f){return m.sphericalToCartesian(l.expression.evaluate(f))},gt.prototype.interpolate=function(l,f,c){return{x:m.number(l.x,f.x,c),y:m.number(l.y,f.y,c),z:m.number(l.z,f.z,c)}};var Je=new m.Properties({anchor:new m.DataConstantProperty(m.styleSpec.light.anchor),position:new gt,color:new m.DataConstantProperty(m.styleSpec.light.color),intensity:new m.DataConstantProperty(m.styleSpec.light.intensity)}),xt=function(l){function f(c){l.call(this),this._transitionable=new m.Transitionable(Je),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getLight=function(){return this._transitionable.serialize()},f.prototype.setLight=function(c,d){if(d===void 0&&(d={}),!this._validate(m.validateLight,c,d))for(var E in c){var A=c[E];m.endsWith(E,"-transition")?this._transitionable.setTransition(E.slice(0,-"-transition".length),A):this._transitionable.setValue(E,A)}},f.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},f.prototype.hasTransition=function(){return this._transitioning.hasTransition()},f.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},f.prototype._validate=function(c,d,E){return(!E||E.validate!==!1)&&m.emitValidationErrors(this,c.call(m.validateStyle,m.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:m.styleSpec})))},f}(m.Evented),Qe=function(l,f){this.width=l,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Qe.prototype.getDash=function(l,f){var c=l.join(",")+String(f);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,f)),this.dashEntry[c]},Qe.prototype.getDashRanges=function(l,f,c){var d=[],E=l.length%2==1?-l[l.length-1]*c:0,A=l[0]*c,M=!0;d.push({left:E,right:A,isDash:M,zeroLength:l[0]===0});for(var L=l[0],U=1;U<l.length;U++){var X=l[U];d.push({left:E=L*c,right:A=(L+=X)*c,isDash:M=!M,zeroLength:X===0})}return d},Qe.prototype.addRoundDash=function(l,f,c){for(var d=f/2,E=-c;E<=c;E++)for(var A=this.width*(this.nextRow+c+E),M=0,L=l[M],U=0;U<this.width;U++){U/L.right>1&&(L=l[++M]);var X=Math.abs(U-L.left),oe=Math.abs(U-L.right),fe=Math.min(X,oe),pe=void 0,Re=E/c*(d+1);if(L.isDash){var Pe=d-Math.abs(Re);pe=Math.sqrt(fe*fe+Pe*Pe)}else pe=d-Math.sqrt(fe*fe+Re*Re);this.data[A+U]=Math.max(0,Math.min(255,pe+128))}},Qe.prototype.addRegularDash=function(l){for(var f=l.length-1;f>=0;--f){var c=l[f],d=l[f+1];c.zeroLength?l.splice(f,1):d&&d.isDash===c.isDash&&(d.left=c.left,l.splice(f,1))}var E=l[0],A=l[l.length-1];E.isDash===A.isDash&&(E.left=A.left-this.width,A.right=E.right+this.width);for(var M=this.width*this.nextRow,L=0,U=l[L],X=0;X<this.width;X++){X/U.right>1&&(U=l[++L]);var oe=Math.abs(X-U.left),fe=Math.abs(X-U.right),pe=Math.min(oe,fe);this.data[M+X]=Math.max(0,Math.min(255,(U.isDash?pe:-pe)+128))}},Qe.prototype.addDash=function(l,f){var c=f?7:0,d=2*c+1;if(this.nextRow+d>this.height)return m.warnOnce("LineAtlas out of space"),null;for(var E=0,A=0;A<l.length;A++)E+=l[A];if(E!==0){var M=this.width/E,L=this.getDashRanges(l,this.width,M);f?this.addRoundDash(L,M,c):this.addRegularDash(L)}var U={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:E};return this.nextRow+=d,this.dirty=!0,U},Qe.prototype.bind=function(l){var f=l.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))};var Kt=function l(f,c){this.workerPool=f,this.actors=[],this.currentActor=0,this.id=m.uniqueId();for(var d=this.workerPool.acquire(this.id),E=0;E<d.length;E++){var A=new l.Actor(d[E],c,this.id);A.name="Worker "+E,this.actors.push(A)}};function Sr(l,f,c){var d=function(E,A){if(E)return c(E);if(A){var M=m.pick(m.extend(A,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);A.vector_layers&&(M.vectorLayers=A.vector_layers,M.vectorLayerIds=M.vectorLayers.map(function(L){return L.id})),M.tiles=f.canonicalizeTileset(M,l.url),c(null,M)}};return l.url?m.getJSON(f.transformRequest(f.normalizeSourceURL(l.url),m.ResourceType.Source),d):m.browser.frame(function(){return d(null,l)})}Kt.prototype.broadcast=function(l,f,c){m.asyncAll(this.actors,function(d,E){d.send(l,f,E)},c=c||function(){})},Kt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Kt.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},Kt.Actor=m.Actor;var Br=function(l,f,c){this.bounds=m.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=c||24};Br.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},Br.prototype.contains=function(l){var f=Math.pow(2,l.z),c=Math.floor(m.mercatorXfromLng(this.bounds.getWest())*f),d=Math.floor(m.mercatorYfromLat(this.bounds.getNorth())*f),E=Math.ceil(m.mercatorXfromLng(this.bounds.getEast())*f),A=Math.ceil(m.mercatorYfromLat(this.bounds.getSouth())*f);return l.x>=c&&l.x<E&&l.y>=d&&l.y<A};var Jr=function(l){function f(c,d,E,A){if(l.call(this),this.id=c,this.dispatcher=E,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,m.extend(this,m.pick(d,["url","scheme","tileSize","promoteId"])),this._options=m.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(A)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Sr(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new m.ErrorEvent(d)):E&&(m.extend(c,E),E.bounds&&(c.tileBounds=new Br(E.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(E.tiles,c.map._requestManager._customAccessToken),m.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},f.prototype.setTiles=function(c){var d=this;return this.setSourceProperty(function(){d._options.tiles=c}),this},f.prototype.setUrl=function(c){var d=this;return this.setSourceProperty(function(){d.url=c,d._options.url=c}),this},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return m.extend({},this._options)},f.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),A={request:this.map._requestManager.transformRequest(E,m.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function M(L,U){return delete c.request,c.aborted?d(null):L&&L.status!==404?d(L):(U&&U.resourceTiming&&(c.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&c.setExpiryData(U),c.loadVectorData(U,this.map.painter),m.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}A.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",A,M.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",A,M.bind(this)))},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.hasTransition=function(){return!1},f}(m.Evented),Te=function(l){function f(c,d,E,A){l.call(this),this.id=c,this.dispatcher=E,this.setEventedParent(A),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=m.extend({type:"raster"},d),m.extend(this,m.pick(d,["url","scheme","tileSize"]))}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Sr(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new m.ErrorEvent(d)):E&&(m.extend(c,E),E.bounds&&(c.tileBounds=new Br(E.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(E.tiles),m.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return m.extend({},this._options)},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.loadTile=function(c,d){var E=this,A=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=m.getImage(this.map._requestManager.transformRequest(A,m.ResourceType.Tile),function(M,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(M)c.state="errored",d(M);else if(L){E.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var U=E.map.painter.context,X=U.gl;c.texture=E.map.painter.getTileTexture(L.width),c.texture?c.texture.update(L,{useMipmap:!0}):(c.texture=new m.Texture(U,L,X.RGBA,{useMipmap:!0}),c.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST),U.extTextureFilterAnisotropic&&X.texParameterf(X.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax)),c.state="loaded",m.cacheEntryPossiblyAdded(E.dispatcher),d(null)}})},f.prototype.abortTile=function(c,d){c.request&&(c.request.cancel(),delete c.request),d()},f.prototype.unloadTile=function(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()},f.prototype.hasTransition=function(){return!1},f}(m.Evented),Xe=function(l){function f(c,d,E,A){l.call(this,c,d,E,A),this.type="raster-dem",this.maxzoom=22,this._options=m.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},f.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function A(M,L){M&&(c.state="errored",d(M)),L&&(c.dem=L,c.needsHillshadePrepare=!0,c.state="loaded",d(null))}c.request=m.getImage(this.map._requestManager.transformRequest(E,m.ResourceType.Tile),function(M,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(M)c.state="errored",d(M);else if(L){this.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var U=m.window.ImageBitmap&&L instanceof m.window.ImageBitmap&&m.offscreenCanvasSupported()?L:m.browser.getImageData(L,1),X={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:U,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",X,A.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},f.prototype._getNeighboringTiles=function(c){var d=c.canonical,E=Math.pow(2,d.z),A=(d.x-1+E)%E,M=d.x===0?c.wrap-1:c.wrap,L=(d.x+1+E)%E,U=d.x+1===E?c.wrap+1:c.wrap,X={};return X[new m.OverscaledTileID(c.overscaledZ,M,d.z,A,d.y).key]={backfilled:!1},X[new m.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y).key]={backfilled:!1},d.y>0&&(X[new m.OverscaledTileID(c.overscaledZ,M,d.z,A,d.y-1).key]={backfilled:!1},X[new m.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},X[new m.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y-1).key]={backfilled:!1}),d.y+1<E&&(X[new m.OverscaledTileID(c.overscaledZ,M,d.z,A,d.y+1).key]={backfilled:!1},X[new m.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},X[new m.OverscaledTileID(c.overscaledZ,U,d.z,L,d.y+1).key]={backfilled:!1}),X},f.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},f}(Te),ke=function(l){function f(c,d,E,A){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=E.getActor(),this.setEventedParent(A),this._data=d.data,this._options=m.extend({},d),this._collectResourceTiming=d.collectResourceTiming,this._resourceTiming=[],d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;var M=m.EXTENT/this.tileSize;this.workerOptions=m.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*M,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*M,extent:m.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?Math.min(d.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:m.EXTENT,radius:(d.clusterRadius||50)*M,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(d){if(d)c.fire(new m.ErrorEvent(d));else{var E={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(E.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new m.Event("data",E))}})},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setData=function(c){var d=this;return this._data=c,this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(E){if(E)d.fire(new m.ErrorEvent(E));else{var A={dataType:"source",sourceDataType:"content"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(A.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new m.Event("data",A))}}),this},f.prototype.getClusterExpansionZoom=function(c,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},d),this},f.prototype.getClusterChildren=function(c,d){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},d),this},f.prototype.getClusterLeaves=function(c,d,E,A){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:d,offset:E},A),this},f.prototype._updateWorkerData=function(c){var d=this;this._loaded=!1;var E=m.extend({},this.workerOptions),A=this._data;typeof A=="string"?(E.request=this.map._requestManager.transformRequest(m.browser.resolveURL(A),m.ResourceType.Source),E.request.collectResourceTiming=this._collectResourceTiming):E.data=JSON.stringify(A),this.actor.send(this.type+".loadData",E,function(M,L){d._removed||L&&L.abandoned||(d._loaded=!0,L&&L.resourceTiming&&L.resourceTiming[d.id]&&(d._resourceTiming=L.resourceTiming[d.id].slice(0)),d.actor.send(d.type+".coalesce",{source:E.source},null),c(M))})},f.prototype.loaded=function(){return this._loaded},f.prototype.loadTile=function(c,d){var E=this,A=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(A,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(M,L){return delete c.request,c.unloadVectorData(),c.aborted?d(null):M?d(M):(c.loadVectorData(L,E.map.painter,A==="reloadTile"),d(null))})},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},f.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},f.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},f.prototype.serialize=function(){return m.extend({},this._options,{type:this.type,data:this._data})},f.prototype.hasTransition=function(){return!1},f}(m.Evented),St=m.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),vt=function(l){function f(c,d,E,A){l.call(this),this.id=c,this.dispatcher=E,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(A),this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(c,d){var E=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this.url=this.options.url,m.getImage(this.map._requestManager.transformRequest(this.url,m.ResourceType.Image),function(A,M){E._loaded=!0,A?E.fire(new m.ErrorEvent(A)):M&&(E.image=M,c&&(E.coordinates=c),d&&d(),E._finishLoading())})},f.prototype.loaded=function(){return this._loaded},f.prototype.updateImage=function(c){var d=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){d.texture=null}),this):this},f.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})))},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setCoordinates=function(c){var d=this;this.coordinates=c;var E=c.map(m.MercatorCoordinate.fromLngLat);this.tileID=function(M){for(var L=1/0,U=1/0,X=-1/0,oe=-1/0,fe=0,pe=M;fe<pe.length;fe+=1){var Re=pe[fe];L=Math.min(L,Re.x),U=Math.min(U,Re.y),X=Math.max(X,Re.x),oe=Math.max(oe,Re.y)}var Pe=Math.max(X-L,oe-U),He=Math.max(0,Math.floor(-Math.log(Pe)/Math.LN2)),be=Math.pow(2,He);return new m.CanonicalTileID(He,Math.floor((L+X)/2*be),Math.floor((U+oe)/2*be))}(E),this.minzoom=this.maxzoom=this.tileID.z;var A=E.map(function(M){return d.tileID.getTilePoint(M)._round()});return this._boundsArray=new m.StructArrayLayout4i8,this._boundsArray.emplaceBack(A[0].x,A[0].y,0,0),this._boundsArray.emplaceBack(A[1].x,A[1].y,m.EXTENT,0),this._boundsArray.emplaceBack(A[3].x,A[3].y,0,m.EXTENT),this._boundsArray.emplaceBack(A[2].x,A[2].y,m.EXTENT,m.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})),this},f.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,St.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new m.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var A=this.tiles[E];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture)}}},f.prototype.loadTile=function(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))},f.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return!1},f}(m.Evented),zt=function(l){function f(c,d,E,A){l.call(this,c,d,E,A),this.roundZoom=!0,this.type="video",this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1;var d=this.options;this.urls=[];for(var E=0,A=d.urls;E<A.length;E+=1)this.urls.push(this.map._requestManager.transformRequest(A[E],m.ResourceType.Source).url);m.getVideo(this.urls,function(M,L){c._loaded=!0,M?c.fire(new m.ErrorEvent(M)):L&&(c.video=L,c.video.loop=!0,c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},f.prototype.pause=function(){this.video&&this.video.pause()},f.prototype.play=function(){this.video&&this.video.play()},f.prototype.seek=function(c){if(this.video){var d=this.video.seekable;c<d.start(0)||c>d.end(0)?this.fire(new m.ErrorEvent(new m.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+d.start(0)+" and "+d.end(0)+"-second mark."))):this.video.currentTime=c}},f.prototype.getVideo=function(){return this.video},f.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},f.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,St.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new m.Texture(c,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var A=this.tiles[E];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this.video&&!this.video.paused},f}(vt),Yt=function(l){function f(c,d,E,A){l.call(this,c,d,E,A),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(function(M){return!Array.isArray(M)||M.length!==2||M.some(function(L){return typeof L!="number"})})||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof m.window.HTMLCanvasElement||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof m.window.HTMLCanvasElement?this.options.canvas:m.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new m.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},f.prototype.getCanvas=function(){return this.canvas},f.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},f.prototype.onRemove=function(){this.pause()},f.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var d=this.map.painter.context,E=d.gl;for(var A in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,St.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new m.Texture(d,this.canvas,E.RGBA,{premultiply:!0}),this.tiles){var M=this.tiles[A];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this._playing},f.prototype._hasInvalidDimensions=function(){for(var c=0,d=[this.canvas.width,this.canvas.height];c<d.length;c+=1){var E=d[c];if(isNaN(E)||E<=0)return!0}return!1},f}(vt),Cr={vector:Jr,raster:Te,"raster-dem":Xe,geojson:ke,video:zt,image:vt,canvas:Yt};function Yn(l,f){var c=m.identity([]);return m.translate(c,c,[1,1,0]),m.scale(c,c,[.5*l.width,.5*l.height,1]),m.multiply(c,c,l.calculatePosMatrix(f.toUnwrapped()))}function hn(l,f,c,d,E,A){var M=function(He,be,je){if(He)for(var et=0,yt=He;et<yt.length;et+=1){var Ht=be[yt[et]];if(Ht&&Ht.source===je&&Ht.type==="fill-extrusion")return!0}else for(var Nt in be){var Qt=be[Nt];if(Qt.source===je&&Qt.type==="fill-extrusion")return!0}return!1}(E&&E.layers,f,l.id),L=A.maxPitchScaleFactor(),U=l.tilesIn(d,L,M);U.sort(Ki);for(var X=[],oe=0,fe=U;oe<fe.length;oe+=1){var pe=fe[oe];X.push({wrappedTileID:pe.tileID.wrapped().key,queryResults:pe.tile.queryRenderedFeatures(f,c,l._state,pe.queryGeometry,pe.cameraQueryGeometry,pe.scale,E,A,L,Yn(l.transform,pe.tileID))})}var Re=function(He){for(var be={},je={},et=0,yt=He;et<yt.length;et+=1){var Ht=yt[et],Nt=Ht.queryResults,Qt=Ht.wrappedTileID,rr=je[Qt]=je[Qt]||{};for(var Ir in Nt)for(var Or=Nt[Ir],ln=rr[Ir]=rr[Ir]||{},Bn=be[Ir]=be[Ir]||[],Dn=0,Un=Or;Dn<Un.length;Dn+=1){var Ni=Un[Dn];ln[Ni.featureIndex]||(ln[Ni.featureIndex]=!0,Bn.push(Ni))}}return be}(X);for(var Pe in Re)Re[Pe].forEach(function(He){var be=He.feature,je=l.getFeatureState(be.layer["source-layer"],be.id);be.source=be.layer.source,be.layer["source-layer"]&&(be.sourceLayer=be.layer["source-layer"]),be.state=je});return Re}function Ki(l,f){var c=l.tileID,d=f.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}var Zn=function(l,f){this.max=l,this.onRemove=f,this.reset()};Zn.prototype.reset=function(){for(var l in this.data)for(var f=0,c=this.data[l];f<c.length;f+=1){var d=c[f];d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value)}return this.data={},this.order=[],this},Zn.prototype.add=function(l,f,c){var d=this,E=l.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);var A={value:f,timeout:void 0};if(c!==void 0&&(A.timeout=setTimeout(function(){d.remove(l,A)},c)),this.data[E].push(A),this.order.push(E),this.order.length>this.max){var M=this._getAndRemoveByKey(this.order[0]);M&&this.onRemove(M)}return this},Zn.prototype.has=function(l){return l.wrapped().key in this.data},Zn.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},Zn.prototype._getAndRemoveByKey=function(l){var f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value},Zn.prototype.getByKey=function(l){var f=this.data[l];return f?f[0].value:null},Zn.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},Zn.prototype.remove=function(l,f){if(!this.has(l))return this;var c=l.wrapped().key,d=f===void 0?0:this.data[c].indexOf(f),E=this.data[c][d];return this.data[c].splice(d,1),E.timeout&&clearTimeout(E.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(E.value),this.order.splice(this.order.indexOf(c),1),this},Zn.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this},Zn.prototype.filter=function(l){var f=[];for(var c in this.data)for(var d=0,E=this.data[c];d<E.length;d+=1){var A=E[d];l(A.value)||f.push(A)}for(var M=0,L=f;M<L.length;M+=1){var U=L[M];this.remove(U.value.tileID,U)}};var Wn=function(l,f,c){this.context=l;var d=l.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};Wn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Wn.prototype.updateData=function(l){var f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},Wn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var mi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},qn=function(l,f,c,d){this.length=f.length,this.attributes=c,this.itemSize=f.bytesPerElement,this.dynamicDraw=d,this.context=l;var E=l.gl;this.buffer=E.createBuffer(),l.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};qn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},qn.prototype.updateData=function(l){var f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)},qn.prototype.enableAttributes=function(l,f){for(var c=0;c<this.attributes.length;c++){var d=f.attributes[this.attributes[c].name];d!==void 0&&l.enableVertexAttribArray(d)}},qn.prototype.setVertexAttribPointers=function(l,f,c){for(var d=0;d<this.attributes.length;d++){var E=this.attributes[d],A=f.attributes[E.name];A!==void 0&&l.vertexAttribPointer(A,E.components,l[mi[E.type]],!1,this.itemSize,E.offset+this.itemSize*(c||0))}},qn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ui=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};ui.prototype.get=function(){return this.current},ui.prototype.set=function(l){},ui.prototype.getDefault=function(){return this.default},ui.prototype.setDefault=function(){this.set(this.default)};var ia=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return m.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(ui),ki=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 1},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},f}(ui),Ai=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},f}(ui),Vi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[!0,!0,!0,!0]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(ui),sa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},f}(ui),wi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 255},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},f}(ui),Ca=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},f.prototype.set=function(c){var d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},f}(ui),Mn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},f}(ui),Ei=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}},f}(ui),Zi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[0,1]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},f}(ui),$i=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}},f}(ui),Wa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.LESS},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},f}(ui),de=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}},f}(ui),Fn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},f}(ui),Xa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return m.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(ui),vs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.FUNC_ADD},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},f}(ui),jt=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}},f}(ui),or=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.BACK},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},f}(ui),Mr=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.CCW},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},f}(ui),I=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},f}(ui),ar=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.TEXTURE0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},f}(ui),kn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(ui),li=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},f}(ui),jn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(ui),an=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}},f}(ui),Pi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},f}(ui),Ii=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){var d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},f}(ui),Ja=function(l){function f(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},f}(ui),ms=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 4},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},f}(ui),xa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},f}(ui),ka=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},f}(ui),Ma=function(l){function f(c,d){l.call(this,c),this.context=c,this.parent=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f}(ui),H=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.setDirty=function(){this.dirty=!0},f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},f}(Ma),$=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(Ma),re=function(l,f,c,d){this.context=l,this.width=f,this.height=c;var E=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new H(l,E),d&&(this.depthAttachment=new $(l,E))};re.prototype.destroy=function(){var l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var ge=function(l,f,c){this.func=l,this.mask=f,this.range=c};ge.ReadOnly=!1,ge.ReadWrite=!0,ge.disabled=new ge(519,ge.ReadOnly,[0,1]);var Ie=function(l,f,c,d,E,A){this.test=l,this.ref=f,this.mask=c,this.fail=d,this.depthFail=E,this.pass=A};Ie.disabled=new Ie({func:519,mask:0},0,0,7680,7680,7680);var Ge=function(l,f,c){this.blendFunction=l,this.blendColor=f,this.mask=c};Ge.disabled=new Ge(Ge.Replace=[1,0],m.Color.transparent,[!1,!1,!1,!1]),Ge.unblended=new Ge(Ge.Replace,m.Color.transparent,[!0,!0,!0,!0]),Ge.alphaBlended=new Ge([1,771],m.Color.transparent,[!0,!0,!0,!0]);var rt=function(l,f,c){this.enable=l,this.mode=f,this.frontFace=c};rt.disabled=new rt(!1,1029,2305),rt.backCCW=new rt(!0,1029,2305);var ce=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ia(this),this.clearDepth=new ki(this),this.clearStencil=new Ai(this),this.colorMask=new Vi(this),this.depthMask=new sa(this),this.stencilMask=new wi(this),this.stencilFunc=new Ca(this),this.stencilOp=new Mn(this),this.stencilTest=new Ei(this),this.depthRange=new Zi(this),this.depthTest=new $i(this),this.depthFunc=new Wa(this),this.blend=new de(this),this.blendFunc=new Fn(this),this.blendColor=new Xa(this),this.blendEquation=new vs(this),this.cullFace=new jt(this),this.cullFaceSide=new or(this),this.frontFace=new Mr(this),this.program=new I(this),this.activeTexture=new ar(this),this.viewport=new kn(this),this.bindFramebuffer=new li(this),this.bindRenderbuffer=new jn(this),this.bindTexture=new an(this),this.bindVertexBuffer=new Pi(this),this.bindElementBuffer=new Ii(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ja(this),this.pixelStoreUnpack=new ms(this),this.pixelStoreUnpackPremultiplyAlpha=new xa(this),this.pixelStoreUnpackFlipY=new ka(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};ce.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ce.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ce.prototype.createIndexBuffer=function(l,f){return new Wn(this,l,f)},ce.prototype.createVertexBuffer=function(l,f,c){return new qn(this,l,f,c)},ce.prototype.createRenderbuffer=function(l,f,c){var d=this.gl,E=d.createRenderbuffer();return this.bindRenderbuffer.set(E),d.renderbufferStorage(d.RENDERBUFFER,l,f,c),this.bindRenderbuffer.set(null),E},ce.prototype.createFramebuffer=function(l,f,c){return new re(this,l,f,c)},ce.prototype.clear=function(l){var f=l.color,c=l.depth,d=this.gl,E=0;f&&(E|=d.COLOR_BUFFER_BIT,this.clearColor.set(f),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(E|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),d.clear(E)},ce.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},ce.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},ce.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},ce.prototype.setColorMode=function(l){m.deepEqual(l.blendFunction,Ge.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},ce.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var De=function(l){function f(c,d,E){var A=this;l.call(this),this.id=c,this.dispatcher=E,this.on("data",function(M){M.dataType==="source"&&M.sourceDataType==="metadata"&&(A._sourceLoaded=!0),A._sourceLoaded&&!A._paused&&M.dataType==="source"&&M.sourceDataType==="content"&&(A.reload(),A.transform&&A.update(A.transform))}),this.on("error",function(){A._sourceErrored=!0}),this._source=function(M,L,U,X){var oe=new Cr[L.type](M,L,U,X);if(oe.id!==M)throw new Error("Expected Source id to be "+M+" instead of "+oe.id);return m.bindAll(["load","abort","unload","serialize","prepare"],oe),oe}(c,d,E,this),this._tiles={},this._cache=new Zn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new m.SourceFeatureState}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},f.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},f.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var d=this._tiles[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0},f.prototype.getSource=function(){return this._source},f.prototype.pause=function(){this._paused=!0},f.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},f.prototype._loadTile=function(c,d){return this._source.loadTile(c,d)},f.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},f.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},f.prototype.serialize=function(){return this._source.serialize()},f.prototype.prepare=function(c){for(var d in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var E=this._tiles[d];E.upload(c),E.prepare(this.map.style.imageManager)}},f.prototype.getIds=function(){return m.values(this._tiles).map(function(c){return c.tileID}).sort(mt).map(function(c){return c.key})},f.prototype.getRenderableIds=function(c){var d=this,E=[];for(var A in this._tiles)this._isIdRenderable(A,c)&&E.push(this._tiles[A]);return c?E.sort(function(M,L){var U=M.tileID,X=L.tileID,oe=new m.Point(U.canonical.x,U.canonical.y)._rotate(d.transform.angle),fe=new m.Point(X.canonical.x,X.canonical.y)._rotate(d.transform.angle);return U.overscaledZ-X.overscaledZ||fe.y-oe.y||fe.x-oe.x}).map(function(M){return M.tileID.key}):E.map(function(M){return M.tileID}).sort(mt).map(function(M){return M.key})},f.prototype.hasRenderableParent=function(c){var d=this.findLoadedParent(c,0);return!!d&&this._isIdRenderable(d.tileID.key)},f.prototype._isIdRenderable=function(c,d){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(d||!this._tiles[c].holdingForFade())},f.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},f.prototype._reloadTile=function(c,d){var E=this._tiles[c];E&&(E.state!=="loading"&&(E.state=d),this._loadTile(E,this._tileLoaded.bind(this,E,c,d)))},f.prototype._tileLoaded=function(c,d,E,A){if(A)return c.state="errored",void(A.status!==404?this._source.fire(new m.ErrorEvent(A,{tile:c})):this.update(this.transform));c.timeAdded=m.browser.now(),E==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(d,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new m.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},f.prototype._backfillDEM=function(c){for(var d=this.getRenderableIds(),E=0;E<d.length;E++){var A=d[E];if(c.neighboringTiles&&c.neighboringTiles[A]){var M=this.getTileByID(A);L(c,M),L(M,c)}}function L(U,X){U.needsHillshadePrepare=!0;var oe=X.tileID.canonical.x-U.tileID.canonical.x,fe=X.tileID.canonical.y-U.tileID.canonical.y,pe=Math.pow(2,U.tileID.canonical.z),Re=X.tileID.key;oe===0&&fe===0||Math.abs(fe)>1||(Math.abs(oe)>1&&(Math.abs(oe+pe)===1?oe+=pe:Math.abs(oe-pe)===1&&(oe-=pe)),X.dem&&U.dem&&(U.dem.backfillBorder(X.dem,oe,fe),U.neighboringTiles&&U.neighboringTiles[Re]&&(U.neighboringTiles[Re].backfilled=!0)))}},f.prototype.getTile=function(c){return this.getTileByID(c.key)},f.prototype.getTileByID=function(c){return this._tiles[c]},f.prototype._retainLoadedChildren=function(c,d,E,A){for(var M in this._tiles){var L=this._tiles[M];if(!(A[M]||!L.hasData()||L.tileID.overscaledZ<=d||L.tileID.overscaledZ>E)){for(var U=L.tileID;L&&L.tileID.overscaledZ>d+1;){var X=L.tileID.scaledTo(L.tileID.overscaledZ-1);(L=this._tiles[X.key])&&L.hasData()&&(U=X)}for(var oe=U;oe.overscaledZ>d;)if(c[(oe=oe.scaledTo(oe.overscaledZ-1)).key]){A[U.key]=U;break}}}},f.prototype.findLoadedParent=function(c,d){if(c.key in this._loadedParentTiles){var E=this._loadedParentTiles[c.key];return E&&E.tileID.overscaledZ>=d?E:null}for(var A=c.overscaledZ-1;A>=d;A--){var M=c.scaledTo(A),L=this._getLoadedTile(M);if(L)return L}},f.prototype._getLoadedTile=function(c){var d=this._tiles[c.key];return d&&d.hasData()?d:this._cache.getByKey(c.wrapped().key)},f.prototype.updateCacheSize=function(c){var d=Math.ceil(c.width/this._source.tileSize)+1,E=Math.ceil(c.height/this._source.tileSize)+1,A=Math.floor(d*E*5),M=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,A):A;this._cache.setMaxSize(M)},f.prototype.handleWrapJump=function(c){var d=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,d){var E={};for(var A in this._tiles){var M=this._tiles[A];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+d),E[M.tileID.key]=M}for(var L in this._tiles=E,this._timers)clearTimeout(this._timers[L]),delete this._timers[L];for(var U in this._tiles)this._setTileReloadTimer(U,this._tiles[U])}},f.prototype.update=function(c){var d=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var E;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?E=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(rr){return new m.OverscaledTileID(rr.canonical.z,rr.wrap,rr.canonical.z,rr.canonical.x,rr.canonical.y)}):(E=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(E=E.filter(function(rr){return d._source.hasTile(rr)}))):E=[];var A=c.coveringZoomLevel(this._source),M=Math.max(A-f.maxOverzooming,this._source.minzoom),L=Math.max(A+f.maxUnderzooming,this._source.minzoom),U=this._updateRetainedTiles(E,A);if(mr(this._source.type)){for(var X={},oe={},fe=0,pe=Object.keys(U);fe<pe.length;fe+=1){var Re=pe[fe],Pe=U[Re],He=this._tiles[Re];if(He&&!(He.fadeEndTime&&He.fadeEndTime<=m.browser.now())){var be=this.findLoadedParent(Pe,M);be&&(this._addTile(be.tileID),X[be.tileID.key]=be.tileID),oe[Re]=Pe}}for(var je in this._retainLoadedChildren(oe,A,L,U),X)U[je]||(this._coveredTiles[je]=!0,U[je]=X[je])}for(var et in U)this._tiles[et].clearFadeHold();for(var yt=0,Ht=m.keysDifference(this._tiles,U);yt<Ht.length;yt+=1){var Nt=Ht[yt],Qt=this._tiles[Nt];Qt.hasSymbolBuckets&&!Qt.holdingForFade()?Qt.setHoldDuration(this.map._fadeDuration):Qt.hasSymbolBuckets&&!Qt.symbolFadeFinished()||this._removeTile(Nt)}this._updateLoadedParentTileCache()}},f.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},f.prototype._updateRetainedTiles=function(c,d){for(var E={},A={},M=Math.max(d-f.maxOverzooming,this._source.minzoom),L=Math.max(d+f.maxUnderzooming,this._source.minzoom),U={},X=0,oe=c;X<oe.length;X+=1){var fe=oe[X],pe=this._addTile(fe);E[fe.key]=fe,pe.hasData()||d<this._source.maxzoom&&(U[fe.key]=fe)}this._retainLoadedChildren(U,d,L,E);for(var Re=0,Pe=c;Re<Pe.length;Re+=1){var He=Pe[Re],be=this._tiles[He.key];if(!be.hasData()){if(d+1>this._source.maxzoom){var je=He.children(this._source.maxzoom)[0],et=this.getTile(je);if(et&&et.hasData()){E[je.key]=je;continue}}else{var yt=He.children(this._source.maxzoom);if(E[yt[0].key]&&E[yt[1].key]&&E[yt[2].key]&&E[yt[3].key])continue}for(var Ht=be.wasRequested(),Nt=He.overscaledZ-1;Nt>=M;--Nt){var Qt=He.scaledTo(Nt);if(A[Qt.key]||(A[Qt.key]=!0,!(be=this.getTile(Qt))&&Ht&&(be=this._addTile(Qt)),be&&(E[Qt.key]=Qt,Ht=be.wasRequested(),be.hasData())))break}}}return E},f.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var d=[],E=void 0,A=this._tiles[c].tileID;A.overscaledZ>0;){if(A.key in this._loadedParentTiles){E=this._loadedParentTiles[A.key];break}d.push(A.key);var M=A.scaledTo(A.overscaledZ-1);if(E=this._getLoadedTile(M))break;A=M}for(var L=0,U=d;L<U.length;L+=1)this._loadedParentTiles[U[L]]=E}},f.prototype._addTile=function(c){var d=this._tiles[c.key];if(d)return d;(d=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,d),d.tileID=c,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,d)));var E=Boolean(d);return E||(d=new m.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,c.key,d.state))),d?(d.uses++,this._tiles[c.key]=d,E||this._source.fire(new m.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null},f.prototype._setTileReloadTimer=function(c,d){var E=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var A=d.getExpiryTimeout();A&&(this._timers[c]=setTimeout(function(){E._reloadTile(c,"expired"),delete E._timers[c]},A))},f.prototype._removeTile=function(c){var d=this._tiles[c];d&&(d.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))},f.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},f.prototype.tilesIn=function(c,d,E){var A=this,M=[],L=this.transform;if(!L)return M;for(var U=E?L.getCameraQueryGeometry(c):c,X=c.map(function(Nt){return L.pointCoordinate(Nt)}),oe=U.map(function(Nt){return L.pointCoordinate(Nt)}),fe=this.getIds(),pe=1/0,Re=1/0,Pe=-1/0,He=-1/0,be=0,je=oe;be<je.length;be+=1){var et=je[be];pe=Math.min(pe,et.x),Re=Math.min(Re,et.y),Pe=Math.max(Pe,et.x),He=Math.max(He,et.y)}for(var yt=function(Nt){var Qt=A._tiles[fe[Nt]];if(!Qt.holdingForFade()){var rr=Qt.tileID,Ir=Math.pow(2,L.zoom-Qt.tileID.overscaledZ),Or=d*Qt.queryPadding*m.EXTENT/Qt.tileSize/Ir,ln=[rr.getTilePoint(new m.MercatorCoordinate(pe,Re)),rr.getTilePoint(new m.MercatorCoordinate(Pe,He))];if(ln[0].x-Or<m.EXTENT&&ln[0].y-Or<m.EXTENT&&ln[1].x+Or>=0&&ln[1].y+Or>=0){var Bn=X.map(function(Un){return rr.getTilePoint(Un)}),Dn=oe.map(function(Un){return rr.getTilePoint(Un)});M.push({tile:Qt,tileID:rr,queryGeometry:Bn,cameraQueryGeometry:Dn,scale:Ir})}}},Ht=0;Ht<fe.length;Ht++)yt(Ht);return M},f.prototype.getVisibleCoordinates=function(c){for(var d=this,E=this.getRenderableIds(c).map(function(U){return d._tiles[U].tileID}),A=0,M=E;A<M.length;A+=1){var L=M[A];L.posMatrix=this.transform.calculatePosMatrix(L.toUnwrapped())}return E},f.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(mr(this._source.type))for(var c in this._tiles){var d=this._tiles[c];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=m.browser.now())return!0}return!1},f.prototype.setFeatureState=function(c,d,E){this._state.updateState(c=c||"_geojsonTileLayer",d,E)},f.prototype.removeFeatureState=function(c,d,E){this._state.removeFeatureState(c=c||"_geojsonTileLayer",d,E)},f.prototype.getFeatureState=function(c,d){return this._state.getState(c=c||"_geojsonTileLayer",d)},f.prototype.setDependencies=function(c,d,E){var A=this._tiles[c];A&&A.setDependencies(d,E)},f.prototype.reloadTilesForDependencies=function(c,d){for(var E in this._tiles)this._tiles[E].hasDependency(c,d)&&this._reloadTile(E,"reloading");this._cache.filter(function(A){return!A.hasDependency(c,d)})},f}(m.Evented);function mt(l,f){var c=Math.abs(2*l.wrap)-+(l.wrap<0),d=Math.abs(2*f.wrap)-+(f.wrap<0);return l.overscaledZ-f.overscaledZ||d-c||f.canonical.y-l.canonical.y||f.canonical.x-l.canonical.x}function mr(l){return l==="raster"||l==="image"||l==="video"}function Dt(){return new m.window.Worker(ac.workerUrl)}De.maxOverzooming=10,De.maxUnderzooming=3;var Bt="mapboxgl_preloaded_worker_pool",yr=function(){this.active={}};yr.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<yr.workerCount;)this.workers.push(new Dt);return this.active[l]=!0,this.workers.slice()},yr.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(f){f.terminate()}),this.workers=null)},yr.prototype.isPreloaded=function(){return!!this.active[Bt]},yr.prototype.numActive=function(){return Object.keys(this.active).length};var En,cn=Math.floor(m.browser.hardwareConcurrency/2);function Pt(){return En||(En=new yr),En}function un(l,f){var c={};for(var d in l)d!=="ref"&&(c[d]=l[d]);return m.refProperties.forEach(function(E){E in f&&(c[E]=f[E])}),c}function Gr(l){l=l.slice();for(var f=Object.create(null),c=0;c<l.length;c++)f[l[c].id]=l[c];for(var d=0;d<l.length;d++)"ref"in l[d]&&(l[d]=un(l[d],f[l[d].ref]));return l}yr.workerCount=Math.max(Math.min(cn,6),1);var Wr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function oi(l,f,c){c.push({command:Wr.addSource,args:[l,f[l]]})}function rn(l,f,c){f.push({command:Wr.removeSource,args:[l]}),c[l]=!0}function Ti(l,f,c,d){rn(l,c,d),oi(l,f,c)}function ea(l,f,c){var d;for(d in l[c])if(l[c].hasOwnProperty(d)&&d!=="data"&&!m.deepEqual(l[c][d],f[c][d]))return!1;for(d in f[c])if(f[c].hasOwnProperty(d)&&d!=="data"&&!m.deepEqual(l[c][d],f[c][d]))return!1;return!0}function bi(l,f,c,d,E,A){var M;for(M in f=f||{},l=l||{})l.hasOwnProperty(M)&&(m.deepEqual(l[M],f[M])||c.push({command:A,args:[d,M,f[M],E]}));for(M in f)f.hasOwnProperty(M)&&!l.hasOwnProperty(M)&&(m.deepEqual(l[M],f[M])||c.push({command:A,args:[d,M,f[M],E]}))}function Oi(l){return l.id}function Si(l,f){return l[f.id]=f,l}var ri=function(l,f){this.reset(l,f)};ri.prototype.reset=function(l,f){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding},ri.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=m.clamp(l,0,1);for(var f=1,c=this._distances[f],d=l*this.paddedLength+this.padding;c<d&&f<this._distances.length;)c=this._distances[++f];var E=f-1,A=this._distances[E],M=c-A,L=M>0?(d-A)/M:0;return this.points[E].mult(1-L).add(this.points[f].mult(L))};var Xi=function(l,f,c){var d=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(f/c);for(var A=0;A<this.xCellCount*this.yCellCount;A++)d.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0};function Da(l,f,c,d,E){var A=m.create();return f?(m.scale(A,A,[1/E,1/E,1]),c||m.rotateZ(A,A,d.angle)):m.multiply(A,d.labelPlaneMatrix,l),A}function aa(l,f,c,d,E){if(f){var A=m.clone(l);return m.scale(A,A,[E,E,1]),c||m.rotateZ(A,A,-d.angle),A}return d.glCoordMatrix}function Ri(l,f){var c=[l.x,l.y,0,1];Ua(c,c,f);var d=c[3];return{point:new m.Point(c[0]/d,c[1]/d),signedDistanceFromCamera:d}}function Gi(l,f){return .5+l/f*.5}function za(l,f){var c=l[0]/l[3],d=l[1]/l[3];return c>=-f[0]&&c<=f[0]&&d>=-f[1]&&d<=f[1]}function su(l,f,c,d,E,A,M,L){var U=d?l.textSizeData:l.iconSizeData,X=m.evaluateSizeForZoom(U,c.transform.zoom),oe=[256/c.width*2+1,256/c.height*2+1],fe=d?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;fe.clear();for(var pe=l.lineVertexArray,Re=d?l.text.placedSymbolArray:l.icon.placedSymbolArray,Pe=c.transform.width/c.transform.height,He=!1,be=0;be<Re.length;be++){var je=Re.get(be);if(je.hidden||je.writingMode===m.WritingMode.vertical&&!He)_o(je.numGlyphs,fe);else{He=!1;var et=[je.anchorX,je.anchorY,0,1];if(m.transformMat4(et,et,f),za(et,oe)){var yt=Gi(c.transform.cameraToCenterDistance,et[3]),Ht=m.evaluateSizeForFeature(U,X,je),Nt=M?Ht/yt:Ht*yt,Qt=new m.Point(je.anchorX,je.anchorY),rr=Ri(Qt,E).point,Ir={},Or=As(je,Nt,!1,L,f,E,A,l.glyphOffsetArray,pe,fe,rr,Qt,Ir,Pe);He=Or.useVertical,(Or.notEnoughRoom||He||Or.needsFlipping&&As(je,Nt,!0,L,f,E,A,l.glyphOffsetArray,pe,fe,rr,Qt,Ir,Pe).notEnoughRoom)&&_o(je.numGlyphs,fe)}else _o(je.numGlyphs,fe)}}d?l.text.dynamicLayoutVertexBuffer.updateData(fe):l.icon.dynamicLayoutVertexBuffer.updateData(fe)}function Pa(l,f,c,d,E,A,M,L,U,X,oe){var fe=L.glyphStartIndex+L.numGlyphs,pe=L.lineStartIndex,Re=L.lineStartIndex+L.lineLength,Pe=f.getoffsetX(L.glyphStartIndex),He=f.getoffsetX(fe-1),be=ta(l*Pe,c,d,E,A,M,L.segment,pe,Re,U,X,oe);if(!be)return null;var je=ta(l*He,c,d,E,A,M,L.segment,pe,Re,U,X,oe);return je?{first:be,last:je}:null}function Ia(l,f,c,d){return l===m.WritingMode.horizontal&&Math.abs(c.y-f.y)>Math.abs(c.x-f.x)*d?{useVertical:!0}:(l===m.WritingMode.vertical?f.y<c.y:f.x>c.x)?{needsFlipping:!0}:null}function As(l,f,c,d,E,A,M,L,U,X,oe,fe,pe,Re){var Pe,He=f/24,be=l.lineOffsetX*He,je=l.lineOffsetY*He;if(l.numGlyphs>1){var et=l.glyphStartIndex+l.numGlyphs,yt=l.lineStartIndex,Ht=l.lineStartIndex+l.lineLength,Nt=Pa(He,L,be,je,c,oe,fe,l,U,A,pe);if(!Nt)return{notEnoughRoom:!0};var Qt=Ri(Nt.first.point,M).point,rr=Ri(Nt.last.point,M).point;if(d&&!c){var Ir=Ia(l.writingMode,Qt,rr,Re);if(Ir)return Ir}Pe=[Nt.first];for(var Or=l.glyphStartIndex+1;Or<et-1;Or++)Pe.push(ta(He*L.getoffsetX(Or),be,je,c,oe,fe,l.segment,yt,Ht,U,A,pe));Pe.push(Nt.last)}else{if(d&&!c){var ln=Ri(fe,E).point,Bn=l.lineStartIndex+l.segment+1,Dn=new m.Point(U.getx(Bn),U.gety(Bn)),Un=Ri(Dn,E),Ni=Un.signedDistanceFromCamera>0?Un.point:gs(fe,Dn,ln,1,E),on=Ia(l.writingMode,ln,Ni,Re);if(on)return on}var ni=ta(He*L.getoffsetX(l.glyphStartIndex),be,je,c,oe,fe,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,U,A,pe);if(!ni)return{notEnoughRoom:!0};Pe=[ni]}for(var pi=0,ei=Pe;pi<ei.length;pi+=1){var Vn=ei[pi];m.addDynamicAttributes(X,Vn.point,Vn.angle)}return{}}function gs(l,f,c,d,E){var A=Ri(l.add(l.sub(f)._unit()),E).point,M=c.sub(A);return c.add(M._mult(d/M.mag()))}function ta(l,f,c,d,E,A,M,L,U,X,oe,fe){var pe=d?l-f:l+f,Re=pe>0?1:-1,Pe=0;d&&(Re*=-1,Pe=Math.PI),Re<0&&(Pe+=Math.PI);for(var He=Re>0?L+M:L+M+1,be=E,je=E,et=0,yt=0,Ht=Math.abs(pe),Nt=[];et+yt<=Ht;){if((He+=Re)<L||He>=U)return null;if(je=be,Nt.push(be),(be=fe[He])===void 0){var Qt=new m.Point(X.getx(He),X.gety(He)),rr=Ri(Qt,oe);if(rr.signedDistanceFromCamera>0)be=fe[He]=rr.point;else{var Ir=He-Re;be=gs(et===0?A:new m.Point(X.getx(Ir),X.gety(Ir)),Qt,je,Ht-et+1,oe)}}et+=yt,yt=je.dist(be)}var Or=(Ht-et)/yt,ln=be.sub(je),Bn=ln.mult(Or)._add(je);Bn._add(ln._unit()._perp()._mult(c*Re));var Dn=Pe+Math.atan2(be.y-je.y,be.x-je.x);return Nt.push(Bn),{point:Bn,angle:Dn,path:Nt}}Xi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Xi.prototype.insert=function(l,f,c,d,E){this._forEachCell(f,c,d,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(E)},Xi.prototype.insertCircle=function(l,f,c,d){this._forEachCell(f-d,c-d,f+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(c),this.circles.push(d)},Xi.prototype._insertBoxCell=function(l,f,c,d,E,A){this.boxCells[E].push(A)},Xi.prototype._insertCircleCell=function(l,f,c,d,E,A){this.circleCells[E].push(A)},Xi.prototype._query=function(l,f,c,d,E,A){if(c<0||l>this.width||d<0||f>this.height)return!E&&[];var M=[];if(l<=0&&f<=0&&this.width<=c&&this.height<=d){if(E)return!0;for(var L=0;L<this.boxKeys.length;L++)M.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(var U=0;U<this.circleKeys.length;U++){var X=this.circles[3*U],oe=this.circles[3*U+1],fe=this.circles[3*U+2];M.push({key:this.circleKeys[U],x1:X-fe,y1:oe-fe,x2:X+fe,y2:oe+fe})}return A?M.filter(A):M}return this._forEachCell(l,f,c,d,this._queryCell,M,{hitTest:E,seenUids:{box:{},circle:{}}},A),E?M.length>0:M},Xi.prototype._queryCircle=function(l,f,c,d,E){var A=l-c,M=l+c,L=f-c,U=f+c;if(M<0||A>this.width||U<0||L>this.height)return!d&&[];var X=[];return this._forEachCell(A,L,M,U,this._queryCellCircle,X,{hitTest:d,circle:{x:l,y:f,radius:c},seenUids:{box:{},circle:{}}},E),d?X.length>0:X},Xi.prototype.query=function(l,f,c,d,E){return this._query(l,f,c,d,!1,E)},Xi.prototype.hitTest=function(l,f,c,d,E){return this._query(l,f,c,d,!0,E)},Xi.prototype.hitTestCircle=function(l,f,c,d){return this._queryCircle(l,f,c,!0,d)},Xi.prototype._queryCell=function(l,f,c,d,E,A,M,L){var U=M.seenUids,X=this.boxCells[E];if(X!==null)for(var oe=this.bboxes,fe=0,pe=X;fe<pe.length;fe+=1){var Re=pe[fe];if(!U.box[Re]){U.box[Re]=!0;var Pe=4*Re;if(l<=oe[Pe+2]&&f<=oe[Pe+3]&&c>=oe[Pe+0]&&d>=oe[Pe+1]&&(!L||L(this.boxKeys[Re]))){if(M.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[Re],x1:oe[Pe],y1:oe[Pe+1],x2:oe[Pe+2],y2:oe[Pe+3]})}}}var He=this.circleCells[E];if(He!==null)for(var be=this.circles,je=0,et=He;je<et.length;je+=1){var yt=et[je];if(!U.circle[yt]){U.circle[yt]=!0;var Ht=3*yt;if(this._circleAndRectCollide(be[Ht],be[Ht+1],be[Ht+2],l,f,c,d)&&(!L||L(this.circleKeys[yt]))){if(M.hitTest)return A.push(!0),!0;var Nt=be[Ht],Qt=be[Ht+1],rr=be[Ht+2];A.push({key:this.circleKeys[yt],x1:Nt-rr,y1:Qt-rr,x2:Nt+rr,y2:Qt+rr})}}}},Xi.prototype._queryCellCircle=function(l,f,c,d,E,A,M,L){var U=M.circle,X=M.seenUids,oe=this.boxCells[E];if(oe!==null)for(var fe=this.bboxes,pe=0,Re=oe;pe<Re.length;pe+=1){var Pe=Re[pe];if(!X.box[Pe]){X.box[Pe]=!0;var He=4*Pe;if(this._circleAndRectCollide(U.x,U.y,U.radius,fe[He+0],fe[He+1],fe[He+2],fe[He+3])&&(!L||L(this.boxKeys[Pe])))return A.push(!0),!0}}var be=this.circleCells[E];if(be!==null)for(var je=this.circles,et=0,yt=be;et<yt.length;et+=1){var Ht=yt[et];if(!X.circle[Ht]){X.circle[Ht]=!0;var Nt=3*Ht;if(this._circlesCollide(je[Nt],je[Nt+1],je[Nt+2],U.x,U.y,U.radius)&&(!L||L(this.circleKeys[Ht])))return A.push(!0),!0}}},Xi.prototype._forEachCell=function(l,f,c,d,E,A,M,L){for(var U=this._convertToXCellCoord(l),X=this._convertToYCellCoord(f),oe=this._convertToXCellCoord(c),fe=this._convertToYCellCoord(d),pe=U;pe<=oe;pe++)for(var Re=X;Re<=fe;Re++)if(E.call(this,l,f,c,d,this.xCellCount*Re+pe,A,M,L))return},Xi.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},Xi.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},Xi.prototype._circlesCollide=function(l,f,c,d,E,A){var M=d-l,L=E-f,U=c+A;return U*U>M*M+L*L},Xi.prototype._circleAndRectCollide=function(l,f,c,d,E,A,M){var L=(A-d)/2,U=Math.abs(l-(d+L));if(U>L+c)return!1;var X=(M-E)/2,oe=Math.abs(f-(E+X));if(oe>X+c)return!1;if(U<=L||oe<=X)return!0;var fe=U-L,pe=oe-X;return fe*fe+pe*pe<=c*c};var Yu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function _o(l,f){for(var c=0;c<l;c++){var d=f.length;f.resize(d+4),f.float32.set(Yu,3*d)}}function Ua(l,f,c){var d=f[0],E=f[1];return l[0]=c[0]*d+c[4]*E+c[12],l[1]=c[1]*d+c[5]*E+c[13],l[3]=c[3]*d+c[7]*E+c[15],l}var so=function(l,f,c){f===void 0&&(f=new Xi(l.width+200,l.height+200,25)),c===void 0&&(c=new Xi(l.width+200,l.height+200,25)),this.transform=l,this.grid=f,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function Qi(l,f,c){return f*(m.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}so.prototype.placeCollisionBox=function(l,f,c,d,E){var A=this.projectAndGetPerspectiveRatio(d,l.anchorPointX,l.anchorPointY),M=c*A.perspectiveRatio,L=l.x1*M+A.point.x,U=l.y1*M+A.point.y,X=l.x2*M+A.point.x,oe=l.y2*M+A.point.y;return!this.isInsideGrid(L,U,X,oe)||!f&&this.grid.hitTest(L,U,X,oe,E)?{box:[],offscreen:!1}:{box:[L,U,X,oe],offscreen:this.isOffscreen(L,U,X,oe)}},so.prototype.placeCollisionCircles=function(l,f,c,d,E,A,M,L,U,X,oe,fe,pe){var Re=[],Pe=new m.Point(f.anchorX,f.anchorY),He=Ri(Pe,A),be=Gi(this.transform.cameraToCenterDistance,He.signedDistanceFromCamera),je=(X?E/be:E*be)/m.ONE_EM,et=Ri(Pe,M).point,yt=Pa(je,d,f.lineOffsetX*je,f.lineOffsetY*je,!1,et,Pe,f,c,M,{}),Ht=!1,Nt=!1,Qt=!0;if(yt){for(var rr=.5*fe*be+pe,Ir=new m.Point(-100,-100),Or=new m.Point(this.screenRightBoundary,this.screenBottomBoundary),ln=new ri,Bn=yt.first,Dn=yt.last,Un=[],Ni=Bn.path.length-1;Ni>=1;Ni--)Un.push(Bn.path[Ni]);for(var on=1;on<Dn.path.length;on++)Un.push(Dn.path[on]);var ni=2.5*rr;if(L){var pi=Un.map(function(Ra){return Ri(Ra,L)});Un=pi.some(function(Ra){return Ra.signedDistanceFromCamera<=0})?[]:pi.map(function(Ra){return Ra.point})}var ei=[];if(Un.length>0){for(var Vn=Un[0].clone(),gi=Un[0].clone(),Kn=1;Kn<Un.length;Kn++)Vn.x=Math.min(Vn.x,Un[Kn].x),Vn.y=Math.min(Vn.y,Un[Kn].y),gi.x=Math.max(gi.x,Un[Kn].x),gi.y=Math.max(gi.y,Un[Kn].y);ei=Vn.x>=Ir.x&&gi.x<=Or.x&&Vn.y>=Ir.y&&gi.y<=Or.y?[Un]:gi.x<Ir.x||Vn.x>Or.x||gi.y<Ir.y||Vn.y>Or.y?[]:m.clipLine([Un],Ir.x,Ir.y,Or.x,Or.y)}for(var Gn=0,Mo=ei;Gn<Mo.length;Gn+=1){var ua;ln.reset(Mo[Gn],.25*rr),ua=ln.length<=.5*rr?1:Math.ceil(ln.paddedLength/ni)+1;for(var Wo=0;Wo<ua;Wo++){var to=Wo/Math.max(ua-1,1),ro=ln.lerp(to),Za=ro.x+100,bs=ro.y+100;Re.push(Za,bs,rr,0);var Es=Za-rr,Nu=bs-rr,Ss=Za+rr,hu=bs+rr;if(Qt=Qt&&this.isOffscreen(Es,Nu,Ss,hu),Nt=Nt||this.isInsideGrid(Es,Nu,Ss,hu),!l&&this.grid.hitTestCircle(Za,bs,rr,oe)&&(Ht=!0,!U))return{circles:[],offscreen:!1,collisionDetected:Ht}}}}return{circles:!U&&Ht||!Nt?[]:Re,offscreen:Qt,collisionDetected:Ht}},so.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var f=[],c=1/0,d=1/0,E=-1/0,A=-1/0,M=0,L=l;M<L.length;M+=1){var U=L[M],X=new m.Point(U.x+100,U.y+100);c=Math.min(c,X.x),d=Math.min(d,X.y),E=Math.max(E,X.x),A=Math.max(A,X.y),f.push(X)}for(var oe={},fe={},pe=0,Re=this.grid.query(c,d,E,A).concat(this.ignoredGrid.query(c,d,E,A));pe<Re.length;pe+=1){var Pe=Re[pe],He=Pe.key;if(oe[He.bucketInstanceId]===void 0&&(oe[He.bucketInstanceId]={}),!oe[He.bucketInstanceId][He.featureIndex]){var be=[new m.Point(Pe.x1,Pe.y1),new m.Point(Pe.x2,Pe.y1),new m.Point(Pe.x2,Pe.y2),new m.Point(Pe.x1,Pe.y2)];m.polygonIntersectsPolygon(f,be)&&(oe[He.bucketInstanceId][He.featureIndex]=!0,fe[He.bucketInstanceId]===void 0&&(fe[He.bucketInstanceId]=[]),fe[He.bucketInstanceId].push(He.featureIndex))}}return fe},so.prototype.insertCollisionBox=function(l,f,c,d,E){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:E},l[0],l[1],l[2],l[3])},so.prototype.insertCollisionCircles=function(l,f,c,d,E){for(var A=f?this.ignoredGrid:this.grid,M={bucketInstanceId:c,featureIndex:d,collisionGroupID:E},L=0;L<l.length;L+=4)A.insertCircle(M,l[L],l[L+1],l[L+2])},so.prototype.projectAndGetPerspectiveRatio=function(l,f,c){var d=[f,c,0,1];return Ua(d,d,l),{point:new m.Point((d[0]/d[3]+1)/2*this.transform.width+100,(-d[1]/d[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}},so.prototype.isOffscreen=function(l,f,c,d){return c<100||l>=this.screenRightBoundary||d<100||f>this.screenBottomBoundary},so.prototype.isInsideGrid=function(l,f,c,d){return c>=0&&l<this.gridRightBoundary&&d>=0&&f<this.gridBottomBoundary},so.prototype.getViewportMatrix=function(){var l=m.identity([]);return m.translate(l,l,[-100,-100,0]),l};var qo=function(l,f,c,d){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):d&&c?1:0,this.placed=c};qo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Ko=function(l,f,c,d,E){this.text=new qo(l?l.text:null,f,c,E),this.icon=new qo(l?l.icon:null,f,d,E)};Ko.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var qu=function(l,f,c){this.text=l,this.icon=f,this.skipFade=c},Ao=function(){this.invProjMatrix=m.create(),this.viewportMatrix=m.create(),this.circles=[]},$o=function(l,f,c,d,E){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=E},ba=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function xo(l,f,c,d,E){var A=m.getAnchorAlignment(l),M=-(A.horizontalAlign-.5)*f,L=-(A.verticalAlign-.5)*c,U=m.evaluateVariableOffset(l,d);return new m.Point(M+U[0]*E,L+U[1]*E)}function Qo(l,f,c,d,E,A){var M=l.x1,L=l.x2,U=l.y1,X=l.y2,oe=l.anchorPointX,fe=l.anchorPointY,pe=new m.Point(f,c);return d&&pe._rotate(E?A:-A),{x1:M+pe.x,y1:U+pe.y,x2:L+pe.x,y2:X+pe.y,anchorPointX:oe,anchorPointY:fe}}ba.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:function(c){return c.collisionGroupID===f}}}return this.collisionGroups[l]};var uo=function(l,f,c,d){this.transform=l.clone(),this.collisionIndex=new so(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new ba(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}};function uu(l,f,c,d,E){l.emplaceBack(f?1:0,c?1:0,d||0,E||0),l.emplaceBack(f?1:0,c?1:0,d||0,E||0),l.emplaceBack(f?1:0,c?1:0,d||0,E||0),l.emplaceBack(f?1:0,c?1:0,d||0,E||0)}uo.prototype.getBucketParts=function(l,f,c,d){var E=c.getBucket(f),A=c.latestFeatureIndex;if(E&&A&&f.id===E.layerIds[0]){var M=c.collisionBoxArray,L=E.layers[0].layout,U=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),X=c.tileSize/m.EXTENT,oe=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),fe=L.get("text-pitch-alignment")==="map",pe=L.get("text-rotation-alignment")==="map",Re=Qi(c,1,this.transform.zoom),Pe=Da(oe,fe,pe,this.transform,Re),He=null;if(fe){var be=aa(oe,fe,pe,this.transform,Re);He=m.multiply([],this.transform.labelPlaneMatrix,be)}this.retainedQueryData[E.bucketInstanceId]=new $o(E.bucketInstanceId,A,E.sourceLayerIndex,E.index,c.tileID);var je={bucket:E,layout:L,posMatrix:oe,textLabelPlaneMatrix:Pe,labelToScreenMatrix:He,scale:U,textPixelRatio:X,holdingForFade:c.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:m.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(d)for(var et=0,yt=E.sortKeyRanges;et<yt.length;et+=1){var Ht=yt[et];l.push({sortKey:Ht.sortKey,symbolInstanceStart:Ht.symbolInstanceStart,symbolInstanceEnd:Ht.symbolInstanceEnd,parameters:je})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:je})}},uo.prototype.attemptAnchorPlacement=function(l,f,c,d,E,A,M,L,U,X,oe,fe,pe,Re,Pe){var He,be=[fe.textOffset0,fe.textOffset1],je=xo(l,c,d,be,E),et=this.collisionIndex.placeCollisionBox(Qo(f,je.x,je.y,A,M,this.transform.angle),oe,L,U,X.predicate);if(!Pe||this.collisionIndex.placeCollisionBox(Qo(Pe,je.x,je.y,A,M,this.transform.angle),oe,L,U,X.predicate).box.length!==0)return et.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[fe.crossTileID]&&this.prevPlacement.placements[fe.crossTileID]&&this.prevPlacement.placements[fe.crossTileID].text&&(He=this.prevPlacement.variableOffsets[fe.crossTileID].anchor),this.variableOffsets[fe.crossTileID]={textOffset:be,width:c,height:d,anchor:l,textBoxScale:E,prevAnchor:He},this.markUsedJustification(pe,l,fe,Re),pe.allowVerticalPlacement&&(this.markUsedOrientation(pe,Re,fe),this.placedOrientations[fe.crossTileID]=Re),{shift:je,placedGlyphBoxes:et}):void 0},uo.prototype.placeLayerBucketPart=function(l,f,c){var d=this,E=l.parameters,A=E.bucket,M=E.layout,L=E.posMatrix,U=E.textLabelPlaneMatrix,X=E.labelToScreenMatrix,oe=E.textPixelRatio,fe=E.holdingForFade,pe=E.collisionBoxArray,Re=E.partiallyEvaluatedTextSize,Pe=E.collisionGroup,He=M.get("text-optional"),be=M.get("icon-optional"),je=M.get("text-allow-overlap"),et=M.get("icon-allow-overlap"),yt=M.get("text-rotation-alignment")==="map",Ht=M.get("text-pitch-alignment")==="map",Nt=M.get("icon-text-fit")!=="none",Qt=M.get("symbol-z-order")==="viewport-y",rr=je&&(et||!A.hasIconData()||be),Ir=et&&(je||!A.hasTextData()||He);!A.collisionArrays&&pe&&A.deserializeCollisionBoxes(pe);var Or=function(on,ni){if(!f[on.crossTileID])if(fe)d.placements[on.crossTileID]=new qu(!1,!1,!1);else{var pi,ei=!1,Vn=!1,gi=!0,Kn=null,Gn={box:null,offscreen:null},Mo={box:null,offscreen:null},ua=null,Wo=null,to=0,ro=0,Za=0;ni.textFeatureIndex?to=ni.textFeatureIndex:on.useRuntimeCollisionCircles&&(to=on.featureIndex),ni.verticalTextFeatureIndex&&(ro=ni.verticalTextFeatureIndex);var bs=ni.textBox;if(bs){var Es=function(la){var ts=m.WritingMode.horizontal;if(A.allowVerticalPlacement&&!la&&d.prevPlacement){var rs=d.prevPlacement.placedOrientations[on.crossTileID];rs&&(d.placedOrientations[on.crossTileID]=rs,d.markUsedOrientation(A,ts=rs,on))}return ts},Nu=function(la,ts){if(A.allowVerticalPlacement&&on.numVerticalGlyphVertices>0&&ni.verticalTextBox)for(var rs=0,vu=A.writingModes;rs<vu.length&&(vu[rs]===m.WritingMode.vertical?(Gn=ts(),Mo=Gn):Gn=la(),!(Gn&&Gn.box&&Gn.box.length));rs+=1);else Gn=la()};if(M.get("text-variable-anchor")){var Ss=M.get("text-variable-anchor");if(d.prevPlacement&&d.prevPlacement.variableOffsets[on.crossTileID]){var hu=d.prevPlacement.variableOffsets[on.crossTileID];Ss.indexOf(hu.anchor)>0&&(Ss=Ss.filter(function(la){return la!==hu.anchor})).unshift(hu.anchor)}var Ra=function(la,ts,rs){for(var vu=la.x2-la.x1,sc=la.y2-la.y1,uc=on.textBoxScale,Bl=Nt&&!et?ts:null,Ts={box:[],offscreen:!1},Nl=je?2*Ss.length:Ss.length,iu=0;iu<Nl;++iu){var Zu=d.attemptAnchorPlacement(Ss[iu%Ss.length],la,vu,sc,uc,yt,Ht,oe,L,Pe,iu>=Ss.length,on,A,rs,Bl);if(Zu&&(Ts=Zu.placedGlyphBoxes)&&Ts.box&&Ts.box.length){ei=!0,Kn=Zu.shift;break}}return Ts};Nu(function(){return Ra(bs,ni.iconBox,m.WritingMode.horizontal)},function(){var la=ni.verticalTextBox;return A.allowVerticalPlacement&&!(Gn&&Gn.box&&Gn.box.length)&&on.numVerticalGlyphVertices>0&&la?Ra(la,ni.verticalIconBox,m.WritingMode.vertical):{box:null,offscreen:null}}),Gn&&(ei=Gn.box,gi=Gn.offscreen);var fo=Es(Gn&&Gn.box);if(!ei&&d.prevPlacement){var zu=d.prevPlacement.variableOffsets[on.crossTileID];zu&&(d.variableOffsets[on.crossTileID]=zu,d.markUsedJustification(A,zu.anchor,on,fo))}}else{var Au=function(la,ts){var rs=d.collisionIndex.placeCollisionBox(la,je,oe,L,Pe.predicate);return rs&&rs.box&&rs.box.length&&(d.markUsedOrientation(A,ts,on),d.placedOrientations[on.crossTileID]=ts),rs};Nu(function(){return Au(bs,m.WritingMode.horizontal)},function(){var la=ni.verticalTextBox;return A.allowVerticalPlacement&&on.numVerticalGlyphVertices>0&&la?Au(la,m.WritingMode.vertical):{box:null,offscreen:null}}),Es(Gn&&Gn.box&&Gn.box.length)}}if(ei=(pi=Gn)&&pi.box&&pi.box.length>0,gi=pi&&pi.offscreen,on.useRuntimeCollisionCircles){var du=A.text.placedSymbolArray.get(on.centerJustifiedTextSymbolIndex),Bc=m.evaluateSizeForFeature(A.textSizeData,Re,du),wu=M.get("text-padding");ua=d.collisionIndex.placeCollisionCircles(je,du,A.lineVertexArray,A.glyphOffsetArray,Bc,L,U,X,c,Ht,Pe.predicate,on.collisionCircleDiameter,wu),ei=je||ua.circles.length>0&&!ua.collisionDetected,gi=gi&&ua.offscreen}if(ni.iconFeatureIndex&&(Za=ni.iconFeatureIndex),ni.iconBox){var oc=function(la){var ts=Nt&&Kn?Qo(la,Kn.x,Kn.y,yt,Ht,d.transform.angle):la;return d.collisionIndex.placeCollisionBox(ts,et,oe,L,Pe.predicate)};Vn=Mo&&Mo.box&&Mo.box.length&&ni.verticalIconBox?(Wo=oc(ni.verticalIconBox)).box.length>0:(Wo=oc(ni.iconBox)).box.length>0,gi=gi&&Wo.offscreen}var Uu=He||on.numHorizontalGlyphVertices===0&&on.numVerticalGlyphVertices===0,Eo=be||on.numIconVertices===0;if(Uu||Eo?Eo?Uu||(Vn=Vn&&ei):ei=Vn&&ei:Vn=ei=Vn&&ei,ei&&pi&&pi.box&&d.collisionIndex.insertCollisionBox(pi.box,M.get("text-ignore-placement"),A.bucketInstanceId,Mo&&Mo.box&&ro?ro:to,Pe.ID),Vn&&Wo&&d.collisionIndex.insertCollisionBox(Wo.box,M.get("icon-ignore-placement"),A.bucketInstanceId,Za,Pe.ID),ua&&(ei&&d.collisionIndex.insertCollisionCircles(ua.circles,M.get("text-ignore-placement"),A.bucketInstanceId,to,Pe.ID),c)){var Xo=A.bucketInstanceId,xl=d.collisionCircleArrays[Xo];xl===void 0&&(xl=d.collisionCircleArrays[Xo]=new Ao);for(var bl=0;bl<ua.circles.length;bl+=4)xl.circles.push(ua.circles[bl+0]),xl.circles.push(ua.circles[bl+1]),xl.circles.push(ua.circles[bl+2]),xl.circles.push(ua.collisionDetected?1:0)}d.placements[on.crossTileID]=new qu(ei||rr,Vn||Ir,gi||A.justReloaded),f[on.crossTileID]=!0}};if(Qt)for(var ln=A.getSortedSymbolIndexes(this.transform.angle),Bn=ln.length-1;Bn>=0;--Bn){var Dn=ln[Bn];Or(A.symbolInstances.get(Dn),A.collisionArrays[Dn])}else for(var Un=l.symbolInstanceStart;Un<l.symbolInstanceEnd;Un++)Or(A.symbolInstances.get(Un),A.collisionArrays[Un]);if(c&&A.bucketInstanceId in this.collisionCircleArrays){var Ni=this.collisionCircleArrays[A.bucketInstanceId];m.invert(Ni.invProjMatrix,L),Ni.viewportMatrix=this.collisionIndex.getViewportMatrix()}A.justReloaded=!1},uo.prototype.markUsedJustification=function(l,f,c,d){var E;E=d===m.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[m.getAnchorJustification(f)];for(var A=0,M=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];A<M.length;A+=1){var L=M[A];L>=0&&(l.text.placedSymbolArray.get(L).crossTileID=E>=0&&L!==E?0:c.crossTileID)}},uo.prototype.markUsedOrientation=function(l,f,c){for(var d=f===m.WritingMode.horizontal||f===m.WritingMode.horizontalOnly?f:0,E=f===m.WritingMode.vertical?f:0,A=0,M=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];A<M.length;A+=1)l.text.placedSymbolArray.get(M[A]).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=E)},uo.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var f=this.prevPlacement,c=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;var d=f?f.symbolFadeChange(l):1,E=f?f.opacities:{},A=f?f.variableOffsets:{},M=f?f.placedOrientations:{};for(var L in this.placements){var U=this.placements[L],X=E[L];X?(this.opacities[L]=new Ko(X,d,U.text,U.icon),c=c||U.text!==X.text.placed||U.icon!==X.icon.placed):(this.opacities[L]=new Ko(null,d,U.text,U.icon,U.skipFade),c=c||U.text||U.icon)}for(var oe in E){var fe=E[oe];if(!this.opacities[oe]){var pe=new Ko(fe,d,!1,!1);pe.isHidden()||(this.opacities[oe]=pe,c=c||fe.text.placed||fe.icon.placed)}}for(var Re in A)this.variableOffsets[Re]||!this.opacities[Re]||this.opacities[Re].isHidden()||(this.variableOffsets[Re]=A[Re]);for(var Pe in M)this.placedOrientations[Pe]||!this.opacities[Pe]||this.opacities[Pe].isHidden()||(this.placedOrientations[Pe]=M[Pe]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)},uo.prototype.updateLayerOpacities=function(l,f){for(var c={},d=0,E=f;d<E.length;d+=1){var A=E[d],M=A.getBucket(l);M&&A.latestFeatureIndex&&l.id===M.layerIds[0]&&this.updateBucketOpacities(M,c,A.collisionBoxArray)}},uo.prototype.updateBucketOpacities=function(l,f,c){var d=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var E=l.layers[0].layout,A=new Ko(null,0,!1,!1,!0),M=E.get("text-allow-overlap"),L=E.get("icon-allow-overlap"),U=E.get("text-variable-anchor"),X=E.get("text-rotation-alignment")==="map",oe=E.get("text-pitch-alignment")==="map",fe=E.get("icon-text-fit")!=="none",pe=new Ko(null,0,M&&(L||!l.hasIconData()||E.get("icon-optional")),L&&(M||!l.hasTextData()||E.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var Re=function(je,et,yt){for(var Ht=0;Ht<et/4;Ht++)je.opacityVertexArray.emplaceBack(yt)},Pe=function(je){var et=l.symbolInstances.get(je),yt=et.numHorizontalGlyphVertices,Ht=et.numVerticalGlyphVertices,Nt=et.crossTileID,Qt=d.opacities[Nt];f[Nt]?Qt=A:Qt||(d.opacities[Nt]=Qt=pe),f[Nt]=!0;var rr=et.numIconVertices>0,Ir=d.placedOrientations[et.crossTileID],Or=Ir===m.WritingMode.vertical,ln=Ir===m.WritingMode.horizontal||Ir===m.WritingMode.horizontalOnly;if(yt>0||Ht>0){var Bn=ot(Qt.text);Re(l.text,yt,Or?wt:Bn),Re(l.text,Ht,ln?wt:Bn);var Dn=Qt.text.isHidden();[et.rightJustifiedTextSymbolIndex,et.centerJustifiedTextSymbolIndex,et.leftJustifiedTextSymbolIndex].forEach(function(Gn){Gn>=0&&(l.text.placedSymbolArray.get(Gn).hidden=Dn||Or?1:0)}),et.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(et.verticalPlacedTextSymbolIndex).hidden=Dn||ln?1:0);var Un=d.variableOffsets[et.crossTileID];Un&&d.markUsedJustification(l,Un.anchor,et,Ir);var Ni=d.placedOrientations[et.crossTileID];Ni&&(d.markUsedJustification(l,"left",et,Ni),d.markUsedOrientation(l,Ni,et))}if(rr){var on=ot(Qt.icon),ni=!(fe&&et.verticalPlacedIconSymbolIndex&&Or);et.placedIconSymbolIndex>=0&&(Re(l.icon,et.numIconVertices,ni?on:wt),l.icon.placedSymbolArray.get(et.placedIconSymbolIndex).hidden=Qt.icon.isHidden()),et.verticalPlacedIconSymbolIndex>=0&&(Re(l.icon,et.numVerticalIconVertices,ni?wt:on),l.icon.placedSymbolArray.get(et.verticalPlacedIconSymbolIndex).hidden=Qt.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var pi=l.collisionArrays[je];if(pi){var ei=new m.Point(0,0);if(pi.textBox||pi.verticalTextBox){var Vn=!0;if(U){var gi=d.variableOffsets[Nt];gi?(ei=xo(gi.anchor,gi.width,gi.height,gi.textOffset,gi.textBoxScale),X&&ei._rotate(oe?d.transform.angle:-d.transform.angle)):Vn=!1}pi.textBox&&uu(l.textCollisionBox.collisionVertexArray,Qt.text.placed,!Vn||Or,ei.x,ei.y),pi.verticalTextBox&&uu(l.textCollisionBox.collisionVertexArray,Qt.text.placed,!Vn||ln,ei.x,ei.y)}var Kn=Boolean(!ln&&pi.verticalIconBox);pi.iconBox&&uu(l.iconCollisionBox.collisionVertexArray,Qt.icon.placed,Kn,fe?ei.x:0,fe?ei.y:0),pi.verticalIconBox&&uu(l.iconCollisionBox.collisionVertexArray,Qt.icon.placed,!Kn,fe?ei.x:0,fe?ei.y:0)}}},He=0;He<l.symbolInstances.length;He++)Pe(He);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var be=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=be.invProjMatrix,l.placementViewportMatrix=be.viewportMatrix,l.collisionCircleArray=be.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},uo.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},uo.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},uo.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},uo.prototype.stillRecent=function(l,f){var c=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*c>l},uo.prototype.setStale=function(){this.stale=!0};var Ac=Math.pow(2,25),Fs=Math.pow(2,24),Q=Math.pow(2,17),Ee=Math.pow(2,16),Ke=Math.pow(2,9),kt=Math.pow(2,8),Fr=Math.pow(2,1);function ot(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var f=l.placed?1:0,c=Math.floor(127*l.opacity);return c*Ac+f*Fs+c*Q+f*Ee+c*Ke+f*kt+c*Fr+f}var wt=0,lo=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};lo.prototype.continuePlacement=function(l,f,c,d,E){for(var A=this._bucketParts;this._currentTileIndex<l.length;)if(f.getBucketParts(A,d,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort(function(M,L){return M.sortKey-L.sortKey}));this._currentPartIndex<A.length;)if(f.placeLayerBucketPart(A[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,E())return!0;return!1};var Ji=function(l,f,c,d,E,A,M){this.placement=new uo(l,E,A,M),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1};Ji.prototype.isDone=function(){return this._done},Ji.prototype.continuePlacement=function(l,f,c){for(var d=this,E=m.browser.now(),A=function(){var U=m.browser.now()-E;return!d._forceFullPlacement&&U>2};this._currentPlacementIndex>=0;){var M=f[l[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=L)&&(!M.maxzoom||M.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new lo(M)),this._inProgressLayer.continuePlacement(c[M.source],this.placement,this._showCollisionBoxes,M,A))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Ji.prototype.commit=function(l){return this.placement.commit(l),this.placement};var Ya=512/m.EXTENT/2,Jo=function(l,f,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var d=0;d<f.length;d++){var E=f.get(d),A=E.key;this.indexedSymbolInstances[A]||(this.indexedSymbolInstances[A]=[]),this.indexedSymbolInstances[A].push({crossTileID:E.crossTileID,coord:this.getScaledCoordinates(E,l)})}};Jo.prototype.getScaledCoordinates=function(l,f){var c=Ya/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*m.EXTENT+l.anchorX)*c),y:Math.floor((f.canonical.y*m.EXTENT+l.anchorY)*c)}},Jo.prototype.findMatches=function(l,f,c){for(var d=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),E=0;E<l.length;E++){var A=l.get(E);if(!A.crossTileID){var M=this.indexedSymbolInstances[A.key];if(M)for(var L=this.getScaledCoordinates(A,f),U=0,X=M;U<X.length;U+=1){var oe=X[U];if(Math.abs(oe.coord.x-L.x)<=d&&Math.abs(oe.coord.y-L.y)<=d&&!c[oe.crossTileID]){c[oe.crossTileID]=!0,A.crossTileID=oe.crossTileID;break}}}}};var en=function(){this.maxCrossTileID=0};en.prototype.generate=function(){return++this.maxCrossTileID};var $r=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};$r.prototype.handleWrapJump=function(l){var f=Math.round((l-this.lng)/360);if(f!==0)for(var c in this.indexes){var d=this.indexes[c],E={};for(var A in d){var M=d[A];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+f),E[M.tileID.key]=M}this.indexes[c]=E}this.lng=l},$r.prototype.addBucket=function(l,f,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var d=0;d<f.symbolInstances.length;d++)f.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var E=this.usedCrossTileIDs[l.overscaledZ];for(var A in this.indexes){var M=this.indexes[A];if(Number(A)>l.overscaledZ)for(var L in M){var U=M[L];U.tileID.isChildOf(l)&&U.findMatches(f.symbolInstances,l,E)}else{var X=M[l.scaledTo(Number(A)).key];X&&X.findMatches(f.symbolInstances,l,E)}}for(var oe=0;oe<f.symbolInstances.length;oe++){var fe=f.symbolInstances.get(oe);fe.crossTileID||(fe.crossTileID=c.generate(),E[fe.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Jo(l,f.symbolInstances,f.bucketInstanceId),!0},$r.prototype.removeBucketCrossTileIDs=function(l,f){for(var c in f.indexedSymbolInstances)for(var d=0,E=f.indexedSymbolInstances[c];d<E.length;d+=1)delete this.usedCrossTileIDs[l][E[d].crossTileID]},$r.prototype.removeStaleBuckets=function(l){var f=!1;for(var c in this.indexes){var d=this.indexes[c];for(var E in d)l[d[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[E]),delete d[E],f=!0)}return f};var Rt=function(){this.layerIndexes={},this.crossTileIDs=new en,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Rt.prototype.addLayer=function(l,f,c){var d=this.layerIndexes[l.id];d===void 0&&(d=this.layerIndexes[l.id]=new $r);var E=!1,A={};d.handleWrapJump(c);for(var M=0,L=f;M<L.length;M+=1){var U=L[M],X=U.getBucket(l);X&&l.id===X.layerIds[0]&&(X.bucketInstanceId||(X.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(U.tileID,X,this.crossTileIDs)&&(E=!0),A[X.bucketInstanceId]=!0)}return d.removeStaleBuckets(A)&&(E=!0),E},Rt.prototype.pruneUnusedLayers=function(l){var f={};for(var c in l.forEach(function(d){f[d]=!0}),this.layerIndexes)f[c]||delete this.layerIndexes[c]};var Vo=function(l,f){return m.emitValidationErrors(l,f&&f.filter(function(c){return c.identifier!=="source.canvas"}))},he=m.pick(Wr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Js=m.pick(Wr,["setCenter","setZoom","setBearing","setPitch"]),lu=function(){var l={},f=m.styleSpec.$version;for(var c in m.styleSpec.$root){var d,E=m.styleSpec.$root[c];E.required&&(d=c==="version"?f:E.type==="array"?[]:{})!=null&&(l[c]=d)}return l}(),ys=function(l){function f(c,d){var E=this;d===void 0&&(d={}),l.call(this),this.map=c,this.dispatcher=new Kt(Pt(),this),this.imageManager=new At,this.imageManager.setEventedParent(this),this.glyphManager=new $t(c._requestManager,d.localIdeographFontFamily),this.lineAtlas=new Qe(256,512),this.crossTileSymbolIndex=new Rt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new m.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",m.getReferrer());var A=this;this._rtlTextPluginCallback=f.registerForPluginStateChange(function(M){A.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:M.pluginStatus,pluginURL:M.pluginURL},function(L,U){if(m.triggerPluginCompletionEvent(L),U&&U.every(function(oe){return oe}))for(var X in A.sourceCaches)A.sourceCaches[X].reload()})}),this.on("data",function(M){if(M.dataType==="source"&&M.sourceDataType==="metadata"){var L=E.sourceCaches[M.sourceId];if(L){var U=L.getSource();if(U&&U.vectorLayerIds)for(var X in E._layers){var oe=E._layers[X];oe.source===U.id&&E._validateLayer(oe)}}}})}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.loadURL=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new m.Event("dataloading",{dataType:"style"}));var A=typeof d.validate=="boolean"?d.validate:!m.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);var M=this.map._requestManager.transformRequest(c,m.ResourceType.Style);this._request=m.getJSON(M,function(L,U){E._request=null,L?E.fire(new m.ErrorEvent(L)):U&&E._load(U,A)})},f.prototype.loadJSON=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new m.Event("dataloading",{dataType:"style"})),this._request=m.browser.frame(function(){E._request=null,E._load(c,d.validate!==!1)})},f.prototype.loadEmpty=function(){this.fire(new m.Event("dataloading",{dataType:"style"})),this._load(lu,!1)},f.prototype._load=function(c,d){if(!d||!Vo(this,m.validateStyle(c))){for(var E in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(E,c.sources[E],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var A=Gr(this.stylesheet.layers);this._order=A.map(function(X){return X.id}),this._layers={},this._serializedLayers={};for(var M=0,L=A;M<L.length;M+=1){var U=L[M];(U=m.createStyleLayer(U)).setEventedParent(this,{layer:{id:U.id}}),this._layers[U.id]=U,this._serializedLayers[U.id]=U.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new xt(this.stylesheet.light),this.fire(new m.Event("data",{dataType:"style"})),this.fire(new m.Event("style.load"))}},f.prototype._loadSprite=function(c){var d=this;this._spriteRequest=function(E,A,M){var L,U,X,oe=m.browser.devicePixelRatio>1?"@2x":"",fe=m.getJSON(A.transformRequest(A.normalizeSpriteURL(E,oe,".json"),m.ResourceType.SpriteJSON),function(Pe,He){fe=null,X||(X=Pe,L=He,Re())}),pe=m.getImage(A.transformRequest(A.normalizeSpriteURL(E,oe,".png"),m.ResourceType.SpriteImage),function(Pe,He){pe=null,X||(X=Pe,U=He,Re())});function Re(){if(X)M(X);else if(L&&U){var Pe=m.browser.getImageData(U),He={};for(var be in L){var je=L[be],et=je.width,yt=je.height,Ht=je.x,Nt=je.y,Qt=je.sdf,rr=je.pixelRatio,Ir=je.stretchX,Or=je.stretchY,ln=je.content,Bn=new m.RGBAImage({width:et,height:yt});m.RGBAImage.copy(Pe,Bn,{x:Ht,y:Nt},{x:0,y:0},{width:et,height:yt}),He[be]={data:Bn,pixelRatio:rr,sdf:Qt,stretchX:Ir,stretchY:Or,content:ln}}M(null,He)}}return{cancel:function(){fe&&(fe.cancel(),fe=null),pe&&(pe.cancel(),pe=null)}}}(c,this.map._requestManager,function(E,A){if(d._spriteRequest=null,E)d.fire(new m.ErrorEvent(E));else if(A)for(var M in A)d.imageManager.addImage(M,A[M]);d.imageManager.setLoaded(!0),d._availableImages=d.imageManager.listImages(),d.dispatcher.broadcast("setImages",d._availableImages),d.fire(new m.Event("data",{dataType:"style"}))})},f.prototype._validateLayer=function(c){var d=this.sourceCaches[c.source];if(d){var E=c.sourceLayer;if(E){var A=d.getSource();(A.type==="geojson"||A.vectorLayerIds&&A.vectorLayerIds.indexOf(E)===-1)&&this.fire(new m.ErrorEvent(new Error('Source layer "'+E+'" does not exist on source "'+A.id+'" as specified by style layer "'+c.id+'"')))}}},f.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},f.prototype._serializeLayers=function(c){for(var d=[],E=0,A=c;E<A.length;E+=1){var M=this._layers[A[E]];M.type!=="custom"&&d.push(M.serialize())}return d},f.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var d in this._layers)if(this._layers[d].hasTransition())return!0;return!1},f.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},f.prototype.update=function(c){if(this._loaded){var d=this._changed;if(this._changed){var E=Object.keys(this._updatedLayers),A=Object.keys(this._removedLayers);for(var M in(E.length||A.length)&&this._updateWorkerLayers(E,A),this._updatedSources){var L=this._updatedSources[M];L==="reload"?this._reloadSource(M):L==="clear"&&this._clearSource(M)}for(var U in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[U].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var X={};for(var oe in this.sourceCaches){var fe=this.sourceCaches[oe];X[oe]=fe.used,fe.used=!1}for(var pe=0,Re=this._order;pe<Re.length;pe+=1){var Pe=this._layers[Re[pe]];Pe.recalculate(c,this._availableImages),!Pe.isHidden(c.zoom)&&Pe.source&&(this.sourceCaches[Pe.source].used=!0)}for(var He in X){var be=this.sourceCaches[He];X[He]!==be.used&&be.fire(new m.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:He}))}this.light.recalculate(c),this.z=c.zoom,d&&this.fire(new m.Event("data",{dataType:"style"}))}},f.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},f.prototype._updateWorkerLayers=function(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})},f.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},f.prototype.setState=function(c){var d=this;if(this._checkLoaded(),Vo(this,m.validateStyle(c)))return!1;(c=m.clone$1(c)).layers=Gr(c.layers);var E=function(M,L){if(!M)return[{command:Wr.setStyle,args:[L]}];var U=[];try{if(!m.deepEqual(M.version,L.version))return[{command:Wr.setStyle,args:[L]}];m.deepEqual(M.center,L.center)||U.push({command:Wr.setCenter,args:[L.center]}),m.deepEqual(M.zoom,L.zoom)||U.push({command:Wr.setZoom,args:[L.zoom]}),m.deepEqual(M.bearing,L.bearing)||U.push({command:Wr.setBearing,args:[L.bearing]}),m.deepEqual(M.pitch,L.pitch)||U.push({command:Wr.setPitch,args:[L.pitch]}),m.deepEqual(M.sprite,L.sprite)||U.push({command:Wr.setSprite,args:[L.sprite]}),m.deepEqual(M.glyphs,L.glyphs)||U.push({command:Wr.setGlyphs,args:[L.glyphs]}),m.deepEqual(M.transition,L.transition)||U.push({command:Wr.setTransition,args:[L.transition]}),m.deepEqual(M.light,L.light)||U.push({command:Wr.setLight,args:[L.light]});var X={},oe=[];(function(pe,Re,Pe,He){var be;for(be in Re=Re||{},pe=pe||{})pe.hasOwnProperty(be)&&(Re.hasOwnProperty(be)||rn(be,Pe,He));for(be in Re)Re.hasOwnProperty(be)&&(pe.hasOwnProperty(be)?m.deepEqual(pe[be],Re[be])||(pe[be].type==="geojson"&&Re[be].type==="geojson"&&ea(pe,Re,be)?Pe.push({command:Wr.setGeoJSONSourceData,args:[be,Re[be].data]}):Ti(be,Re,Pe,He)):oi(be,Re,Pe))})(M.sources,L.sources,oe,X);var fe=[];M.layers&&M.layers.forEach(function(pe){X[pe.source]?U.push({command:Wr.removeLayer,args:[pe.id]}):fe.push(pe)}),U=U.concat(oe),function(pe,Re,Pe){Re=Re||[];var He,be,je,et,yt,Ht,Nt,Qt=(pe=pe||[]).map(Oi),rr=Re.map(Oi),Ir=pe.reduce(Si,{}),Or=Re.reduce(Si,{}),ln=Qt.slice(),Bn=Object.create(null);for(He=0,be=0;He<Qt.length;He++)Or.hasOwnProperty(je=Qt[He])?be++:(Pe.push({command:Wr.removeLayer,args:[je]}),ln.splice(ln.indexOf(je,be),1));for(He=0,be=0;He<rr.length;He++)ln[ln.length-1-He]!==(je=rr[rr.length-1-He])&&(Ir.hasOwnProperty(je)?(Pe.push({command:Wr.removeLayer,args:[je]}),ln.splice(ln.lastIndexOf(je,ln.length-be),1)):be++,Pe.push({command:Wr.addLayer,args:[Or[je],Ht=ln[ln.length-He]]}),ln.splice(ln.length-He,0,je),Bn[je]=!0);for(He=0;He<rr.length;He++)if(et=Ir[je=rr[He]],yt=Or[je],!Bn[je]&&!m.deepEqual(et,yt))if(m.deepEqual(et.source,yt.source)&&m.deepEqual(et["source-layer"],yt["source-layer"])&&m.deepEqual(et.type,yt.type)){for(Nt in bi(et.layout,yt.layout,Pe,je,null,Wr.setLayoutProperty),bi(et.paint,yt.paint,Pe,je,null,Wr.setPaintProperty),m.deepEqual(et.filter,yt.filter)||Pe.push({command:Wr.setFilter,args:[je,yt.filter]}),m.deepEqual(et.minzoom,yt.minzoom)&&m.deepEqual(et.maxzoom,yt.maxzoom)||Pe.push({command:Wr.setLayerZoomRange,args:[je,yt.minzoom,yt.maxzoom]}),et)et.hasOwnProperty(Nt)&&Nt!=="layout"&&Nt!=="paint"&&Nt!=="filter"&&Nt!=="metadata"&&Nt!=="minzoom"&&Nt!=="maxzoom"&&(Nt.indexOf("paint.")===0?bi(et[Nt],yt[Nt],Pe,je,Nt.slice(6),Wr.setPaintProperty):m.deepEqual(et[Nt],yt[Nt])||Pe.push({command:Wr.setLayerProperty,args:[je,Nt,yt[Nt]]}));for(Nt in yt)yt.hasOwnProperty(Nt)&&!et.hasOwnProperty(Nt)&&Nt!=="layout"&&Nt!=="paint"&&Nt!=="filter"&&Nt!=="metadata"&&Nt!=="minzoom"&&Nt!=="maxzoom"&&(Nt.indexOf("paint.")===0?bi(et[Nt],yt[Nt],Pe,je,Nt.slice(6),Wr.setPaintProperty):m.deepEqual(et[Nt],yt[Nt])||Pe.push({command:Wr.setLayerProperty,args:[je,Nt,yt[Nt]]}))}else Pe.push({command:Wr.removeLayer,args:[je]}),Ht=ln[ln.lastIndexOf(je)+1],Pe.push({command:Wr.addLayer,args:[yt,Ht]})}(fe,L.layers,U)}catch(pe){console.warn("Unable to compute style diff:",pe),U=[{command:Wr.setStyle,args:[L]}]}return U}(this.serialize(),c).filter(function(M){return!(M.command in Js)});if(E.length===0)return!1;var A=E.filter(function(M){return!(M.command in he)});if(A.length>0)throw new Error("Unimplemented: "+A.map(function(M){return M.command}).join(", ")+".");return E.forEach(function(M){M.command!=="setTransition"&&d[M.command].apply(d,M.args)}),this.stylesheet=c,!0},f.prototype.addImage=function(c,d){if(this.getImage(c))return this.fire(new m.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,d),this._afterImageUpdated(c)},f.prototype.updateImage=function(c,d){this.imageManager.updateImage(c,d)},f.prototype.getImage=function(c){return this.imageManager.getImage(c)},f.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new m.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},f.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new m.Event("data",{dataType:"style"}))},f.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},f.prototype.addSource=function(c,d,E){var A=this;if(E===void 0&&(E={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(d).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(m.validateStyle.source,"sources."+c,d,null,E))){this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);var M=this.sourceCaches[c]=new De(c,d,this.dispatcher);M.style=this,M.setEventedParent(this,function(){return{isSourceLoaded:A.loaded(),source:M.serialize(),sourceId:c}}),M.onAdd(this.map),this._changed=!0}},f.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var d in this._layers)if(this._layers[d].source===c)return this.fire(new m.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+d+'" is using it.')));var E=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],E.fire(new m.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),E.setEventedParent(null),E.clearTiles(),E.onRemove&&E.onRemove(this.map),this._changed=!0},f.prototype.setGeoJSONSourceData=function(c,d){this._checkLoaded(),this.sourceCaches[c].getSource().setData(d),this._changed=!0},f.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},f.prototype.addLayer=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var A=c.id;if(this.getLayer(A))this.fire(new m.ErrorEvent(new Error('Layer with id "'+A+'" already exists on this map')));else{var M;if(c.type==="custom"){if(Vo(this,m.validateCustomStyleLayer(c)))return;M=m.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(A,c.source),c=m.clone$1(c),c=m.extend(c,{source:A})),this._validate(m.validateStyle.layer,"layers."+A,c,{arrayIndex:-1},E))return;M=m.createStyleLayer(c),this._validateLayer(M),M.setEventedParent(this,{layer:{id:A}}),this._serializedLayers[M.id]=M.serialize()}var L=d?this._order.indexOf(d):this._order.length;if(d&&L===-1)this.fire(new m.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.')));else{if(this._order.splice(L,0,A),this._layerOrderChanged=!0,this._layers[A]=M,this._removedLayers[A]&&M.source&&M.type!=="custom"){var U=this._removedLayers[A];delete this._removedLayers[A],U.type!==M.type?this._updatedSources[M.source]="clear":(this._updatedSources[M.source]="reload",this.sourceCaches[M.source].pause())}this._updateLayer(M),M.onAdd&&M.onAdd(this.map)}}},f.prototype.moveLayer=function(c,d){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==d){var E=this._order.indexOf(c);this._order.splice(E,1);var A=d?this._order.indexOf(d):this._order.length;d&&A===-1?this.fire(new m.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.'))):(this._order.splice(A,0,c),this._layerOrderChanged=!0)}}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},f.prototype.removeLayer=function(c){this._checkLoaded();var d=this._layers[c];if(d){d.setEventedParent(null);var E=this._order.indexOf(c);this._order.splice(E,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map)}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},f.prototype.getLayer=function(c){return this._layers[c]},f.prototype.hasLayer=function(c){return c in this._layers},f.prototype.setLayerZoomRange=function(c,d,E){this._checkLoaded();var A=this.getLayer(c);A?A.minzoom===d&&A.maxzoom===E||(d!=null&&(A.minzoom=d),E!=null&&(A.maxzoom=E),this._updateLayer(A)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},f.prototype.setFilter=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var A=this.getLayer(c);if(A){if(!m.deepEqual(A.filter,d))return d==null?(A.filter=void 0,void this._updateLayer(A)):void(this._validate(m.validateStyle.filter,"layers."+A.id+".filter",d,null,E)||(A.filter=m.clone$1(d),this._updateLayer(A)))}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},f.prototype.getFilter=function(c){return m.clone$1(this.getLayer(c).filter)},f.prototype.setLayoutProperty=function(c,d,E,A){A===void 0&&(A={}),this._checkLoaded();var M=this.getLayer(c);M?m.deepEqual(M.getLayoutProperty(d),E)||(M.setLayoutProperty(d,E,A),this._updateLayer(M)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getLayoutProperty=function(c,d){var E=this.getLayer(c);if(E)return E.getLayoutProperty(d);this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},f.prototype.setPaintProperty=function(c,d,E,A){A===void 0&&(A={}),this._checkLoaded();var M=this.getLayer(c);M?m.deepEqual(M.getPaintProperty(d),E)||(M.setPaintProperty(d,E,A)&&this._updateLayer(M),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getPaintProperty=function(c,d){return this.getLayer(c).getPaintProperty(d)},f.prototype.setFeatureState=function(c,d){this._checkLoaded();var E=c.source,A=c.sourceLayer,M=this.sourceCaches[E];if(M!==void 0){var L=M.getSource().type;L==="geojson"&&A?this.fire(new m.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):L!=="vector"||A?(c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),M.setFeatureState(A,c.id,d)):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},f.prototype.removeFeatureState=function(c,d){this._checkLoaded();var E=c.source,A=this.sourceCaches[E];if(A!==void 0){var M=A.getSource().type,L=M==="vector"?c.sourceLayer:void 0;M!=="vector"||L?d&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new m.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):A.removeFeatureState(L,c.id,d):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},f.prototype.getFeatureState=function(c){this._checkLoaded();var d=c.source,E=c.sourceLayer,A=this.sourceCaches[d];if(A!==void 0){if(A.getSource().type!=="vector"||E)return c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),A.getFeatureState(E,c.id);this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+d+"' does not exist in the map's style.")))},f.prototype.getTransition=function(){return m.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},f.prototype.serialize=function(){return m.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:m.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},f.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},f.prototype._flattenAndSortRenderedFeatures=function(c){for(var d=this,E=function(Ir){return d._layers[Ir].type==="fill-extrusion"},A={},M=[],L=this._order.length-1;L>=0;L--){var U=this._order[L];if(E(U)){A[U]=L;for(var X=0,oe=c;X<oe.length;X+=1){var fe=oe[X][U];if(fe)for(var pe=0,Re=fe;pe<Re.length;pe+=1)M.push(Re[pe])}}}M.sort(function(Ir,Or){return Or.intersectionZ-Ir.intersectionZ});for(var Pe=[],He=this._order.length-1;He>=0;He--){var be=this._order[He];if(E(be))for(var je=M.length-1;je>=0;je--){var et=M[je].feature;if(A[et.layer.id]<He)break;Pe.push(et),M.pop()}else for(var yt=0,Ht=c;yt<Ht.length;yt+=1){var Nt=Ht[yt][be];if(Nt)for(var Qt=0,rr=Nt;Qt<rr.length;Qt+=1)Pe.push(rr[Qt].feature)}}return Pe},f.prototype.queryRenderedFeatures=function(c,d,E){d&&d.filter&&this._validate(m.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);var A={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new m.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var M=0,L=d.layers;M<L.length;M+=1){var U=L[M],X=this._layers[U];if(!X)return this.fire(new m.ErrorEvent(new Error("The layer '"+U+"' does not exist in the map's style and cannot be queried for features."))),[];A[X.source]=!0}}var oe=[];for(var fe in d.availableImages=this._availableImages,this.sourceCaches)d.layers&&!A[fe]||oe.push(hn(this.sourceCaches[fe],this._layers,this._serializedLayers,c,d,E));return this.placement&&oe.push(function(pe,Re,Pe,He,be,je,et){for(var yt={},Ht=je.queryRenderedSymbols(He),Nt=[],Qt=0,rr=Object.keys(Ht).map(Number);Qt<rr.length;Qt+=1)Nt.push(et[rr[Qt]]);Nt.sort(Ki);for(var Ir=function(){var Un=ln[Or],Ni=Un.featureIndex.lookupSymbolFeatures(Ht[Un.bucketInstanceId],Re,Un.bucketIndex,Un.sourceLayerIndex,be.filter,be.layers,be.availableImages,pe);for(var on in Ni){var ni=yt[on]=yt[on]||[],pi=Ni[on];pi.sort(function(gi,Kn){var Gn=Un.featureSortOrder;if(Gn){var Mo=Gn.indexOf(gi.featureIndex);return Gn.indexOf(Kn.featureIndex)-Mo}return Kn.featureIndex-gi.featureIndex});for(var ei=0,Vn=pi;ei<Vn.length;ei+=1)ni.push(Vn[ei])}},Or=0,ln=Nt;Or<ln.length;Or+=1)Ir();var Bn=function(Un){yt[Un].forEach(function(Ni){var on=Ni.feature,ni=Pe[pe[Un].source].getFeatureState(on.layer["source-layer"],on.id);on.source=on.layer.source,on.layer["source-layer"]&&(on.sourceLayer=on.layer["source-layer"]),on.state=ni})};for(var Dn in yt)Bn(Dn);return yt}(this._layers,this._serializedLayers,this.sourceCaches,c,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(oe)},f.prototype.querySourceFeatures=function(c,d){d&&d.filter&&this._validate(m.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);var E=this.sourceCaches[c];return E?function(A,M){for(var L=A.getRenderableIds().map(function(Re){return A.getTileByID(Re)}),U=[],X={},oe=0;oe<L.length;oe++){var fe=L[oe],pe=fe.tileID.canonical.key;X[pe]||(X[pe]=!0,fe.querySourceFeatures(U,M))}return U}(E,d):[]},f.prototype.addSourceType=function(c,d,E){return f.getSourceType(c)?E(new Error('A source type called "'+c+'" already exists.')):(f.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},E):E(null,null))},f.prototype.getLight=function(){return this.light.getLight()},f.prototype.setLight=function(c,d){d===void 0&&(d={}),this._checkLoaded();var E=this.light.getLight(),A=!1;for(var M in c)if(!m.deepEqual(c[M],E[M])){A=!0;break}if(A){var L={now:m.browser.now(),transition:m.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,d),this.light.updateTransitions(L)}},f.prototype._validate=function(c,d,E,A,M){return M===void 0&&(M={}),(!M||M.validate!==!1)&&Vo(this,c.call(m.validateStyle,m.extend({key:d,style:this.serialize(),value:E,styleSpec:m.styleSpec},A)))},f.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),m.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var d in this.sourceCaches)this.sourceCaches[d].clearTiles(),this.sourceCaches[d].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},f.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},f.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},f.prototype._updateSources=function(c){for(var d in this.sourceCaches)this.sourceCaches[d].update(c)},f.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},f.prototype._updatePlacement=function(c,d,E,A,M){M===void 0&&(M=!1);for(var L=!1,U=!1,X={},oe=0,fe=this._order;oe<fe.length;oe+=1){var pe=this._layers[fe[oe]];if(pe.type==="symbol"){if(!X[pe.source]){var Re=this.sourceCaches[pe.source];X[pe.source]=Re.getRenderableIds(!0).map(function(et){return Re.getTileByID(et)}).sort(function(et,yt){return yt.tileID.overscaledZ-et.tileID.overscaledZ||(et.tileID.isLessThan(yt.tileID)?-1:1)})}var Pe=this.crossTileSymbolIndex.addLayer(pe,X[pe.source],c.center.lng);L=L||Pe}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((M=M||this._layerOrderChanged||E===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(m.browser.now(),c.zoom))&&(this.pauseablePlacement=new Ji(c,this._order,M,d,E,A,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,X),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(m.browser.now()),U=!0),L&&this.pauseablePlacement.placement.setStale()),U||L)for(var He=0,be=this._order;He<be.length;He+=1){var je=this._layers[be[He]];je.type==="symbol"&&this.placement.updateLayerOpacities(je,X[je.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(m.browser.now())},f.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},f.prototype.getImages=function(c,d,E){this.imageManager.getImages(d.icons,E),this._updateTilesForChangedImages();var A=this.sourceCaches[d.source];A&&A.setDependencies(d.tileID.key,d.type,d.icons)},f.prototype.getGlyphs=function(c,d,E){this.glyphManager.getGlyphs(d.stacks,E)},f.prototype.getResource=function(c,d,E){return m.makeRequest(d,E)},f}(m.Evented);ys.getSourceType=function(l){return Cr[l]},ys.setSourceType=function(l,f){Cr[l]=f},ys.registerForPluginStateChange=m.registerForPluginStateChange;var oa=m.createLayout([{name:"a_pos",type:"Int16",components:2}]),bo=Hi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Kl=Hi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),wc=Hi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Ku=Hi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Tc=Hi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ml=Hi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),$u=Hi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),cu=Hi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Qu=Hi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),_=Hi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),T=Hi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),F=Hi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),R=Hi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),K=Hi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),xe=Hi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),We=Hi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),ct=Hi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),ht=Hi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),cr=Hi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),xr=Hi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Rn=Hi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),ci=Hi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Jn=Hi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Yi=Hi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),ha=Hi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),La=Hi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Hi(l,f){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=f.match(/attribute ([\w]+) ([\w]+)/g),E=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=A?A.concat(E):E,L={};return{fragmentSource:l=l.replace(c,function(U,X,oe,fe,pe){return L[pe]=!0,X==="define"?`
#ifndef HAS_UNIFORM_u_`+pe+`
varying `+oe+" "+fe+" "+pe+`;
#else
uniform `+oe+" "+fe+" u_"+pe+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+pe+`
    `+oe+" "+fe+" "+pe+" = u_"+pe+`;
#endif
`}),vertexSource:f=f.replace(c,function(U,X,oe,fe,pe){var Re=fe==="float"?"vec2":"vec4",Pe=pe.match(/color/)?"color":Re;return L[pe]?X==="define"?`
#ifndef HAS_UNIFORM_u_`+pe+`
uniform lowp float u_`+pe+`_t;
attribute `+oe+" "+Re+" a_"+pe+`;
varying `+oe+" "+fe+" "+pe+`;
#else
uniform `+oe+" "+fe+" u_"+pe+`;
#endif
`:Pe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+pe+`
    `+pe+" = a_"+pe+`;
#else
    `+oe+" "+fe+" "+pe+" = u_"+pe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+pe+`
    `+pe+" = unpack_mix_"+Pe+"(a_"+pe+", u_"+pe+`_t);
#else
    `+oe+" "+fe+" "+pe+" = u_"+pe+`;
#endif
`:X==="define"?`
#ifndef HAS_UNIFORM_u_`+pe+`
uniform lowp float u_`+pe+`_t;
attribute `+oe+" "+Re+" a_"+pe+`;
#else
uniform `+oe+" "+fe+" u_"+pe+`;
#endif
`:Pe==="vec4"?`
#ifndef HAS_UNIFORM_u_`+pe+`
    `+oe+" "+fe+" "+pe+" = a_"+pe+`;
#else
    `+oe+" "+fe+" "+pe+" = u_"+pe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+pe+`
    `+oe+" "+fe+" "+pe+" = unpack_mix_"+Pe+"(a_"+pe+", u_"+pe+`_t);
#else
    `+oe+" "+fe+" "+pe+" = u_"+pe+`;
#endif
`}),staticAttributes:d,staticUniforms:M}}var Fo=Object.freeze({__proto__:null,prelude:bo,background:Kl,backgroundPattern:wc,circle:Ku,clippingMask:Tc,heatmap:Ml,heatmapTexture:$u,collisionBox:cu,collisionCircle:Qu,debug:_,fill:T,fillOutline:F,fillOutlinePattern:R,fillPattern:K,fillExtrusion:xe,fillExtrusionPattern:We,hillshadePrepare:ct,hillshade:ht,line:cr,lineGradient:xr,linePattern:Rn,lineSDF:ci,raster:Jn,symbolIcon:Yi,symbolSDF:ha,symbolTextAndIcon:La}),ws=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function pl(l){for(var f=[],c=0;c<l.length;c++)if(l[c]!==null){var d=l[c].split(" ");f.push(d.pop())}return f}ws.prototype.bind=function(l,f,c,d,E,A,M,L){this.context=l;for(var U=this.boundPaintVertexBuffers.length!==d.length,X=0;!U&&X<d.length;X++)this.boundPaintVertexBuffers[X]!==d[X]&&(U=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===f&&this.boundLayoutVertexBuffer===c&&!U&&this.boundIndexBuffer===E&&this.boundVertexOffset===A&&this.boundDynamicVertexBuffer===M&&this.boundDynamicVertexBuffer2===L?(l.bindVertexArrayOES.set(this.vao),M&&M.bind(),E&&E.dynamicDraw&&E.bind(),L&&L.bind()):this.freshBind(f,c,d,E,A,M,L)},ws.prototype.freshBind=function(l,f,c,d,E,A,M){var L,U=l.numAttributes,X=this.context,oe=X.gl;if(X.extVertexArrayObject)this.vao&&this.destroy(),this.vao=X.extVertexArrayObject.createVertexArrayOES(),X.bindVertexArrayOES.set(this.vao),L=0,this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=A,this.boundDynamicVertexBuffer2=M;else{L=X.currentNumAttributes||0;for(var fe=U;fe<L;fe++)oe.disableVertexAttribArray(fe)}f.enableAttributes(oe,l);for(var pe=0,Re=c;pe<Re.length;pe+=1)Re[pe].enableAttributes(oe,l);A&&A.enableAttributes(oe,l),M&&M.enableAttributes(oe,l),f.bind(),f.setVertexAttribPointers(oe,l,E);for(var Pe=0,He=c;Pe<He.length;Pe+=1){var be=He[Pe];be.bind(),be.setVertexAttribPointers(oe,l,E)}A&&(A.bind(),A.setVertexAttribPointers(oe,l,E)),d&&d.bind(),M&&(M.bind(),M.setVertexAttribPointers(oe,l,E)),X.currentNumAttributes=U},ws.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var tf=function(l,f,c,d,E,A){var M=l.gl;this.program=M.createProgram();for(var L=pl(c.staticAttributes),U=d?d.getBinderAttributes():[],X=L.concat(U),oe=c.staticUniforms?pl(c.staticUniforms):[],fe=d?d.getBinderUniforms():[],pe=[],Re=0,Pe=oe.concat(fe);Re<Pe.length;Re+=1){var He=Pe[Re];pe.indexOf(He)<0&&pe.push(He)}var be=d?d.defines():[];A&&be.push("#define OVERDRAW_INSPECTOR;");var je=be.concat(bo.fragmentSource,c.fragmentSource).join(`
`),et=be.concat(bo.vertexSource,c.vertexSource).join(`
`),yt=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(yt,je),M.compileShader(yt),M.attachShader(this.program,yt);var Ht=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(Ht,et),M.compileShader(Ht),M.attachShader(this.program,Ht),this.attributes={};var Nt={};this.numAttributes=X.length;for(var Qt=0;Qt<this.numAttributes;Qt++)X[Qt]&&(M.bindAttribLocation(this.program,Qt,X[Qt]),this.attributes[X[Qt]]=Qt);M.linkProgram(this.program),M.deleteShader(Ht),M.deleteShader(yt);for(var rr=0;rr<pe.length;rr++){var Ir=pe[rr];if(Ir&&!Nt[Ir]){var Or=M.getUniformLocation(this.program,Ir);Or&&(Nt[Ir]=Or)}}this.fixedUniforms=E(l,Nt),this.binderUniforms=d?d.getUniforms(l,Nt):[]}}};function Ju(l,f,c){var d=1/Qi(c,1,f.transform.tileZoom),E=Math.pow(2,c.tileID.overscaledZ),A=c.tileSize*Math.pow(2,f.transform.tileZoom)/E,M=A*(c.tileID.canonical.x+c.tileID.wrap*E),L=A*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[M>>16,L>>16],u_pixel_coord_lower:[65535&M,65535&L]}}tf.prototype.draw=function(l,f,c,d,E,A,M,L,U,X,oe,fe,pe,Re,Pe,He){var be,je=l.gl;if(!this.failedToCreate){for(var et in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(d),l.setColorMode(E),l.setCullFace(A),this.fixedUniforms)this.fixedUniforms[et].set(M[et]);Re&&Re.setUniforms(l,this.binderUniforms,fe,{zoom:pe});for(var yt=(be={},be[je.LINES]=2,be[je.TRIANGLES]=3,be[je.LINE_STRIP]=1,be)[f],Ht=0,Nt=oe.get();Ht<Nt.length;Ht+=1){var Qt=Nt[Ht],rr=Qt.vaos||(Qt.vaos={});(rr[L]||(rr[L]=new ws)).bind(l,this,U,Re?Re.getPaintVertexBuffers():[],X,Qt.vertexOffset,Pe,He),je.drawElements(f,Qt.primitiveLength*yt,je.UNSIGNED_SHORT,Qt.primitiveOffset*yt*2)}}};var Mc=function(l,f,c,d){var E=f.style.light,A=E.properties.get("position"),M=[A.x,A.y,A.z],L=m.create$1();E.properties.get("anchor")==="viewport"&&m.fromRotation(L,-f.transform.angle),m.transformMat3(M,M,L);var U=E.properties.get("color");return{u_matrix:l,u_lightpos:M,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[U.r,U.g,U.b],u_vertical_gradient:+c,u_opacity:d}},Ru=function(l,f,c,d,E,A,M){return m.extend(Mc(l,f,c,d),Ju(A,f,M),{u_height_factor:-Math.pow(2,E.overscaledZ)/M.tileSize/8})},yu=function(l){return{u_matrix:l}},wo=function(l,f,c,d){return m.extend(yu(l),Ju(c,f,d))},da=function(l,f){return{u_matrix:l,u_world:f}},yp=function(l,f,c,d,E){return m.extend(wo(l,f,c,d),{u_world:E})},_p=function(l,f,c,d){var E,A,M=l.transform;if(d.paint.get("circle-pitch-alignment")==="map"){var L=Qi(c,1,M.zoom);E=!0,A=[L,L]}else E=!1,A=M.pixelsToGLUnits;return{u_camera_to_center_distance:M.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(f.posMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:m.browser.devicePixelRatio,u_extrude_scale:A}},vo=function(l,f,c){var d=Qi(c,1,f.zoom),E=Math.pow(2,f.zoom-c.tileID.overscaledZ),A=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:f.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[f.pixelsToGLUnits[0]/(d*E),f.pixelsToGLUnits[1]/(d*E)],u_overscale_factor:A}},Ff=function(l,f,c){return{u_matrix:l,u_inv_matrix:f,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},_u=function(l,f,c){return c===void 0&&(c=1),{u_matrix:l,u_color:f,u_overlay:0,u_overlay_scale:c}},Bs=function(l){return{u_matrix:l}},Pc=function(l,f,c,d){return{u_matrix:l,u_extrude_scale:Qi(f,1,c),u_intensity:d}},hl=function(l,f,c){var d=l.transform;return{u_matrix:Bf(l,f,c),u_ratio:1/Qi(f,1,d.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Aa=function(l,f,c,d){return m.extend(hl(l,f,c),{u_image:0,u_image_height:d})},Pl=function(l,f,c,d){var E=l.transform,A=os(f,E);return{u_matrix:Bf(l,f,c),u_texsize:f.imageAtlasTexture.size,u_ratio:1/Qi(f,1,E.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_image:0,u_scale:[A,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},$l=function(l,f,c,d,E){var A=l.lineAtlas,M=os(f,l.transform),L=c.layout.get("line-cap")==="round",U=A.getDash(d.from,L),X=A.getDash(d.to,L),oe=U.width*E.fromScale,fe=X.width*E.toScale;return m.extend(hl(l,f,c),{u_patternscale_a:[M/oe,-U.height/2],u_patternscale_b:[M/fe,-X.height/2],u_sdfgamma:A.width/(256*Math.min(oe,fe)*m.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:U.y,u_tex_y_b:X.y,u_mix:E.t})};function os(l,f){return 1/Qi(l,1,f.tileZoom)}function Bf(l,f,c){return l.translatePosMatrix(f.tileID.posMatrix,f,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var xp=function(l,f,c,d,E){return{u_matrix:l,u_tl_parent:f,u_scale_parent:c,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(M=E.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(A=E.paint.get("raster-contrast"),A>0?1/(1-A):1+A),u_spin_weights:bp(E.paint.get("raster-hue-rotate"))};var A,M};function bp(l){l*=Math.PI/180;var f=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*f-c+1)/3,(Math.sqrt(3)*f-c+1)/3]}var rf,dl=function(l,f,c,d,E,A,M,L,U,X){var oe=E.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:f?f.uSizeT:0,u_size:f?f.uSize:0,u_camera_to_center_distance:oe.cameraToCenterDistance,u_pitch:oe.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:oe.width/oe.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:A,u_label_plane_matrix:M,u_coord_matrix:L,u_is_text:+U,u_pitch_with_map:+d,u_texsize:X,u_texture:0}},Go=function(l,f,c,d,E,A,M,L,U,X,oe){var fe=E.transform;return m.extend(dl(l,f,c,d,E,A,M,L,U,X),{u_gamma_scale:d?Math.cos(fe._pitch)*fe.cameraToCenterDistance:1,u_device_pixel_ratio:m.browser.devicePixelRatio,u_is_halo:+oe})},Lu=function(l,f,c,d,E,A,M,L,U,X){return m.extend(Go(l,f,c,d,E,A,M,L,!0,U,!0),{u_texsize_icon:X,u_texture_icon:1})},el=function(l,f,c){return{u_matrix:l,u_opacity:f,u_color:c}},Ho=function(l,f,c,d,E,A){return m.extend(function(M,L,U,X){var oe=U.imageManager.getPattern(M.from.toString()),fe=U.imageManager.getPattern(M.to.toString()),pe=U.imageManager.getPixelSize(),Re=pe.width,Pe=pe.height,He=Math.pow(2,X.tileID.overscaledZ),be=X.tileSize*Math.pow(2,U.transform.tileZoom)/He,je=be*(X.tileID.canonical.x+X.tileID.wrap*He),et=be*X.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:oe.tl,u_pattern_br_a:oe.br,u_pattern_tl_b:fe.tl,u_pattern_br_b:fe.br,u_texsize:[Re,Pe],u_mix:L.t,u_pattern_size_a:oe.displaySize,u_pattern_size_b:fe.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/Qi(X,1,U.transform.tileZoom),u_pixel_coord_upper:[je>>16,et>>16],u_pixel_coord_lower:[65535&je,65535&et]}}(d,A,c,E),{u_matrix:l,u_opacity:f})},Il={fillExtrusion:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_lightpos:new m.Uniform3f(l,f.u_lightpos),u_lightintensity:new m.Uniform1f(l,f.u_lightintensity),u_lightcolor:new m.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new m.Uniform1f(l,f.u_vertical_gradient),u_opacity:new m.Uniform1f(l,f.u_opacity)}},fillExtrusionPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_lightpos:new m.Uniform3f(l,f.u_lightpos),u_lightintensity:new m.Uniform1f(l,f.u_lightintensity),u_lightcolor:new m.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new m.Uniform1f(l,f.u_vertical_gradient),u_height_factor:new m.Uniform1f(l,f.u_height_factor),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade),u_opacity:new m.Uniform1f(l,f.u_opacity)}},fill:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},fillPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},fillOutline:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world)}},fillOutlinePattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},circle:function(l,f){return{u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_scale_with_map:new m.Uniform1i(l,f.u_scale_with_map),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_extrude_scale:new m.Uniform2f(l,f.u_extrude_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},collisionBox:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pixels_to_tile_units:new m.Uniform1f(l,f.u_pixels_to_tile_units),u_extrude_scale:new m.Uniform2f(l,f.u_extrude_scale),u_overscale_factor:new m.Uniform1f(l,f.u_overscale_factor)}},collisionCircle:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_inv_matrix:new m.UniformMatrix4f(l,f.u_inv_matrix),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_viewport_size:new m.Uniform2f(l,f.u_viewport_size)}},debug:function(l,f){return{u_color:new m.UniformColor(l,f.u_color),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_overlay:new m.Uniform1i(l,f.u_overlay),u_overlay_scale:new m.Uniform1f(l,f.u_overlay_scale)}},clippingMask:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},heatmap:function(l,f){return{u_extrude_scale:new m.Uniform1f(l,f.u_extrude_scale),u_intensity:new m.Uniform1f(l,f.u_intensity),u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},heatmapTexture:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world),u_image:new m.Uniform1i(l,f.u_image),u_color_ramp:new m.Uniform1i(l,f.u_color_ramp),u_opacity:new m.Uniform1f(l,f.u_opacity)}},hillshade:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_latrange:new m.Uniform2f(l,f.u_latrange),u_light:new m.Uniform2f(l,f.u_light),u_shadow:new m.UniformColor(l,f.u_shadow),u_highlight:new m.UniformColor(l,f.u_highlight),u_accent:new m.UniformColor(l,f.u_accent)}},hillshadePrepare:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_dimension:new m.Uniform2f(l,f.u_dimension),u_zoom:new m.Uniform1f(l,f.u_zoom),u_unpack:new m.Uniform4f(l,f.u_unpack)}},line:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels)}},lineGradient:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_image:new m.Uniform1i(l,f.u_image),u_image_height:new m.Uniform1f(l,f.u_image_height)}},linePattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_texsize:new m.Uniform2f(l,f.u_texsize),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_image:new m.Uniform1i(l,f.u_image),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},lineSDF:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_patternscale_a:new m.Uniform2f(l,f.u_patternscale_a),u_patternscale_b:new m.Uniform2f(l,f.u_patternscale_b),u_sdfgamma:new m.Uniform1f(l,f.u_sdfgamma),u_image:new m.Uniform1i(l,f.u_image),u_tex_y_a:new m.Uniform1f(l,f.u_tex_y_a),u_tex_y_b:new m.Uniform1f(l,f.u_tex_y_b),u_mix:new m.Uniform1f(l,f.u_mix)}},raster:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_tl_parent:new m.Uniform2f(l,f.u_tl_parent),u_scale_parent:new m.Uniform1f(l,f.u_scale_parent),u_buffer_scale:new m.Uniform1f(l,f.u_buffer_scale),u_fade_t:new m.Uniform1f(l,f.u_fade_t),u_opacity:new m.Uniform1f(l,f.u_opacity),u_image0:new m.Uniform1i(l,f.u_image0),u_image1:new m.Uniform1i(l,f.u_image1),u_brightness_low:new m.Uniform1f(l,f.u_brightness_low),u_brightness_high:new m.Uniform1f(l,f.u_brightness_high),u_saturation_factor:new m.Uniform1f(l,f.u_saturation_factor),u_contrast_factor:new m.Uniform1f(l,f.u_contrast_factor),u_spin_weights:new m.Uniform3f(l,f.u_spin_weights)}},symbolIcon:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texture:new m.Uniform1i(l,f.u_texture)}},symbolSDF:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texture:new m.Uniform1i(l,f.u_texture),u_gamma_scale:new m.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(l,f.u_is_halo)}},symbolTextAndIcon:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texsize_icon:new m.Uniform2f(l,f.u_texsize_icon),u_texture:new m.Uniform1i(l,f.u_texture),u_texture_icon:new m.Uniform1i(l,f.u_texture_icon),u_gamma_scale:new m.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(l,f.u_is_halo)}},background:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_opacity:new m.Uniform1f(l,f.u_opacity),u_color:new m.UniformColor(l,f.u_color)}},backgroundPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_opacity:new m.Uniform1f(l,f.u_opacity),u_image:new m.Uniform1i(l,f.u_image),u_pattern_tl_a:new m.Uniform2f(l,f.u_pattern_tl_a),u_pattern_br_a:new m.Uniform2f(l,f.u_pattern_br_a),u_pattern_tl_b:new m.Uniform2f(l,f.u_pattern_tl_b),u_pattern_br_b:new m.Uniform2f(l,f.u_pattern_br_b),u_texsize:new m.Uniform2f(l,f.u_texsize),u_mix:new m.Uniform1f(l,f.u_mix),u_pattern_size_a:new m.Uniform2f(l,f.u_pattern_size_a),u_pattern_size_b:new m.Uniform2f(l,f.u_pattern_size_b),u_scale_a:new m.Uniform1f(l,f.u_scale_a),u_scale_b:new m.Uniform1f(l,f.u_scale_b),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_tile_units_to_pixels:new m.Uniform1f(l,f.u_tile_units_to_pixels)}}};function tl(l,f,c,d,E,A,M){for(var L=l.context,U=L.gl,X=l.useProgram("collisionBox"),oe=[],fe=0,pe=0,Re=0;Re<d.length;Re++){var Pe=d[Re],He=f.getTile(Pe),be=He.getBucket(c);if(be){var je=Pe.posMatrix;E[0]===0&&E[1]===0||(je=l.translatePosMatrix(Pe.posMatrix,He,E,A));var et=M?be.textCollisionBox:be.iconCollisionBox,yt=be.collisionCircleArray;if(yt.length>0){var Ht=m.create(),Nt=je;m.mul(Ht,be.placementInvProjMatrix,l.transform.glCoordMatrix),m.mul(Ht,Ht,be.placementViewportMatrix),oe.push({circleArray:yt,circleOffset:pe,transform:Nt,invTransform:Ht}),pe=fe+=yt.length/4}et&&X.draw(L,U.LINES,ge.disabled,Ie.disabled,l.colorModeForRenderPass(),rt.disabled,vo(je,l.transform,He),c.id,et.layoutVertexBuffer,et.indexBuffer,et.segments,null,l.transform.zoom,null,null,et.collisionVertexBuffer)}}if(M&&oe.length){var Qt=l.useProgram("collisionCircle"),rr=new m.StructArrayLayout2f1f2i16;rr.resize(4*fe),rr._trim();for(var Ir=0,Or=0,ln=oe;Or<ln.length;Or+=1)for(var Bn=ln[Or],Dn=0;Dn<Bn.circleArray.length/4;Dn++){var Un=4*Dn,Ni=Bn.circleArray[Un+0],on=Bn.circleArray[Un+1],ni=Bn.circleArray[Un+2],pi=Bn.circleArray[Un+3];rr.emplace(Ir++,Ni,on,ni,pi,0),rr.emplace(Ir++,Ni,on,ni,pi,1),rr.emplace(Ir++,Ni,on,ni,pi,2),rr.emplace(Ir++,Ni,on,ni,pi,3)}(!rf||rf.length<2*fe)&&(rf=function(ua){var Wo=2*ua,to=new m.StructArrayLayout3ui6;to.resize(Wo),to._trim();for(var ro=0;ro<Wo;ro++){var Za=6*ro;to.uint16[Za+0]=4*ro+0,to.uint16[Za+1]=4*ro+1,to.uint16[Za+2]=4*ro+2,to.uint16[Za+3]=4*ro+2,to.uint16[Za+4]=4*ro+3,to.uint16[Za+5]=4*ro+0}return to}(fe));for(var ei=L.createIndexBuffer(rf,!0),Vn=L.createVertexBuffer(rr,m.collisionCircleLayout.members,!0),gi=0,Kn=oe;gi<Kn.length;gi+=1){var Gn=Kn[gi],Mo=Ff(Gn.transform,Gn.invTransform,l.transform);Qt.draw(L,U.TRIANGLES,ge.disabled,Ie.disabled,l.colorModeForRenderPass(),rt.disabled,Mo,c.id,Vn,ei,m.SegmentVector.simpleSegment(0,2*Gn.circleOffset,Gn.circleArray.length,Gn.circleArray.length/2),null,l.transform.zoom,null,null,null)}Vn.destroy(),ei.destroy()}}var eu=m.identity(new Float32Array(16));function nf(l,f,c,d,E,A){var M=m.getAnchorAlignment(l),L=-(M.horizontalAlign-.5)*f,U=-(M.verticalAlign-.5)*c,X=m.evaluateVariableOffset(l,d);return new m.Point((L/E+X[0])*A,(U/E+X[1])*A)}function af(l,f,c,d,E,A,M,L,U,X,oe){var fe=l.text.placedSymbolArray,pe=l.text.dynamicLayoutVertexArray,Re=l.icon.dynamicLayoutVertexArray,Pe={};pe.clear();for(var He=0;He<fe.length;He++){var be=fe.get(He),je=be.hidden||!be.crossTileID||l.allowVerticalPlacement&&!be.placedOrientation?null:d[be.crossTileID];if(je){var et=new m.Point(be.anchorX,be.anchorY),yt=Ri(et,c?L:M),Ht=Gi(A.cameraToCenterDistance,yt.signedDistanceFromCamera),Nt=E.evaluateSizeForFeature(l.textSizeData,X,be)*Ht/m.ONE_EM;c&&(Nt*=l.tilePixelRatio/U);for(var Qt=nf(je.anchor,je.width,je.height,je.textOffset,je.textBoxScale,Nt),rr=c?Ri(et.add(Qt),M).point:yt.point.add(f?Qt.rotate(-A.angle):Qt),Ir=l.allowVerticalPlacement&&be.placedOrientation===m.WritingMode.vertical?Math.PI/2:0,Or=0;Or<be.numGlyphs;Or++)m.addDynamicAttributes(pe,rr,Ir);oe&&be.associatedIconIndex>=0&&(Pe[be.associatedIconIndex]={shiftedAnchor:rr,angle:Ir})}else _o(be.numGlyphs,pe)}if(oe){Re.clear();for(var ln=l.icon.placedSymbolArray,Bn=0;Bn<ln.length;Bn++){var Dn=ln.get(Bn);if(Dn.hidden)_o(Dn.numGlyphs,Re);else{var Un=Pe[Bn];if(Un)for(var Ni=0;Ni<Dn.numGlyphs;Ni++)m.addDynamicAttributes(Re,Un.shiftedAnchor,Un.angle);else _o(Dn.numGlyphs,Re)}}l.icon.dynamicLayoutVertexBuffer.updateData(Re)}l.text.dynamicLayoutVertexBuffer.updateData(pe)}function of(l,f,c){return c.iconsInText&&f?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function rl(l,f,c,d,E,A,M,L,U,X,oe,fe){for(var pe=l.context,Re=pe.gl,Pe=l.transform,He=L==="map",be=U==="map",je=He&&c.layout.get("symbol-placement")!=="point",et=He&&!be&&!je,yt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ht=!1,Nt=l.depthModeForSublayer(0,ge.ReadOnly),Qt=c.layout.get("text-variable-anchor"),rr=[],Ir=0,Or=d;Ir<Or.length;Ir+=1){var ln=Or[Ir],Bn=f.getTile(ln),Dn=Bn.getBucket(c);if(Dn){var Un=E?Dn.text:Dn.icon;if(Un&&Un.segments.get().length){var Ni=Un.programConfigurations.get(c.id),on=E||Dn.sdfIcons,ni=E?Dn.textSizeData:Dn.iconSizeData,pi=be||Pe.pitch!==0,ei=l.useProgram(of(on,E,Dn),Ni),Vn=m.evaluateSizeForZoom(ni,Pe.zoom),gi=void 0,Kn=[0,0],Gn=void 0,Mo=void 0,ua=null,Wo=void 0;if(E)Gn=Bn.glyphAtlasTexture,Mo=Re.LINEAR,gi=Bn.glyphAtlasTexture.size,Dn.iconsInText&&(Kn=Bn.imageAtlasTexture.size,ua=Bn.imageAtlasTexture,Wo=pi||l.options.rotating||l.options.zooming||ni.kind==="composite"||ni.kind==="camera"?Re.LINEAR:Re.NEAREST);else{var to=c.layout.get("icon-size").constantOr(0)!==1||Dn.iconsNeedLinear;Gn=Bn.imageAtlasTexture,Mo=on||l.options.rotating||l.options.zooming||to||pi?Re.LINEAR:Re.NEAREST,gi=Bn.imageAtlasTexture.size}var ro=Qi(Bn,1,l.transform.zoom),Za=Da(ln.posMatrix,be,He,l.transform,ro),bs=aa(ln.posMatrix,be,He,l.transform,ro),Es=Qt&&Dn.hasTextData(),Nu=c.layout.get("icon-text-fit")!=="none"&&Es&&Dn.hasIconData();je&&su(Dn,ln.posMatrix,l,E,Za,bs,be,X);var Ss=l.translatePosMatrix(ln.posMatrix,Bn,A,M),hu=je||E&&Qt||Nu?eu:Za,Ra=l.translatePosMatrix(bs,Bn,A,M,!0),fo=on&&c.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1)!==0,zu={program:ei,buffers:Un,uniformValues:on?Dn.iconsInText?Lu(ni.kind,Vn,et,be,l,Ss,hu,Ra,gi,Kn):Go(ni.kind,Vn,et,be,l,Ss,hu,Ra,E,gi,!0):dl(ni.kind,Vn,et,be,l,Ss,hu,Ra,E,gi),atlasTexture:Gn,atlasTextureIcon:ua,atlasInterpolation:Mo,atlasInterpolationIcon:Wo,isSDF:on,hasHalo:fo};if(yt&&Dn.canOverlap){Ht=!0;for(var Au=0,du=Un.segments.get();Au<du.length;Au+=1){var Bc=du[Au];rr.push({segments:new m.SegmentVector([Bc]),sortKey:Bc.sortKey,state:zu})}}else rr.push({segments:Un.segments,sortKey:0,state:zu})}}}Ht&&rr.sort(function(xl,bl){return xl.sortKey-bl.sortKey});for(var wu=0,oc=rr;wu<oc.length;wu+=1){var Uu=oc[wu],Eo=Uu.state;if(pe.activeTexture.set(Re.TEXTURE0),Eo.atlasTexture.bind(Eo.atlasInterpolation,Re.CLAMP_TO_EDGE),Eo.atlasTextureIcon&&(pe.activeTexture.set(Re.TEXTURE1),Eo.atlasTextureIcon&&Eo.atlasTextureIcon.bind(Eo.atlasInterpolationIcon,Re.CLAMP_TO_EDGE)),Eo.isSDF){var Xo=Eo.uniformValues;Eo.hasHalo&&(Xo.u_is_halo=1,Ql(Eo.buffers,Uu.segments,c,l,Eo.program,Nt,oe,fe,Xo)),Xo.u_is_halo=0}Ql(Eo.buffers,Uu.segments,c,l,Eo.program,Nt,oe,fe,Eo.uniformValues)}}function Ql(l,f,c,d,E,A,M,L,U){var X=d.context;E.draw(X,X.gl.TRIANGLES,A,M,L,rt.disabled,U,c.id,l.layoutVertexBuffer,l.indexBuffer,f,c.paint,d.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Ic(l,f,c,d,E,A,M){var L,U,X,oe,fe,pe=l.context.gl,Re=c.paint.get("fill-pattern"),Pe=Re&&Re.constantOr(1),He=c.getCrossfadeParameters();M?(U=Pe&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=pe.LINES):(U=Pe?"fillPattern":"fill",L=pe.TRIANGLES);for(var be=0,je=d;be<je.length;be+=1){var et=je[be],yt=f.getTile(et);if(!Pe||yt.patternsLoaded()){var Ht=yt.getBucket(c);if(Ht){var Nt=Ht.programConfigurations.get(c.id),Qt=l.useProgram(U,Nt);Pe&&(l.context.activeTexture.set(pe.TEXTURE0),yt.imageAtlasTexture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),Nt.updatePaintBuffers(He));var rr=Re.constantOr(null);if(rr&&yt.imageAtlas){var Ir=yt.imageAtlas,Or=Ir.patternPositions[rr.to.toString()],ln=Ir.patternPositions[rr.from.toString()];Or&&ln&&Nt.setConstantPatternPositions(Or,ln)}var Bn=l.translatePosMatrix(et.posMatrix,yt,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(M){oe=Ht.indexBuffer2,fe=Ht.segments2;var Dn=[pe.drawingBufferWidth,pe.drawingBufferHeight];X=U==="fillOutlinePattern"&&Pe?yp(Bn,l,He,yt,Dn):da(Bn,Dn)}else oe=Ht.indexBuffer,fe=Ht.segments,X=Pe?wo(Bn,l,He,yt):yu(Bn);Qt.draw(l.context,L,E,l.stencilModeForClipping(et),A,rt.disabled,X,c.id,Ht.layoutVertexBuffer,oe,fe,c.paint,l.transform.zoom,Nt)}}}}function sf(l,f,c,d,E,A,M){for(var L=l.context,U=L.gl,X=c.paint.get("fill-extrusion-pattern"),oe=X.constantOr(1),fe=c.getCrossfadeParameters(),pe=c.paint.get("fill-extrusion-opacity"),Re=0,Pe=d;Re<Pe.length;Re+=1){var He=Pe[Re],be=f.getTile(He),je=be.getBucket(c);if(je){var et=je.programConfigurations.get(c.id),yt=l.useProgram(oe?"fillExtrusionPattern":"fillExtrusion",et);oe&&(l.context.activeTexture.set(U.TEXTURE0),be.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),et.updatePaintBuffers(fe));var Ht=X.constantOr(null);if(Ht&&be.imageAtlas){var Nt=be.imageAtlas,Qt=Nt.patternPositions[Ht.to.toString()],rr=Nt.patternPositions[Ht.from.toString()];Qt&&rr&&et.setConstantPatternPositions(Qt,rr)}var Ir=l.translatePosMatrix(He.posMatrix,be,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Or=c.paint.get("fill-extrusion-vertical-gradient"),ln=oe?Ru(Ir,l,Or,pe,He,fe,be):Mc(Ir,l,Or,pe);yt.draw(L,L.gl.TRIANGLES,E,A,M,rt.backCCW,ln,c.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,c.paint,l.transform.zoom,et)}}}function Oc(l,f,c,d,E,A){var M=l.context,L=M.gl,U=f.fbo;if(U){var X=l.useProgram("hillshade");M.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,U.colorAttachment.get());var oe=function(fe,pe,Re){var Pe=Re.paint.get("hillshade-shadow-color"),He=Re.paint.get("hillshade-highlight-color"),be=Re.paint.get("hillshade-accent-color"),je=Re.paint.get("hillshade-illumination-direction")*(Math.PI/180);Re.paint.get("hillshade-illumination-anchor")==="viewport"&&(je-=fe.transform.angle);var et,yt,Ht,Nt=!fe.options.moving;return{u_matrix:fe.transform.calculatePosMatrix(pe.tileID.toUnwrapped(),Nt),u_image:0,u_latrange:(et=pe.tileID,yt=Math.pow(2,et.canonical.z),Ht=et.canonical.y,[new m.MercatorCoordinate(0,Ht/yt).toLngLat().lat,new m.MercatorCoordinate(0,(Ht+1)/yt).toLngLat().lat]),u_light:[Re.paint.get("hillshade-exaggeration"),je],u_shadow:Pe,u_highlight:He,u_accent:be}}(l,f,c);X.draw(M,L.TRIANGLES,d,E,A,rt.disabled,oe,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function Ep(l,f,c,d,E,A){var M=l.context,L=M.gl,U=f.dem;if(U&&U.data){var X=U.dim,oe=U.stride,fe=U.getPixels();if(M.activeTexture.set(L.TEXTURE1),M.pixelStoreUnpackPremultiplyAlpha.set(!1),f.demTexture=f.demTexture||l.getTileTexture(oe),f.demTexture){var pe=f.demTexture;pe.update(fe,{premultiply:!1}),pe.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else f.demTexture=new m.Texture(M,fe,L.RGBA,{premultiply:!1}),f.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);M.activeTexture.set(L.TEXTURE0);var Re=f.fbo;if(!Re){var Pe=new m.Texture(M,{width:X,height:X,data:null},L.RGBA);Pe.bind(L.LINEAR,L.CLAMP_TO_EDGE),(Re=f.fbo=M.createFramebuffer(X,X,!0)).colorAttachment.set(Pe.texture)}M.bindFramebuffer.set(Re.framebuffer),M.viewport.set([0,0,X,X]),l.useProgram("hillshadePrepare").draw(M,L.TRIANGLES,d,E,A,rt.disabled,function(He,be){var je=be.stride,et=m.create();return m.ortho(et,0,m.EXTENT,-m.EXTENT,0,0,1),m.translate(et,et,[0,-m.EXTENT,0]),{u_matrix:et,u_image:1,u_dimension:[je,je],u_zoom:He.overscaledZ,u_unpack:be.getUnpackVector()}}(f.tileID,U),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),f.needsHillshadePrepare=!1}}function Rc(l,f,c,d,E){var A=d.paint.get("raster-fade-duration");if(A>0){var M=m.browser.now(),L=(M-l.timeAdded)/A,U=f?(M-f.timeAdded)/A:-1,X=c.getSource(),oe=E.coveringZoomLevel({tileSize:X.tileSize,roundZoom:X.roundZoom}),fe=!f||Math.abs(f.tileID.overscaledZ-oe)>Math.abs(l.tileID.overscaledZ-oe),pe=fe&&l.refreshedUponExpiration?1:m.clamp(fe?L:1-U,0,1);return l.refreshedUponExpiration&&L>=1&&(l.refreshedUponExpiration=!1),f?{opacity:1,mix:1-pe}:{opacity:pe,mix:0}}return{opacity:1,mix:0}}var vl=new m.Color(1,0,0,1),uf=new m.Color(0,1,0,1),lf=new m.Color(0,0,1,1),ku=new m.Color(1,0,1,1),cf=new m.Color(0,1,1,1);function Nf(l,f,c,d){Ol(l,0,f+c/2,l.transform.width,c,d)}function Sp(l,f,c,d){Ol(l,f-c/2,0,c,l.transform.height,d)}function Ol(l,f,c,d,E,A){var M=l.context,L=M.gl;L.enable(L.SCISSOR_TEST),L.scissor(f*m.browser.devicePixelRatio,c*m.browser.devicePixelRatio,d*m.browser.devicePixelRatio,E*m.browser.devicePixelRatio),M.clear({color:A}),L.disable(L.SCISSOR_TEST)}function ih(l,f,c){var d=l.context,E=d.gl,A=c.posMatrix,M=l.useProgram("debug"),L=ge.disabled,U=Ie.disabled,X=l.colorModeForRenderPass();d.activeTexture.set(E.TEXTURE0),l.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),M.draw(d,E.LINE_STRIP,L,U,X,rt.disabled,_u(A,m.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var oe=f.getTileByID(c.key).latestRawTileData,fe=Math.floor((oe&&oe.byteLength||0)/1024),pe=f.getTile(c).tileSize,Re=512/Math.min(pe,512)*(c.overscaledZ/l.transform.zoom)*.5,Pe=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Pe+=" => "+c.overscaledZ),function(He,be){He.initDebugOverlayCanvas();var je=He.debugOverlayCanvas,et=He.context.gl,yt=He.debugOverlayCanvas.getContext("2d");yt.clearRect(0,0,je.width,je.height),yt.shadowColor="white",yt.shadowBlur=2,yt.lineWidth=1.5,yt.strokeStyle="white",yt.textBaseline="top",yt.font="bold 36px Open Sans, sans-serif",yt.fillText(be,5,5),yt.strokeText(be,5,5),He.debugOverlayTexture.update(je),He.debugOverlayTexture.bind(et.LINEAR,et.CLAMP_TO_EDGE)}(l,Pe+" "+fe+"kb"),M.draw(d,E.TRIANGLES,L,U,Ge.alphaBlended,rt.disabled,_u(A,m.Color.transparent,Re),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var ss={symbol:function(l,f,c,d,E){if(l.renderPass==="translucent"){var A=Ie.disabled,M=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(L,U,X,oe,fe,pe,Re){for(var Pe=U.transform,He=fe==="map",be=pe==="map",je=0,et=L;je<et.length;je+=1){var yt=et[je],Ht=oe.getTile(yt),Nt=Ht.getBucket(X);if(Nt&&Nt.text&&Nt.text.segments.get().length){var Qt=m.evaluateSizeForZoom(Nt.textSizeData,Pe.zoom),rr=Qi(Ht,1,U.transform.zoom),Ir=Da(yt.posMatrix,be,He,U.transform,rr),Or=X.layout.get("icon-text-fit")!=="none"&&Nt.hasIconData();if(Qt){var ln=Math.pow(2,Pe.zoom-Ht.tileID.overscaledZ);af(Nt,He,be,Re,m.symbolSize,Pe,Ir,yt.posMatrix,ln,Qt,Or)}}}}(d,l,c,f,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),E),c.paint.get("icon-opacity").constantOr(1)!==0&&rl(l,f,c,d,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),A,M),c.paint.get("text-opacity").constantOr(1)!==0&&rl(l,f,c,d,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),A,M),f.map.showCollisionBoxes&&(tl(l,f,c,d,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),tl(l,f,c,d,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,f,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("circle-opacity"),A=c.paint.get("circle-stroke-width"),M=c.paint.get("circle-stroke-opacity"),L=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(E.constantOr(1)!==0||A.constantOr(1)!==0&&M.constantOr(1)!==0){for(var U=l.context,X=U.gl,oe=l.depthModeForSublayer(0,ge.ReadOnly),fe=Ie.disabled,pe=l.colorModeForRenderPass(),Re=[],Pe=0;Pe<d.length;Pe++){var He=d[Pe],be=f.getTile(He),je=be.getBucket(c);if(je){var et=je.programConfigurations.get(c.id),yt={programConfiguration:et,program:l.useProgram("circle",et),layoutVertexBuffer:je.layoutVertexBuffer,indexBuffer:je.indexBuffer,uniformValues:_p(l,He,be,c)};if(L)for(var Ht=0,Nt=je.segments.get();Ht<Nt.length;Ht+=1){var Qt=Nt[Ht];Re.push({segments:new m.SegmentVector([Qt]),sortKey:Qt.sortKey,state:yt})}else Re.push({segments:je.segments,sortKey:0,state:yt})}}L&&Re.sort(function(Bn,Dn){return Bn.sortKey-Dn.sortKey});for(var rr=0,Ir=Re;rr<Ir.length;rr+=1){var Or=Ir[rr],ln=Or.state;ln.program.draw(U,X.TRIANGLES,oe,fe,pe,rt.disabled,ln.uniformValues,c.id,ln.layoutVertexBuffer,ln.indexBuffer,Or.segments,c.paint,l.transform.zoom,ln.programConfiguration)}}}},heatmap:function(l,f,c,d){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var E=l.context,A=E.gl,M=Ie.disabled,L=new Ge([A.ONE,A.ONE],m.Color.transparent,[!0,!0,!0,!0]);(function(Re,Pe,He){var be=Re.gl;Re.activeTexture.set(be.TEXTURE1),Re.viewport.set([0,0,Pe.width/4,Pe.height/4]);var je=He.heatmapFbo;if(je)be.bindTexture(be.TEXTURE_2D,je.colorAttachment.get()),Re.bindFramebuffer.set(je.framebuffer);else{var et=be.createTexture();be.bindTexture(be.TEXTURE_2D,et),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_WRAP_S,be.CLAMP_TO_EDGE),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_WRAP_T,be.CLAMP_TO_EDGE),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_MIN_FILTER,be.LINEAR),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_MAG_FILTER,be.LINEAR),je=He.heatmapFbo=Re.createFramebuffer(Pe.width/4,Pe.height/4,!1),function(yt,Ht,Nt,Qt){var rr=yt.gl;rr.texImage2D(rr.TEXTURE_2D,0,rr.RGBA,Ht.width/4,Ht.height/4,0,rr.RGBA,yt.extRenderToTextureHalfFloat?yt.extTextureHalfFloat.HALF_FLOAT_OES:rr.UNSIGNED_BYTE,null),Qt.colorAttachment.set(Nt)}(Re,Pe,et,je)}})(E,l,c),E.clear({color:m.Color.transparent});for(var U=0;U<d.length;U++){var X=d[U];if(!f.hasRenderableParent(X)){var oe=f.getTile(X),fe=oe.getBucket(c);if(fe){var pe=fe.programConfigurations.get(c.id);l.useProgram("heatmap",pe).draw(E,A.TRIANGLES,ge.disabled,M,L,rt.disabled,Pc(X.posMatrix,oe,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,c.paint,l.transform.zoom,pe)}}}E.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(Re,Pe){var He=Re.context,be=He.gl,je=Pe.heatmapFbo;if(je){He.activeTexture.set(be.TEXTURE0),be.bindTexture(be.TEXTURE_2D,je.colorAttachment.get()),He.activeTexture.set(be.TEXTURE1);var et=Pe.colorRampTexture;et||(et=Pe.colorRampTexture=new m.Texture(He,Pe.colorRamp,be.RGBA)),et.bind(be.LINEAR,be.CLAMP_TO_EDGE),Re.useProgram("heatmapTexture").draw(He,be.TRIANGLES,ge.disabled,Ie.disabled,Re.colorModeForRenderPass(),rt.disabled,function(yt,Ht,Nt,Qt){var rr=m.create();m.ortho(rr,0,yt.width,yt.height,0,0,1);var Ir=yt.context.gl;return{u_matrix:rr,u_world:[Ir.drawingBufferWidth,Ir.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Ht.paint.get("heatmap-opacity")}}(Re,Pe),Pe.id,Re.viewportBuffer,Re.quadTriangleIndexBuffer,Re.viewportSegments,Pe.paint,Re.transform.zoom)}}(l,c))},line:function(l,f,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("line-opacity"),A=c.paint.get("line-width");if(E.constantOr(1)!==0&&A.constantOr(1)!==0)for(var M=l.depthModeForSublayer(0,ge.ReadOnly),L=l.colorModeForRenderPass(),U=c.paint.get("line-dasharray"),X=c.paint.get("line-pattern"),oe=X.constantOr(1),fe=c.paint.get("line-gradient"),pe=c.getCrossfadeParameters(),Re=oe?"linePattern":U?"lineSDF":fe?"lineGradient":"line",Pe=l.context,He=Pe.gl,be=!0,je=0,et=d;je<et.length;je+=1){var yt=et[je],Ht=f.getTile(yt);if(!oe||Ht.patternsLoaded()){var Nt=Ht.getBucket(c);if(Nt){var Qt=Nt.programConfigurations.get(c.id),rr=l.context.program.get(),Ir=l.useProgram(Re,Qt),Or=be||Ir.program!==rr,ln=X.constantOr(null);if(ln&&Ht.imageAtlas){var Bn=Ht.imageAtlas,Dn=Bn.patternPositions[ln.to.toString()],Un=Bn.patternPositions[ln.from.toString()];Dn&&Un&&Qt.setConstantPatternPositions(Dn,Un)}var Ni=oe?Pl(l,Ht,c,pe):U?$l(l,Ht,c,U,pe):fe?Aa(l,Ht,c,Nt.lineClipsArray.length):hl(l,Ht,c);if(oe)Pe.activeTexture.set(He.TEXTURE0),Ht.imageAtlasTexture.bind(He.LINEAR,He.CLAMP_TO_EDGE),Qt.updatePaintBuffers(pe);else if(U&&(Or||l.lineAtlas.dirty))Pe.activeTexture.set(He.TEXTURE0),l.lineAtlas.bind(Pe);else if(fe){var on=Nt.gradients[c.id],ni=on.texture;if(c.gradientVersion!==on.version){var pi=256;if(c.stepInterpolant){var ei=f.getSource().maxzoom,Vn=yt.canonical.z===ei?Math.ceil(1<<l.transform.maxZoom-yt.canonical.z):1;pi=m.clamp(m.nextPowerOfTwo(Nt.maxLineLength/m.EXTENT*1024*Vn),256,Pe.maxTextureSize)}on.gradient=m.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:pi,image:on.gradient||void 0,clips:Nt.lineClipsArray}),on.texture?on.texture.update(on.gradient):on.texture=new m.Texture(Pe,on.gradient,He.RGBA),on.version=c.gradientVersion,ni=on.texture}Pe.activeTexture.set(He.TEXTURE0),ni.bind(c.stepInterpolant?He.NEAREST:He.LINEAR,He.CLAMP_TO_EDGE)}Ir.draw(Pe,He.TRIANGLES,M,l.stencilModeForClipping(yt),L,rt.disabled,Ni,c.id,Nt.layoutVertexBuffer,Nt.indexBuffer,Nt.segments,c.paint,l.transform.zoom,Qt,Nt.layoutVertexBuffer2),be=!1}}}}},fill:function(l,f,c,d){var E=c.paint.get("fill-color"),A=c.paint.get("fill-opacity");if(A.constantOr(1)!==0){var M=l.colorModeForRenderPass(),L=c.paint.get("fill-pattern"),U=l.opaquePassEnabledForLayer()&&!L.constantOr(1)&&E.constantOr(m.Color.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===U){var X=l.depthModeForSublayer(1,l.renderPass==="opaque"?ge.ReadWrite:ge.ReadOnly);Ic(l,f,c,d,X,M,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var oe=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,ge.ReadOnly);Ic(l,f,c,d,oe,M,!0)}}},"fill-extrusion":function(l,f,c,d){var E=c.paint.get("fill-extrusion-opacity");if(E!==0&&l.renderPass==="translucent"){var A=new ge(l.context.gl.LEQUAL,ge.ReadWrite,l.depthRangeFor3D);if(E!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))sf(l,f,c,d,A,Ie.disabled,Ge.disabled),sf(l,f,c,d,A,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var M=l.colorModeForRenderPass();sf(l,f,c,d,A,Ie.disabled,M)}}},hillshade:function(l,f,c,d){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var E=l.context,A=l.depthModeForSublayer(0,ge.ReadOnly),M=l.colorModeForRenderPass(),L=l.renderPass==="translucent"?l.stencilConfigForOverlap(d):[{},d],U=L[0],X=0,oe=L[1];X<oe.length;X+=1){var fe=oe[X],pe=f.getTile(fe);pe.needsHillshadePrepare&&l.renderPass==="offscreen"?Ep(l,pe,c,A,Ie.disabled,M):l.renderPass==="translucent"&&Oc(l,pe,c,A,U[fe.overscaledZ],M)}E.viewport.set([0,0,l.width,l.height])}},raster:function(l,f,c,d){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&d.length)for(var E=l.context,A=E.gl,M=f.getSource(),L=l.useProgram("raster"),U=l.colorModeForRenderPass(),X=M instanceof vt?[{},d]:l.stencilConfigForOverlap(d),oe=X[0],fe=X[1],pe=fe[fe.length-1].overscaledZ,Re=!l.options.moving,Pe=0,He=fe;Pe<He.length;Pe+=1){var be=He[Pe],je=l.depthModeForSublayer(be.overscaledZ-pe,c.paint.get("raster-opacity")===1?ge.ReadWrite:ge.ReadOnly,A.LESS),et=f.getTile(be),yt=l.transform.calculatePosMatrix(be.toUnwrapped(),Re);et.registerFadeDuration(c.paint.get("raster-fade-duration"));var Ht=f.findLoadedParent(be,0),Nt=Rc(et,Ht,f,c,l.transform),Qt=void 0,rr=void 0,Ir=c.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;E.activeTexture.set(A.TEXTURE0),et.texture.bind(Ir,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(A.TEXTURE1),Ht?(Ht.texture.bind(Ir,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),Qt=Math.pow(2,Ht.tileID.overscaledZ-et.tileID.overscaledZ),rr=[et.tileID.canonical.x*Qt%1,et.tileID.canonical.y*Qt%1]):et.texture.bind(Ir,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST);var Or=xp(yt,rr||[0,0],Qt||1,Nt,c);M instanceof vt?L.draw(E,A.TRIANGLES,je,Ie.disabled,U,rt.disabled,Or,c.id,M.boundsBuffer,l.quadTriangleIndexBuffer,M.boundsSegments):L.draw(E,A.TRIANGLES,je,oe[be.overscaledZ],U,rt.disabled,Or,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,f,c){var d=c.paint.get("background-color"),E=c.paint.get("background-opacity");if(E!==0){var A=l.context,M=A.gl,L=l.transform,U=L.tileSize,X=c.paint.get("background-pattern");if(!l.isPatternMissing(X)){var oe=!X&&d.a===1&&E===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===oe){var fe=Ie.disabled,pe=l.depthModeForSublayer(0,oe==="opaque"?ge.ReadWrite:ge.ReadOnly),Re=l.colorModeForRenderPass(),Pe=l.useProgram(X?"backgroundPattern":"background"),He=L.coveringTiles({tileSize:U});X&&(A.activeTexture.set(M.TEXTURE0),l.imageManager.bind(l.context));for(var be=c.getCrossfadeParameters(),je=0,et=He;je<et.length;je+=1){var yt=et[je],Ht=l.transform.calculatePosMatrix(yt.toUnwrapped()),Nt=X?Ho(Ht,E,l,X,{tileID:yt,tileSize:U},be):el(Ht,E,d);Pe.draw(A,M.TRIANGLES,pe,fe,Re,rt.disabled,Nt,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,f,c){for(var d=0;d<c.length;d++)ih(l,f,c[d])},custom:function(l,f,c){var d=l.context,E=c.implementation;if(l.renderPass==="offscreen"){var A=E.prerender;A&&(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),A.call(E,d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(Ie.disabled);var M=E.renderingMode==="3d"?new ge(l.context.gl.LEQUAL,ge.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,ge.ReadOnly);d.setDepthMode(M),E.render(d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}},qa=function(l,f){this.context=new ce(l),this.transform=f,this._tileTextures={},this.setup(),this.numSublayers=De.maxUnderzooming+De.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Rt,this.gpuTimers={}};qa.prototype.resize=function(l,f){if(this.width=l*m.browser.devicePixelRatio,this.height=f*m.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,d=this.style._order;c<d.length;c+=1)this.style._layers[d[c]].resize()},qa.prototype.setup=function(){var l=this.context,f=new m.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(m.EXTENT,0),f.emplaceBack(0,m.EXTENT),f.emplaceBack(m.EXTENT,m.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(f,oa.members),this.tileExtentSegments=m.SegmentVector.simpleSegment(0,0,4,2);var c=new m.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(m.EXTENT,0),c.emplaceBack(0,m.EXTENT),c.emplaceBack(m.EXTENT,m.EXTENT),this.debugBuffer=l.createVertexBuffer(c,oa.members),this.debugSegments=m.SegmentVector.simpleSegment(0,0,4,5);var d=new m.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(m.EXTENT,0,m.EXTENT,0),d.emplaceBack(0,m.EXTENT,0,m.EXTENT),d.emplaceBack(m.EXTENT,m.EXTENT,m.EXTENT,m.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(d,St.members),this.rasterBoundsSegments=m.SegmentVector.simpleSegment(0,0,4,2);var E=new m.StructArrayLayout2i4;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(E,oa.members),this.viewportSegments=m.SegmentVector.simpleSegment(0,0,4,2);var A=new m.StructArrayLayout1ui2;A.emplaceBack(0),A.emplaceBack(1),A.emplaceBack(3),A.emplaceBack(2),A.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(A);var M=new m.StructArrayLayout3ui6;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(M),this.emptyTexture=new m.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var L=this.context.gl;this.stencilClearMode=new Ie({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)},qa.prototype.clearStencil=function(){var l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=m.create();m.ortho(c,0,this.width,this.height,0,0,1),m.scale(c,c,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,f.TRIANGLES,ge.disabled,this.stencilClearMode,Ge.disabled,rt.disabled,Bs(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},qa.prototype._renderTileClippingMasks=function(l,f){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&f&&f.length){this.currentStencilSource=l.source;var c=this.context,d=c.gl;this.nextStencilID+f.length>256&&this.clearStencil(),c.setColorMode(Ge.disabled),c.setDepthMode(ge.disabled);var E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var A=0,M=f;A<M.length;A+=1){var L=M[A],U=this._tileClippingMaskIDs[L.key]=this.nextStencilID++;E.draw(c,d.TRIANGLES,ge.disabled,new Ie({func:d.ALWAYS,mask:0},U,255,d.KEEP,d.KEEP,d.REPLACE),Ge.disabled,rt.disabled,Bs(L.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},qa.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,f=this.context.gl;return new Ie({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)},qa.prototype.stencilModeForClipping=function(l){var f=this.context.gl;return new Ie({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)},qa.prototype.stencilConfigForOverlap=function(l){var f,c=this.context.gl,d=l.sort(function(U,X){return X.overscaledZ-U.overscaledZ}),E=d[d.length-1].overscaledZ,A=d[0].overscaledZ-E+1;if(A>1){this.currentStencilSource=void 0,this.nextStencilID+A>256&&this.clearStencil();for(var M={},L=0;L<A;L++)M[L+E]=new Ie({func:c.GEQUAL,mask:255},L+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=A,[M,d]}return[(f={},f[E]=Ie.disabled,f),d]},qa.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new Ge([l.CONSTANT_COLOR,l.ONE],new m.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ge.unblended:Ge.alphaBlended},qa.prototype.depthModeForSublayer=function(l,f,c){if(!this.opaquePassEnabledForLayer())return ge.disabled;var d=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new ge(c||this.context.gl.LEQUAL,f,[d,d])},qa.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},qa.prototype.render=function(l,f){var c=this;this.style=l,this.options=f,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(m.browser.now()),this.imageManager.beginFrame();var d=this.style._order,E=this.style.sourceCaches;for(var A in E){var M=E[A];M.used&&M.prepare(this.context)}var L,U,X={},oe={},fe={};for(var pe in E){var Re=E[pe];X[pe]=Re.getVisibleCoordinates(),oe[pe]=X[pe].slice().reverse(),fe[pe]=Re.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Pe=0;Pe<d.length;Pe++)if(this.style._layers[d[Pe]].is3D()){this.opaquePassCutoff=Pe;break}this.renderPass="offscreen";for(var He=0,be=d;He<be.length;He+=1){var je=this.style._layers[be[He]];if(je.hasOffscreenPass()&&!je.isHidden(this.transform.zoom)){var et=oe[je.source];(je.type==="custom"||et.length)&&this.renderLayer(this,E[je.source],je,et)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?m.Color.black:m.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){var yt=this.style._layers[d[this.currentLayer]],Ht=E[yt.source],Nt=X[yt.source];this._renderTileClippingMasks(yt,Nt),this.renderLayer(this,Ht,yt,Nt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){var Qt=this.style._layers[d[this.currentLayer]],rr=E[Qt.source],Ir=(Qt.type==="symbol"?fe:oe)[Qt.source];this._renderTileClippingMasks(Qt,X[Qt.source]),this.renderLayer(this,rr,Qt,Ir)}this.options.showTileBoundaries&&(m.values(this.style._layers).forEach(function(Or){Or.source&&!Or.isHidden(c.transform.zoom)&&(Or.source!==(U&&U.id)&&(U=c.style.sourceCaches[Or.source]),(!L||L.getSource().maxzoom<U.getSource().maxzoom)&&(L=U))}),L&&ss.debug(this,L,L.getVisibleCoordinates())),this.options.showPadding&&function(Or){var ln=Or.transform.padding;Nf(Or,Or.transform.height-(ln.top||0),3,vl),Nf(Or,ln.bottom||0,3,uf),Sp(Or,ln.left||0,3,lf),Sp(Or,Or.transform.width-(ln.right||0),3,ku);var Bn=Or.transform.centerPoint;(function(Dn,Un,Ni,on){Ol(Dn,Un-1,Ni-10,2,20,on),Ol(Dn,Un-10,Ni-1,20,2,on)})(Or,Bn.x,Or.transform.height-Bn.y,cf)}(this),this.context.setDefault()},qa.prototype.renderLayer=function(l,f,c,d){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||d.length)&&(this.id=c.id,this.gpuTimingStart(c),ss[c.type](l,f,c,d,this.style.placement.variableOffsets),this.gpuTimingEnd())},qa.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var f=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),c.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,c.query)}},qa.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},qa.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},qa.prototype.queryGpuTimers=function(l){var f={};for(var c in l){var d=l[c],E=this.context.extTimerQuery,A=E.getQueryObjectEXT(d.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(d.query),f[c]=A}return f},qa.prototype.translatePosMatrix=function(l,f,c,d,E){if(!c[0]&&!c[1])return l;var A=E?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(A){var M=Math.sin(A),L=Math.cos(A);c=[c[0]*L-c[1]*M,c[0]*M+c[1]*L]}var U=[E?c[0]:Qi(f,c[0],this.transform.zoom),E?c[1]:Qi(f,c[1],this.transform.zoom),0],X=new Float32Array(16);return m.translate(X,l,U),X},qa.prototype.saveTileTexture=function(l){var f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]},qa.prototype.getTileTexture=function(l){var f=this._tileTextures[l];return f&&f.length>0?f.pop():null},qa.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var f=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!f||!c},qa.prototype.useProgram=function(l,f){this.cache=this.cache||{};var c=""+l+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new tf(this.context,l,Fo[l],f,Il[l],this._showOverdrawInspector)),this.cache[c]},qa.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},qa.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},qa.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=m.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new m.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},qa.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Jl=function(l,f){this.points=l,this.planes=f};Jl.fromInvProjectionMatrix=function(l,f,c){var d=Math.pow(2,c),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(M){return m.transformMat4([],M,l)}).map(function(M){return m.scale$1([],M,1/M[3]/f*d)}),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(M){var L=m.sub([],E[M[0]],E[M[1]]),U=m.sub([],E[M[2]],E[M[1]]),X=m.normalize([],m.cross([],L,U)),oe=-m.dot(X,E[M[1]]);return X.concat(oe)});return new Jl(E,A)};var Rl=function(l,f){this.min=l,this.max=f,this.center=m.scale$2([],m.add([],this.min,this.max),.5)};Rl.prototype.quadrant=function(l){for(var f=[l%2==0,l<2],c=m.clone$2(this.min),d=m.clone$2(this.max),E=0;E<f.length;E++)c[E]=f[E]?this.min[E]:this.center[E],d[E]=f[E]?this.center[E]:this.max[E];return d[2]=this.max[2],new Rl(c,d)},Rl.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},Rl.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},Rl.prototype.intersects=function(l){for(var f=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,d=0;d<l.planes.length;d++){for(var E=l.planes[d],A=0,M=0;M<f.length;M++)A+=m.dot$1(E,f[M])>=0;if(A===0)return 0;A!==f.length&&(c=!1)}if(c)return 2;for(var L=0;L<3;L++){for(var U=Number.MAX_VALUE,X=-Number.MAX_VALUE,oe=0;oe<l.points.length;oe++){var fe=l.points[oe][L]-this.min[L];U=Math.min(U,fe),X=Math.max(X,fe)}if(X<0||U>this.max[L]-this.min[L])return 0}return 1};var fu=function(l,f,c,d){if(l===void 0&&(l=0),f===void 0&&(f=0),c===void 0&&(c=0),d===void 0&&(d=0),isNaN(l)||l<0||isNaN(f)||f<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=c,this.right=d};fu.prototype.interpolate=function(l,f,c){return f.top!=null&&l.top!=null&&(this.top=m.number(l.top,f.top,c)),f.bottom!=null&&l.bottom!=null&&(this.bottom=m.number(l.bottom,f.bottom,c)),f.left!=null&&l.left!=null&&(this.left=m.number(l.left,f.left,c)),f.right!=null&&l.right!=null&&(this.right=m.number(l.right,f.right,c)),this},fu.prototype.getCenter=function(l,f){var c=m.clamp((this.left+l-this.right)/2,0,l),d=m.clamp((this.top+f-this.bottom)/2,0,f);return new m.Point(c,d)},fu.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},fu.prototype.clone=function(){return new fu(this.top,this.bottom,this.left,this.right)},fu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Bi=function(l,f,c,d,E){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=E===void 0||E,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=c==null?0:c,this._maxPitch=d==null?60:d,this.setMaxBounds(),this.width=0,this.height=0,this._center=new m.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new fu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Fa={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Bi.prototype.clone=function(){var l=new Bi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},Fa.minZoom.get=function(){return this._minZoom},Fa.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},Fa.maxZoom.get=function(){return this._maxZoom},Fa.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},Fa.minPitch.get=function(){return this._minPitch},Fa.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},Fa.maxPitch.get=function(){return this._maxPitch},Fa.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},Fa.renderWorldCopies.get=function(){return this._renderWorldCopies},Fa.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},Fa.worldSize.get=function(){return this.tileSize*this.scale},Fa.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Fa.size.get=function(){return new m.Point(this.width,this.height)},Fa.bearing.get=function(){return-this.angle/Math.PI*180},Fa.bearing.set=function(l){var f=-m.wrap(l,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=m.create$2(),m.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Fa.pitch.get=function(){return this._pitch/Math.PI*180},Fa.pitch.set=function(l){var f=m.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())},Fa.fov.get=function(){return this._fov/Math.PI*180},Fa.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},Fa.zoom.get=function(){return this._zoom},Fa.zoom.set=function(l){var f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.scale=this.zoomScale(f),this.tileZoom=Math.floor(f),this.zoomFraction=f-this.tileZoom,this._constrain(),this._calcMatrices())},Fa.center.get=function(){return this._center},Fa.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},Fa.padding.get=function(){return this._edgeInsets.toJSON()},Fa.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},Fa.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Bi.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},Bi.prototype.interpolatePadding=function(l,f,c){this._unmodified=!1,this._edgeInsets.interpolate(l,f,c),this._constrain(),this._calcMatrices()},Bi.prototype.coveringZoomLevel=function(l){var f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)},Bi.prototype.getVisibleUnwrappedCoordinates=function(l){var f=[new m.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new m.Point(0,0)),d=this.pointCoordinate(new m.Point(this.width,0)),E=this.pointCoordinate(new m.Point(this.width,this.height)),A=this.pointCoordinate(new m.Point(0,this.height)),M=Math.floor(Math.min(c.x,d.x,E.x,A.x)),L=Math.floor(Math.max(c.x,d.x,E.x,A.x)),U=M-1;U<=L+1;U++)U!==0&&f.push(new m.UnwrappedTileID(U,l));return f},Bi.prototype.coveringTiles=function(l){var f=this.coveringZoomLevel(l),c=f;if(l.minzoom!==void 0&&f<l.minzoom)return[];l.maxzoom!==void 0&&f>l.maxzoom&&(f=l.maxzoom);var d=m.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,f),A=[E*d.x,E*d.y,0],M=Jl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f),L=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(L=f);var U=function(Or){return{aabb:new Rl([Or*E,0,0],[(Or+1)*E,E,0]),zoom:0,x:0,y:0,wrap:Or,fullyVisible:!1}},X=[],oe=[],fe=f,pe=l.reparseOverscaled?c:f;if(this._renderWorldCopies)for(var Re=1;Re<=3;Re++)X.push(U(-Re)),X.push(U(Re));for(X.push(U(0));X.length>0;){var Pe=X.pop(),He=Pe.x,be=Pe.y,je=Pe.fullyVisible;if(!je){var et=Pe.aabb.intersects(M);if(et===0)continue;je=et===2}var yt=Pe.aabb.distanceX(A),Ht=Pe.aabb.distanceY(A),Nt=Math.max(Math.abs(yt),Math.abs(Ht));if(Pe.zoom===fe||Nt>3+(1<<fe-Pe.zoom)-2&&Pe.zoom>=L)oe.push({tileID:new m.OverscaledTileID(Pe.zoom===fe?pe:Pe.zoom,Pe.wrap,Pe.zoom,He,be),distanceSq:m.sqrLen([A[0]-.5-He,A[1]-.5-be])});else for(var Qt=0;Qt<4;Qt++){var rr=(He<<1)+Qt%2,Ir=(be<<1)+(Qt>>1);X.push({aabb:Pe.aabb.quadrant(Qt),zoom:Pe.zoom+1,x:rr,y:Ir,wrap:Pe.wrap,fullyVisible:je})}}return oe.sort(function(Or,ln){return Or.distanceSq-ln.distanceSq}).map(function(Or){return Or.tileID})},Bi.prototype.resize=function(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()},Fa.unmodified.get=function(){return this._unmodified},Bi.prototype.zoomScale=function(l){return Math.pow(2,l)},Bi.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},Bi.prototype.project=function(l){var f=m.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new m.Point(m.mercatorXfromLng(l.lng)*this.worldSize,m.mercatorYfromLat(f)*this.worldSize)},Bi.prototype.unproject=function(l){return new m.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},Fa.point.get=function(){return this.project(this.center)},Bi.prototype.setLocationAtPoint=function(l,f){var c=this.pointCoordinate(f),d=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(l),A=new m.MercatorCoordinate(E.x-(c.x-d.x),E.y-(c.y-d.y));this.center=this.coordinateLocation(A),this._renderWorldCopies&&(this.center=this.center.wrap())},Bi.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},Bi.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},Bi.prototype.locationCoordinate=function(l){return m.MercatorCoordinate.fromLngLat(l)},Bi.prototype.coordinateLocation=function(l){return l.toLngLat()},Bi.prototype.pointCoordinate=function(l){var f=[l.x,l.y,0,1],c=[l.x,l.y,1,1];m.transformMat4(f,f,this.pixelMatrixInverse),m.transformMat4(c,c,this.pixelMatrixInverse);var d=f[3],E=c[3],A=f[1]/d,M=c[1]/E,L=f[2]/d,U=c[2]/E,X=L===U?0:(0-L)/(U-L);return new m.MercatorCoordinate(m.number(f[0]/d,c[0]/E,X)/this.worldSize,m.number(A,M,X)/this.worldSize)},Bi.prototype.coordinatePoint=function(l){var f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return m.transformMat4(f,f,this.pixelMatrix),new m.Point(f[0]/f[3],f[1]/f[3])},Bi.prototype.getBounds=function(){return new m.LngLatBounds().extend(this.pointLocation(new m.Point(0,0))).extend(this.pointLocation(new m.Point(this.width,0))).extend(this.pointLocation(new m.Point(this.width,this.height))).extend(this.pointLocation(new m.Point(0,this.height)))},Bi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new m.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Bi.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Bi.prototype.calculatePosMatrix=function(l,f){f===void 0&&(f=!1);var c=l.key,d=f?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];var E=l.canonical,A=this.worldSize/this.zoomScale(E.z),M=E.x+Math.pow(2,E.z)*l.wrap,L=m.identity(new Float64Array(16));return m.translate(L,L,[M*A,E.y*A,0]),m.scale(L,L,[A/m.EXTENT,A/m.EXTENT,1]),m.multiply(L,f?this.alignedProjMatrix:this.projMatrix,L),d[c]=new Float32Array(L),d[c]},Bi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Bi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,f,c,d,E=-90,A=90,M=-180,L=180,U=this.size,X=this._unmodified;if(this.latRange){var oe=this.latRange;E=m.mercatorYfromLat(oe[1])*this.worldSize,l=(A=m.mercatorYfromLat(oe[0])*this.worldSize)-E<U.y?U.y/(A-E):0}if(this.lngRange){var fe=this.lngRange;M=m.mercatorXfromLng(fe[0])*this.worldSize,f=(L=m.mercatorXfromLng(fe[1])*this.worldSize)-M<U.x?U.x/(L-M):0}var pe=this.point,Re=Math.max(f||0,l||0);if(Re)return this.center=this.unproject(new m.Point(f?(L+M)/2:pe.x,l?(A+E)/2:pe.y)),this.zoom+=this.scaleZoom(Re),this._unmodified=X,void(this._constraining=!1);if(this.latRange){var Pe=pe.y,He=U.y/2;Pe-He<E&&(d=E+He),Pe+He>A&&(d=A-He)}if(this.lngRange){var be=pe.x,je=U.x/2;be-je<M&&(c=M+je),be+je>L&&(c=L-je)}c===void 0&&d===void 0||(this.center=this.unproject(new m.Point(c!==void 0?c:pe.x,d!==void 0?d:pe.y))),this._unmodified=X,this._constraining=!1}},Bi.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var f=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),d=Math.sin(c)*this.cameraToCenterDistance/Math.sin(m.clamp(Math.PI-f-c,.01,Math.PI-.01)),E=this.point,A=E.x,M=E.y,L=1.01*(Math.cos(Math.PI/2-this._pitch)*d+this.cameraToCenterDistance),U=this.height/50,X=new Float64Array(16);m.perspective(X,this._fov,this.width/this.height,U,L),X[8]=2*-l.x/this.width,X[9]=2*l.y/this.height,m.scale(X,X,[1,-1,1]),m.translate(X,X,[0,0,-this.cameraToCenterDistance]),m.rotateX(X,X,this._pitch),m.rotateZ(X,X,this.angle),m.translate(X,X,[-A,-M,0]),this.mercatorMatrix=m.scale([],X,[this.worldSize,this.worldSize,this.worldSize]),m.scale(X,X,[1,1,m.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=X,this.invProjMatrix=m.invert([],this.projMatrix);var oe=this.width%2/2,fe=this.height%2/2,pe=Math.cos(this.angle),Re=Math.sin(this.angle),Pe=A-Math.round(A)+pe*oe+Re*fe,He=M-Math.round(M)+pe*fe+Re*oe,be=new Float64Array(X);if(m.translate(be,be,[Pe>.5?Pe-1:Pe,He>.5?He-1:He,0]),this.alignedProjMatrix=be,X=m.create(),m.scale(X,X,[this.width/2,-this.height/2,1]),m.translate(X,X,[1,-1,0]),this.labelPlaneMatrix=X,X=m.create(),m.scale(X,X,[1,-1,1]),m.translate(X,X,[-1,-1,0]),m.scale(X,X,[2/this.width,2/this.height,1]),this.glCoordMatrix=X,this.pixelMatrix=m.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(X=m.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=X,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Bi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new m.Point(0,0)),f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return m.transformMat4(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance},Bi.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new m.Point(0,l))},Bi.prototype.getCameraQueryGeometry=function(l){var f=this.getCameraPoint();if(l.length===1)return[l[0],f];for(var c=f.x,d=f.y,E=f.x,A=f.y,M=0,L=l;M<L.length;M+=1){var U=L[M];c=Math.min(c,U.x),d=Math.min(d,U.y),E=Math.max(E,U.x),A=Math.max(A,U.y)}return[new m.Point(c,d),new m.Point(E,d),new m.Point(E,A),new m.Point(c,A),new m.Point(c,d)]},Object.defineProperties(Bi.prototype,Fa);var Ns=function(l){var f,c,d,E;this._hashName=l&&encodeURIComponent(l),m.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(f=this._updateHashUnthrottled.bind(this),c=!1,d=null,E=function(){d=null,c&&(f(),d=setTimeout(E,300),c=!1)},function(){return c=!0,d||E(),d})};Ns.prototype.addTo=function(l){return this._map=l,m.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ns.prototype.remove=function(){return m.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ns.prototype.getHashString=function(l){var f=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,d),A=Math.round(f.lng*E)/E,M=Math.round(f.lat*E)/E,L=this._map.getBearing(),U=this._map.getPitch(),X="";if(X+=l?"/"+A+"/"+M+"/"+c:c+"/"+M+"/"+A,(L||U)&&(X+="/"+Math.round(10*L)/10),U&&(X+="/"+Math.round(U)),this._hashName){var oe=this._hashName,fe=!1,pe=m.window.location.hash.slice(1).split("&").map(function(Re){var Pe=Re.split("=")[0];return Pe===oe?(fe=!0,Pe+"="+X):Re}).filter(function(Re){return Re});return fe||pe.push(oe+"="+X),"#"+pe.join("&")}return"#"+X},Ns.prototype._getCurrentHash=function(){var l,f=this,c=m.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(d){return d.split("=")}).forEach(function(d){d[0]===f._hashName&&(l=d)}),(l&&l[1]||"").split("/")):c.split("/")},Ns.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1},Ns.prototype._updateHashUnthrottled=function(){var l=m.window.location.href.replace(/(#.+)?$/,this.getHashString());try{m.window.history.replaceState(m.window.history.state,null,l)}catch(f){}};var ff={linearity:.3,easing:m.bezier(0,0,.3,1)},ml=m.extend({deceleration:2500,maxSpeed:1400},ff),pf=m.extend({deceleration:20,maxSpeed:1400},ff),ah=m.extend({deceleration:1e3,maxSpeed:360},ff),oh=m.extend({deceleration:1e3,maxSpeed:90},ff),Lc=function(l){this._map=l,this.clear()};function ec(l,f){(!l.duration||l.duration<f.duration)&&(l.duration=f.duration,l.easing=f.easing)}function nl(l,f,c){var d=c.maxSpeed,E=c.linearity,A=c.deceleration,M=m.clamp(l*E/(f/1e3),-d,d),L=Math.abs(M)/(A*E);return{easing:c.easing,duration:1e3*L,amount:M*(L/2)}}Lc.prototype.clear=function(){this._inertiaBuffer=[]},Lc.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:m.browser.now(),settings:l})},Lc.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,f=m.browser.now();l.length>0&&f-l[0].time>160;)l.shift()},Lc.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var f={zoom:0,bearing:0,pitch:0,pan:new m.Point(0,0),pinchAround:void 0,around:void 0},c=0,d=this._inertiaBuffer;c<d.length;c+=1){var E=d[c].settings;f.zoom+=E.zoomDelta||0,f.bearing+=E.bearingDelta||0,f.pitch+=E.pitchDelta||0,E.panDelta&&f.pan._add(E.panDelta),E.around&&(f.around=E.around),E.pinchAround&&(f.pinchAround=E.pinchAround)}var A=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,M={};if(f.pan.mag()){var L=nl(f.pan.mag(),A,m.extend({},ml,l||{}));M.offset=f.pan.mult(L.amount/f.pan.mag()),M.center=this._map.transform.center,ec(M,L)}if(f.zoom){var U=nl(f.zoom,A,pf);M.zoom=this._map.transform.zoom+U.amount,ec(M,U)}if(f.bearing){var X=nl(f.bearing,A,ah);M.bearing=this._map.transform.bearing+m.clamp(X.amount,-179,179),ec(M,X)}if(f.pitch){var oe=nl(f.pitch,A,oh);M.pitch=this._map.transform.pitch+oe.amount,ec(M,oe)}if(M.zoom||M.bearing){var fe=f.pinchAround===void 0?f.around:f.pinchAround;M.around=fe?this._map.unproject(fe):this._map.getCenter()}return this.clear(),m.extend(M,{noMoveStart:!0})}};var Bo=function(l){function f(d,E,A,M){M===void 0&&(M={});var L=j.mousePos(E.getCanvasContainer(),A),U=E.unproject(L);l.call(this,d,m.extend({point:L,lngLat:U,originalEvent:A},M)),this._defaultPrevented=!1,this.target=E}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),tc=function(l){function f(d,E,A){var M=d==="touchend"?A.changedTouches:A.touches,L=j.touchPos(E.getCanvasContainer(),M),U=L.map(function(fe){return E.unproject(fe)}),X=L.reduce(function(fe,pe,Re,Pe){return fe.add(pe.div(Pe.length))},new m.Point(0,0)),oe=E.unproject(X);l.call(this,d,{points:L,point:X,lngLats:U,lngLat:oe,originalEvent:A}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),rc=function(l){function f(d,E,A){l.call(this,d,{originalEvent:A}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),eo=function(l,f){this._map=l,this._clickTolerance=f.clickTolerance};eo.prototype.reset=function(){delete this._mousedownPos},eo.prototype.wheel=function(l){return this._firePreventable(new rc(l.type,this._map,l))},eo.prototype.mousedown=function(l,f){return this._mousedownPos=f,this._firePreventable(new Bo(l.type,this._map,l))},eo.prototype.mouseup=function(l){this._map.fire(new Bo(l.type,this._map,l))},eo.prototype.click=function(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new Bo(l.type,this._map,l))},eo.prototype.dblclick=function(l){return this._firePreventable(new Bo(l.type,this._map,l))},eo.prototype.mouseover=function(l){this._map.fire(new Bo(l.type,this._map,l))},eo.prototype.mouseout=function(l){this._map.fire(new Bo(l.type,this._map,l))},eo.prototype.touchstart=function(l){return this._firePreventable(new tc(l.type,this._map,l))},eo.prototype.touchmove=function(l){this._map.fire(new tc(l.type,this._map,l))},eo.prototype.touchend=function(l){this._map.fire(new tc(l.type,this._map,l))},eo.prototype.touchcancel=function(l){this._map.fire(new tc(l.type,this._map,l))},eo.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},eo.prototype.isEnabled=function(){return!0},eo.prototype.isActive=function(){return!1},eo.prototype.enable=function(){},eo.prototype.disable=function(){};var yn=function(l){this._map=l};yn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},yn.prototype.mousemove=function(l){this._map.fire(new Bo(l.type,this._map,l))},yn.prototype.mousedown=function(){this._delayContextMenu=!0},yn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Bo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},yn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new Bo(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},yn.prototype.isEnabled=function(){return!0},yn.prototype.isActive=function(){return!1},yn.prototype.enable=function(){},yn.prototype.disable=function(){};var co=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1};function il(l,f){for(var c={},d=0;d<l.length;d++)c[l[d].identifier]=f[d];return c}co.prototype.isEnabled=function(){return!!this._enabled},co.prototype.isActive=function(){return!!this._active},co.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},co.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},co.prototype.mousedown=function(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(j.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)},co.prototype.mousemoveWindow=function(l,f){if(this._active){var c=f;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var d=this._startPos;this._lastPos=c,this._box||(this._box=j.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var E=Math.min(d.x,c.x),A=Math.max(d.x,c.x),M=Math.min(d.y,c.y),L=Math.max(d.y,c.y);j.setTransform(this._box,"translate("+E+"px,"+M+"px)"),this._box.style.width=A-E+"px",this._box.style.height=L-M+"px"}}},co.prototype.mouseupWindow=function(l,f){var c=this;if(this._active&&l.button===0){var d=this._startPos,E=f;if(this.reset(),j.suppressClick(),d.x!==E.x||d.y!==E.y)return this._map.fire(new m.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(A){return A.fitScreenCoordinates(d,E,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},co.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},co.prototype.blur=function(){this.reset()},co.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(j.remove(this._box),this._box=null),j.enableDrag(),delete this._startPos,delete this._lastPos},co.prototype._fireEvent=function(l,f){return this._map.fire(new m.Event(l,{originalEvent:f}))};var al=function(l){this.reset(),this.numTouches=l.numTouches};al.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},al.prototype.touchstart=function(l,f,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){for(var E=new m.Point(0,0),A=0,M=d;A<M.length;A+=1)E._add(M[A]);return E.div(d.length)}(f),this.touches=il(c,f)))},al.prototype.touchmove=function(l,f,c){if(!this.aborted&&this.centroid){var d=il(c,f);for(var E in this.touches){var A=d[E];(!A||A.dist(this.touches[E])>30)&&(this.aborted=!0)}}},al.prototype.touchend=function(l,f,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var d=!this.aborted&&this.centroid;if(this.reset(),d)return d}};var xu=function(l){this.singleTap=new al(l),this.numTaps=l.numTaps,this.reset()};xu.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},xu.prototype.touchstart=function(l,f,c){this.singleTap.touchstart(l,f,c)},xu.prototype.touchmove=function(l,f,c){this.singleTap.touchmove(l,f,c)},xu.prototype.touchend=function(l,f,c){var d=this.singleTap.touchend(l,f,c);if(d){var E=l.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(d)<30;if(E&&A||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}};var zs=function(){this._zoomIn=new xu({numTouches:1,numTaps:2}),this._zoomOut=new xu({numTouches:2,numTaps:1}),this.reset()};zs.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},zs.prototype.touchstart=function(l,f,c){this._zoomIn.touchstart(l,f,c),this._zoomOut.touchstart(l,f,c)},zs.prototype.touchmove=function(l,f,c){this._zoomIn.touchmove(l,f,c),this._zoomOut.touchmove(l,f,c)},zs.prototype.touchend=function(l,f,c){var d=this,E=this._zoomIn.touchend(l,f,c),A=this._zoomOut.touchend(l,f,c);return E?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(M){return M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(E)},{originalEvent:l})}}):A?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(M){return M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(A)},{originalEvent:l})}}):void 0},zs.prototype.touchcancel=function(){this.reset()},zs.prototype.enable=function(){this._enabled=!0},zs.prototype.disable=function(){this._enabled=!1,this.reset()},zs.prototype.isEnabled=function(){return this._enabled},zs.prototype.isActive=function(){return this._active};var zf={0:1,2:2},Kr=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};Kr.prototype.blur=function(){this.reset()},Kr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Kr.prototype._correctButton=function(l,f){return!1},Kr.prototype._move=function(l,f){return{}},Kr.prototype.mousedown=function(l,f){if(!this._lastPoint){var c=j.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=f,this._eventButton=c)}},Kr.prototype.mousemoveWindow=function(l,f){var c=this._lastPoint;if(c){if(l.preventDefault(),function(d,E){var A=zf[E];return d.buttons===void 0||(d.buttons&A)!==A}(l,this._eventButton))this.reset();else if(this._moved||!(f.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(c,f)}},Kr.prototype.mouseupWindow=function(l){this._lastPoint&&j.mouseButton(l)===this._eventButton&&(this._moved&&j.suppressClick(),this.reset())},Kr.prototype.enable=function(){this._enabled=!0},Kr.prototype.disable=function(){this._enabled=!1,this.reset()},Kr.prototype.isEnabled=function(){return this._enabled},Kr.prototype.isActive=function(){return this._active};var hf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.mousedown=function(c,d){l.prototype.mousedown.call(this,c,d),this._lastPoint&&(this._active=!0)},f.prototype._correctButton=function(c,d){return d===0&&!c.ctrlKey},f.prototype._move=function(c,d){return{around:d,panDelta:d.sub(c)}},f}(Kr),Uf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var E=.8*(d.x-c.x);if(E)return this._active=!0,{bearingDelta:E}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(Kr),Du=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var E=-.5*(d.y-c.y);if(E)return this._active=!0,{pitchDelta:E}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(Kr),Ha=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};Ha.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new m.Point(0,0)},Ha.prototype.touchstart=function(l,f,c){return this._calculateTransform(l,f,c)},Ha.prototype.touchmove=function(l,f,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,f,c)},Ha.prototype.touchend=function(l,f,c){this._calculateTransform(l,f,c),this._active&&c.length<this._minTouches&&this.reset()},Ha.prototype.touchcancel=function(){this.reset()},Ha.prototype._calculateTransform=function(l,f,c){c.length>0&&(this._active=!0);var d=il(c,f),E=new m.Point(0,0),A=new m.Point(0,0),M=0;for(var L in d){var U=d[L],X=this._touches[L];X&&(E._add(U),A._add(U.sub(X)),M++,d[L]=U)}if(this._touches=d,!(M<this._minTouches)&&A.mag()){var oe=A.div(M);if(this._sum._add(oe),!(this._sum.mag()<this._clickTolerance))return{around:E.div(M),panDelta:oe}}},Ha.prototype.enable=function(){this._enabled=!0},Ha.prototype.disable=function(){this._enabled=!1,this.reset()},Ha.prototype.isEnabled=function(){return this._enabled},Ha.prototype.isActive=function(){return this._active};var Us=function(){this.reset()};function df(l,f,c){for(var d=0;d<l.length;d++)if(l[d].identifier===c)return f[d]}function Fu(l,f){return Math.log(l/f)/Math.LN2}Us.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Us.prototype._start=function(l){},Us.prototype._move=function(l,f,c){return{}},Us.prototype.touchstart=function(l,f,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([f[0],f[1]]))},Us.prototype.touchmove=function(l,f,c){if(this._firstTwoTouches){l.preventDefault();var d=this._firstTwoTouches,E=d[1],A=df(c,f,d[0]),M=df(c,f,E);if(A&&M){var L=this._aroundCenter?null:A.add(M).div(2);return this._move([A,M],L,l)}}},Us.prototype.touchend=function(l,f,c){if(this._firstTwoTouches){var d=this._firstTwoTouches,E=d[1],A=df(c,f,d[0]),M=df(c,f,E);A&&M||(this._active&&j.suppressClick(),this.reset())}},Us.prototype.touchcancel=function(){this.reset()},Us.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},Us.prototype.disable=function(){this._enabled=!1,this.reset()},Us.prototype.isEnabled=function(){return this._enabled},Us.prototype.isActive=function(){return this._active};var Os=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},f.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},f.prototype._move=function(c,d){var E=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Fu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Fu(this._distance,E),pinchAround:d}},f}(Us);function To(l,f){return 180*l.angleWith(f)/Math.PI}var Cp=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},f.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},f.prototype._move=function(c,d){var E=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:To(this._vector,E),pinchAround:d}},f.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var d=25/(Math.PI*this._minDiameter)*360,E=To(c,this._startVector);return Math.abs(E)<d},f}(Us);function Ea(l){return Math.abs(l.y)>Math.abs(l.x)}var Zf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},f.prototype._start=function(c){this._lastPoints=c,Ea(c[0].sub(c[1]))&&(this._valid=!1)},f.prototype._move=function(c,d,E){var A=c[0].sub(this._lastPoints[0]),M=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(A,M,E.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(A.y+M.y)/2*-.5}},f.prototype.gestureBeginsVertically=function(c,d,E){if(this._valid!==void 0)return this._valid;var A=c.mag()>=2,M=d.mag()>=2;if(A||M){if(!A||!M)return this._firstMove===void 0&&(this._firstMove=E),E-this._firstMove<100&&void 0;var L=c.y>0==d.y>0;return Ea(c)&&Ea(d)&&L}},f}(Us),Ap={panStep:100,bearingStep:15,pitchStep:10},tu=function(){var l=Ap;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function Rs(l){return l*(2-l)}tu.prototype.blur=function(){this.reset()},tu.prototype.reset=function(){this._active=!1},tu.prototype.keydown=function(l){var f=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,d=0,E=0,A=0,M=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?d=-1:(l.preventDefault(),A=-1);break;case 39:l.shiftKey?d=1:(l.preventDefault(),A=1);break;case 38:l.shiftKey?E=1:(l.preventDefault(),M=-1);break;case 40:l.shiftKey?E=-1:(l.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(d=0,E=0),{cameraAnimation:function(L){var U=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:Rs,zoom:c?Math.round(U)+c*(l.shiftKey?2:1):U,bearing:L.getBearing()+d*f._bearingStep,pitch:L.getPitch()+E*f._pitchStep,offset:[-A*f._panStep,-M*f._panStep],center:L.getCenter()},{originalEvent:l})}}}},tu.prototype.enable=function(){this._enabled=!0},tu.prototype.disable=function(){this._enabled=!1,this.reset()},tu.prototype.isEnabled=function(){return this._enabled},tu.prototype.isActive=function(){return this._active},tu.prototype.disableRotation=function(){this._rotationDisabled=!0},tu.prototype.enableRotation=function(){this._rotationDisabled=!1};var Li=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,m.bindAll(["_onTimeout"],this)};Li.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Li.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Li.prototype.isEnabled=function(){return!!this._enabled},Li.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Li.prototype.isZooming=function(){return!!this._zooming},Li.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Li.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Li.prototype.wheel=function(l){if(this.isEnabled()){var f=l.deltaMode===m.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=m.browser.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,f!==0&&f%4.000244140625==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(d*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}},Li.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Li.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var f=j.mousePos(this._el,l);this._around=m.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(f)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Li.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var f=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,d=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&d!==0&&(d=1/d);var E=typeof this._targetZoom=="number"?f.zoomScale(this._targetZoom):f.scale;this._targetZoom=Math.min(f.maxZoom,Math.max(f.minZoom,f.scaleZoom(E*d))),this._type==="wheel"&&(this._startZoom=f.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var A,M=typeof this._targetZoom=="number"?this._targetZoom:f.zoom,L=this._startZoom,U=this._easing,X=!1;if(this._type==="wheel"&&L&&U){var oe=Math.min((m.browser.now()-this._lastWheelEventTime)/200,1),fe=U(oe);A=m.number(L,M,fe),oe<1?this._frameId||(this._frameId=!0):X=!0}else A=M,X=!0;return this._active=!0,X&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!X,zoomDelta:A-f.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Li.prototype._smoothOutEasing=function(l){var f=m.ease;if(this._prevEase){var c=this._prevEase,d=(m.browser.now()-c.start)/c.duration,E=c.easing(d+.01)-c.easing(d),A=.27/Math.sqrt(E*E+1e-4)*.01,M=Math.sqrt(.0729-A*A);f=m.bezier(A,M,.25,1)}return this._prevEase={start:m.browser.now(),duration:l,easing:f},f},Li.prototype.blur=function(){this.reset()},Li.prototype.reset=function(){this._active=!1};var bu=function(l,f){this._clickZoom=l,this._tapZoom=f};bu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},bu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},bu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},bu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var va=function(){this.reset()};va.prototype.reset=function(){this._active=!1},va.prototype.blur=function(){this.reset()},va.prototype.dblclick=function(l,f){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(f)},{originalEvent:l})}}},va.prototype.enable=function(){this._enabled=!0},va.prototype.disable=function(){this._enabled=!1,this.reset()},va.prototype.isEnabled=function(){return this._enabled},va.prototype.isActive=function(){return this._active};var mo=function(){this._tap=new xu({numTouches:1,numTaps:1}),this.reset()};mo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},mo.prototype.touchstart=function(l,f,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=f[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,f,c))},mo.prototype.touchmove=function(l,f,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var d=f[0],E=d.y-this._swipePoint.y;return this._swipePoint=d,l.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(l,f,c)},mo.prototype.touchend=function(l,f,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,f,c)&&(this._tapTime=l.timeStamp)},mo.prototype.touchcancel=function(){this.reset()},mo.prototype.enable=function(){this._enabled=!0},mo.prototype.disable=function(){this._enabled=!1,this.reset()},mo.prototype.isEnabled=function(){return this._enabled},mo.prototype.isActive=function(){return this._active};var Zs=function(l,f,c){this._el=l,this._mousePan=f,this._touchPan=c};Zs.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Zs.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Zs.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Zs.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var pu=function(l,f,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=c};pu.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},pu.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},pu.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},pu.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var js=function(l,f,c,d){this._el=l,this._touchZoom=f,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0};js.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},js.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},js.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},js.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},js.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},js.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var _s=function(l){return l.zoom||l.drag||l.pitch||l.rotate},Vs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f}(m.Event);function Ln(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var wn=function(l,f){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Lc(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f),m.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[m.window.document,"mousemove",{capture:!0}],[m.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[m.window,"blur",void 0]];for(var d=0,E=this._listeners;d<E.length;d+=1){var A=E[d],M=A[0];j.addEventListener(M,A[1],M===m.window.document?this.handleWindowEvent:this.handleEvent,A[2])}};wn.prototype.destroy=function(){for(var l=0,f=this._listeners;l<f.length;l+=1){var c=f[l],d=c[0];j.removeEventListener(d,c[1],d===m.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},wn.prototype._addDefaultHandlers=function(l){var f=this._map,c=f.getCanvasContainer();this._add("mapEvent",new eo(f,l));var d=f.boxZoom=new co(f,l);this._add("boxZoom",d);var E=new zs,A=new va;f.doubleClickZoom=new bu(A,E),this._add("tapZoom",E),this._add("clickZoom",A);var M=new mo;this._add("tapDragZoom",M);var L=f.touchPitch=new Zf;this._add("touchPitch",L);var U=new Uf(l),X=new Du(l);f.dragRotate=new pu(l,U,X),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",X,["mouseRotate"]);var oe=new hf(l),fe=new Ha(l);f.dragPan=new Zs(c,oe,fe),this._add("mousePan",oe),this._add("touchPan",fe,["touchZoom","touchRotate"]);var pe=new Cp,Re=new Os;f.touchZoomRotate=new js(c,Re,pe,M),this._add("touchRotate",pe,["touchPan","touchZoom"]),this._add("touchZoom",Re,["touchPan","touchRotate"]);var Pe=f.scrollZoom=new Li(f,this);this._add("scrollZoom",Pe,["mousePan"]);var He=f.keyboard=new tu;this._add("keyboard",He),this._add("blockableMapEvent",new yn(f));for(var be=0,je=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];be<je.length;be+=1){var et=je[be];l.interactive&&l[et]&&f[et].enable(l[et])}},wn.prototype._add=function(l,f,c){this._handlers.push({handlerName:l,handler:f,allowed:c}),this._handlersById[l]=f},wn.prototype.stop=function(l){if(!this._updatingCamera){for(var f=0,c=this._handlers;f<c.length;f+=1)c[f].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},wn.prototype.isActive=function(){for(var l=0,f=this._handlers;l<f.length;l+=1)if(f[l].handler.isActive())return!0;return!1},wn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},wn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},wn.prototype.isMoving=function(){return Boolean(_s(this._eventsInProgress))||this.isZooming()},wn.prototype._blockedByActive=function(l,f,c){for(var d in l)if(d!==c&&(!f||f.indexOf(d)<0))return!0;return!1},wn.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},wn.prototype._getMapTouches=function(l){for(var f=[],c=0,d=l;c<d.length;c+=1){var E=d[c];this._el.contains(E.target)&&f.push(E)}return f},wn.prototype.handleEvent=function(l,f){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,d={needsRenderFrame:!1},E={},A={},M=l.touches?this._getMapTouches(l.touches):void 0,L=M?j.touchPos(this._el,M):j.mousePos(this._el,l),U=0,X=this._handlers;U<X.length;U+=1){var oe=X[U],fe=oe.handlerName,pe=oe.handler,Re=oe.allowed;if(pe.isEnabled()){var Pe=void 0;this._blockedByActive(A,Re,fe)?pe.reset():pe[f||l.type]&&(Pe=pe[f||l.type](l,L,M),this.mergeHandlerResult(d,E,Pe,fe,c),Pe&&Pe.needsRenderFrame&&this._triggerRenderFrame()),(Pe||pe.isActive())&&(A[fe]=pe)}}var He={};for(var be in this._previousActiveHandlers)A[be]||(He[be]=c);this._previousActiveHandlers=A,(Object.keys(He).length||Ln(d))&&(this._changes.push([d,E,He]),this._triggerRenderFrame()),(Object.keys(A).length||Ln(d))&&this._map._stop(!0),this._updatingCamera=!1;var je=d.cameraAnimation;je&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],je(this._map))},wn.prototype.mergeHandlerResult=function(l,f,c,d,E){if(c){m.extend(l,c);var A={handlerName:d,originalEvent:c.originalEvent||E};c.zoomDelta!==void 0&&(f.zoom=A),c.panDelta!==void 0&&(f.drag=A),c.pitchDelta!==void 0&&(f.pitch=A),c.bearingDelta!==void 0&&(f.rotate=A)}},wn.prototype._applyChanges=function(){for(var l={},f={},c={},d=0,E=this._changes;d<E.length;d+=1){var A=E[d],M=A[0],L=A[1],U=A[2];M.panDelta&&(l.panDelta=(l.panDelta||new m.Point(0,0))._add(M.panDelta)),M.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+M.zoomDelta),M.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+M.bearingDelta),M.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+M.pitchDelta),M.around!==void 0&&(l.around=M.around),M.pinchAround!==void 0&&(l.pinchAround=M.pinchAround),M.noInertia&&(l.noInertia=M.noInertia),m.extend(f,L),m.extend(c,U)}this._updateMapTransform(l,f,c),this._changes=[]},wn.prototype._updateMapTransform=function(l,f,c){var d=this._map,E=d.transform;if(!Ln(l))return this._fireEvents(f,c,!0);var A=l.panDelta,M=l.zoomDelta,L=l.bearingDelta,U=l.pitchDelta,X=l.around,oe=l.pinchAround;oe!==void 0&&(X=oe),d._stop(!0),X=X||d.transform.centerPoint;var fe=E.pointLocation(A?X.sub(A):X);L&&(E.bearing+=L),U&&(E.pitch+=U),M&&(E.zoom+=M),E.setLocationAtPoint(fe,X),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,c,!0)},wn.prototype._fireEvents=function(l,f,c){var d=this,E=_s(this._eventsInProgress),A=_s(l),M={};for(var L in l)this._eventsInProgress[L]||(M[L+"start"]=l[L].originalEvent),this._eventsInProgress[L]=l[L];for(var U in!E&&A&&this._fireEvent("movestart",A.originalEvent),M)this._fireEvent(U,M[U]);for(var X in A&&this._fireEvent("move",A.originalEvent),l)this._fireEvent(X,l[X].originalEvent);var oe,fe={};for(var pe in this._eventsInProgress){var Re=this._eventsInProgress[pe],Pe=Re.handlerName,He=Re.originalEvent;this._handlersById[Pe].isActive()||(delete this._eventsInProgress[pe],fe[pe+"end"]=oe=f[Pe]||He)}for(var be in fe)this._fireEvent(be,fe[be]);var je=_s(this._eventsInProgress);if(c&&(E||A)&&!je){this._updatingCamera=!0;var et=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),yt=function(Ht){return Ht!==0&&-d._bearingSnap<Ht&&Ht<d._bearingSnap};et?(yt(et.bearing||this._map.getBearing())&&(et.bearing=0),this._map.easeTo(et,{originalEvent:oe})):(this._map.fire(new m.Event("moveend",{originalEvent:oe})),yt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},wn.prototype._fireEvent=function(l,f){this._map.fire(new m.Event(l,f?{originalEvent:f}:{}))},wn.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(f){delete l._frameId,l.handleEvent(new Vs("renderFrame",{timeStamp:f})),l._applyChanges()})},wn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var nc=function(l){function f(c,d){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,m.bindAll(["_renderFrameCallback"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getCenter=function(){return new m.LngLat(this.transform.center.lng,this.transform.center.lat)},f.prototype.setCenter=function(c,d){return this.jumpTo({center:c},d)},f.prototype.panBy=function(c,d,E){return c=m.Point.convert(c).mult(-1),this.panTo(this.transform.center,m.extend({offset:c},d),E)},f.prototype.panTo=function(c,d,E){return this.easeTo(m.extend({center:c},d),E)},f.prototype.getZoom=function(){return this.transform.zoom},f.prototype.setZoom=function(c,d){return this.jumpTo({zoom:c},d),this},f.prototype.zoomTo=function(c,d,E){return this.easeTo(m.extend({zoom:c},d),E)},f.prototype.zoomIn=function(c,d){return this.zoomTo(this.getZoom()+1,c,d),this},f.prototype.zoomOut=function(c,d){return this.zoomTo(this.getZoom()-1,c,d),this},f.prototype.getBearing=function(){return this.transform.bearing},f.prototype.setBearing=function(c,d){return this.jumpTo({bearing:c},d),this},f.prototype.getPadding=function(){return this.transform.padding},f.prototype.setPadding=function(c,d){return this.jumpTo({padding:c},d),this},f.prototype.rotateTo=function(c,d,E){return this.easeTo(m.extend({bearing:c},d),E)},f.prototype.resetNorth=function(c,d){return this.rotateTo(0,m.extend({duration:1e3},c),d),this},f.prototype.resetNorthPitch=function(c,d){return this.easeTo(m.extend({bearing:0,pitch:0,duration:1e3},c),d),this},f.prototype.snapToNorth=function(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this},f.prototype.getPitch=function(){return this.transform.pitch},f.prototype.setPitch=function(c,d){return this.jumpTo({pitch:c},d),this},f.prototype.cameraForBounds=function(c,d){c=m.LngLatBounds.convert(c);var E=d&&d.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),E,d)},f.prototype._cameraForBoxAndBearing=function(c,d,E,A){var M={top:0,bottom:0,right:0,left:0};if(typeof(A=m.extend({padding:M,offset:[0,0],maxZoom:this.transform.maxZoom},A)).padding=="number"){var L=A.padding;A.padding={top:L,bottom:L,right:L,left:L}}A.padding=m.extend(M,A.padding);var U=this.transform,X=U.padding,oe=U.project(m.LngLat.convert(c)),fe=U.project(m.LngLat.convert(d)),pe=oe.rotate(-E*Math.PI/180),Re=fe.rotate(-E*Math.PI/180),Pe=new m.Point(Math.max(pe.x,Re.x),Math.max(pe.y,Re.y)),He=new m.Point(Math.min(pe.x,Re.x),Math.min(pe.y,Re.y)),be=Pe.sub(He),je=(U.width-(X.left+X.right+A.padding.left+A.padding.right))/be.x,et=(U.height-(X.top+X.bottom+A.padding.top+A.padding.bottom))/be.y;if(!(et<0||je<0)){var yt=Math.min(U.scaleZoom(U.scale*Math.min(je,et)),A.maxZoom),Ht=typeof A.offset.x=="number"?new m.Point(A.offset.x,A.offset.y):m.Point.convert(A.offset),Nt=new m.Point((A.padding.left-A.padding.right)/2,(A.padding.top-A.padding.bottom)/2).rotate(E*Math.PI/180),Qt=Ht.add(Nt).mult(U.scale/U.zoomScale(yt));return{center:U.unproject(oe.add(fe).div(2).sub(Qt)),zoom:yt,bearing:E}}m.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},f.prototype.fitBounds=function(c,d,E){return this._fitInternal(this.cameraForBounds(c,d),d,E)},f.prototype.fitScreenCoordinates=function(c,d,E,A,M){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(m.Point.convert(c)),this.transform.pointLocation(m.Point.convert(d)),E,A),A,M)},f.prototype._fitInternal=function(c,d,E){return c?(delete(d=m.extend(c,d)).padding,d.linear?this.easeTo(d,E):this.flyTo(d,E)):this},f.prototype.jumpTo=function(c,d){this.stop();var E=this.transform,A=!1,M=!1,L=!1;return"zoom"in c&&E.zoom!==+c.zoom&&(A=!0,E.zoom=+c.zoom),c.center!==void 0&&(E.center=m.LngLat.convert(c.center)),"bearing"in c&&E.bearing!==+c.bearing&&(M=!0,E.bearing=+c.bearing),"pitch"in c&&E.pitch!==+c.pitch&&(L=!0,E.pitch=+c.pitch),c.padding==null||E.isPaddingEqual(c.padding)||(E.padding=c.padding),this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),A&&this.fire(new m.Event("zoomstart",d)).fire(new m.Event("zoom",d)).fire(new m.Event("zoomend",d)),M&&this.fire(new m.Event("rotatestart",d)).fire(new m.Event("rotate",d)).fire(new m.Event("rotateend",d)),L&&this.fire(new m.Event("pitchstart",d)).fire(new m.Event("pitch",d)).fire(new m.Event("pitchend",d)),this.fire(new m.Event("moveend",d))},f.prototype.easeTo=function(c,d){var E=this;this._stop(!1,c.easeId),((c=m.extend({offset:[0,0],duration:500,easing:m.ease},c)).animate===!1||!c.essential&&m.browser.prefersReducedMotion)&&(c.duration=0);var A=this.transform,M=this.getZoom(),L=this.getBearing(),U=this.getPitch(),X=this.getPadding(),oe="zoom"in c?+c.zoom:M,fe="bearing"in c?this._normalizeBearing(c.bearing,L):L,pe="pitch"in c?+c.pitch:U,Re="padding"in c?c.padding:A.padding,Pe=m.Point.convert(c.offset),He=A.centerPoint.add(Pe),be=A.pointLocation(He),je=m.LngLat.convert(c.center||be);this._normalizeCenter(je);var et,yt,Ht=A.project(be),Nt=A.project(je).sub(Ht),Qt=A.zoomScale(oe-M);c.around&&(et=m.LngLat.convert(c.around),yt=A.locationPoint(et));var rr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||oe!==M,this._rotating=this._rotating||L!==fe,this._pitching=this._pitching||pe!==U,this._padding=!A.isPaddingEqual(Re),this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,rr),this._ease(function(Ir){if(E._zooming&&(A.zoom=m.number(M,oe,Ir)),E._rotating&&(A.bearing=m.number(L,fe,Ir)),E._pitching&&(A.pitch=m.number(U,pe,Ir)),E._padding&&(A.interpolatePadding(X,Re,Ir),He=A.centerPoint.add(Pe)),et)A.setLocationAtPoint(et,yt);else{var Or=A.zoomScale(A.zoom-M),ln=oe>M?Math.min(2,Qt):Math.max(.5,Qt),Bn=Math.pow(ln,1-Ir),Dn=A.unproject(Ht.add(Nt.mult(Ir*Bn)).mult(Or));A.setLocationAtPoint(A.renderWorldCopies?Dn.wrap():Dn,He)}E._fireMoveEvents(d)},function(Ir){E._afterEase(d,Ir)},c),this},f.prototype._prepareEase=function(c,d,E){E===void 0&&(E={}),this._moving=!0,d||E.moving||this.fire(new m.Event("movestart",c)),this._zooming&&!E.zooming&&this.fire(new m.Event("zoomstart",c)),this._rotating&&!E.rotating&&this.fire(new m.Event("rotatestart",c)),this._pitching&&!E.pitching&&this.fire(new m.Event("pitchstart",c))},f.prototype._fireMoveEvents=function(c){this.fire(new m.Event("move",c)),this._zooming&&this.fire(new m.Event("zoom",c)),this._rotating&&this.fire(new m.Event("rotate",c)),this._pitching&&this.fire(new m.Event("pitch",c))},f.prototype._afterEase=function(c,d){if(!this._easeId||!d||this._easeId!==d){delete this._easeId;var E=this._zooming,A=this._rotating,M=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,E&&this.fire(new m.Event("zoomend",c)),A&&this.fire(new m.Event("rotateend",c)),M&&this.fire(new m.Event("pitchend",c)),this.fire(new m.Event("moveend",c))}},f.prototype.flyTo=function(c,d){var E=this;if(!c.essential&&m.browser.prefersReducedMotion){var A=m.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(A,d)}this.stop(),c=m.extend({offset:[0,0],speed:1.2,curve:1.42,easing:m.ease},c);var M=this.transform,L=this.getZoom(),U=this.getBearing(),X=this.getPitch(),oe=this.getPadding(),fe="zoom"in c?m.clamp(+c.zoom,M.minZoom,M.maxZoom):L,pe="bearing"in c?this._normalizeBearing(c.bearing,U):U,Re="pitch"in c?+c.pitch:X,Pe="padding"in c?c.padding:M.padding,He=M.zoomScale(fe-L),be=m.Point.convert(c.offset),je=M.centerPoint.add(be),et=M.pointLocation(je),yt=m.LngLat.convert(c.center||et);this._normalizeCenter(yt);var Ht=M.project(et),Nt=M.project(yt).sub(Ht),Qt=c.curve,rr=Math.max(M.width,M.height),Ir=rr/He,Or=Nt.mag();if("minZoom"in c){var ln=m.clamp(Math.min(c.minZoom,L,fe),M.minZoom,M.maxZoom),Bn=rr/M.zoomScale(ln-L);Qt=Math.sqrt(Bn/Or*2)}var Dn=Qt*Qt;function Un(Kn){var Gn=(Ir*Ir-rr*rr+(Kn?-1:1)*Dn*Dn*Or*Or)/(2*(Kn?Ir:rr)*Dn*Or);return Math.log(Math.sqrt(Gn*Gn+1)-Gn)}function Ni(Kn){return(Math.exp(Kn)-Math.exp(-Kn))/2}function on(Kn){return(Math.exp(Kn)+Math.exp(-Kn))/2}var ni=Un(0),pi=function(Kn){return on(ni)/on(ni+Qt*Kn)},ei=function(Kn){return rr*((on(ni)*(Ni(Gn=ni+Qt*Kn)/on(Gn))-Ni(ni))/Dn)/Or;var Gn},Vn=(Un(1)-ni)/Qt;if(Math.abs(Or)<1e-6||!isFinite(Vn)){if(Math.abs(rr-Ir)<1e-6)return this.easeTo(c,d);var gi=Ir<rr?-1:1;Vn=Math.abs(Math.log(Ir/rr))/Qt,ei=function(){return 0},pi=function(Kn){return Math.exp(gi*Qt*Kn)}}return c.duration="duration"in c?+c.duration:1e3*Vn/("screenSpeed"in c?+c.screenSpeed/Qt:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=U!==pe,this._pitching=Re!==X,this._padding=!M.isPaddingEqual(Pe),this._prepareEase(d,!1),this._ease(function(Kn){var Gn=Kn*Vn,Mo=1/pi(Gn);M.zoom=Kn===1?fe:L+M.scaleZoom(Mo),E._rotating&&(M.bearing=m.number(U,pe,Kn)),E._pitching&&(M.pitch=m.number(X,Re,Kn)),E._padding&&(M.interpolatePadding(oe,Pe,Kn),je=M.centerPoint.add(be));var ua=Kn===1?yt:M.unproject(Ht.add(Nt.mult(ei(Gn))).mult(Mo));M.setLocationAtPoint(M.renderWorldCopies?ua.wrap():ua,je),E._fireMoveEvents(d)},function(){return E._afterEase(d)},c),this},f.prototype.isEasing=function(){return!!this._easeFrameId},f.prototype.stop=function(){return this._stop()},f.prototype._stop=function(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var E=this._onEaseEnd;delete this._onEaseEnd,E.call(this,d)}if(!c){var A=this.handlers;A&&A.stop(!1)}return this},f.prototype._ease=function(c,d,E){E.animate===!1||E.duration===0?(c(1),d()):(this._easeStart=m.browser.now(),this._easeOptions=E,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},f.prototype._renderFrameCallback=function(){var c=Math.min((m.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},f.prototype._normalizeBearing=function(c,d){c=m.wrap(c,-180,180);var E=Math.abs(c-d);return Math.abs(c-360-d)<E&&(c-=360),Math.abs(c+360-d)<E&&(c+=360),c},f.prototype._normalizeCenter=function(c){var d=this.transform;if(d.renderWorldCopies&&!d.lngRange){var E=c.lng-d.center.lng;c.lng+=E>180?-360:E<-180?360:0}},f}(m.Evented),xs=function(l){l===void 0&&(l={}),this.options=l,m.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};xs.prototype.getDefaultPosition=function(){return"bottom-right"},xs.prototype.onAdd=function(l){var f=this.options&&this.options.compact;return this._map=l,this._container=j.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=j.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=j.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},xs.prototype.onRemove=function(){j.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},xs.prototype._setElementTitle=function(l,f){var c=this._map._getUIString("AttributionControl."+f);l.title=c,l.setAttribute("aria-label",c)},xs.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},xs.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||m.config.ACCESS_TOKEN}];if(l){var c=f.reduce(function(d,E,A){return E.value&&(d+=E.key+"="+E.value+(A<f.length-1?"&":"")),d},"?");l.href=m.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},xs.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},xs.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(L){return typeof L!="string"?"":L})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}var c=this._map.style.sourceCaches;for(var d in c){var E=c[d];if(E.used){var A=E.getSource();A.attribution&&l.indexOf(A.attribution)<0&&l.push(A.attribution)}}l.sort(function(L,U){return L.length-U.length});var M=(l=l.filter(function(L,U){for(var X=U+1;X<l.length;X++)if(l[X].indexOf(L)>=0)return!1;return!0})).join(" | ");M!==this._attribHTML&&(this._attribHTML=M,l.length?(this._innerContainer.innerHTML=M,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},xs.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Eu=function(){m.bindAll(["_updateLogo"],this),m.bindAll(["_updateCompact"],this)};Eu.prototype.onAdd=function(l){this._map=l,this._container=j.create("div","mapboxgl-ctrl");var f=j.create("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Eu.prototype.onRemove=function(){j.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Eu.prototype.getDefaultPosition=function(){return"bottom-left"},Eu.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Eu.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var f in l)if(l[f].getSource().mapbox_logo)return!0;return!1}},Eu.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var f=l[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}};var es=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};es.prototype.add=function(l){var f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f},es.prototype.remove=function(l){for(var f=this._currentlyRunning,c=0,d=f?this._queue.concat(f):this._queue;c<d.length;c+=1){var E=d[c];if(E.id===l)return void(E.cancelled=!0)}},es.prototype.run=function(l){l===void 0&&(l=0);var f=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,d=f;c<d.length;c+=1){var E=d[c];if(!E.cancelled&&(E.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},es.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var wa={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},kc=m.window.HTMLImageElement,Dc=m.window.HTMLElement,ma=m.window.ImageBitmap,Oa={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Fc=function(l){function f(d){var E=this;if((d=m.extend({},Oa,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var A=new Bi(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies);if(l.call(this,A,d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new es,this._controls=[],this._mapId=m.uniqueId(),this._locale=m.extend({},wa,d.locale),this._clickTolerance=d.clickTolerance,this._requestManager=new m.RequestManager(d.transformRequest,d.accessToken),typeof d.container=="string"){if(this._container=m.window.document.getElementById(d.container),!this._container)throw new Error("Container '"+d.container+"' not found.")}else{if(!(d.container instanceof Dc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),m.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return E._update(!1)}),this.on("moveend",function(){return E._update(!1)}),this.on("zoom",function(){return E._update(!0)}),m.window!==void 0&&(m.window.addEventListener("online",this._onWindowOnline,!1),m.window.addEventListener("resize",this._onWindowResize,!1),m.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new wn(this,d),this._hash=d.hash&&new Ns(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,m.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new xs({customAttribution:d.customAttribution})),this.addControl(new Eu,d.logoPosition),this.on("style.load",function(){E.transform.unmodified&&E.jumpTo(E.style.stylesheet)}),this.on("data",function(M){E._update(M.dataType==="style"),E.fire(new m.Event(M.dataType+"data",M))}),this.on("dataloading",function(M){E.fire(new m.Event(M.dataType+"dataloading",M))})}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return f.prototype._getMapId=function(){return this._mapId},f.prototype.addControl=function(d,E){if(E===void 0&&(E=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var A=d.onAdd(this);this._controls.push(d);var M=this._controlPositions[E];return E.indexOf("bottom")!==-1?M.insertBefore(A,M.firstChild):M.appendChild(A),this},f.prototype.removeControl=function(d){if(!d||!d.onRemove)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var E=this._controls.indexOf(d);return E>-1&&this._controls.splice(E,1),d.onRemove(this),this},f.prototype.hasControl=function(d){return this._controls.indexOf(d)>-1},f.prototype.resize=function(d){var E=this._containerDimensions(),A=E[0],M=E[1];if(A===this.transform.width&&M===this.transform.height)return this;this._resizeCanvas(A,M),this.transform.resize(A,M),this.painter.resize(A,M);var L=!this._moving;return L&&this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),this.fire(new m.Event("resize",d)),L&&this.fire(new m.Event("moveend",d)),this},f.prototype.getBounds=function(){return this.transform.getBounds()},f.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},f.prototype.setMaxBounds=function(d){return this.transform.setMaxBounds(m.LngLatBounds.convert(d)),this._update()},f.prototype.setMinZoom=function(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},f.prototype.getMinZoom=function(){return this.transform.minZoom},f.prototype.setMaxZoom=function(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")},f.prototype.getMaxZoom=function(){return this.transform.maxZoom},f.prototype.setMinPitch=function(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},f.prototype.getMinPitch=function(){return this.transform.minPitch},f.prototype.setMaxPitch=function(d){if((d=d==null?60:d)>60)throw new Error("maxPitch must be less than or equal to 60");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")},f.prototype.getMaxPitch=function(){return this.transform.maxPitch},f.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},f.prototype.setRenderWorldCopies=function(d){return this.transform.renderWorldCopies=d,this._update()},f.prototype.project=function(d){return this.transform.locationPoint(m.LngLat.convert(d))},f.prototype.unproject=function(d){return this.transform.pointLocation(m.Point.convert(d))},f.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},f.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},f.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},f.prototype._createDelegatedListener=function(d,E,A){var M,L=this;if(d==="mouseenter"||d==="mouseover"){var U=!1;return{layer:E,listener:A,delegates:{mousemove:function(oe){var fe=L.getLayer(E)?L.queryRenderedFeatures(oe.point,{layers:[E]}):[];fe.length?U||(U=!0,A.call(L,new Bo(d,L,oe.originalEvent,{features:fe}))):U=!1},mouseout:function(){U=!1}}}}if(d==="mouseleave"||d==="mouseout"){var X=!1;return{layer:E,listener:A,delegates:{mousemove:function(oe){(L.getLayer(E)?L.queryRenderedFeatures(oe.point,{layers:[E]}):[]).length?X=!0:X&&(X=!1,A.call(L,new Bo(d,L,oe.originalEvent)))},mouseout:function(oe){X&&(X=!1,A.call(L,new Bo(d,L,oe.originalEvent)))}}}}return{layer:E,listener:A,delegates:(M={},M[d]=function(oe){var fe=L.getLayer(E)?L.queryRenderedFeatures(oe.point,{layers:[E]}):[];fe.length&&(oe.features=fe,A.call(L,oe),delete oe.features)},M)}},f.prototype.on=function(d,E,A){if(A===void 0)return l.prototype.on.call(this,d,E);var M=this._createDelegatedListener(d,E,A);for(var L in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(M),M.delegates)this.on(L,M.delegates[L]);return this},f.prototype.once=function(d,E,A){if(A===void 0)return l.prototype.once.call(this,d,E);var M=this._createDelegatedListener(d,E,A);for(var L in M.delegates)this.once(L,M.delegates[L]);return this},f.prototype.off=function(d,E,A){var M=this;return A===void 0?l.prototype.off.call(this,d,E):(this._delegatedListeners&&this._delegatedListeners[d]&&function(L){for(var U=L[d],X=0;X<U.length;X++){var oe=U[X];if(oe.layer===E&&oe.listener===A){for(var fe in oe.delegates)M.off(fe,oe.delegates[fe]);return U.splice(X,1),M}}}(this._delegatedListeners),this)},f.prototype.queryRenderedFeatures=function(d,E){if(!this.style)return[];var A;if(E!==void 0||d===void 0||d instanceof m.Point||Array.isArray(d)||(E=d,d=void 0),E=E||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof m.Point||typeof d[0]=="number")A=[m.Point.convert(d)];else{var M=m.Point.convert(d[0]),L=m.Point.convert(d[1]);A=[M,new m.Point(L.x,M.y),L,new m.Point(M.x,L.y),M]}return this.style.queryRenderedFeatures(A,E,this.transform)},f.prototype.querySourceFeatures=function(d,E){return this.style.querySourceFeatures(d,E)},f.prototype.setStyle=function(d,E){return(E=m.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},E)).diff!==!1&&E.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,E),this):(this._localIdeographFontFamily=E.localIdeographFontFamily,this._updateStyle(d,E))},f.prototype._getUIString=function(d){var E=this._locale[d];if(E==null)throw new Error("Missing UI string '"+d+"'");return E},f.prototype._updateStyle=function(d,E){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new ys(this,E||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)},f.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new ys(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},f.prototype._diffStyle=function(d,E){var A=this;if(typeof d=="string"){var M=this._requestManager.normalizeStyleURL(d),L=this._requestManager.transformRequest(M,m.ResourceType.Style);m.getJSON(L,function(U,X){U?A.fire(new m.ErrorEvent(U)):X&&A._updateDiff(X,E)})}else typeof d=="object"&&this._updateDiff(d,E)},f.prototype._updateDiff=function(d,E){try{this.style.setState(d)&&this._update(!0)}catch(A){m.warnOnce("Unable to perform style diff: "+(A.message||A.error||A)+".  Rebuilding the style from scratch."),this._updateStyle(d,E)}},f.prototype.getStyle=function(){if(this.style)return this.style.serialize()},f.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():m.warnOnce("There is no style added to the map.")},f.prototype.addSource=function(d,E){return this._lazyInitEmptyStyle(),this.style.addSource(d,E),this._update(!0)},f.prototype.isSourceLoaded=function(d){var E=this.style&&this.style.sourceCaches[d];if(E!==void 0)return E.loaded();this.fire(new m.ErrorEvent(new Error("There is no source with ID '"+d+"'")))},f.prototype.areTilesLoaded=function(){var d=this.style&&this.style.sourceCaches;for(var E in d){var A=d[E]._tiles;for(var M in A){var L=A[M];if(L.state!=="loaded"&&L.state!=="errored")return!1}}return!0},f.prototype.addSourceType=function(d,E,A){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,E,A)},f.prototype.removeSource=function(d){return this.style.removeSource(d),this._update(!0)},f.prototype.getSource=function(d){return this.style.getSource(d)},f.prototype.addImage=function(d,E,A){A===void 0&&(A={});var M=A.pixelRatio;M===void 0&&(M=1);var L=A.sdf;L===void 0&&(L=!1);var U=A.stretchX,X=A.stretchY,oe=A.content;if(this._lazyInitEmptyStyle(),E instanceof kc||ma&&E instanceof ma){var fe=m.browser.getImageData(E);this.style.addImage(d,{data:new m.RGBAImage({width:fe.width,height:fe.height},fe.data),pixelRatio:M,stretchX:U,stretchY:X,content:oe,sdf:L,version:0})}else{if(E.width===void 0||E.height===void 0)return this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var pe=E;this.style.addImage(d,{data:new m.RGBAImage({width:E.width,height:E.height},new Uint8Array(E.data)),pixelRatio:M,stretchX:U,stretchY:X,content:oe,sdf:L,version:0,userImage:pe}),pe.onAdd&&pe.onAdd(this,d)}},f.prototype.updateImage=function(d,E){var A=this.style.getImage(d);if(!A)return this.fire(new m.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var M=E instanceof kc||ma&&E instanceof ma?m.browser.getImageData(E):E,L=M.width,U=M.height,X=M.data;return L===void 0||U===void 0?this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):L!==A.data.width||U!==A.data.height?this.fire(new m.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(A.data.replace(X,!(E instanceof kc||ma&&E instanceof ma)),void this.style.updateImage(d,A))},f.prototype.hasImage=function(d){return d?!!this.style.getImage(d):(this.fire(new m.ErrorEvent(new Error("Missing required image id"))),!1)},f.prototype.removeImage=function(d){this.style.removeImage(d)},f.prototype.loadImage=function(d,E){m.getImage(this._requestManager.transformRequest(d,m.ResourceType.Image),E)},f.prototype.listImages=function(){return this.style.listImages()},f.prototype.addLayer=function(d,E){return this._lazyInitEmptyStyle(),this.style.addLayer(d,E),this._update(!0)},f.prototype.moveLayer=function(d,E){return this.style.moveLayer(d,E),this._update(!0)},f.prototype.removeLayer=function(d){return this.style.removeLayer(d),this._update(!0)},f.prototype.getLayer=function(d){return this.style.getLayer(d)},f.prototype.setLayerZoomRange=function(d,E,A){return this.style.setLayerZoomRange(d,E,A),this._update(!0)},f.prototype.setFilter=function(d,E,A){return A===void 0&&(A={}),this.style.setFilter(d,E,A),this._update(!0)},f.prototype.getFilter=function(d){return this.style.getFilter(d)},f.prototype.setPaintProperty=function(d,E,A,M){return M===void 0&&(M={}),this.style.setPaintProperty(d,E,A,M),this._update(!0)},f.prototype.getPaintProperty=function(d,E){return this.style.getPaintProperty(d,E)},f.prototype.setLayoutProperty=function(d,E,A,M){return M===void 0&&(M={}),this.style.setLayoutProperty(d,E,A,M),this._update(!0)},f.prototype.getLayoutProperty=function(d,E){return this.style.getLayoutProperty(d,E)},f.prototype.setLight=function(d,E){return E===void 0&&(E={}),this._lazyInitEmptyStyle(),this.style.setLight(d,E),this._update(!0)},f.prototype.getLight=function(){return this.style.getLight()},f.prototype.setFeatureState=function(d,E){return this.style.setFeatureState(d,E),this._update()},f.prototype.removeFeatureState=function(d,E){return this.style.removeFeatureState(d,E),this._update()},f.prototype.getFeatureState=function(d){return this.style.getFeatureState(d)},f.prototype.getContainer=function(){return this._container},f.prototype.getCanvasContainer=function(){return this._canvasContainer},f.prototype.getCanvas=function(){return this._canvas},f.prototype._containerDimensions=function(){var d=0,E=0;return this._container&&(d=this._container.clientWidth||400,E=this._container.clientHeight||300),[d,E]},f.prototype._detectMissingCSS=function(){m.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&m.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},f.prototype._setupContainer=function(){var d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=j.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();var E=this._canvasContainer=j.create("div","mapboxgl-canvas-container",d);this._interactive&&E.classList.add("mapboxgl-interactive"),this._canvas=j.create("canvas","mapboxgl-canvas",E),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var A=this._containerDimensions();this._resizeCanvas(A[0],A[1]);var M=this._controlContainer=j.create("div","mapboxgl-control-container",d),L=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(U){L[U]=j.create("div","mapboxgl-ctrl-"+U,M)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},f.prototype._resizeCanvas=function(d,E){var A=m.browser.devicePixelRatio||1;this._canvas.width=A*d,this._canvas.height=A*E,this._canvas.style.width=d+"px",this._canvas.style.height=E+"px"},f.prototype._setupPainter=function(){var d=m.extend({},ve.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),E=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);E?(this.painter=new qa(E,this.transform),m.webpSupported.testSupport(E)):this.fire(new m.ErrorEvent(new Error("Failed to initialize WebGL")))},f.prototype._contextLost=function(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new m.Event("webglcontextlost",{originalEvent:d}))},f.prototype._contextRestored=function(d){this._setupPainter(),this.resize(),this._update(),this.fire(new m.Event("webglcontextrestored",{originalEvent:d}))},f.prototype._onMapScroll=function(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},f.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},f.prototype._update=function(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this},f.prototype._requestRenderFrame=function(d){return this._update(),this._renderTaskQueue.add(d)},f.prototype._cancelRenderFrame=function(d){this._renderTaskQueue.remove(d)},f.prototype._render=function(d){var E,A=this,M=0,L=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(E=L.createQueryEXT(),L.beginQueryEXT(L.TIME_ELAPSED_EXT,E),M=m.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),!this._removed){var U=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var X=this.transform.zoom,oe=m.browser.now();this.style.zoomHistory.update(X,oe);var fe=new m.EvaluationParameters(X,{now:oe,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),pe=fe.crossFadingFactor();pe===1&&pe===this._crossFadingFactor||(U=!0,this._crossFadingFactor=pe),this.style.update(fe)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new m.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new m.Event("load"))),this.style&&(this.style.hasTransitions()||U)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Re=m.browser.now()-M;L.endQueryEXT(L.TIME_ELAPSED_EXT,E),setTimeout(function(){var be=L.getQueryObjectEXT(E,L.QUERY_RESULT_EXT)/1e6;L.deleteQueryEXT(E),A.fire(new m.Event("gpu-timing-frame",{cpuTime:Re,gpuTime:be}))},50)}if(this.listens("gpu-timing-layer")){var Pe=this.painter.collectGpuTimers();setTimeout(function(){var be=A.painter.queryGpuTimers(Pe);A.fire(new m.Event("gpu-timing-layer",{layerTimes:be}))},50)}var He=this._sourcesDirty||this._styleDirty||this._placementDirty;return He||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new m.Event("idle")),!this._loaded||this._fullyLoaded||He||(this._fullyLoaded=!0),this}},f.prototype.remove=function(){this._hash&&this._hash.remove();for(var d=0,E=this._controls;d<E.length;d+=1)E[d].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),m.window!==void 0&&(m.window.removeEventListener("resize",this._onWindowResize,!1),m.window.removeEventListener("orientationchange",this._onWindowResize,!1),m.window.removeEventListener("online",this._onWindowOnline,!1));var A=this.painter.context.gl.getExtension("WEBGL_lose_context");A&&A.loseContext(),Ll(this._canvasContainer),Ll(this._controlContainer),Ll(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new m.Event("remove"))},f.prototype.triggerRepaint=function(){var d=this;this.style&&!this._frame&&(this._frame=m.browser.frame(function(E){d._frame=null,d._render(E)}))},f.prototype._onWindowOnline=function(){this._update()},f.prototype._onWindowResize=function(d){this._trackResize&&this.resize({originalEvent:d})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(d){this._showPadding!==d&&(this._showPadding=d,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(d){this._vertices=d,this._update()},f.prototype._setCacheLimits=function(d,E){m.setCacheLimits(d,E)},c.version.get=function(){return m.version},Object.defineProperties(f.prototype,c),f}(nc);function Ll(l){l.parentNode&&l.parentNode.removeChild(l)}var Su={showCompass:!0,showZoom:!0,visualizePitch:!1},ru=function(l){var f=this;this.options=m.extend({},Su,l),this._container=j.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(m.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return f._map.zoomIn({},{originalEvent:c})}),j.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return f._map.zoomOut({},{originalEvent:c})}),j.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(m.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){f.options.visualizePitch?f._map.resetNorthPitch({},{originalEvent:c}):f._map.resetNorth({},{originalEvent:c})}),this._compassIcon=j.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};ru.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),f=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},ru.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},ru.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new No(this._map,this._compass,this.options.visualizePitch)),this._container},ru.prototype.onRemove=function(){j.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},ru.prototype._createButton=function(l,f){var c=j.create("button",l,this._container);return c.type="button",c.addEventListener("click",f),c},ru.prototype._setButtonTitle=function(l,f){var c=this._map._getUIString("NavigationControl."+f);l.title=c,l.setAttribute("aria-label",c)};var No=function(l,f,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=f,this.mouseRotate=new Uf({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new Du({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),m.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),j.addEventListener(f,"mousedown",this.mousedown),j.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),j.addEventListener(f,"touchmove",this.touchmove),j.addEventListener(f,"touchend",this.touchend),j.addEventListener(f,"touchcancel",this.reset)};function gl(l,f,c){if(l=new m.LngLat(l.lng,l.lat),f){var d=new m.LngLat(l.lng-360,l.lat),E=new m.LngLat(l.lng+360,l.lat),A=c.locationPoint(l).distSqr(f);c.locationPoint(d).distSqr(f)<A?l=d:c.locationPoint(E).distSqr(f)<A&&(l=E)}for(;Math.abs(l.lng-c.center.lng)>180;){var M=c.locationPoint(l);if(M.x>=0&&M.y>=0&&M.x<=c.width&&M.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}No.prototype.down=function(l,f){this.mouseRotate.mousedown(l,f),this.mousePitch&&this.mousePitch.mousedown(l,f),j.disableDrag()},No.prototype.move=function(l,f){var c=this.map,d=this.mouseRotate.mousemoveWindow(l,f);if(d&&d.bearingDelta&&c.setBearing(c.getBearing()+d.bearingDelta),this.mousePitch){var E=this.mousePitch.mousemoveWindow(l,f);E&&E.pitchDelta&&c.setPitch(c.getPitch()+E.pitchDelta)}},No.prototype.off=function(){var l=this.element;j.removeEventListener(l,"mousedown",this.mousedown),j.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),j.removeEventListener(l,"touchmove",this.touchmove),j.removeEventListener(l,"touchend",this.touchend),j.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},No.prototype.offTemp=function(){j.enableDrag(),j.removeEventListener(m.window,"mousemove",this.mousemove),j.removeEventListener(m.window,"mouseup",this.mouseup)},No.prototype.mousedown=function(l){this.down(m.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),j.mousePos(this.element,l)),j.addEventListener(m.window,"mousemove",this.mousemove),j.addEventListener(m.window,"mouseup",this.mouseup)},No.prototype.mousemove=function(l){this.move(l,j.mousePos(this.element,l))},No.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},No.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=j.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},No.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=j.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},No.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},No.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Cu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function vf(l,f,c){var d=l.classList;for(var E in Cu)d.remove("mapboxgl-"+c+"-anchor-"+E);d.add("mapboxgl-"+c+"-anchor-"+f)}var kl,Dl=function(l){function f(c,d){if(l.call(this),(c instanceof m.window.HTMLElement||d)&&(c=m.extend({element:c},d)),m.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=m.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=j.create("div"),this._element.setAttribute("aria-label","Map marker");var E=j.createNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","41px"),E.setAttributeNS(null,"width","27px"),E.setAttributeNS(null,"viewBox","0 0 27 41");var A=j.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"stroke","none"),A.setAttributeNS(null,"stroke-width","1"),A.setAttributeNS(null,"fill","none"),A.setAttributeNS(null,"fill-rule","evenodd");var M=j.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill-rule","nonzero");var L=j.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");for(var U=0,X=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];U<X.length;U+=1){var oe=X[U],fe=j.createNS("http://www.w3.org/2000/svg","ellipse");fe.setAttributeNS(null,"opacity","0.04"),fe.setAttributeNS(null,"cx","10.5"),fe.setAttributeNS(null,"cy","5.80029008"),fe.setAttributeNS(null,"rx",oe.rx),fe.setAttributeNS(null,"ry",oe.ry),L.appendChild(fe)}var pe=j.createNS("http://www.w3.org/2000/svg","g");pe.setAttributeNS(null,"fill",this._color);var Re=j.createNS("http://www.w3.org/2000/svg","path");Re.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),pe.appendChild(Re);var Pe=j.createNS("http://www.w3.org/2000/svg","g");Pe.setAttributeNS(null,"opacity","0.25"),Pe.setAttributeNS(null,"fill","#000000");var He=j.createNS("http://www.w3.org/2000/svg","path");He.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Pe.appendChild(He);var be=j.createNS("http://www.w3.org/2000/svg","g");be.setAttributeNS(null,"transform","translate(6.0, 7.0)"),be.setAttributeNS(null,"fill","#FFFFFF");var je=j.createNS("http://www.w3.org/2000/svg","g");je.setAttributeNS(null,"transform","translate(8.0, 8.0)");var et=j.createNS("http://www.w3.org/2000/svg","circle");et.setAttributeNS(null,"fill","#000000"),et.setAttributeNS(null,"opacity","0.25"),et.setAttributeNS(null,"cx","5.5"),et.setAttributeNS(null,"cy","5.5"),et.setAttributeNS(null,"r","5.4999962");var yt=j.createNS("http://www.w3.org/2000/svg","circle");yt.setAttributeNS(null,"fill","#FFFFFF"),yt.setAttributeNS(null,"cx","5.5"),yt.setAttributeNS(null,"cy","5.5"),yt.setAttributeNS(null,"r","5.4999962"),je.appendChild(et),je.appendChild(yt),M.appendChild(L),M.appendChild(pe),M.appendChild(Pe),M.appendChild(be),M.appendChild(je),E.appendChild(M),E.setAttributeNS(null,"height",41*this._scale+"px"),E.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(E),this._offset=m.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Ht){Ht.preventDefault()}),this._element.addEventListener("mousedown",function(Ht){Ht.preventDefault()}),vf(this._element,this._anchor,"marker"),this._popup=null}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},f.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),j.remove(this._element),this._popup&&this._popup.remove(),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},f.prototype.getElement=function(){return this._element},f.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var d=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},f.prototype._onKeyPress=function(c){var d=c.code,E=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&E!==32&&E!==13||this.togglePopup()},f.prototype._onMapClick=function(c){var d=c.originalEvent.target,E=this._element;this._popup&&(d===E||E.contains(d))&&this.togglePopup()},f.prototype.getPopup=function(){return this._popup},f.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},f.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=gl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(d="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),j.setTransform(this._element,Cu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+E+" "+d)}},f.prototype.getOffset=function(){return this._offset},f.prototype.setOffset=function(c){return this._offset=m.Point.convert(c),this._update(),this},f.prototype._onMove=function(c){if(!this._isDragging){var d=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new m.Event("dragstart"))),this.fire(new m.Event("drag")))},f.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new m.Event("dragend")),this._state="inactive"},f.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},f.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},f.prototype.isDraggable=function(){return this._draggable},f.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},f.prototype.getRotation=function(){return this._rotation},f.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},f.prototype.getRotationAlignment=function(){return this._rotationAlignment},f.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},f.prototype.getPitchAlignment=function(){return this._pitchAlignment},f}(m.Evented),Fl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},ic=0,yl=!1,wp=function(l){function f(c){l.call(this),this.options=m.extend({},Fl,c),m.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){var d;return this._map=c,this._container=j.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),d=this._setupUI,kl!==void 0?d(kl):m.window.navigator.permissions!==void 0?m.window.navigator.permissions.query({name:"geolocation"}).then(function(E){d(kl=E.state!=="denied")}):d(kl=!!m.window.navigator.geolocation),this._container},f.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),j.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ic=0,yl=!1},f.prototype._isOutOfMapMaxBounds=function(c){var d=this._map.getMaxBounds(),E=c.coords;return d&&(E.longitude<d.getWest()||E.longitude>d.getEast()||E.latitude<d.getSouth()||E.latitude>d.getNorth())},f.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},f.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new m.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("geolocate",c)),this._finish()}},f.prototype._updateCamera=function(c){var d=new m.LngLat(c.coords.longitude,c.coords.latitude),E=c.coords.accuracy,A=this._map.getBearing(),M=m.extend({bearing:A},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds(E),M,{geolocateSource:!0})},f.prototype._updateMarker=function(c){if(c){var d=new m.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},f.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,d=this._map.unproject([0,c]),E=this._map.unproject([1,c]),A=d.distanceTo(E),M=Math.ceil(2*this._accuracy/A);this._circleElement.style.width=M+"px",this._circleElement.style.height=M+"px"},f.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},f.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&yl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("error",c)),this._finish()}},f.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},f.prototype._setupUI=function(c){var d=this;if(this._container.addEventListener("contextmenu",function(M){return M.preventDefault()}),this._geolocateButton=j.create("button","mapboxgl-ctrl-geolocate",this._container),j.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){m.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var E=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=E,this._geolocateButton.setAttribute("aria-label",E)}else{var A=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=A,this._geolocateButton.setAttribute("aria-label",A)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=j.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Dl(this._dotElement),this._circleElement=j.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Dl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(M){M.geolocateSource||d._watchState!=="ACTIVE_LOCK"||M.originalEvent&&M.originalEvent.type==="resize"||(d._watchState="BACKGROUND",d._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),d._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),d.fire(new m.Event("trackuserlocationend")))})},f.prototype.trigger=function(){if(!this._setup)return m.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new m.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ic--,yl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new m.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new m.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++ic>1?(c={maximumAge:6e5,timeout:0},yl=!0):(c=this.options.positionOptions,yl=!1),this._geolocationWatchID=m.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else m.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},f.prototype._clearWatch=function(){m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},f}(m.Evented),ol={maxWidth:100,unit:"metric"},Bu=function(l){this.options=m.extend({},ol,l),m.bindAll(["_onMove","setUnit"],this)};function jf(l,f,c){var d=c&&c.maxWidth||100,E=l._container.clientHeight/2,A=l.unproject([0,E]),M=l.unproject([d,E]),L=A.distanceTo(M);if(c&&c.unit==="imperial"){var U=3.2808*L;U>5280?_l(f,d,U/5280,l._getUIString("ScaleControl.Miles")):_l(f,d,U,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?_l(f,d,L/1852,l._getUIString("ScaleControl.NauticalMiles")):L>=1e3?_l(f,d,L/1e3,l._getUIString("ScaleControl.Kilometers")):_l(f,d,L,l._getUIString("ScaleControl.Meters"))}function _l(l,f,c,d){var E,A,M,L=(E=c,(A=Math.pow(10,(""+Math.floor(E)).length-1))*(M=(M=E/A)>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(U){var X=Math.pow(10,Math.ceil(-Math.log(U)/Math.LN10));return Math.round(U*X)/X}(M)));l.style.width=f*(L/c)+"px",l.innerHTML=L+"&nbsp;"+d}Bu.prototype.getDefaultPosition=function(){return"bottom-left"},Bu.prototype._onMove=function(){jf(this._map,this._container,this.options)},Bu.prototype.onAdd=function(l){return this._map=l,this._container=j.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Bu.prototype.onRemove=function(){j.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Bu.prototype.setUnit=function(l){this.options.unit=l,jf(this._map,this._container,this.options)};var nu=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof m.window.HTMLElement?this._container=l.container:m.warnOnce("Full screen control 'container' must be a DOM element.")),m.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in m.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in m.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in m.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in m.window.document&&(this._fullscreenchange="MSFullscreenChange")};nu.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=j.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",m.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},nu.prototype.onRemove=function(){j.remove(this._controlContainer),this._map=null,m.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},nu.prototype._checkFullscreenSupport=function(){return!!(m.window.document.fullscreenEnabled||m.window.document.mozFullScreenEnabled||m.window.document.msFullscreenEnabled||m.window.document.webkitFullscreenEnabled)},nu.prototype._setupUI=function(){var l=this._fullscreenButton=j.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);j.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),m.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},nu.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},nu.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},nu.prototype._isFullscreen=function(){return this._fullscreen},nu.prototype._changeIcon=function(){(m.window.document.fullscreenElement||m.window.document.mozFullScreenElement||m.window.document.webkitFullscreenElement||m.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},nu.prototype._onClickFullscreen=function(){this._isFullscreen()?m.window.document.exitFullscreen?m.window.document.exitFullscreen():m.window.document.mozCancelFullScreen?m.window.document.mozCancelFullScreen():m.window.document.msExitFullscreen?m.window.document.msExitFullscreen():m.window.document.webkitCancelFullScreen&&m.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var mf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Gs=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Tp=function(l){function f(c){l.call(this),this.options=m.extend(Object.create(mf),c),m.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new m.Event("open")),this},f.prototype.isOpen=function(){return!!this._map},f.prototype.remove=function(){return this._content&&j.remove(this._content),this._container&&(j.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new m.Event("close")),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},f.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},f.prototype.getElement=function(){return this._container},f.prototype.setText=function(c){return this.setDOMContent(m.window.document.createTextNode(c))},f.prototype.setHTML=function(c){var d,E=m.window.document.createDocumentFragment(),A=m.window.document.createElement("body");for(A.innerHTML=c;d=A.firstChild;)E.appendChild(d);return this.setDOMContent(E)},f.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},f.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},f.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=j.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},f.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},f.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},f.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},f.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},f.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=j.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},f.prototype._onMouseUp=function(c){this._update(c.point)},f.prototype._onMouseMove=function(c){this._update(c.point)},f.prototype._onDrag=function(c){this._update(c.point)},f.prototype._update=function(c){var d=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=j.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=j.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(fe){return d._container.classList.add(fe)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=gl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var E=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),A=this.options.anchor,M=function fe(pe){if(pe){if(typeof pe=="number"){var Re=Math.round(Math.sqrt(.5*Math.pow(pe,2)));return{center:new m.Point(0,0),top:new m.Point(0,pe),"top-left":new m.Point(Re,Re),"top-right":new m.Point(-Re,Re),bottom:new m.Point(0,-pe),"bottom-left":new m.Point(Re,-Re),"bottom-right":new m.Point(-Re,-Re),left:new m.Point(pe,0),right:new m.Point(-pe,0)}}if(pe instanceof m.Point||Array.isArray(pe)){var Pe=m.Point.convert(pe);return{center:Pe,top:Pe,"top-left":Pe,"top-right":Pe,bottom:Pe,"bottom-left":Pe,"bottom-right":Pe,left:Pe,right:Pe}}return{center:m.Point.convert(pe.center||[0,0]),top:m.Point.convert(pe.top||[0,0]),"top-left":m.Point.convert(pe["top-left"]||[0,0]),"top-right":m.Point.convert(pe["top-right"]||[0,0]),bottom:m.Point.convert(pe.bottom||[0,0]),"bottom-left":m.Point.convert(pe["bottom-left"]||[0,0]),"bottom-right":m.Point.convert(pe["bottom-right"]||[0,0]),left:m.Point.convert(pe.left||[0,0]),right:m.Point.convert(pe.right||[0,0])}}return fe(new m.Point(0,0))}(this.options.offset);if(!A){var L,U=this._container.offsetWidth,X=this._container.offsetHeight;L=E.y+M.bottom.y<X?["top"]:E.y>this._map.transform.height-X?["bottom"]:[],E.x<U/2?L.push("left"):E.x>this._map.transform.width-U/2&&L.push("right"),A=L.length===0?"bottom":L.join("-")}var oe=E.add(M[A]).round();j.setTransform(this._container,Cu[A]+" translate("+oe.x+"px,"+oe.y+"px)"),vf(this._container,A,"popup")}},f.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(Gs);c&&c.focus()}},f.prototype._onClose=function(){this.remove()},f}(m.Evented),ac={version:m.version,supported:ve,setRTLTextPlugin:m.setRTLTextPlugin,getRTLTextPluginStatus:m.getRTLTextPluginStatus,Map:Fc,NavigationControl:ru,GeolocateControl:wp,AttributionControl:xs,ScaleControl:Bu,FullscreenControl:nu,Popup:Tp,Marker:Dl,Style:ys,LngLat:m.LngLat,LngLatBounds:m.LngLatBounds,Point:m.Point,MercatorCoordinate:m.MercatorCoordinate,Evented:m.Evented,config:m.config,prewarm:function(){Pt().acquire(Bt)},clearPrewarmedResources:function(){var l=En;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Bt),En=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return m.config.ACCESS_TOKEN},set accessToken(l){m.config.ACCESS_TOKEN=l},get baseApiUrl(){return m.config.API_URL},set baseApiUrl(l){m.config.API_URL=l},get workerCount(){return yr.workerCount},set workerCount(l){yr.workerCount=l},get maxParallelImageRequests(){return m.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){m.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){m.clearTileCache(l)},workerUrl:""};return ac}),ue})},28660:function(Mt,J,N){var ue=N(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var ye;(function(m){(function(ve){var j=typeof N.g=="object"?N.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),le=se(m);typeof j.Reflect=="undefined"?j.Reflect=m:le=se(j.Reflect,le),ve(le);function se(Ne,ae){return function(tt,Le){typeof Ne[tt]!="function"&&Object.defineProperty(Ne,tt,{configurable:!0,writable:!0,value:Le}),ae&&ae(tt,Le)}}})(function(ve){var j=Object.prototype.hasOwnProperty,le=typeof Symbol=="function",se=le&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Ne=le&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",ae=typeof Object.create=="function",tt={__proto__:[]}instanceof Array,Le=!ae&&!tt,it={create:ae?function(){return vs(Object.create(null))}:tt?function(){return vs({__proto__:null})}:function(){return vs({})},has:Le?function(jt,or){return j.call(jt,or)}:function(jt,or){return or in jt},get:Le?function(jt,or){return j.call(jt,or)?jt[or]:void 0}:function(jt,or){return jt[or]}},Vt=Object.getPrototypeOf(Function),sr=typeof ue=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",At=!sr&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:de(),er=!sr&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Fn(),It=!sr&&typeof WeakMap=="function"?WeakMap:Xa(),lt=new It;function dt(jt,or,Mr,I){if(hn(Mr)){if(!Ai(jt))throw new TypeError;if(!sa(or))throw new TypeError;return Br(jt,or)}else{if(!Ai(jt))throw new TypeError;if(!Wn(or))throw new TypeError;if(!Wn(I)&&!hn(I)&&!Ki(I))throw new TypeError;return Ki(I)&&(I=void 0),Mr=ki(Mr),Jr(jt,or,Mr,I)}}ve("decorate",dt);function tr(jt,or){function Mr(I,ar){if(!Wn(I))throw new TypeError;if(!hn(ar)&&!wi(ar))throw new TypeError;zt(jt,or,I,ar)}return Mr}ve("metadata",tr);function Y(jt,or,Mr,I){if(!Wn(Mr))throw new TypeError;return hn(I)||(I=ki(I)),zt(jt,or,Mr,I)}ve("defineMetadata",Y);function $t(jt,or,Mr){if(!Wn(or))throw new TypeError;return hn(Mr)||(Mr=ki(Mr)),Xe(jt,or,Mr)}ve("hasMetadata",$t);function gt(jt,or,Mr){if(!Wn(or))throw new TypeError;return hn(Mr)||(Mr=ki(Mr)),ke(jt,or,Mr)}ve("hasOwnMetadata",gt);function Je(jt,or,Mr){if(!Wn(or))throw new TypeError;return hn(Mr)||(Mr=ki(Mr)),St(jt,or,Mr)}ve("getMetadata",Je);function xt(jt,or,Mr){if(!Wn(or))throw new TypeError;return hn(Mr)||(Mr=ki(Mr)),vt(jt,or,Mr)}ve("getOwnMetadata",xt);function Qe(jt,or){if(!Wn(jt))throw new TypeError;return hn(or)||(or=ki(or)),Yt(jt,or)}ve("getMetadataKeys",Qe);function Kt(jt,or){if(!Wn(jt))throw new TypeError;return hn(or)||(or=ki(or)),Cr(jt,or)}ve("getOwnMetadataKeys",Kt);function Sr(jt,or,Mr){if(!Wn(or))throw new TypeError;hn(Mr)||(Mr=ki(Mr));var I=Te(or,Mr,!1);if(hn(I)||!I.delete(jt))return!1;if(I.size>0)return!0;var ar=lt.get(or);return ar.delete(Mr),ar.size>0||lt.delete(or),!0}ve("deleteMetadata",Sr);function Br(jt,or){for(var Mr=jt.length-1;Mr>=0;--Mr){var I=jt[Mr],ar=I(or);if(!hn(ar)&&!Ki(ar)){if(!sa(ar))throw new TypeError;or=ar}}return or}function Jr(jt,or,Mr,I){for(var ar=jt.length-1;ar>=0;--ar){var kn=jt[ar],li=kn(or,Mr,I);if(!hn(li)&&!Ki(li)){if(!Wn(li))throw new TypeError;I=li}}return I}function Te(jt,or,Mr){var I=lt.get(jt);if(hn(I)){if(!Mr)return;I=new At,lt.set(jt,I)}var ar=I.get(or);if(hn(ar)){if(!Mr)return;ar=new At,I.set(or,ar)}return ar}function Xe(jt,or,Mr){var I=ke(jt,or,Mr);if(I)return!0;var ar=Wa(or);return Ki(ar)?!1:Xe(jt,ar,Mr)}function ke(jt,or,Mr){var I=Te(or,Mr,!1);return hn(I)?!1:ui(I.has(jt))}function St(jt,or,Mr){var I=ke(jt,or,Mr);if(I)return vt(jt,or,Mr);var ar=Wa(or);if(!Ki(ar))return St(jt,ar,Mr)}function vt(jt,or,Mr){var I=Te(or,Mr,!1);if(!hn(I))return I.get(jt)}function zt(jt,or,Mr,I){var ar=Te(Mr,I,!0);ar.set(jt,or)}function Yt(jt,or){var Mr=Cr(jt,or),I=Wa(jt);if(I===null)return Mr;var ar=Yt(I,or);if(ar.length<=0)return Mr;if(Mr.length<=0)return ar;for(var kn=new er,li=[],jn=0,an=Mr;jn<an.length;jn++){var Pi=an[jn],Ii=kn.has(Pi);Ii||(kn.add(Pi),li.push(Pi))}for(var Ja=0,ms=ar;Ja<ms.length;Ja++){var Pi=ms[Ja],Ii=kn.has(Pi);Ii||(kn.add(Pi),li.push(Pi))}return li}function Cr(jt,or){var Mr=[],I=Te(jt,or,!1);if(hn(I))return Mr;for(var ar=I.keys(),kn=Mn(ar),li=0;;){var jn=Zi(kn);if(!jn)return Mr.length=li,Mr;var an=Ei(jn);try{Mr[li]=an}catch(Pi){try{$i(kn)}finally{throw Pi}}li++}}function Yn(jt){if(jt===null)return 1;switch(typeof jt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return jt===null?1:6;default:return 6}}function hn(jt){return jt===void 0}function Ki(jt){return jt===null}function Zn(jt){return typeof jt=="symbol"}function Wn(jt){return typeof jt=="object"?jt!==null:typeof jt=="function"}function mi(jt,or){switch(Yn(jt)){case 0:return jt;case 1:return jt;case 2:return jt;case 3:return jt;case 4:return jt;case 5:return jt}var Mr=or===3?"string":or===5?"number":"default",I=Ca(jt,se);if(I!==void 0){var ar=I.call(jt,Mr);if(Wn(ar))throw new TypeError;return ar}return qn(jt,Mr==="default"?"number":Mr)}function qn(jt,or){if(or==="string"){var Mr=jt.toString;if(Vi(Mr)){var I=Mr.call(jt);if(!Wn(I))return I}var ar=jt.valueOf;if(Vi(ar)){var I=ar.call(jt);if(!Wn(I))return I}}else{var ar=jt.valueOf;if(Vi(ar)){var I=ar.call(jt);if(!Wn(I))return I}var kn=jt.toString;if(Vi(kn)){var I=kn.call(jt);if(!Wn(I))return I}}throw new TypeError}function ui(jt){return!!jt}function ia(jt){return""+jt}function ki(jt){var or=mi(jt,3);return Zn(or)?or:ia(or)}function Ai(jt){return Array.isArray?Array.isArray(jt):jt instanceof Object?jt instanceof Array:Object.prototype.toString.call(jt)==="[object Array]"}function Vi(jt){return typeof jt=="function"}function sa(jt){return typeof jt=="function"}function wi(jt){switch(Yn(jt)){case 3:return!0;case 4:return!0;default:return!1}}function Ca(jt,or){var Mr=jt[or];if(Mr!=null){if(!Vi(Mr))throw new TypeError;return Mr}}function Mn(jt){var or=Ca(jt,Ne);if(!Vi(or))throw new TypeError;var Mr=or.call(jt);if(!Wn(Mr))throw new TypeError;return Mr}function Ei(jt){return jt.value}function Zi(jt){var or=jt.next();return or.done?!1:or}function $i(jt){var or=jt.return;or&&or.call(jt)}function Wa(jt){var or=Object.getPrototypeOf(jt);if(typeof jt!="function"||jt===Vt||or!==Vt)return or;var Mr=jt.prototype,I=Mr&&Object.getPrototypeOf(Mr);if(I==null||I===Object.prototype)return or;var ar=I.constructor;return typeof ar!="function"||ar===jt?or:ar}function de(){var jt={},or=[],Mr=function(){function li(jn,an,Pi){this._index=0,this._keys=jn,this._values=an,this._selector=Pi}return li.prototype["@@iterator"]=function(){return this},li.prototype[Ne]=function(){return this},li.prototype.next=function(){var jn=this._index;if(jn>=0&&jn<this._keys.length){var an=this._selector(this._keys[jn],this._values[jn]);return jn+1>=this._keys.length?(this._index=-1,this._keys=or,this._values=or):this._index++,{value:an,done:!1}}return{value:void 0,done:!0}},li.prototype.throw=function(jn){throw this._index>=0&&(this._index=-1,this._keys=or,this._values=or),jn},li.prototype.return=function(jn){return this._index>=0&&(this._index=-1,this._keys=or,this._values=or),{value:jn,done:!0}},li}();return function(){function li(){this._keys=[],this._values=[],this._cacheKey=jt,this._cacheIndex=-2}return Object.defineProperty(li.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),li.prototype.has=function(jn){return this._find(jn,!1)>=0},li.prototype.get=function(jn){var an=this._find(jn,!1);return an>=0?this._values[an]:void 0},li.prototype.set=function(jn,an){var Pi=this._find(jn,!0);return this._values[Pi]=an,this},li.prototype.delete=function(jn){var an=this._find(jn,!1);if(an>=0){for(var Pi=this._keys.length,Ii=an+1;Ii<Pi;Ii++)this._keys[Ii-1]=this._keys[Ii],this._values[Ii-1]=this._values[Ii];return this._keys.length--,this._values.length--,jn===this._cacheKey&&(this._cacheKey=jt,this._cacheIndex=-2),!0}return!1},li.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=jt,this._cacheIndex=-2},li.prototype.keys=function(){return new Mr(this._keys,this._values,I)},li.prototype.values=function(){return new Mr(this._keys,this._values,ar)},li.prototype.entries=function(){return new Mr(this._keys,this._values,kn)},li.prototype["@@iterator"]=function(){return this.entries()},li.prototype[Ne]=function(){return this.entries()},li.prototype._find=function(jn,an){return this._cacheKey!==jn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=jn)),this._cacheIndex<0&&an&&(this._cacheIndex=this._keys.length,this._keys.push(jn),this._values.push(void 0)),this._cacheIndex},li}();function I(li,jn){return li}function ar(li,jn){return jn}function kn(li,jn){return[li,jn]}}function Fn(){return function(){function jt(){this._map=new At}return Object.defineProperty(jt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),jt.prototype.has=function(or){return this._map.has(or)},jt.prototype.add=function(or){return this._map.set(or,or),this},jt.prototype.delete=function(or){return this._map.delete(or)},jt.prototype.clear=function(){this._map.clear()},jt.prototype.keys=function(){return this._map.keys()},jt.prototype.values=function(){return this._map.values()},jt.prototype.entries=function(){return this._map.entries()},jt.prototype["@@iterator"]=function(){return this.keys()},jt.prototype[Ne]=function(){return this.keys()},jt}()}function Xa(){var jt=16,or=it.create(),Mr=I();return function(){function an(){this._key=I()}return an.prototype.has=function(Pi){var Ii=ar(Pi,!1);return Ii!==void 0?it.has(Ii,this._key):!1},an.prototype.get=function(Pi){var Ii=ar(Pi,!1);return Ii!==void 0?it.get(Ii,this._key):void 0},an.prototype.set=function(Pi,Ii){var Ja=ar(Pi,!0);return Ja[this._key]=Ii,this},an.prototype.delete=function(Pi){var Ii=ar(Pi,!1);return Ii!==void 0?delete Ii[this._key]:!1},an.prototype.clear=function(){this._key=I()},an}();function I(){var an;do an="@@WeakMap@@"+jn();while(it.has(or,an));return or[an]=!0,an}function ar(an,Pi){if(!j.call(an,Mr)){if(!Pi)return;Object.defineProperty(an,Mr,{value:it.create()})}return an[Mr]}function kn(an,Pi){for(var Ii=0;Ii<Pi;++Ii)an[Ii]=Math.random()*255|0;return an}function li(an){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(an)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(an)):kn(new Uint8Array(an),an):kn(new Array(an),an)}function jn(){var an=li(jt);an[6]=an[6]&79|64,an[8]=an[8]&191|128;for(var Pi="",Ii=0;Ii<jt;++Ii){var Ja=an[Ii];(Ii===4||Ii===6||Ii===8)&&(Pi+="-"),Ja<16&&(Pi+="0"),Pi+=Ja.toString(16).toLowerCase()}return Pi}}function vs(jt){return jt.__=void 0,delete jt.__,jt}})})(ye||(ye={}))},69848:function(Mt){(function(J,N){Mt.exports=N()})(this,function(){"use strict";function J(gt,Je,xt,Qe,Kt,Sr){if(!(Kt-Qe<=xt)){var Br=Qe+Kt>>1;N(gt,Je,Br,Qe,Kt,Sr%2),J(gt,Je,xt,Qe,Br-1,Sr+1),J(gt,Je,xt,Br+1,Kt,Sr+1)}}function N(gt,Je,xt,Qe,Kt,Sr){for(;Kt>Qe;){if(Kt-Qe>600){var Br=Kt-Qe+1,Jr=xt-Qe+1,Te=Math.log(Br),Xe=.5*Math.exp(2*Te/3),ke=.5*Math.sqrt(Te*Xe*(Br-Xe)/Br)*(Jr-Br/2<0?-1:1),St=Math.max(Qe,Math.floor(xt-Jr*Xe/Br+ke)),vt=Math.min(Kt,Math.floor(xt+(Br-Jr)*Xe/Br+ke));N(gt,Je,xt,St,vt,Sr)}var zt=Je[2*xt+Sr],Yt=Qe,Cr=Kt;for(ue(gt,Je,Qe,xt),Je[2*Kt+Sr]>zt&&ue(gt,Je,Qe,Kt);Yt<Cr;){for(ue(gt,Je,Yt,Cr),Yt++,Cr--;Je[2*Yt+Sr]<zt;)Yt++;for(;Je[2*Cr+Sr]>zt;)Cr--}Je[2*Qe+Sr]===zt?ue(gt,Je,Qe,Cr):(Cr++,ue(gt,Je,Cr,Kt)),Cr<=xt&&(Qe=Cr+1),xt<=Cr&&(Kt=Cr-1)}}function ue(gt,Je,xt,Qe){ye(gt,xt,Qe),ye(Je,2*xt,2*Qe),ye(Je,2*xt+1,2*Qe+1)}function ye(gt,Je,xt){var Qe=gt[Je];gt[Je]=gt[xt],gt[xt]=Qe}function m(gt,Je,xt,Qe,Kt,Sr,Br){for(var Jr=[0,gt.length-1,0],Te=[],Xe,ke;Jr.length;){var St=Jr.pop(),vt=Jr.pop(),zt=Jr.pop();if(vt-zt<=Br){for(var Yt=zt;Yt<=vt;Yt++)Xe=Je[2*Yt],ke=Je[2*Yt+1],Xe>=xt&&Xe<=Kt&&ke>=Qe&&ke<=Sr&&Te.push(gt[Yt]);continue}var Cr=Math.floor((zt+vt)/2);Xe=Je[2*Cr],ke=Je[2*Cr+1],Xe>=xt&&Xe<=Kt&&ke>=Qe&&ke<=Sr&&Te.push(gt[Cr]);var Yn=(St+1)%2;(St===0?xt<=Xe:Qe<=ke)&&(Jr.push(zt),Jr.push(Cr-1),Jr.push(Yn)),(St===0?Kt>=Xe:Sr>=ke)&&(Jr.push(Cr+1),Jr.push(vt),Jr.push(Yn))}return Te}function ve(gt,Je,xt,Qe,Kt,Sr){for(var Br=[0,gt.length-1,0],Jr=[],Te=Kt*Kt;Br.length;){var Xe=Br.pop(),ke=Br.pop(),St=Br.pop();if(ke-St<=Sr){for(var vt=St;vt<=ke;vt++)j(Je[2*vt],Je[2*vt+1],xt,Qe)<=Te&&Jr.push(gt[vt]);continue}var zt=Math.floor((St+ke)/2),Yt=Je[2*zt],Cr=Je[2*zt+1];j(Yt,Cr,xt,Qe)<=Te&&Jr.push(gt[zt]);var Yn=(Xe+1)%2;(Xe===0?xt-Kt<=Yt:Qe-Kt<=Cr)&&(Br.push(St),Br.push(zt-1),Br.push(Yn)),(Xe===0?xt+Kt>=Yt:Qe+Kt>=Cr)&&(Br.push(zt+1),Br.push(ke),Br.push(Yn))}return Jr}function j(gt,Je,xt,Qe){var Kt=gt-xt,Sr=Je-Qe;return Kt*Kt+Sr*Sr}var le=function(gt){return gt[0]},se=function(gt){return gt[1]},Ne=function(Je,xt,Qe,Kt,Sr){xt===void 0&&(xt=le),Qe===void 0&&(Qe=se),Kt===void 0&&(Kt=64),Sr===void 0&&(Sr=Float64Array),this.nodeSize=Kt,this.points=Je;for(var Br=Je.length<65536?Uint16Array:Uint32Array,Jr=this.ids=new Br(Je.length),Te=this.coords=new Sr(Je.length*2),Xe=0;Xe<Je.length;Xe++)Jr[Xe]=Xe,Te[2*Xe]=xt(Je[Xe]),Te[2*Xe+1]=Qe(Je[Xe]);J(Jr,Te,Kt,0,Jr.length-1,0)};Ne.prototype.range=function(Je,xt,Qe,Kt){return m(this.ids,this.coords,Je,xt,Qe,Kt,this.nodeSize)},Ne.prototype.within=function(Je,xt,Qe){return ve(this.ids,this.coords,Je,xt,Qe,this.nodeSize)};var ae={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(gt){return gt}},tt=Math.fround||function(gt){return function(Je){return gt[0]=+Je,gt[0]}}(new Float32Array(1)),Le=function(Je){this.options=tr(Object.create(ae),Je),this.trees=new Array(this.options.maxZoom+1)};Le.prototype.load=function(Je){var xt=this.options,Qe=xt.log,Kt=xt.minZoom,Sr=xt.maxZoom,Br=xt.nodeSize;Qe&&console.time("total time");var Jr="prepare "+Je.length+" points";Qe&&console.time(Jr),this.points=Je;for(var Te=[],Xe=0;Xe<Je.length;Xe++)!Je[Xe].geometry||Te.push(Vt(Je[Xe],Xe));this.trees[Sr+1]=new Ne(Te,Y,$t,Br,Float32Array),Qe&&console.timeEnd(Jr);for(var ke=Sr;ke>=Kt;ke--){var St=+Date.now();Te=this._cluster(Te,ke),this.trees[ke]=new Ne(Te,Y,$t,Br,Float32Array),Qe&&console.log("z%d: %d clusters in %dms",ke,Te.length,+Date.now()-St)}return Qe&&console.timeEnd("total time"),this},Le.prototype.getClusters=function(Je,xt){var Qe=((Je[0]+180)%360+360)%360-180,Kt=Math.max(-90,Math.min(90,Je[1])),Sr=Je[2]===180?180:((Je[2]+180)%360+360)%360-180,Br=Math.max(-90,Math.min(90,Je[3]));if(Je[2]-Je[0]>=360)Qe=-180,Sr=180;else if(Qe>Sr){var Jr=this.getClusters([Qe,Kt,180,Br],xt),Te=this.getClusters([-180,Kt,Sr,Br],xt);return Jr.concat(Te)}for(var Xe=this.trees[this._limitZoom(xt)],ke=Xe.range(er(Qe),It(Br),er(Sr),It(Kt)),St=[],vt=0,zt=ke;vt<zt.length;vt+=1){var Yt=zt[vt],Cr=Xe.points[Yt];St.push(Cr.numPoints?sr(Cr):this.points[Cr.index])}return St},Le.prototype.getChildren=function(Je){var xt=this._getOriginId(Je),Qe=this._getOriginZoom(Je),Kt="No cluster with the specified id.",Sr=this.trees[Qe];if(!Sr)throw new Error(Kt);var Br=Sr.points[xt];if(!Br)throw new Error(Kt);for(var Jr=this.options.radius/(this.options.extent*Math.pow(2,Qe-1)),Te=Sr.within(Br.x,Br.y,Jr),Xe=[],ke=0,St=Te;ke<St.length;ke+=1){var vt=St[ke],zt=Sr.points[vt];zt.parentId===Je&&Xe.push(zt.numPoints?sr(zt):this.points[zt.index])}if(Xe.length===0)throw new Error(Kt);return Xe},Le.prototype.getLeaves=function(Je,xt,Qe){xt=xt||10,Qe=Qe||0;var Kt=[];return this._appendLeaves(Kt,Je,xt,Qe,0),Kt},Le.prototype.getTile=function(Je,xt,Qe){var Kt=this.trees[this._limitZoom(Je)],Sr=Math.pow(2,Je),Br=this.options,Jr=Br.extent,Te=Br.radius,Xe=Te/Jr,ke=(Qe-Xe)/Sr,St=(Qe+1+Xe)/Sr,vt={features:[]};return this._addTileFeatures(Kt.range((xt-Xe)/Sr,ke,(xt+1+Xe)/Sr,St),Kt.points,xt,Qe,Sr,vt),xt===0&&this._addTileFeatures(Kt.range(1-Xe/Sr,ke,1,St),Kt.points,Sr,Qe,Sr,vt),xt===Sr-1&&this._addTileFeatures(Kt.range(0,ke,Xe/Sr,St),Kt.points,-1,Qe,Sr,vt),vt.features.length?vt:null},Le.prototype.getClusterExpansionZoom=function(Je){for(var xt=this._getOriginZoom(Je)-1;xt<=this.options.maxZoom;){var Qe=this.getChildren(Je);if(xt++,Qe.length!==1)break;Je=Qe[0].properties.cluster_id}return xt},Le.prototype._appendLeaves=function(Je,xt,Qe,Kt,Sr){for(var Br=this.getChildren(xt),Jr=0,Te=Br;Jr<Te.length;Jr+=1){var Xe=Te[Jr],ke=Xe.properties;if(ke&&ke.cluster?Sr+ke.point_count<=Kt?Sr+=ke.point_count:Sr=this._appendLeaves(Je,ke.cluster_id,Qe,Kt,Sr):Sr<Kt?Sr++:Je.push(Xe),Je.length===Qe)break}return Sr},Le.prototype._addTileFeatures=function(Je,xt,Qe,Kt,Sr,Br){for(var Jr=0,Te=Je;Jr<Te.length;Jr+=1){var Xe=Te[Jr],ke=xt[Xe],St=ke.numPoints,vt=void 0,zt=void 0,Yt=void 0;if(St)vt=At(ke),zt=ke.x,Yt=ke.y;else{var Cr=this.points[ke.index];vt=Cr.properties,zt=er(Cr.geometry.coordinates[0]),Yt=It(Cr.geometry.coordinates[1])}var Yn={type:1,geometry:[[Math.round(this.options.extent*(zt*Sr-Qe)),Math.round(this.options.extent*(Yt*Sr-Kt))]],tags:vt},hn=void 0;St?hn=ke.id:this.options.generateId?hn=ke.index:this.points[ke.index].id&&(hn=this.points[ke.index].id),hn!==void 0&&(Yn.id=hn),Br.features.push(Yn)}},Le.prototype._limitZoom=function(Je){return Math.max(this.options.minZoom,Math.min(Math.floor(+Je),this.options.maxZoom+1))},Le.prototype._cluster=function(Je,xt){for(var Qe=[],Kt=this.options,Sr=Kt.radius,Br=Kt.extent,Jr=Kt.reduce,Te=Kt.minPoints,Xe=Sr/(Br*Math.pow(2,xt)),ke=0;ke<Je.length;ke++){var St=Je[ke];if(!(St.zoom<=xt)){St.zoom=xt;for(var vt=this.trees[xt+1],zt=vt.within(St.x,St.y,Xe),Yt=St.numPoints||1,Cr=Yt,Yn=0,hn=zt;Yn<hn.length;Yn+=1){var Ki=hn[Yn],Zn=vt.points[Ki];Zn.zoom>xt&&(Cr+=Zn.numPoints||1)}if(Cr>Yt&&Cr>=Te){for(var Wn=St.x*Yt,mi=St.y*Yt,qn=Jr&&Yt>1?this._map(St,!0):null,ui=(ke<<5)+(xt+1)+this.points.length,ia=0,ki=zt;ia<ki.length;ia+=1){var Ai=ki[ia],Vi=vt.points[Ai];if(!(Vi.zoom<=xt)){Vi.zoom=xt;var sa=Vi.numPoints||1;Wn+=Vi.x*sa,mi+=Vi.y*sa,Vi.parentId=ui,Jr&&(qn||(qn=this._map(St,!0)),Jr(qn,this._map(Vi)))}}St.parentId=ui,Qe.push(it(Wn/Cr,mi/Cr,ui,Cr,qn))}else if(Qe.push(St),Cr>1)for(var wi=0,Ca=zt;wi<Ca.length;wi+=1){var Mn=Ca[wi],Ei=vt.points[Mn];Ei.zoom<=xt||(Ei.zoom=xt,Qe.push(Ei))}}}return Qe},Le.prototype._getOriginId=function(Je){return Je-this.points.length>>5},Le.prototype._getOriginZoom=function(Je){return(Je-this.points.length)%32},Le.prototype._map=function(Je,xt){if(Je.numPoints)return xt?tr({},Je.properties):Je.properties;var Qe=this.points[Je.index].properties,Kt=this.options.map(Qe);return xt&&Kt===Qe?tr({},Kt):Kt};function it(gt,Je,xt,Qe,Kt){return{x:tt(gt),y:tt(Je),zoom:Infinity,id:xt,parentId:-1,numPoints:Qe,properties:Kt}}function Vt(gt,Je){var xt=gt.geometry.coordinates,Qe=xt[0],Kt=xt[1];return{x:tt(er(Qe)),y:tt(It(Kt)),zoom:Infinity,index:Je,parentId:-1}}function sr(gt){return{type:"Feature",id:gt.id,properties:At(gt),geometry:{type:"Point",coordinates:[lt(gt.x),dt(gt.y)]}}}function At(gt){var Je=gt.numPoints,xt=Je>=1e4?Math.round(Je/1e3)+"k":Je>=1e3?Math.round(Je/100)/10+"k":Je;return tr(tr({},gt.properties),{cluster:!0,cluster_id:gt.id,point_count:Je,point_count_abbreviated:xt})}function er(gt){return gt/360+.5}function It(gt){var Je=Math.sin(gt*Math.PI/180),xt=.5-.25*Math.log((1+Je)/(1-Je))/Math.PI;return xt<0?0:xt>1?1:xt}function lt(gt){return(gt-.5)*360}function dt(gt){var Je=(180-gt*360)*Math.PI/180;return 360*Math.atan(Math.exp(Je))/Math.PI-90}function tr(gt,Je){for(var xt in Je)gt[xt]=Je[xt];return gt}function Y(gt){return gt.x}function $t(gt){return gt.y}return Le})},75752:function(Mt){Mt.exports.RADIUS=6378137,Mt.exports.FLATTENING=1/298.257223563,Mt.exports.POLAR_RADIUS=63567523142e-4}}]);
